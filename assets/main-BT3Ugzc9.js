(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();function Qj(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $v={exports:{}},hu={},Fv={exports:{}},Fe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bl=Symbol.for("react.element"),Jj=Symbol.for("react.portal"),Yj=Symbol.for("react.fragment"),Xj=Symbol.for("react.strict_mode"),Zj=Symbol.for("react.profiler"),e2=Symbol.for("react.provider"),t2=Symbol.for("react.context"),s2=Symbol.for("react.forward_ref"),n2=Symbol.for("react.suspense"),r2=Symbol.for("react.memo"),i2=Symbol.for("react.lazy"),wx=Symbol.iterator;function a2(t){return t===null||typeof t!="object"?null:(t=wx&&t[wx]||t["@@iterator"],typeof t=="function"?t:null)}var Dv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Uv=Object.assign,Bv={};function to(t,e,s){this.props=t,this.context=e,this.refs=Bv,this.updater=s||Dv}to.prototype.isReactComponent={};to.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};to.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function zv(){}zv.prototype=to.prototype;function Ff(t,e,s){this.props=t,this.context=e,this.refs=Bv,this.updater=s||Dv}var Df=Ff.prototype=new zv;Df.constructor=Ff;Uv(Df,to.prototype);Df.isPureReactComponent=!0;var _x=Array.isArray,Hv=Object.prototype.hasOwnProperty,Uf={current:null},qv={key:!0,ref:!0,__self:!0,__source:!0};function Wv(t,e,s){var n,r={},a=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(a=""+e.key),e)Hv.call(e,n)&&!qv.hasOwnProperty(n)&&(r[n]=e[n]);var l=arguments.length-2;if(l===1)r.children=s;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];r.children=c}if(t&&t.defaultProps)for(n in l=t.defaultProps,l)r[n]===void 0&&(r[n]=l[n]);return{$$typeof:Bl,type:t,key:a,ref:o,props:r,_owner:Uf.current}}function o2(t,e){return{$$typeof:Bl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Bf(t){return typeof t=="object"&&t!==null&&t.$$typeof===Bl}function l2(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(s){return e[s]})}var Nx=/\/+/g;function mh(t,e){return typeof t=="object"&&t!==null&&t.key!=null?l2(""+t.key):e.toString(36)}function Gc(t,e,s,n,r){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Bl:case Jj:o=!0}}if(o)return o=t,r=r(o),t=n===""?"."+mh(o,0):n,_x(r)?(s="",t!=null&&(s=t.replace(Nx,"$&/")+"/"),Gc(r,e,s,"",function(u){return u})):r!=null&&(Bf(r)&&(r=o2(r,s+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Nx,"$&/")+"/")+t)),e.push(r)),1;if(o=0,n=n===""?".":n+":",_x(t))for(var l=0;l<t.length;l++){a=t[l];var c=n+mh(a,l);o+=Gc(a,e,s,c,r)}else if(c=a2(t),typeof c=="function")for(t=c.call(t),l=0;!(a=t.next()).done;)a=a.value,c=n+mh(a,l++),o+=Gc(a,e,s,c,r);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function yc(t,e,s){if(t==null)return t;var n=[],r=0;return Gc(t,n,"","",function(a){return e.call(s,a,r++)}),n}function c2(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(s){(t._status===0||t._status===-1)&&(t._status=1,t._result=s)},function(s){(t._status===0||t._status===-1)&&(t._status=2,t._result=s)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ps={current:null},Qc={transition:null},d2={ReactCurrentDispatcher:ps,ReactCurrentBatchConfig:Qc,ReactCurrentOwner:Uf};function Kv(){throw Error("act(...) is not supported in production builds of React.")}Fe.Children={map:yc,forEach:function(t,e,s){yc(t,function(){e.apply(this,arguments)},s)},count:function(t){var e=0;return yc(t,function(){e++}),e},toArray:function(t){return yc(t,function(e){return e})||[]},only:function(t){if(!Bf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Fe.Component=to;Fe.Fragment=Yj;Fe.Profiler=Zj;Fe.PureComponent=Ff;Fe.StrictMode=Xj;Fe.Suspense=n2;Fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=d2;Fe.act=Kv;Fe.cloneElement=function(t,e,s){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=Uv({},t.props),r=t.key,a=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,o=Uf.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)Hv.call(e,c)&&!qv.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=s;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];n.children=l}return{$$typeof:Bl,type:t.type,key:r,ref:a,props:n,_owner:o}};Fe.createContext=function(t){return t={$$typeof:t2,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:e2,_context:t},t.Consumer=t};Fe.createElement=Wv;Fe.createFactory=function(t){var e=Wv.bind(null,t);return e.type=t,e};Fe.createRef=function(){return{current:null}};Fe.forwardRef=function(t){return{$$typeof:s2,render:t}};Fe.isValidElement=Bf;Fe.lazy=function(t){return{$$typeof:i2,_payload:{_status:-1,_result:t},_init:c2}};Fe.memo=function(t,e){return{$$typeof:r2,type:t,compare:e===void 0?null:e}};Fe.startTransition=function(t){var e=Qc.transition;Qc.transition={};try{t()}finally{Qc.transition=e}};Fe.unstable_act=Kv;Fe.useCallback=function(t,e){return ps.current.useCallback(t,e)};Fe.useContext=function(t){return ps.current.useContext(t)};Fe.useDebugValue=function(){};Fe.useDeferredValue=function(t){return ps.current.useDeferredValue(t)};Fe.useEffect=function(t,e){return ps.current.useEffect(t,e)};Fe.useId=function(){return ps.current.useId()};Fe.useImperativeHandle=function(t,e,s){return ps.current.useImperativeHandle(t,e,s)};Fe.useInsertionEffect=function(t,e){return ps.current.useInsertionEffect(t,e)};Fe.useLayoutEffect=function(t,e){return ps.current.useLayoutEffect(t,e)};Fe.useMemo=function(t,e){return ps.current.useMemo(t,e)};Fe.useReducer=function(t,e,s){return ps.current.useReducer(t,e,s)};Fe.useRef=function(t){return ps.current.useRef(t)};Fe.useState=function(t){return ps.current.useState(t)};Fe.useSyncExternalStore=function(t,e,s){return ps.current.useSyncExternalStore(t,e,s)};Fe.useTransition=function(){return ps.current.useTransition()};Fe.version="18.3.1";Fv.exports=Fe;var O=Fv.exports;const u2=Qj(O);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h2=O,m2=Symbol.for("react.element"),f2=Symbol.for("react.fragment"),p2=Object.prototype.hasOwnProperty,g2=h2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,x2={key:!0,ref:!0,__self:!0,__source:!0};function Gv(t,e,s){var n,r={},a=null,o=null;s!==void 0&&(a=""+s),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)p2.call(e,n)&&!x2.hasOwnProperty(n)&&(r[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:m2,type:t,key:a,ref:o,props:r,_owner:g2.current}}hu.Fragment=f2;hu.jsx=Gv;hu.jsxs=Gv;$v.exports=hu;var i=$v.exports,um={},Qv={exports:{}},Hs={},Jv={exports:{}},Yv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(F,Q){var K=F.length;F.push(Q);e:for(;0<K;){var I=K-1>>>1,L=F[I];if(0<r(L,Q))F[I]=Q,F[K]=L,K=I;else break e}}function s(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var Q=F[0],K=F.pop();if(K!==Q){F[0]=K;e:for(var I=0,L=F.length,W=L>>>1;I<W;){var b=2*(I+1)-1,V=F[b],J=b+1,z=F[J];if(0>r(V,K))J<L&&0>r(z,V)?(F[I]=z,F[J]=K,I=J):(F[I]=V,F[b]=K,I=b);else if(J<L&&0>r(z,K))F[I]=z,F[J]=K,I=J;else break e}}return Q}function r(F,Q){var K=F.sortIndex-Q.sortIndex;return K!==0?K:F.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,m=null,f=3,y=!1,_=!1,S=!1,R=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function A(F){for(var Q=s(u);Q!==null;){if(Q.callback===null)n(u);else if(Q.startTime<=F)n(u),Q.sortIndex=Q.expirationTime,e(c,Q);else break;Q=s(u)}}function M(F){if(S=!1,A(F),!_)if(s(c)!==null)_=!0,le(D);else{var Q=s(u);Q!==null&&ce(M,Q.startTime-F)}}function D(F,Q){_=!1,S&&(S=!1,k(N),N=-1),y=!0;var K=f;try{for(A(Q),m=s(c);m!==null&&(!(m.expirationTime>Q)||F&&!C());){var I=m.callback;if(typeof I=="function"){m.callback=null,f=m.priorityLevel;var L=I(m.expirationTime<=Q);Q=t.unstable_now(),typeof L=="function"?m.callback=L:m===s(c)&&n(c),A(Q)}else n(c);m=s(c)}if(m!==null)var W=!0;else{var b=s(u);b!==null&&ce(M,b.startTime-Q),W=!1}return W}finally{m=null,f=K,y=!1}}var B=!1,v=null,N=-1,w=5,E=-1;function C(){return!(t.unstable_now()-E<w)}function P(){if(v!==null){var F=t.unstable_now();E=F;var Q=!0;try{Q=v(!0,F)}finally{Q?j():(B=!1,v=null)}}else B=!1}var j;if(typeof x=="function")j=function(){x(P)};else if(typeof MessageChannel<"u"){var re=new MessageChannel,Z=re.port2;re.port1.onmessage=P,j=function(){Z.postMessage(null)}}else j=function(){R(P,0)};function le(F){v=F,B||(B=!0,j())}function ce(F,Q){N=R(function(){F(t.unstable_now())},Q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_continueExecution=function(){_||y||(_=!0,le(D))},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):w=0<F?Math.floor(1e3/F):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return s(c)},t.unstable_next=function(F){switch(f){case 1:case 2:case 3:var Q=3;break;default:Q=f}var K=f;f=Q;try{return F()}finally{f=K}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(F,Q){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var K=f;f=F;try{return Q()}finally{f=K}},t.unstable_scheduleCallback=function(F,Q,K){var I=t.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?I+K:I):K=I,F){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=K+L,F={id:h++,callback:Q,priorityLevel:F,startTime:K,expirationTime:L,sortIndex:-1},K>I?(F.sortIndex=K,e(u,F),s(c)===null&&F===s(u)&&(S?(k(N),N=-1):S=!0,ce(M,K-I))):(F.sortIndex=L,e(c,F),_||y||(_=!0,le(D))),F},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(F){var Q=f;return function(){var K=f;f=Q;try{return F.apply(this,arguments)}finally{f=K}}}})(Yv);Jv.exports=Yv;var y2=Jv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v2=O,Bs=y2;function te(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,s=1;s<arguments.length;s++)e+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Xv=new Set,dl={};function Wi(t,e){Ua(t,e),Ua(t+"Capture",e)}function Ua(t,e){for(dl[t]=e,t=0;t<e.length;t++)Xv.add(e[t])}var sr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),hm=Object.prototype.hasOwnProperty,b2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,jx={},Ix={};function w2(t){return hm.call(Ix,t)?!0:hm.call(jx,t)?!1:b2.test(t)?Ix[t]=!0:(jx[t]=!0,!1)}function _2(t,e,s,n){if(s!==null&&s.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:s!==null?!s.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function N2(t,e,s,n){if(e===null||typeof e>"u"||_2(t,e,s,n))return!0;if(n)return!1;if(s!==null)switch(s.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function gs(t,e,s,n,r,a,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=s,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var Jt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Jt[t]=new gs(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Jt[e]=new gs(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Jt[t]=new gs(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Jt[t]=new gs(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Jt[t]=new gs(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Jt[t]=new gs(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Jt[t]=new gs(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Jt[t]=new gs(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Jt[t]=new gs(t,5,!1,t.toLowerCase(),null,!1,!1)});var zf=/[\-:]([a-z])/g;function Hf(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(zf,Hf);Jt[e]=new gs(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(zf,Hf);Jt[e]=new gs(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(zf,Hf);Jt[e]=new gs(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Jt[t]=new gs(t,1,!1,t.toLowerCase(),null,!1,!1)});Jt.xlinkHref=new gs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Jt[t]=new gs(t,1,!1,t.toLowerCase(),null,!0,!0)});function qf(t,e,s,n){var r=Jt.hasOwnProperty(e)?Jt[e]:null;(r!==null?r.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(N2(e,s,r,n)&&(s=null),n||r===null?w2(e)&&(s===null?t.removeAttribute(e):t.setAttribute(e,""+s)):r.mustUseProperty?t[r.propertyName]=s===null?r.type===3?!1:"":s:(e=r.attributeName,n=r.attributeNamespace,s===null?t.removeAttribute(e):(r=r.type,s=r===3||r===4&&s===!0?"":""+s,n?t.setAttributeNS(n,e,s):t.setAttribute(e,s))))}var ur=v2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,vc=Symbol.for("react.element"),xa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),Wf=Symbol.for("react.strict_mode"),mm=Symbol.for("react.profiler"),Zv=Symbol.for("react.provider"),eb=Symbol.for("react.context"),Kf=Symbol.for("react.forward_ref"),fm=Symbol.for("react.suspense"),pm=Symbol.for("react.suspense_list"),Gf=Symbol.for("react.memo"),jr=Symbol.for("react.lazy"),tb=Symbol.for("react.offscreen"),Sx=Symbol.iterator;function ko(t){return t===null||typeof t!="object"?null:(t=Sx&&t[Sx]||t["@@iterator"],typeof t=="function"?t:null)}var gt=Object.assign,fh;function Lo(t){if(fh===void 0)try{throw Error()}catch(s){var e=s.stack.trim().match(/\n( *(at )?)/);fh=e&&e[1]||""}return`
`+fh+t}var ph=!1;function gh(t,e){if(!t||ph)return"";ph=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var n=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){n=u}t.call(e.prototype)}else{try{throw Error()}catch(u){n=u}t()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),a=n.stack.split(`
`),o=r.length-1,l=a.length-1;1<=o&&0<=l&&r[o]!==a[l];)l--;for(;1<=o&&0<=l;o--,l--)if(r[o]!==a[l]){if(o!==1||l!==1)do if(o--,l--,0>l||r[o]!==a[l]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{ph=!1,Error.prepareStackTrace=s}return(t=t?t.displayName||t.name:"")?Lo(t):""}function j2(t){switch(t.tag){case 5:return Lo(t.type);case 16:return Lo("Lazy");case 13:return Lo("Suspense");case 19:return Lo("SuspenseList");case 0:case 2:case 15:return t=gh(t.type,!1),t;case 11:return t=gh(t.type.render,!1),t;case 1:return t=gh(t.type,!0),t;default:return""}}function gm(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ya:return"Fragment";case xa:return"Portal";case mm:return"Profiler";case Wf:return"StrictMode";case fm:return"Suspense";case pm:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case eb:return(t.displayName||"Context")+".Consumer";case Zv:return(t._context.displayName||"Context")+".Provider";case Kf:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Gf:return e=t.displayName||null,e!==null?e:gm(t.type)||"Memo";case jr:e=t._payload,t=t._init;try{return gm(t(e))}catch{}}return null}function I2(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gm(e);case 8:return e===Wf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Gr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function sb(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function S2(t){var e=sb(t)?"checked":"value",s=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var r=s.get,a=s.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){n=""+o,a.call(this,o)}}),Object.defineProperty(t,e,{enumerable:s.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function bc(t){t._valueTracker||(t._valueTracker=S2(t))}function nb(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var s=e.getValue(),n="";return t&&(n=sb(t)?t.checked?"true":"false":t.value),t=n,t!==s?(e.setValue(t),!0):!1}function xd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function xm(t,e){var s=e.checked;return gt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??t._wrapperState.initialChecked})}function kx(t,e){var s=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;s=Gr(e.value!=null?e.value:s),t._wrapperState={initialChecked:n,initialValue:s,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function rb(t,e){e=e.checked,e!=null&&qf(t,"checked",e,!1)}function ym(t,e){rb(t,e);var s=Gr(e.value),n=e.type;if(s!=null)n==="number"?(s===0&&t.value===""||t.value!=s)&&(t.value=""+s):t.value!==""+s&&(t.value=""+s);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?vm(t,e.type,s):e.hasOwnProperty("defaultValue")&&vm(t,e.type,Gr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Ex(t,e,s){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,s||e===t.value||(t.value=e),t.defaultValue=e}s=t.name,s!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,s!==""&&(t.name=s)}function vm(t,e,s){(e!=="number"||xd(t.ownerDocument)!==t)&&(s==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+s&&(t.defaultValue=""+s))}var Vo=Array.isArray;function Aa(t,e,s,n){if(t=t.options,e){e={};for(var r=0;r<s.length;r++)e["$"+s[r]]=!0;for(s=0;s<t.length;s++)r=e.hasOwnProperty("$"+t[s].value),t[s].selected!==r&&(t[s].selected=r),r&&n&&(t[s].defaultSelected=!0)}else{for(s=""+Gr(s),e=null,r=0;r<t.length;r++){if(t[r].value===s){t[r].selected=!0,n&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function bm(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(te(91));return gt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Tx(t,e){var s=e.value;if(s==null){if(s=e.children,e=e.defaultValue,s!=null){if(e!=null)throw Error(te(92));if(Vo(s)){if(1<s.length)throw Error(te(93));s=s[0]}e=s}e==null&&(e=""),s=e}t._wrapperState={initialValue:Gr(s)}}function ib(t,e){var s=Gr(e.value),n=Gr(e.defaultValue);s!=null&&(s=""+s,s!==t.value&&(t.value=s),e.defaultValue==null&&t.defaultValue!==s&&(t.defaultValue=s)),n!=null&&(t.defaultValue=""+n)}function Ax(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function ab(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function wm(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?ab(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var wc,ob=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,s,n,r){MSApp.execUnsafeLocalFunction(function(){return t(e,s,n,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(wc=wc||document.createElement("div"),wc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=wc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ul(t,e){if(e){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=e;return}}t.textContent=e}var Go={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},k2=["Webkit","ms","Moz","O"];Object.keys(Go).forEach(function(t){k2.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Go[e]=Go[t]})});function lb(t,e,s){return e==null||typeof e=="boolean"||e===""?"":s||typeof e!="number"||e===0||Go.hasOwnProperty(t)&&Go[t]?(""+e).trim():e+"px"}function cb(t,e){t=t.style;for(var s in e)if(e.hasOwnProperty(s)){var n=s.indexOf("--")===0,r=lb(s,e[s],n);s==="float"&&(s="cssFloat"),n?t.setProperty(s,r):t[s]=r}}var E2=gt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _m(t,e){if(e){if(E2[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(te(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(te(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(te(61))}if(e.style!=null&&typeof e.style!="object")throw Error(te(62))}}function Nm(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jm=null;function Qf(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Im=null,Ca=null,Pa=null;function Cx(t){if(t=ql(t)){if(typeof Im!="function")throw Error(te(280));var e=t.stateNode;e&&(e=xu(e),Im(t.stateNode,t.type,e))}}function db(t){Ca?Pa?Pa.push(t):Pa=[t]:Ca=t}function ub(){if(Ca){var t=Ca,e=Pa;if(Pa=Ca=null,Cx(t),e)for(t=0;t<e.length;t++)Cx(e[t])}}function hb(t,e){return t(e)}function mb(){}var xh=!1;function fb(t,e,s){if(xh)return t(e,s);xh=!0;try{return hb(t,e,s)}finally{xh=!1,(Ca!==null||Pa!==null)&&(mb(),ub())}}function hl(t,e){var s=t.stateNode;if(s===null)return null;var n=xu(s);if(n===null)return null;s=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(te(231,e,typeof s));return s}var Sm=!1;if(sr)try{var Eo={};Object.defineProperty(Eo,"passive",{get:function(){Sm=!0}}),window.addEventListener("test",Eo,Eo),window.removeEventListener("test",Eo,Eo)}catch{Sm=!1}function T2(t,e,s,n,r,a,o,l,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(s,u)}catch(h){this.onError(h)}}var Qo=!1,yd=null,vd=!1,km=null,A2={onError:function(t){Qo=!0,yd=t}};function C2(t,e,s,n,r,a,o,l,c){Qo=!1,yd=null,T2.apply(A2,arguments)}function P2(t,e,s,n,r,a,o,l,c){if(C2.apply(this,arguments),Qo){if(Qo){var u=yd;Qo=!1,yd=null}else throw Error(te(198));vd||(vd=!0,km=u)}}function Ki(t){var e=t,s=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(s=e.return),t=e.return;while(t)}return e.tag===3?s:null}function pb(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Px(t){if(Ki(t)!==t)throw Error(te(188))}function R2(t){var e=t.alternate;if(!e){if(e=Ki(t),e===null)throw Error(te(188));return e!==t?null:t}for(var s=t,n=e;;){var r=s.return;if(r===null)break;var a=r.alternate;if(a===null){if(n=r.return,n!==null){s=n;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===s)return Px(r),t;if(a===n)return Px(r),e;a=a.sibling}throw Error(te(188))}if(s.return!==n.return)s=r,n=a;else{for(var o=!1,l=r.child;l;){if(l===s){o=!0,s=r,n=a;break}if(l===n){o=!0,n=r,s=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===s){o=!0,s=a,n=r;break}if(l===n){o=!0,n=a,s=r;break}l=l.sibling}if(!o)throw Error(te(189))}}if(s.alternate!==n)throw Error(te(190))}if(s.tag!==3)throw Error(te(188));return s.stateNode.current===s?t:e}function gb(t){return t=R2(t),t!==null?xb(t):null}function xb(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=xb(t);if(e!==null)return e;t=t.sibling}return null}var yb=Bs.unstable_scheduleCallback,Rx=Bs.unstable_cancelCallback,M2=Bs.unstable_shouldYield,O2=Bs.unstable_requestPaint,St=Bs.unstable_now,L2=Bs.unstable_getCurrentPriorityLevel,Jf=Bs.unstable_ImmediatePriority,vb=Bs.unstable_UserBlockingPriority,bd=Bs.unstable_NormalPriority,V2=Bs.unstable_LowPriority,bb=Bs.unstable_IdlePriority,mu=null,Pn=null;function $2(t){if(Pn&&typeof Pn.onCommitFiberRoot=="function")try{Pn.onCommitFiberRoot(mu,t,void 0,(t.current.flags&128)===128)}catch{}}var mn=Math.clz32?Math.clz32:U2,F2=Math.log,D2=Math.LN2;function U2(t){return t>>>=0,t===0?32:31-(F2(t)/D2|0)|0}var _c=64,Nc=4194304;function $o(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function wd(t,e){var s=t.pendingLanes;if(s===0)return 0;var n=0,r=t.suspendedLanes,a=t.pingedLanes,o=s&268435455;if(o!==0){var l=o&~r;l!==0?n=$o(l):(a&=o,a!==0&&(n=$o(a)))}else o=s&~r,o!==0?n=$o(o):a!==0&&(n=$o(a));if(n===0)return 0;if(e!==0&&e!==n&&!(e&r)&&(r=n&-n,a=e&-e,r>=a||r===16&&(a&4194240)!==0))return e;if(n&4&&(n|=s&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)s=31-mn(e),r=1<<s,n|=t[s],e&=~r;return n}function B2(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function z2(t,e){for(var s=t.suspendedLanes,n=t.pingedLanes,r=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-mn(a),l=1<<o,c=r[o];c===-1?(!(l&s)||l&n)&&(r[o]=B2(l,e)):c<=e&&(t.expiredLanes|=l),a&=~l}}function Em(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function wb(){var t=_c;return _c<<=1,!(_c&4194240)&&(_c=64),t}function yh(t){for(var e=[],s=0;31>s;s++)e.push(t);return e}function zl(t,e,s){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-mn(e),t[e]=s}function H2(t,e){var s=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<s;){var r=31-mn(s),a=1<<r;e[r]=0,n[r]=-1,t[r]=-1,s&=~a}}function Yf(t,e){var s=t.entangledLanes|=e;for(t=t.entanglements;s;){var n=31-mn(s),r=1<<n;r&e|t[n]&e&&(t[n]|=e),s&=~r}}var Xe=0;function _b(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Nb,Xf,jb,Ib,Sb,Tm=!1,jc=[],Vr=null,$r=null,Fr=null,ml=new Map,fl=new Map,Sr=[],q2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mx(t,e){switch(t){case"focusin":case"focusout":Vr=null;break;case"dragenter":case"dragleave":$r=null;break;case"mouseover":case"mouseout":Fr=null;break;case"pointerover":case"pointerout":ml.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":fl.delete(e.pointerId)}}function To(t,e,s,n,r,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:s,eventSystemFlags:n,nativeEvent:a,targetContainers:[r]},e!==null&&(e=ql(e),e!==null&&Xf(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function W2(t,e,s,n,r){switch(e){case"focusin":return Vr=To(Vr,t,e,s,n,r),!0;case"dragenter":return $r=To($r,t,e,s,n,r),!0;case"mouseover":return Fr=To(Fr,t,e,s,n,r),!0;case"pointerover":var a=r.pointerId;return ml.set(a,To(ml.get(a)||null,t,e,s,n,r)),!0;case"gotpointercapture":return a=r.pointerId,fl.set(a,To(fl.get(a)||null,t,e,s,n,r)),!0}return!1}function kb(t){var e=bi(t.target);if(e!==null){var s=Ki(e);if(s!==null){if(e=s.tag,e===13){if(e=pb(s),e!==null){t.blockedOn=e,Sb(t.priority,function(){jb(s)});return}}else if(e===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Jc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var s=Am(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(s===null){s=t.nativeEvent;var n=new s.constructor(s.type,s);jm=n,s.target.dispatchEvent(n),jm=null}else return e=ql(s),e!==null&&Xf(e),t.blockedOn=s,!1;e.shift()}return!0}function Ox(t,e,s){Jc(t)&&s.delete(e)}function K2(){Tm=!1,Vr!==null&&Jc(Vr)&&(Vr=null),$r!==null&&Jc($r)&&($r=null),Fr!==null&&Jc(Fr)&&(Fr=null),ml.forEach(Ox),fl.forEach(Ox)}function Ao(t,e){t.blockedOn===e&&(t.blockedOn=null,Tm||(Tm=!0,Bs.unstable_scheduleCallback(Bs.unstable_NormalPriority,K2)))}function pl(t){function e(r){return Ao(r,t)}if(0<jc.length){Ao(jc[0],t);for(var s=1;s<jc.length;s++){var n=jc[s];n.blockedOn===t&&(n.blockedOn=null)}}for(Vr!==null&&Ao(Vr,t),$r!==null&&Ao($r,t),Fr!==null&&Ao(Fr,t),ml.forEach(e),fl.forEach(e),s=0;s<Sr.length;s++)n=Sr[s],n.blockedOn===t&&(n.blockedOn=null);for(;0<Sr.length&&(s=Sr[0],s.blockedOn===null);)kb(s),s.blockedOn===null&&Sr.shift()}var Ra=ur.ReactCurrentBatchConfig,_d=!0;function G2(t,e,s,n){var r=Xe,a=Ra.transition;Ra.transition=null;try{Xe=1,Zf(t,e,s,n)}finally{Xe=r,Ra.transition=a}}function Q2(t,e,s,n){var r=Xe,a=Ra.transition;Ra.transition=null;try{Xe=4,Zf(t,e,s,n)}finally{Xe=r,Ra.transition=a}}function Zf(t,e,s,n){if(_d){var r=Am(t,e,s,n);if(r===null)Eh(t,e,n,Nd,s),Mx(t,n);else if(W2(r,t,e,s,n))n.stopPropagation();else if(Mx(t,n),e&4&&-1<q2.indexOf(t)){for(;r!==null;){var a=ql(r);if(a!==null&&Nb(a),a=Am(t,e,s,n),a===null&&Eh(t,e,n,Nd,s),a===r)break;r=a}r!==null&&n.stopPropagation()}else Eh(t,e,n,null,s)}}var Nd=null;function Am(t,e,s,n){if(Nd=null,t=Qf(n),t=bi(t),t!==null)if(e=Ki(t),e===null)t=null;else if(s=e.tag,s===13){if(t=pb(e),t!==null)return t;t=null}else if(s===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Nd=t,null}function Eb(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(L2()){case Jf:return 1;case vb:return 4;case bd:case V2:return 16;case bb:return 536870912;default:return 16}default:return 16}}var Mr=null,ep=null,Yc=null;function Tb(){if(Yc)return Yc;var t,e=ep,s=e.length,n,r="value"in Mr?Mr.value:Mr.textContent,a=r.length;for(t=0;t<s&&e[t]===r[t];t++);var o=s-t;for(n=1;n<=o&&e[s-n]===r[a-n];n++);return Yc=r.slice(t,1<n?1-n:void 0)}function Xc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ic(){return!0}function Lx(){return!1}function qs(t){function e(s,n,r,a,o){this._reactName=s,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(s=t[l],this[l]=s?s(a):a[l]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?Ic:Lx,this.isPropagationStopped=Lx,this}return gt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Ic)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Ic)},persist:function(){},isPersistent:Ic}),e}var so={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tp=qs(so),Hl=gt({},so,{view:0,detail:0}),J2=qs(Hl),vh,bh,Co,fu=gt({},Hl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:sp,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Co&&(Co&&t.type==="mousemove"?(vh=t.screenX-Co.screenX,bh=t.screenY-Co.screenY):bh=vh=0,Co=t),vh)},movementY:function(t){return"movementY"in t?t.movementY:bh}}),Vx=qs(fu),Y2=gt({},fu,{dataTransfer:0}),X2=qs(Y2),Z2=gt({},Hl,{relatedTarget:0}),wh=qs(Z2),eI=gt({},so,{animationName:0,elapsedTime:0,pseudoElement:0}),tI=qs(eI),sI=gt({},so,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),nI=qs(sI),rI=gt({},so,{data:0}),$x=qs(rI),iI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},aI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},oI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lI(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=oI[t])?!!e[t]:!1}function sp(){return lI}var cI=gt({},Hl,{key:function(t){if(t.key){var e=iI[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Xc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?aI[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:sp,charCode:function(t){return t.type==="keypress"?Xc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Xc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),dI=qs(cI),uI=gt({},fu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fx=qs(uI),hI=gt({},Hl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:sp}),mI=qs(hI),fI=gt({},so,{propertyName:0,elapsedTime:0,pseudoElement:0}),pI=qs(fI),gI=gt({},fu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),xI=qs(gI),yI=[9,13,27,32],np=sr&&"CompositionEvent"in window,Jo=null;sr&&"documentMode"in document&&(Jo=document.documentMode);var vI=sr&&"TextEvent"in window&&!Jo,Ab=sr&&(!np||Jo&&8<Jo&&11>=Jo),Dx=" ",Ux=!1;function Cb(t,e){switch(t){case"keyup":return yI.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Pb(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var va=!1;function bI(t,e){switch(t){case"compositionend":return Pb(e);case"keypress":return e.which!==32?null:(Ux=!0,Dx);case"textInput":return t=e.data,t===Dx&&Ux?null:t;default:return null}}function wI(t,e){if(va)return t==="compositionend"||!np&&Cb(t,e)?(t=Tb(),Yc=ep=Mr=null,va=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Ab&&e.locale!=="ko"?null:e.data;default:return null}}var _I={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bx(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!_I[t.type]:e==="textarea"}function Rb(t,e,s,n){db(n),e=jd(e,"onChange"),0<e.length&&(s=new tp("onChange","change",null,s,n),t.push({event:s,listeners:e}))}var Yo=null,gl=null;function NI(t){Hb(t,0)}function pu(t){var e=_a(t);if(nb(e))return t}function jI(t,e){if(t==="change")return e}var Mb=!1;if(sr){var _h;if(sr){var Nh="oninput"in document;if(!Nh){var zx=document.createElement("div");zx.setAttribute("oninput","return;"),Nh=typeof zx.oninput=="function"}_h=Nh}else _h=!1;Mb=_h&&(!document.documentMode||9<document.documentMode)}function Hx(){Yo&&(Yo.detachEvent("onpropertychange",Ob),gl=Yo=null)}function Ob(t){if(t.propertyName==="value"&&pu(gl)){var e=[];Rb(e,gl,t,Qf(t)),fb(NI,e)}}function II(t,e,s){t==="focusin"?(Hx(),Yo=e,gl=s,Yo.attachEvent("onpropertychange",Ob)):t==="focusout"&&Hx()}function SI(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return pu(gl)}function kI(t,e){if(t==="click")return pu(e)}function EI(t,e){if(t==="input"||t==="change")return pu(e)}function TI(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var gn=typeof Object.is=="function"?Object.is:TI;function xl(t,e){if(gn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var s=Object.keys(t),n=Object.keys(e);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var r=s[n];if(!hm.call(e,r)||!gn(t[r],e[r]))return!1}return!0}function qx(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Wx(t,e){var s=qx(t);t=0;for(var n;s;){if(s.nodeType===3){if(n=t+s.textContent.length,t<=e&&n>=e)return{node:s,offset:e-t};t=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=qx(s)}}function Lb(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Lb(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Vb(){for(var t=window,e=xd();e instanceof t.HTMLIFrameElement;){try{var s=typeof e.contentWindow.location.href=="string"}catch{s=!1}if(s)t=e.contentWindow;else break;e=xd(t.document)}return e}function rp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function AI(t){var e=Vb(),s=t.focusedElem,n=t.selectionRange;if(e!==s&&s&&s.ownerDocument&&Lb(s.ownerDocument.documentElement,s)){if(n!==null&&rp(s)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in s)s.selectionStart=e,s.selectionEnd=Math.min(t,s.value.length);else if(t=(e=s.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=s.textContent.length,a=Math.min(n.start,r);n=n.end===void 0?a:Math.min(n.end,r),!t.extend&&a>n&&(r=n,n=a,a=r),r=Wx(s,a);var o=Wx(s,n);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),a>n?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=s;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<e.length;s++)t=e[s],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var CI=sr&&"documentMode"in document&&11>=document.documentMode,ba=null,Cm=null,Xo=null,Pm=!1;function Kx(t,e,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Pm||ba==null||ba!==xd(n)||(n=ba,"selectionStart"in n&&rp(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Xo&&xl(Xo,n)||(Xo=n,n=jd(Cm,"onSelect"),0<n.length&&(e=new tp("onSelect","select",null,e,s),t.push({event:e,listeners:n}),e.target=ba)))}function Sc(t,e){var s={};return s[t.toLowerCase()]=e.toLowerCase(),s["Webkit"+t]="webkit"+e,s["Moz"+t]="moz"+e,s}var wa={animationend:Sc("Animation","AnimationEnd"),animationiteration:Sc("Animation","AnimationIteration"),animationstart:Sc("Animation","AnimationStart"),transitionend:Sc("Transition","TransitionEnd")},jh={},$b={};sr&&($b=document.createElement("div").style,"AnimationEvent"in window||(delete wa.animationend.animation,delete wa.animationiteration.animation,delete wa.animationstart.animation),"TransitionEvent"in window||delete wa.transitionend.transition);function gu(t){if(jh[t])return jh[t];if(!wa[t])return t;var e=wa[t],s;for(s in e)if(e.hasOwnProperty(s)&&s in $b)return jh[t]=e[s];return t}var Fb=gu("animationend"),Db=gu("animationiteration"),Ub=gu("animationstart"),Bb=gu("transitionend"),zb=new Map,Gx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function si(t,e){zb.set(t,e),Wi(e,[t])}for(var Ih=0;Ih<Gx.length;Ih++){var Sh=Gx[Ih],PI=Sh.toLowerCase(),RI=Sh[0].toUpperCase()+Sh.slice(1);si(PI,"on"+RI)}si(Fb,"onAnimationEnd");si(Db,"onAnimationIteration");si(Ub,"onAnimationStart");si("dblclick","onDoubleClick");si("focusin","onFocus");si("focusout","onBlur");si(Bb,"onTransitionEnd");Ua("onMouseEnter",["mouseout","mouseover"]);Ua("onMouseLeave",["mouseout","mouseover"]);Ua("onPointerEnter",["pointerout","pointerover"]);Ua("onPointerLeave",["pointerout","pointerover"]);Wi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),MI=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fo));function Qx(t,e,s){var n=t.type||"unknown-event";t.currentTarget=s,P2(n,e,void 0,t),t.currentTarget=null}function Hb(t,e){e=(e&4)!==0;for(var s=0;s<t.length;s++){var n=t[s],r=n.event;n=n.listeners;e:{var a=void 0;if(e)for(var o=n.length-1;0<=o;o--){var l=n[o],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==a&&r.isPropagationStopped())break e;Qx(r,l,u),a=c}else for(o=0;o<n.length;o++){if(l=n[o],c=l.instance,u=l.currentTarget,l=l.listener,c!==a&&r.isPropagationStopped())break e;Qx(r,l,u),a=c}}}if(vd)throw t=km,vd=!1,km=null,t}function ot(t,e){var s=e[Vm];s===void 0&&(s=e[Vm]=new Set);var n=t+"__bubble";s.has(n)||(qb(e,t,2,!1),s.add(n))}function kh(t,e,s){var n=0;e&&(n|=4),qb(s,t,n,e)}var kc="_reactListening"+Math.random().toString(36).slice(2);function yl(t){if(!t[kc]){t[kc]=!0,Xv.forEach(function(s){s!=="selectionchange"&&(MI.has(s)||kh(s,!1,t),kh(s,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[kc]||(e[kc]=!0,kh("selectionchange",!1,e))}}function qb(t,e,s,n){switch(Eb(e)){case 1:var r=G2;break;case 4:r=Q2;break;default:r=Zf}s=r.bind(null,e,s,t),r=void 0,!Sm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),n?r!==void 0?t.addEventListener(e,s,{capture:!0,passive:r}):t.addEventListener(e,s,!0):r!==void 0?t.addEventListener(e,s,{passive:r}):t.addEventListener(e,s,!1)}function Eh(t,e,s,n,r){var a=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var l=n.stateNode.containerInfo;if(l===r||l.nodeType===8&&l.parentNode===r)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;l!==null;){if(o=bi(l),o===null)return;if(c=o.tag,c===5||c===6){n=a=o;continue e}l=l.parentNode}}n=n.return}fb(function(){var u=a,h=Qf(s),m=[];e:{var f=zb.get(t);if(f!==void 0){var y=tp,_=t;switch(t){case"keypress":if(Xc(s)===0)break e;case"keydown":case"keyup":y=dI;break;case"focusin":_="focus",y=wh;break;case"focusout":_="blur",y=wh;break;case"beforeblur":case"afterblur":y=wh;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=Vx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=X2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=mI;break;case Fb:case Db:case Ub:y=tI;break;case Bb:y=pI;break;case"scroll":y=J2;break;case"wheel":y=xI;break;case"copy":case"cut":case"paste":y=nI;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Fx}var S=(e&4)!==0,R=!S&&t==="scroll",k=S?f!==null?f+"Capture":null:f;S=[];for(var x=u,A;x!==null;){A=x;var M=A.stateNode;if(A.tag===5&&M!==null&&(A=M,k!==null&&(M=hl(x,k),M!=null&&S.push(vl(x,M,A)))),R)break;x=x.return}0<S.length&&(f=new y(f,_,null,s,h),m.push({event:f,listeners:S}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",y=t==="mouseout"||t==="pointerout",f&&s!==jm&&(_=s.relatedTarget||s.fromElement)&&(bi(_)||_[nr]))break e;if((y||f)&&(f=h.window===h?h:(f=h.ownerDocument)?f.defaultView||f.parentWindow:window,y?(_=s.relatedTarget||s.toElement,y=u,_=_?bi(_):null,_!==null&&(R=Ki(_),_!==R||_.tag!==5&&_.tag!==6)&&(_=null)):(y=null,_=u),y!==_)){if(S=Vx,M="onMouseLeave",k="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(S=Fx,M="onPointerLeave",k="onPointerEnter",x="pointer"),R=y==null?f:_a(y),A=_==null?f:_a(_),f=new S(M,x+"leave",y,s,h),f.target=R,f.relatedTarget=A,M=null,bi(h)===u&&(S=new S(k,x+"enter",_,s,h),S.target=A,S.relatedTarget=R,M=S),R=M,y&&_)t:{for(S=y,k=_,x=0,A=S;A;A=ua(A))x++;for(A=0,M=k;M;M=ua(M))A++;for(;0<x-A;)S=ua(S),x--;for(;0<A-x;)k=ua(k),A--;for(;x--;){if(S===k||k!==null&&S===k.alternate)break t;S=ua(S),k=ua(k)}S=null}else S=null;y!==null&&Jx(m,f,y,S,!1),_!==null&&R!==null&&Jx(m,R,_,S,!0)}}e:{if(f=u?_a(u):window,y=f.nodeName&&f.nodeName.toLowerCase(),y==="select"||y==="input"&&f.type==="file")var D=jI;else if(Bx(f))if(Mb)D=EI;else{D=SI;var B=II}else(y=f.nodeName)&&y.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(D=kI);if(D&&(D=D(t,u))){Rb(m,D,s,h);break e}B&&B(t,f,u),t==="focusout"&&(B=f._wrapperState)&&B.controlled&&f.type==="number"&&vm(f,"number",f.value)}switch(B=u?_a(u):window,t){case"focusin":(Bx(B)||B.contentEditable==="true")&&(ba=B,Cm=u,Xo=null);break;case"focusout":Xo=Cm=ba=null;break;case"mousedown":Pm=!0;break;case"contextmenu":case"mouseup":case"dragend":Pm=!1,Kx(m,s,h);break;case"selectionchange":if(CI)break;case"keydown":case"keyup":Kx(m,s,h)}var v;if(np)e:{switch(t){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else va?Cb(t,s)&&(N="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(N="onCompositionStart");N&&(Ab&&s.locale!=="ko"&&(va||N!=="onCompositionStart"?N==="onCompositionEnd"&&va&&(v=Tb()):(Mr=h,ep="value"in Mr?Mr.value:Mr.textContent,va=!0)),B=jd(u,N),0<B.length&&(N=new $x(N,t,null,s,h),m.push({event:N,listeners:B}),v?N.data=v:(v=Pb(s),v!==null&&(N.data=v)))),(v=vI?bI(t,s):wI(t,s))&&(u=jd(u,"onBeforeInput"),0<u.length&&(h=new $x("onBeforeInput","beforeinput",null,s,h),m.push({event:h,listeners:u}),h.data=v))}Hb(m,e)})}function vl(t,e,s){return{instance:t,listener:e,currentTarget:s}}function jd(t,e){for(var s=e+"Capture",n=[];t!==null;){var r=t,a=r.stateNode;r.tag===5&&a!==null&&(r=a,a=hl(t,s),a!=null&&n.unshift(vl(t,a,r)),a=hl(t,e),a!=null&&n.push(vl(t,a,r))),t=t.return}return n}function ua(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Jx(t,e,s,n,r){for(var a=e._reactName,o=[];s!==null&&s!==n;){var l=s,c=l.alternate,u=l.stateNode;if(c!==null&&c===n)break;l.tag===5&&u!==null&&(l=u,r?(c=hl(s,a),c!=null&&o.unshift(vl(s,c,l))):r||(c=hl(s,a),c!=null&&o.push(vl(s,c,l)))),s=s.return}o.length!==0&&t.push({event:e,listeners:o})}var OI=/\r\n?/g,LI=/\u0000|\uFFFD/g;function Yx(t){return(typeof t=="string"?t:""+t).replace(OI,`
`).replace(LI,"")}function Ec(t,e,s){if(e=Yx(e),Yx(t)!==e&&s)throw Error(te(425))}function Id(){}var Rm=null,Mm=null;function Om(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Lm=typeof setTimeout=="function"?setTimeout:void 0,VI=typeof clearTimeout=="function"?clearTimeout:void 0,Xx=typeof Promise=="function"?Promise:void 0,$I=typeof queueMicrotask=="function"?queueMicrotask:typeof Xx<"u"?function(t){return Xx.resolve(null).then(t).catch(FI)}:Lm;function FI(t){setTimeout(function(){throw t})}function Th(t,e){var s=e,n=0;do{var r=s.nextSibling;if(t.removeChild(s),r&&r.nodeType===8)if(s=r.data,s==="/$"){if(n===0){t.removeChild(r),pl(e);return}n--}else s!=="$"&&s!=="$?"&&s!=="$!"||n++;s=r}while(s);pl(e)}function Dr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Zx(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"){if(e===0)return t;e--}else s==="/$"&&e++}t=t.previousSibling}return null}var no=Math.random().toString(36).slice(2),An="__reactFiber$"+no,bl="__reactProps$"+no,nr="__reactContainer$"+no,Vm="__reactEvents$"+no,DI="__reactListeners$"+no,UI="__reactHandles$"+no;function bi(t){var e=t[An];if(e)return e;for(var s=t.parentNode;s;){if(e=s[nr]||s[An]){if(s=e.alternate,e.child!==null||s!==null&&s.child!==null)for(t=Zx(t);t!==null;){if(s=t[An])return s;t=Zx(t)}return e}t=s,s=t.parentNode}return null}function ql(t){return t=t[An]||t[nr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function _a(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(te(33))}function xu(t){return t[bl]||null}var $m=[],Na=-1;function ni(t){return{current:t}}function lt(t){0>Na||(t.current=$m[Na],$m[Na]=null,Na--)}function at(t,e){Na++,$m[Na]=t.current,t.current=e}var Qr={},ls=ni(Qr),Ss=ni(!1),Pi=Qr;function Ba(t,e){var s=t.type.contextTypes;if(!s)return Qr;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var r={},a;for(a in s)r[a]=e[a];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function ks(t){return t=t.childContextTypes,t!=null}function Sd(){lt(Ss),lt(ls)}function e0(t,e,s){if(ls.current!==Qr)throw Error(te(168));at(ls,e),at(Ss,s)}function Wb(t,e,s){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return s;n=n.getChildContext();for(var r in n)if(!(r in e))throw Error(te(108,I2(t)||"Unknown",r));return gt({},s,n)}function kd(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Qr,Pi=ls.current,at(ls,t),at(Ss,Ss.current),!0}function t0(t,e,s){var n=t.stateNode;if(!n)throw Error(te(169));s?(t=Wb(t,e,Pi),n.__reactInternalMemoizedMergedChildContext=t,lt(Ss),lt(ls),at(ls,t)):lt(Ss),at(Ss,s)}var Wn=null,yu=!1,Ah=!1;function Kb(t){Wn===null?Wn=[t]:Wn.push(t)}function BI(t){yu=!0,Kb(t)}function ri(){if(!Ah&&Wn!==null){Ah=!0;var t=0,e=Xe;try{var s=Wn;for(Xe=1;t<s.length;t++){var n=s[t];do n=n(!0);while(n!==null)}Wn=null,yu=!1}catch(r){throw Wn!==null&&(Wn=Wn.slice(t+1)),yb(Jf,ri),r}finally{Xe=e,Ah=!1}}return null}var ja=[],Ia=0,Ed=null,Td=0,Gs=[],Qs=0,Ri=null,Gn=1,Qn="";function xi(t,e){ja[Ia++]=Td,ja[Ia++]=Ed,Ed=t,Td=e}function Gb(t,e,s){Gs[Qs++]=Gn,Gs[Qs++]=Qn,Gs[Qs++]=Ri,Ri=t;var n=Gn;t=Qn;var r=32-mn(n)-1;n&=~(1<<r),s+=1;var a=32-mn(e)+r;if(30<a){var o=r-r%5;a=(n&(1<<o)-1).toString(32),n>>=o,r-=o,Gn=1<<32-mn(e)+r|s<<r|n,Qn=a+t}else Gn=1<<a|s<<r|n,Qn=t}function ip(t){t.return!==null&&(xi(t,1),Gb(t,1,0))}function ap(t){for(;t===Ed;)Ed=ja[--Ia],ja[Ia]=null,Td=ja[--Ia],ja[Ia]=null;for(;t===Ri;)Ri=Gs[--Qs],Gs[Qs]=null,Qn=Gs[--Qs],Gs[Qs]=null,Gn=Gs[--Qs],Gs[Qs]=null}var Us=null,$s=null,ut=!1,un=null;function Qb(t,e){var s=Ys(5,null,null,0);s.elementType="DELETED",s.stateNode=e,s.return=t,e=t.deletions,e===null?(t.deletions=[s],t.flags|=16):e.push(s)}function s0(t,e){switch(t.tag){case 5:var s=t.type;return e=e.nodeType!==1||s.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Us=t,$s=Dr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Us=t,$s=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(s=Ri!==null?{id:Gn,overflow:Qn}:null,t.memoizedState={dehydrated:e,treeContext:s,retryLane:1073741824},s=Ys(18,null,null,0),s.stateNode=e,s.return=t,t.child=s,Us=t,$s=null,!0):!1;default:return!1}}function Fm(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Dm(t){if(ut){var e=$s;if(e){var s=e;if(!s0(t,e)){if(Fm(t))throw Error(te(418));e=Dr(s.nextSibling);var n=Us;e&&s0(t,e)?Qb(n,s):(t.flags=t.flags&-4097|2,ut=!1,Us=t)}}else{if(Fm(t))throw Error(te(418));t.flags=t.flags&-4097|2,ut=!1,Us=t}}}function n0(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Us=t}function Tc(t){if(t!==Us)return!1;if(!ut)return n0(t),ut=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Om(t.type,t.memoizedProps)),e&&(e=$s)){if(Fm(t))throw Jb(),Error(te(418));for(;e;)Qb(t,e),e=Dr(e.nextSibling)}if(n0(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(te(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"){if(e===0){$s=Dr(t.nextSibling);break e}e--}else s!=="$"&&s!=="$!"&&s!=="$?"||e++}t=t.nextSibling}$s=null}}else $s=Us?Dr(t.stateNode.nextSibling):null;return!0}function Jb(){for(var t=$s;t;)t=Dr(t.nextSibling)}function za(){$s=Us=null,ut=!1}function op(t){un===null?un=[t]:un.push(t)}var zI=ur.ReactCurrentBatchConfig;function Po(t,e,s){if(t=s.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(te(309));var n=s.stateNode}if(!n)throw Error(te(147,t));var r=n,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(o){var l=r.refs;o===null?delete l[a]:l[a]=o},e._stringRef=a,e)}if(typeof t!="string")throw Error(te(284));if(!s._owner)throw Error(te(290,t))}return t}function Ac(t,e){throw t=Object.prototype.toString.call(e),Error(te(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function r0(t){var e=t._init;return e(t._payload)}function Yb(t){function e(k,x){if(t){var A=k.deletions;A===null?(k.deletions=[x],k.flags|=16):A.push(x)}}function s(k,x){if(!t)return null;for(;x!==null;)e(k,x),x=x.sibling;return null}function n(k,x){for(k=new Map;x!==null;)x.key!==null?k.set(x.key,x):k.set(x.index,x),x=x.sibling;return k}function r(k,x){return k=Hr(k,x),k.index=0,k.sibling=null,k}function a(k,x,A){return k.index=A,t?(A=k.alternate,A!==null?(A=A.index,A<x?(k.flags|=2,x):A):(k.flags|=2,x)):(k.flags|=1048576,x)}function o(k){return t&&k.alternate===null&&(k.flags|=2),k}function l(k,x,A,M){return x===null||x.tag!==6?(x=Vh(A,k.mode,M),x.return=k,x):(x=r(x,A),x.return=k,x)}function c(k,x,A,M){var D=A.type;return D===ya?h(k,x,A.props.children,M,A.key):x!==null&&(x.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===jr&&r0(D)===x.type)?(M=r(x,A.props),M.ref=Po(k,x,A),M.return=k,M):(M=id(A.type,A.key,A.props,null,k.mode,M),M.ref=Po(k,x,A),M.return=k,M)}function u(k,x,A,M){return x===null||x.tag!==4||x.stateNode.containerInfo!==A.containerInfo||x.stateNode.implementation!==A.implementation?(x=$h(A,k.mode,M),x.return=k,x):(x=r(x,A.children||[]),x.return=k,x)}function h(k,x,A,M,D){return x===null||x.tag!==7?(x=ki(A,k.mode,M,D),x.return=k,x):(x=r(x,A),x.return=k,x)}function m(k,x,A){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Vh(""+x,k.mode,A),x.return=k,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case vc:return A=id(x.type,x.key,x.props,null,k.mode,A),A.ref=Po(k,null,x),A.return=k,A;case xa:return x=$h(x,k.mode,A),x.return=k,x;case jr:var M=x._init;return m(k,M(x._payload),A)}if(Vo(x)||ko(x))return x=ki(x,k.mode,A,null),x.return=k,x;Ac(k,x)}return null}function f(k,x,A,M){var D=x!==null?x.key:null;if(typeof A=="string"&&A!==""||typeof A=="number")return D!==null?null:l(k,x,""+A,M);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case vc:return A.key===D?c(k,x,A,M):null;case xa:return A.key===D?u(k,x,A,M):null;case jr:return D=A._init,f(k,x,D(A._payload),M)}if(Vo(A)||ko(A))return D!==null?null:h(k,x,A,M,null);Ac(k,A)}return null}function y(k,x,A,M,D){if(typeof M=="string"&&M!==""||typeof M=="number")return k=k.get(A)||null,l(x,k,""+M,D);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case vc:return k=k.get(M.key===null?A:M.key)||null,c(x,k,M,D);case xa:return k=k.get(M.key===null?A:M.key)||null,u(x,k,M,D);case jr:var B=M._init;return y(k,x,A,B(M._payload),D)}if(Vo(M)||ko(M))return k=k.get(A)||null,h(x,k,M,D,null);Ac(x,M)}return null}function _(k,x,A,M){for(var D=null,B=null,v=x,N=x=0,w=null;v!==null&&N<A.length;N++){v.index>N?(w=v,v=null):w=v.sibling;var E=f(k,v,A[N],M);if(E===null){v===null&&(v=w);break}t&&v&&E.alternate===null&&e(k,v),x=a(E,x,N),B===null?D=E:B.sibling=E,B=E,v=w}if(N===A.length)return s(k,v),ut&&xi(k,N),D;if(v===null){for(;N<A.length;N++)v=m(k,A[N],M),v!==null&&(x=a(v,x,N),B===null?D=v:B.sibling=v,B=v);return ut&&xi(k,N),D}for(v=n(k,v);N<A.length;N++)w=y(v,k,N,A[N],M),w!==null&&(t&&w.alternate!==null&&v.delete(w.key===null?N:w.key),x=a(w,x,N),B===null?D=w:B.sibling=w,B=w);return t&&v.forEach(function(C){return e(k,C)}),ut&&xi(k,N),D}function S(k,x,A,M){var D=ko(A);if(typeof D!="function")throw Error(te(150));if(A=D.call(A),A==null)throw Error(te(151));for(var B=D=null,v=x,N=x=0,w=null,E=A.next();v!==null&&!E.done;N++,E=A.next()){v.index>N?(w=v,v=null):w=v.sibling;var C=f(k,v,E.value,M);if(C===null){v===null&&(v=w);break}t&&v&&C.alternate===null&&e(k,v),x=a(C,x,N),B===null?D=C:B.sibling=C,B=C,v=w}if(E.done)return s(k,v),ut&&xi(k,N),D;if(v===null){for(;!E.done;N++,E=A.next())E=m(k,E.value,M),E!==null&&(x=a(E,x,N),B===null?D=E:B.sibling=E,B=E);return ut&&xi(k,N),D}for(v=n(k,v);!E.done;N++,E=A.next())E=y(v,k,N,E.value,M),E!==null&&(t&&E.alternate!==null&&v.delete(E.key===null?N:E.key),x=a(E,x,N),B===null?D=E:B.sibling=E,B=E);return t&&v.forEach(function(P){return e(k,P)}),ut&&xi(k,N),D}function R(k,x,A,M){if(typeof A=="object"&&A!==null&&A.type===ya&&A.key===null&&(A=A.props.children),typeof A=="object"&&A!==null){switch(A.$$typeof){case vc:e:{for(var D=A.key,B=x;B!==null;){if(B.key===D){if(D=A.type,D===ya){if(B.tag===7){s(k,B.sibling),x=r(B,A.props.children),x.return=k,k=x;break e}}else if(B.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===jr&&r0(D)===B.type){s(k,B.sibling),x=r(B,A.props),x.ref=Po(k,B,A),x.return=k,k=x;break e}s(k,B);break}else e(k,B);B=B.sibling}A.type===ya?(x=ki(A.props.children,k.mode,M,A.key),x.return=k,k=x):(M=id(A.type,A.key,A.props,null,k.mode,M),M.ref=Po(k,x,A),M.return=k,k=M)}return o(k);case xa:e:{for(B=A.key;x!==null;){if(x.key===B)if(x.tag===4&&x.stateNode.containerInfo===A.containerInfo&&x.stateNode.implementation===A.implementation){s(k,x.sibling),x=r(x,A.children||[]),x.return=k,k=x;break e}else{s(k,x);break}else e(k,x);x=x.sibling}x=$h(A,k.mode,M),x.return=k,k=x}return o(k);case jr:return B=A._init,R(k,x,B(A._payload),M)}if(Vo(A))return _(k,x,A,M);if(ko(A))return S(k,x,A,M);Ac(k,A)}return typeof A=="string"&&A!==""||typeof A=="number"?(A=""+A,x!==null&&x.tag===6?(s(k,x.sibling),x=r(x,A),x.return=k,k=x):(s(k,x),x=Vh(A,k.mode,M),x.return=k,k=x),o(k)):s(k,x)}return R}var Ha=Yb(!0),Xb=Yb(!1),Ad=ni(null),Cd=null,Sa=null,lp=null;function cp(){lp=Sa=Cd=null}function dp(t){var e=Ad.current;lt(Ad),t._currentValue=e}function Um(t,e,s){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===s)break;t=t.return}}function Ma(t,e){Cd=t,lp=Sa=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(js=!0),t.firstContext=null)}function en(t){var e=t._currentValue;if(lp!==t)if(t={context:t,memoizedValue:e,next:null},Sa===null){if(Cd===null)throw Error(te(308));Sa=t,Cd.dependencies={lanes:0,firstContext:t}}else Sa=Sa.next=t;return e}var wi=null;function up(t){wi===null?wi=[t]:wi.push(t)}function Zb(t,e,s,n){var r=e.interleaved;return r===null?(s.next=s,up(e)):(s.next=r.next,r.next=s),e.interleaved=s,rr(t,n)}function rr(t,e){t.lanes|=e;var s=t.alternate;for(s!==null&&(s.lanes|=e),s=t,t=t.return;t!==null;)t.childLanes|=e,s=t.alternate,s!==null&&(s.childLanes|=e),s=t,t=t.return;return s.tag===3?s.stateNode:null}var Ir=!1;function hp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ew(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Xn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ur(t,e,s){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,We&2){var r=n.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),n.pending=e,rr(t,s)}return r=n.interleaved,r===null?(e.next=e,up(n)):(e.next=r.next,r.next=e),n.interleaved=e,rr(t,s)}function Zc(t,e,s){if(e=e.updateQueue,e!==null&&(e=e.shared,(s&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,s|=n,e.lanes=s,Yf(t,s)}}function i0(t,e){var s=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var r=null,a=null;if(s=s.firstBaseUpdate,s!==null){do{var o={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};a===null?r=a=o:a=a.next=o,s=s.next}while(s!==null);a===null?r=a=e:a=a.next=e}else r=a=e;s={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:n.shared,effects:n.effects},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=e:t.next=e,s.lastBaseUpdate=e}function Pd(t,e,s,n){var r=t.updateQueue;Ir=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,l=r.shared.pending;if(l!==null){r.shared.pending=null;var c=l,u=c.next;c.next=null,o===null?a=u:o.next=u,o=c;var h=t.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==o&&(l===null?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=c))}if(a!==null){var m=r.baseState;o=0,h=u=c=null,l=a;do{var f=l.lane,y=l.eventTime;if((n&f)===f){h!==null&&(h=h.next={eventTime:y,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var _=t,S=l;switch(f=e,y=s,S.tag){case 1:if(_=S.payload,typeof _=="function"){m=_.call(y,m,f);break e}m=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=S.payload,f=typeof _=="function"?_.call(y,m,f):_,f==null)break e;m=gt({},m,f);break e;case 2:Ir=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,f=r.effects,f===null?r.effects=[l]:f.push(l))}else y={eventTime:y,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(u=h=y,c=m):h=h.next=y,o|=f;if(l=l.next,l===null){if(l=r.shared.pending,l===null)break;f=l,l=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(!0);if(h===null&&(c=m),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=h,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else a===null&&(r.shared.lanes=0);Oi|=o,t.lanes=o,t.memoizedState=m}}function a0(t,e,s){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],r=n.callback;if(r!==null){if(n.callback=null,n=s,typeof r!="function")throw Error(te(191,r));r.call(n)}}}var Wl={},Rn=ni(Wl),wl=ni(Wl),_l=ni(Wl);function _i(t){if(t===Wl)throw Error(te(174));return t}function mp(t,e){switch(at(_l,e),at(wl,t),at(Rn,Wl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:wm(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=wm(e,t)}lt(Rn),at(Rn,e)}function qa(){lt(Rn),lt(wl),lt(_l)}function tw(t){_i(_l.current);var e=_i(Rn.current),s=wm(e,t.type);e!==s&&(at(wl,t),at(Rn,s))}function fp(t){wl.current===t&&(lt(Rn),lt(wl))}var ft=ni(0);function Rd(t){for(var e=t;e!==null;){if(e.tag===13){var s=e.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ch=[];function pp(){for(var t=0;t<Ch.length;t++)Ch[t]._workInProgressVersionPrimary=null;Ch.length=0}var ed=ur.ReactCurrentDispatcher,Ph=ur.ReactCurrentBatchConfig,Mi=0,pt=null,Ot=null,Bt=null,Md=!1,Zo=!1,Nl=0,HI=0;function es(){throw Error(te(321))}function gp(t,e){if(e===null)return!1;for(var s=0;s<e.length&&s<t.length;s++)if(!gn(t[s],e[s]))return!1;return!0}function xp(t,e,s,n,r,a){if(Mi=a,pt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ed.current=t===null||t.memoizedState===null?GI:QI,t=s(n,r),Zo){a=0;do{if(Zo=!1,Nl=0,25<=a)throw Error(te(301));a+=1,Bt=Ot=null,e.updateQueue=null,ed.current=JI,t=s(n,r)}while(Zo)}if(ed.current=Od,e=Ot!==null&&Ot.next!==null,Mi=0,Bt=Ot=pt=null,Md=!1,e)throw Error(te(300));return t}function yp(){var t=Nl!==0;return Nl=0,t}function En(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bt===null?pt.memoizedState=Bt=t:Bt=Bt.next=t,Bt}function tn(){if(Ot===null){var t=pt.alternate;t=t!==null?t.memoizedState:null}else t=Ot.next;var e=Bt===null?pt.memoizedState:Bt.next;if(e!==null)Bt=e,Ot=t;else{if(t===null)throw Error(te(310));Ot=t,t={memoizedState:Ot.memoizedState,baseState:Ot.baseState,baseQueue:Ot.baseQueue,queue:Ot.queue,next:null},Bt===null?pt.memoizedState=Bt=t:Bt=Bt.next=t}return Bt}function jl(t,e){return typeof e=="function"?e(t):e}function Rh(t){var e=tn(),s=e.queue;if(s===null)throw Error(te(311));s.lastRenderedReducer=t;var n=Ot,r=n.baseQueue,a=s.pending;if(a!==null){if(r!==null){var o=r.next;r.next=a.next,a.next=o}n.baseQueue=r=a,s.pending=null}if(r!==null){a=r.next,n=n.baseState;var l=o=null,c=null,u=a;do{var h=u.lane;if((Mi&h)===h)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:t(n,u.action);else{var m={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(l=c=m,o=n):c=c.next=m,pt.lanes|=h,Oi|=h}u=u.next}while(u!==null&&u!==a);c===null?o=n:c.next=l,gn(n,e.memoizedState)||(js=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,s.lastRenderedState=n}if(t=s.interleaved,t!==null){r=t;do a=r.lane,pt.lanes|=a,Oi|=a,r=r.next;while(r!==t)}else r===null&&(s.lanes=0);return[e.memoizedState,s.dispatch]}function Mh(t){var e=tn(),s=e.queue;if(s===null)throw Error(te(311));s.lastRenderedReducer=t;var n=s.dispatch,r=s.pending,a=e.memoizedState;if(r!==null){s.pending=null;var o=r=r.next;do a=t(a,o.action),o=o.next;while(o!==r);gn(a,e.memoizedState)||(js=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),s.lastRenderedState=a}return[a,n]}function sw(){}function nw(t,e){var s=pt,n=tn(),r=e(),a=!gn(n.memoizedState,r);if(a&&(n.memoizedState=r,js=!0),n=n.queue,vp(aw.bind(null,s,n,t),[t]),n.getSnapshot!==e||a||Bt!==null&&Bt.memoizedState.tag&1){if(s.flags|=2048,Il(9,iw.bind(null,s,n,r,e),void 0,null),zt===null)throw Error(te(349));Mi&30||rw(s,e,r)}return r}function rw(t,e,s){t.flags|=16384,t={getSnapshot:e,value:s},e=pt.updateQueue,e===null?(e={lastEffect:null,stores:null},pt.updateQueue=e,e.stores=[t]):(s=e.stores,s===null?e.stores=[t]:s.push(t))}function iw(t,e,s,n){e.value=s,e.getSnapshot=n,ow(e)&&lw(t)}function aw(t,e,s){return s(function(){ow(e)&&lw(t)})}function ow(t){var e=t.getSnapshot;t=t.value;try{var s=e();return!gn(t,s)}catch{return!0}}function lw(t){var e=rr(t,1);e!==null&&fn(e,t,1,-1)}function o0(t){var e=En();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:jl,lastRenderedState:t},e.queue=t,t=t.dispatch=KI.bind(null,pt,t),[e.memoizedState,t]}function Il(t,e,s,n){return t={tag:t,create:e,destroy:s,deps:n,next:null},e=pt.updateQueue,e===null?(e={lastEffect:null,stores:null},pt.updateQueue=e,e.lastEffect=t.next=t):(s=e.lastEffect,s===null?e.lastEffect=t.next=t:(n=s.next,s.next=t,t.next=n,e.lastEffect=t)),t}function cw(){return tn().memoizedState}function td(t,e,s,n){var r=En();pt.flags|=t,r.memoizedState=Il(1|e,s,void 0,n===void 0?null:n)}function vu(t,e,s,n){var r=tn();n=n===void 0?null:n;var a=void 0;if(Ot!==null){var o=Ot.memoizedState;if(a=o.destroy,n!==null&&gp(n,o.deps)){r.memoizedState=Il(e,s,a,n);return}}pt.flags|=t,r.memoizedState=Il(1|e,s,a,n)}function l0(t,e){return td(8390656,8,t,e)}function vp(t,e){return vu(2048,8,t,e)}function dw(t,e){return vu(4,2,t,e)}function uw(t,e){return vu(4,4,t,e)}function hw(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function mw(t,e,s){return s=s!=null?s.concat([t]):null,vu(4,4,hw.bind(null,e,t),s)}function bp(){}function fw(t,e){var s=tn();e=e===void 0?null:e;var n=s.memoizedState;return n!==null&&e!==null&&gp(e,n[1])?n[0]:(s.memoizedState=[t,e],t)}function pw(t,e){var s=tn();e=e===void 0?null:e;var n=s.memoizedState;return n!==null&&e!==null&&gp(e,n[1])?n[0]:(t=t(),s.memoizedState=[t,e],t)}function gw(t,e,s){return Mi&21?(gn(s,e)||(s=wb(),pt.lanes|=s,Oi|=s,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,js=!0),t.memoizedState=s)}function qI(t,e){var s=Xe;Xe=s!==0&&4>s?s:4,t(!0);var n=Ph.transition;Ph.transition={};try{t(!1),e()}finally{Xe=s,Ph.transition=n}}function xw(){return tn().memoizedState}function WI(t,e,s){var n=zr(t);if(s={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null},yw(t))vw(e,s);else if(s=Zb(t,e,s,n),s!==null){var r=ms();fn(s,t,n,r),bw(s,e,n)}}function KI(t,e,s){var n=zr(t),r={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null};if(yw(t))vw(e,r);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,l=a(o,s);if(r.hasEagerState=!0,r.eagerState=l,gn(l,o)){var c=e.interleaved;c===null?(r.next=r,up(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}s=Zb(t,e,r,n),s!==null&&(r=ms(),fn(s,t,n,r),bw(s,e,n))}}function yw(t){var e=t.alternate;return t===pt||e!==null&&e===pt}function vw(t,e){Zo=Md=!0;var s=t.pending;s===null?e.next=e:(e.next=s.next,s.next=e),t.pending=e}function bw(t,e,s){if(s&4194240){var n=e.lanes;n&=t.pendingLanes,s|=n,e.lanes=s,Yf(t,s)}}var Od={readContext:en,useCallback:es,useContext:es,useEffect:es,useImperativeHandle:es,useInsertionEffect:es,useLayoutEffect:es,useMemo:es,useReducer:es,useRef:es,useState:es,useDebugValue:es,useDeferredValue:es,useTransition:es,useMutableSource:es,useSyncExternalStore:es,useId:es,unstable_isNewReconciler:!1},GI={readContext:en,useCallback:function(t,e){return En().memoizedState=[t,e===void 0?null:e],t},useContext:en,useEffect:l0,useImperativeHandle:function(t,e,s){return s=s!=null?s.concat([t]):null,td(4194308,4,hw.bind(null,e,t),s)},useLayoutEffect:function(t,e){return td(4194308,4,t,e)},useInsertionEffect:function(t,e){return td(4,2,t,e)},useMemo:function(t,e){var s=En();return e=e===void 0?null:e,t=t(),s.memoizedState=[t,e],t},useReducer:function(t,e,s){var n=En();return e=s!==void 0?s(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=WI.bind(null,pt,t),[n.memoizedState,t]},useRef:function(t){var e=En();return t={current:t},e.memoizedState=t},useState:o0,useDebugValue:bp,useDeferredValue:function(t){return En().memoizedState=t},useTransition:function(){var t=o0(!1),e=t[0];return t=qI.bind(null,t[1]),En().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,s){var n=pt,r=En();if(ut){if(s===void 0)throw Error(te(407));s=s()}else{if(s=e(),zt===null)throw Error(te(349));Mi&30||rw(n,e,s)}r.memoizedState=s;var a={value:s,getSnapshot:e};return r.queue=a,l0(aw.bind(null,n,a,t),[t]),n.flags|=2048,Il(9,iw.bind(null,n,a,s,e),void 0,null),s},useId:function(){var t=En(),e=zt.identifierPrefix;if(ut){var s=Qn,n=Gn;s=(n&~(1<<32-mn(n)-1)).toString(32)+s,e=":"+e+"R"+s,s=Nl++,0<s&&(e+="H"+s.toString(32)),e+=":"}else s=HI++,e=":"+e+"r"+s.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},QI={readContext:en,useCallback:fw,useContext:en,useEffect:vp,useImperativeHandle:mw,useInsertionEffect:dw,useLayoutEffect:uw,useMemo:pw,useReducer:Rh,useRef:cw,useState:function(){return Rh(jl)},useDebugValue:bp,useDeferredValue:function(t){var e=tn();return gw(e,Ot.memoizedState,t)},useTransition:function(){var t=Rh(jl)[0],e=tn().memoizedState;return[t,e]},useMutableSource:sw,useSyncExternalStore:nw,useId:xw,unstable_isNewReconciler:!1},JI={readContext:en,useCallback:fw,useContext:en,useEffect:vp,useImperativeHandle:mw,useInsertionEffect:dw,useLayoutEffect:uw,useMemo:pw,useReducer:Mh,useRef:cw,useState:function(){return Mh(jl)},useDebugValue:bp,useDeferredValue:function(t){var e=tn();return Ot===null?e.memoizedState=t:gw(e,Ot.memoizedState,t)},useTransition:function(){var t=Mh(jl)[0],e=tn().memoizedState;return[t,e]},useMutableSource:sw,useSyncExternalStore:nw,useId:xw,unstable_isNewReconciler:!1};function cn(t,e){if(t&&t.defaultProps){e=gt({},e),t=t.defaultProps;for(var s in t)e[s]===void 0&&(e[s]=t[s]);return e}return e}function Bm(t,e,s,n){e=t.memoizedState,s=s(n,e),s=s==null?e:gt({},e,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var bu={isMounted:function(t){return(t=t._reactInternals)?Ki(t)===t:!1},enqueueSetState:function(t,e,s){t=t._reactInternals;var n=ms(),r=zr(t),a=Xn(n,r);a.payload=e,s!=null&&(a.callback=s),e=Ur(t,a,r),e!==null&&(fn(e,t,r,n),Zc(e,t,r))},enqueueReplaceState:function(t,e,s){t=t._reactInternals;var n=ms(),r=zr(t),a=Xn(n,r);a.tag=1,a.payload=e,s!=null&&(a.callback=s),e=Ur(t,a,r),e!==null&&(fn(e,t,r,n),Zc(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var s=ms(),n=zr(t),r=Xn(s,n);r.tag=2,e!=null&&(r.callback=e),e=Ur(t,r,n),e!==null&&(fn(e,t,n,s),Zc(e,t,n))}};function c0(t,e,s,n,r,a,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,a,o):e.prototype&&e.prototype.isPureReactComponent?!xl(s,n)||!xl(r,a):!0}function ww(t,e,s){var n=!1,r=Qr,a=e.contextType;return typeof a=="object"&&a!==null?a=en(a):(r=ks(e)?Pi:ls.current,n=e.contextTypes,a=(n=n!=null)?Ba(t,r):Qr),e=new e(s,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=bu,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=a),e}function d0(t,e,s,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(s,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(s,n),e.state!==t&&bu.enqueueReplaceState(e,e.state,null)}function zm(t,e,s,n){var r=t.stateNode;r.props=s,r.state=t.memoizedState,r.refs={},hp(t);var a=e.contextType;typeof a=="object"&&a!==null?r.context=en(a):(a=ks(e)?Pi:ls.current,r.context=Ba(t,a)),r.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(Bm(t,e,a,s),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&bu.enqueueReplaceState(r,r.state,null),Pd(t,s,r,n),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Wa(t,e){try{var s="",n=e;do s+=j2(n),n=n.return;while(n);var r=s}catch(a){r=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:r,digest:null}}function Oh(t,e,s){return{value:t,source:null,stack:s??null,digest:e??null}}function Hm(t,e){try{console.error(e.value)}catch(s){setTimeout(function(){throw s})}}var YI=typeof WeakMap=="function"?WeakMap:Map;function _w(t,e,s){s=Xn(-1,s),s.tag=3,s.payload={element:null};var n=e.value;return s.callback=function(){Vd||(Vd=!0,ef=n),Hm(t,e)},s}function Nw(t,e,s){s=Xn(-1,s),s.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var r=e.value;s.payload=function(){return n(r)},s.callback=function(){Hm(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(s.callback=function(){Hm(t,e),typeof n!="function"&&(Br===null?Br=new Set([this]):Br.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),s}function u0(t,e,s){var n=t.pingCache;if(n===null){n=t.pingCache=new YI;var r=new Set;n.set(e,r)}else r=n.get(e),r===void 0&&(r=new Set,n.set(e,r));r.has(s)||(r.add(s),t=uS.bind(null,t,e,s),e.then(t,t))}function h0(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function m0(t,e,s,n,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(e=Xn(-1,1),e.tag=2,Ur(s,e,1))),s.lanes|=1),t)}var XI=ur.ReactCurrentOwner,js=!1;function us(t,e,s,n){e.child=t===null?Xb(e,null,s,n):Ha(e,t.child,s,n)}function f0(t,e,s,n,r){s=s.render;var a=e.ref;return Ma(e,r),n=xp(t,e,s,n,a,r),s=yp(),t!==null&&!js?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,ir(t,e,r)):(ut&&s&&ip(e),e.flags|=1,us(t,e,n,r),e.child)}function p0(t,e,s,n,r){if(t===null){var a=s.type;return typeof a=="function"&&!Ep(a)&&a.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(e.tag=15,e.type=a,jw(t,e,a,n,r)):(t=id(s.type,null,n,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&r)){var o=a.memoizedProps;if(s=s.compare,s=s!==null?s:xl,s(o,n)&&t.ref===e.ref)return ir(t,e,r)}return e.flags|=1,t=Hr(a,n),t.ref=e.ref,t.return=e,e.child=t}function jw(t,e,s,n,r){if(t!==null){var a=t.memoizedProps;if(xl(a,n)&&t.ref===e.ref)if(js=!1,e.pendingProps=n=a,(t.lanes&r)!==0)t.flags&131072&&(js=!0);else return e.lanes=t.lanes,ir(t,e,r)}return qm(t,e,s,n,r)}function Iw(t,e,s){var n=e.pendingProps,r=n.children,a=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},at(Ea,Os),Os|=s;else{if(!(s&1073741824))return t=a!==null?a.baseLanes|s:s,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,at(Ea,Os),Os|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=a!==null?a.baseLanes:s,at(Ea,Os),Os|=n}else a!==null?(n=a.baseLanes|s,e.memoizedState=null):n=s,at(Ea,Os),Os|=n;return us(t,e,r,s),e.child}function Sw(t,e){var s=e.ref;(t===null&&s!==null||t!==null&&t.ref!==s)&&(e.flags|=512,e.flags|=2097152)}function qm(t,e,s,n,r){var a=ks(s)?Pi:ls.current;return a=Ba(e,a),Ma(e,r),s=xp(t,e,s,n,a,r),n=yp(),t!==null&&!js?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,ir(t,e,r)):(ut&&n&&ip(e),e.flags|=1,us(t,e,s,r),e.child)}function g0(t,e,s,n,r){if(ks(s)){var a=!0;kd(e)}else a=!1;if(Ma(e,r),e.stateNode===null)sd(t,e),ww(e,s,n),zm(e,s,n,r),n=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,u=s.contextType;typeof u=="object"&&u!==null?u=en(u):(u=ks(s)?Pi:ls.current,u=Ba(e,u));var h=s.getDerivedStateFromProps,m=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";m||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==n||c!==u)&&d0(e,o,n,u),Ir=!1;var f=e.memoizedState;o.state=f,Pd(e,n,o,r),c=e.memoizedState,l!==n||f!==c||Ss.current||Ir?(typeof h=="function"&&(Bm(e,s,h,n),c=e.memoizedState),(l=Ir||c0(e,s,l,n,f,c,u))?(m||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),o.props=n,o.state=c,o.context=u,n=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,ew(t,e),l=e.memoizedProps,u=e.type===e.elementType?l:cn(e.type,l),o.props=u,m=e.pendingProps,f=o.context,c=s.contextType,typeof c=="object"&&c!==null?c=en(c):(c=ks(s)?Pi:ls.current,c=Ba(e,c));var y=s.getDerivedStateFromProps;(h=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==m||f!==c)&&d0(e,o,n,c),Ir=!1,f=e.memoizedState,o.state=f,Pd(e,n,o,r);var _=e.memoizedState;l!==m||f!==_||Ss.current||Ir?(typeof y=="function"&&(Bm(e,s,y,n),_=e.memoizedState),(u=Ir||c0(e,s,u,n,f,_,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,_,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,_,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=_),o.props=n,o.state=_,o.context=c,n=u):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),n=!1)}return Wm(t,e,s,n,a,r)}function Wm(t,e,s,n,r,a){Sw(t,e);var o=(e.flags&128)!==0;if(!n&&!o)return r&&t0(e,s,!1),ir(t,e,a);n=e.stateNode,XI.current=e;var l=o&&typeof s.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&o?(e.child=Ha(e,t.child,null,a),e.child=Ha(e,null,l,a)):us(t,e,l,a),e.memoizedState=n.state,r&&t0(e,s,!0),e.child}function kw(t){var e=t.stateNode;e.pendingContext?e0(t,e.pendingContext,e.pendingContext!==e.context):e.context&&e0(t,e.context,!1),mp(t,e.containerInfo)}function x0(t,e,s,n,r){return za(),op(r),e.flags|=256,us(t,e,s,n),e.child}var Km={dehydrated:null,treeContext:null,retryLane:0};function Gm(t){return{baseLanes:t,cachePool:null,transitions:null}}function Ew(t,e,s){var n=e.pendingProps,r=ft.current,a=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(r&2)!==0),l?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),at(ft,r&1),t===null)return Dm(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,t=n.fallback,a?(n=e.mode,a=e.child,o={mode:"hidden",children:o},!(n&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=Nu(o,n,0,null),t=ki(t,n,s,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=Gm(s),e.memoizedState=Km,t):wp(e,o));if(r=t.memoizedState,r!==null&&(l=r.dehydrated,l!==null))return ZI(t,e,o,n,l,r,s);if(a){a=n.fallback,o=e.mode,r=t.child,l=r.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&e.child!==r?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=Hr(r,c),n.subtreeFlags=r.subtreeFlags&14680064),l!==null?a=Hr(l,a):(a=ki(a,o,s,null),a.flags|=2),a.return=e,n.return=e,n.sibling=a,e.child=n,n=a,a=e.child,o=t.child.memoizedState,o=o===null?Gm(s):{baseLanes:o.baseLanes|s,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=t.childLanes&~s,e.memoizedState=Km,n}return a=t.child,t=a.sibling,n=Hr(a,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=s),n.return=e,n.sibling=null,t!==null&&(s=e.deletions,s===null?(e.deletions=[t],e.flags|=16):s.push(t)),e.child=n,e.memoizedState=null,n}function wp(t,e){return e=Nu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Cc(t,e,s,n){return n!==null&&op(n),Ha(e,t.child,null,s),t=wp(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function ZI(t,e,s,n,r,a,o){if(s)return e.flags&256?(e.flags&=-257,n=Oh(Error(te(422))),Cc(t,e,o,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=n.fallback,r=e.mode,n=Nu({mode:"visible",children:n.children},r,0,null),a=ki(a,r,o,null),a.flags|=2,n.return=e,a.return=e,n.sibling=a,e.child=n,e.mode&1&&Ha(e,t.child,null,o),e.child.memoizedState=Gm(o),e.memoizedState=Km,a);if(!(e.mode&1))return Cc(t,e,o,null);if(r.data==="$!"){if(n=r.nextSibling&&r.nextSibling.dataset,n)var l=n.dgst;return n=l,a=Error(te(419)),n=Oh(a,n,void 0),Cc(t,e,o,n)}if(l=(o&t.childLanes)!==0,js||l){if(n=zt,n!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(n.suspendedLanes|o)?0:r,r!==0&&r!==a.retryLane&&(a.retryLane=r,rr(t,r),fn(n,t,r,-1))}return kp(),n=Oh(Error(te(421))),Cc(t,e,o,n)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=hS.bind(null,t),r._reactRetry=e,null):(t=a.treeContext,$s=Dr(r.nextSibling),Us=e,ut=!0,un=null,t!==null&&(Gs[Qs++]=Gn,Gs[Qs++]=Qn,Gs[Qs++]=Ri,Gn=t.id,Qn=t.overflow,Ri=e),e=wp(e,n.children),e.flags|=4096,e)}function y0(t,e,s){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),Um(t.return,e,s)}function Lh(t,e,s,n,r){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=s,a.tailMode=r)}function Tw(t,e,s){var n=e.pendingProps,r=n.revealOrder,a=n.tail;if(us(t,e,n.children,s),n=ft.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&y0(t,s,e);else if(t.tag===19)y0(t,s,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(at(ft,n),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(s=e.child,r=null;s!==null;)t=s.alternate,t!==null&&Rd(t)===null&&(r=s),s=s.sibling;s=r,s===null?(r=e.child,e.child=null):(r=s.sibling,s.sibling=null),Lh(e,!1,r,s,a);break;case"backwards":for(s=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Rd(t)===null){e.child=r;break}t=r.sibling,r.sibling=s,s=r,r=t}Lh(e,!0,s,null,a);break;case"together":Lh(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function sd(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ir(t,e,s){if(t!==null&&(e.dependencies=t.dependencies),Oi|=e.lanes,!(s&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(te(153));if(e.child!==null){for(t=e.child,s=Hr(t,t.pendingProps),e.child=s,s.return=e;t.sibling!==null;)t=t.sibling,s=s.sibling=Hr(t,t.pendingProps),s.return=e;s.sibling=null}return e.child}function eS(t,e,s){switch(e.tag){case 3:kw(e),za();break;case 5:tw(e);break;case 1:ks(e.type)&&kd(e);break;case 4:mp(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,r=e.memoizedProps.value;at(Ad,n._currentValue),n._currentValue=r;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(at(ft,ft.current&1),e.flags|=128,null):s&e.child.childLanes?Ew(t,e,s):(at(ft,ft.current&1),t=ir(t,e,s),t!==null?t.sibling:null);at(ft,ft.current&1);break;case 19:if(n=(s&e.childLanes)!==0,t.flags&128){if(n)return Tw(t,e,s);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),at(ft,ft.current),n)break;return null;case 22:case 23:return e.lanes=0,Iw(t,e,s)}return ir(t,e,s)}var Aw,Qm,Cw,Pw;Aw=function(t,e){for(var s=e.child;s!==null;){if(s.tag===5||s.tag===6)t.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};Qm=function(){};Cw=function(t,e,s,n){var r=t.memoizedProps;if(r!==n){t=e.stateNode,_i(Rn.current);var a=null;switch(s){case"input":r=xm(t,r),n=xm(t,n),a=[];break;case"select":r=gt({},r,{value:void 0}),n=gt({},n,{value:void 0}),a=[];break;case"textarea":r=bm(t,r),n=bm(t,n),a=[];break;default:typeof r.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=Id)}_m(s,n);var o;s=null;for(u in r)if(!n.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var l=r[u];for(o in l)l.hasOwnProperty(o)&&(s||(s={}),s[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(dl.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in n){var c=n[u];if(l=r!=null?r[u]:void 0,n.hasOwnProperty(u)&&c!==l&&(c!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(s||(s={}),s[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(s||(s={}),s[o]=c[o])}else s||(a||(a=[]),a.push(u,s)),s=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(a=a||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(a=a||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(dl.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&ot("scroll",t),a||l===c||(a=[])):(a=a||[]).push(u,c))}s&&(a=a||[]).push("style",s);var u=a;(e.updateQueue=u)&&(e.flags|=4)}};Pw=function(t,e,s,n){s!==n&&(e.flags|=4)};function Ro(t,e){if(!ut)switch(t.tailMode){case"hidden":e=t.tail;for(var s=null;e!==null;)e.alternate!==null&&(s=e),e=e.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function ts(t){var e=t.alternate!==null&&t.alternate.child===t.child,s=0,n=0;if(e)for(var r=t.child;r!==null;)s|=r.lanes|r.childLanes,n|=r.subtreeFlags&14680064,n|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)s|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=n,t.childLanes=s,e}function tS(t,e,s){var n=e.pendingProps;switch(ap(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ts(e),null;case 1:return ks(e.type)&&Sd(),ts(e),null;case 3:return n=e.stateNode,qa(),lt(Ss),lt(ls),pp(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(Tc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,un!==null&&(nf(un),un=null))),Qm(t,e),ts(e),null;case 5:fp(e);var r=_i(_l.current);if(s=e.type,t!==null&&e.stateNode!=null)Cw(t,e,s,n,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(te(166));return ts(e),null}if(t=_i(Rn.current),Tc(e)){n=e.stateNode,s=e.type;var a=e.memoizedProps;switch(n[An]=e,n[bl]=a,t=(e.mode&1)!==0,s){case"dialog":ot("cancel",n),ot("close",n);break;case"iframe":case"object":case"embed":ot("load",n);break;case"video":case"audio":for(r=0;r<Fo.length;r++)ot(Fo[r],n);break;case"source":ot("error",n);break;case"img":case"image":case"link":ot("error",n),ot("load",n);break;case"details":ot("toggle",n);break;case"input":kx(n,a),ot("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},ot("invalid",n);break;case"textarea":Tx(n,a),ot("invalid",n)}_m(s,a),r=null;for(var o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="children"?typeof l=="string"?n.textContent!==l&&(a.suppressHydrationWarning!==!0&&Ec(n.textContent,l,t),r=["children",l]):typeof l=="number"&&n.textContent!==""+l&&(a.suppressHydrationWarning!==!0&&Ec(n.textContent,l,t),r=["children",""+l]):dl.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&ot("scroll",n)}switch(s){case"input":bc(n),Ex(n,a,!0);break;case"textarea":bc(n),Ax(n);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(n.onclick=Id)}n=r,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=ab(s)),t==="http://www.w3.org/1999/xhtml"?s==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=o.createElement(s,{is:n.is}):(t=o.createElement(s),s==="select"&&(o=t,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):t=o.createElementNS(t,s),t[An]=e,t[bl]=n,Aw(t,e,!1,!1),e.stateNode=t;e:{switch(o=Nm(s,n),s){case"dialog":ot("cancel",t),ot("close",t),r=n;break;case"iframe":case"object":case"embed":ot("load",t),r=n;break;case"video":case"audio":for(r=0;r<Fo.length;r++)ot(Fo[r],t);r=n;break;case"source":ot("error",t),r=n;break;case"img":case"image":case"link":ot("error",t),ot("load",t),r=n;break;case"details":ot("toggle",t),r=n;break;case"input":kx(t,n),r=xm(t,n),ot("invalid",t);break;case"option":r=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},r=gt({},n,{value:void 0}),ot("invalid",t);break;case"textarea":Tx(t,n),r=bm(t,n),ot("invalid",t);break;default:r=n}_m(s,r),l=r;for(a in l)if(l.hasOwnProperty(a)){var c=l[a];a==="style"?cb(t,c):a==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&ob(t,c)):a==="children"?typeof c=="string"?(s!=="textarea"||c!=="")&&ul(t,c):typeof c=="number"&&ul(t,""+c):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(dl.hasOwnProperty(a)?c!=null&&a==="onScroll"&&ot("scroll",t):c!=null&&qf(t,a,c,o))}switch(s){case"input":bc(t),Ex(t,n,!1);break;case"textarea":bc(t),Ax(t);break;case"option":n.value!=null&&t.setAttribute("value",""+Gr(n.value));break;case"select":t.multiple=!!n.multiple,a=n.value,a!=null?Aa(t,!!n.multiple,a,!1):n.defaultValue!=null&&Aa(t,!!n.multiple,n.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Id)}switch(s){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ts(e),null;case 6:if(t&&e.stateNode!=null)Pw(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(te(166));if(s=_i(_l.current),_i(Rn.current),Tc(e)){if(n=e.stateNode,s=e.memoizedProps,n[An]=e,(a=n.nodeValue!==s)&&(t=Us,t!==null))switch(t.tag){case 3:Ec(n.nodeValue,s,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Ec(n.nodeValue,s,(t.mode&1)!==0)}a&&(e.flags|=4)}else n=(s.nodeType===9?s:s.ownerDocument).createTextNode(n),n[An]=e,e.stateNode=n}return ts(e),null;case 13:if(lt(ft),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ut&&$s!==null&&e.mode&1&&!(e.flags&128))Jb(),za(),e.flags|=98560,a=!1;else if(a=Tc(e),n!==null&&n.dehydrated!==null){if(t===null){if(!a)throw Error(te(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(te(317));a[An]=e}else za(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ts(e),a=!1}else un!==null&&(nf(un),un=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=s,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||ft.current&1?Lt===0&&(Lt=3):kp())),e.updateQueue!==null&&(e.flags|=4),ts(e),null);case 4:return qa(),Qm(t,e),t===null&&yl(e.stateNode.containerInfo),ts(e),null;case 10:return dp(e.type._context),ts(e),null;case 17:return ks(e.type)&&Sd(),ts(e),null;case 19:if(lt(ft),a=e.memoizedState,a===null)return ts(e),null;if(n=(e.flags&128)!==0,o=a.rendering,o===null)if(n)Ro(a,!1);else{if(Lt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Rd(t),o!==null){for(e.flags|=128,Ro(a,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=s,s=e.child;s!==null;)a=s,t=n,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,t=o.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),s=s.sibling;return at(ft,ft.current&1|2),e.child}t=t.sibling}a.tail!==null&&St()>Ka&&(e.flags|=128,n=!0,Ro(a,!1),e.lanes=4194304)}else{if(!n)if(t=Rd(o),t!==null){if(e.flags|=128,n=!0,s=t.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),Ro(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!ut)return ts(e),null}else 2*St()-a.renderingStartTime>Ka&&s!==1073741824&&(e.flags|=128,n=!0,Ro(a,!1),e.lanes=4194304);a.isBackwards?(o.sibling=e.child,e.child=o):(s=a.last,s!==null?s.sibling=o:e.child=o,a.last=o)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=St(),e.sibling=null,s=ft.current,at(ft,n?s&1|2:s&1),e):(ts(e),null);case 22:case 23:return Sp(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Os&1073741824&&(ts(e),e.subtreeFlags&6&&(e.flags|=8192)):ts(e),null;case 24:return null;case 25:return null}throw Error(te(156,e.tag))}function sS(t,e){switch(ap(e),e.tag){case 1:return ks(e.type)&&Sd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return qa(),lt(Ss),lt(ls),pp(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return fp(e),null;case 13:if(lt(ft),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(te(340));za()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return lt(ft),null;case 4:return qa(),null;case 10:return dp(e.type._context),null;case 22:case 23:return Sp(),null;case 24:return null;default:return null}}var Pc=!1,rs=!1,nS=typeof WeakSet=="function"?WeakSet:Set,me=null;function ka(t,e){var s=t.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(n){bt(t,e,n)}else s.current=null}function Jm(t,e,s){try{s()}catch(n){bt(t,e,n)}}var v0=!1;function rS(t,e){if(Rm=_d,t=Vb(),rp(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var r=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{s.nodeType,a.nodeType}catch{s=null;break e}var o=0,l=-1,c=-1,u=0,h=0,m=t,f=null;t:for(;;){for(var y;m!==s||r!==0&&m.nodeType!==3||(l=o+r),m!==a||n!==0&&m.nodeType!==3||(c=o+n),m.nodeType===3&&(o+=m.nodeValue.length),(y=m.firstChild)!==null;)f=m,m=y;for(;;){if(m===t)break t;if(f===s&&++u===r&&(l=o),f===a&&++h===n&&(c=o),(y=m.nextSibling)!==null)break;m=f,f=m.parentNode}m=y}s=l===-1||c===-1?null:{start:l,end:c}}else s=null}s=s||{start:0,end:0}}else s=null;for(Mm={focusedElem:t,selectionRange:s},_d=!1,me=e;me!==null;)if(e=me,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,me=t;else for(;me!==null;){e=me;try{var _=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var S=_.memoizedProps,R=_.memoizedState,k=e.stateNode,x=k.getSnapshotBeforeUpdate(e.elementType===e.type?S:cn(e.type,S),R);k.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var A=e.stateNode.containerInfo;A.nodeType===1?A.textContent="":A.nodeType===9&&A.documentElement&&A.removeChild(A.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(te(163))}}catch(M){bt(e,e.return,M)}if(t=e.sibling,t!==null){t.return=e.return,me=t;break}me=e.return}return _=v0,v0=!1,_}function el(t,e,s){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do{if((r.tag&t)===t){var a=r.destroy;r.destroy=void 0,a!==void 0&&Jm(e,s,a)}r=r.next}while(r!==n)}}function wu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var s=e=e.next;do{if((s.tag&t)===t){var n=s.create;s.destroy=n()}s=s.next}while(s!==e)}}function Ym(t){var e=t.ref;if(e!==null){var s=t.stateNode;switch(t.tag){case 5:t=s;break;default:t=s}typeof e=="function"?e(t):e.current=t}}function Rw(t){var e=t.alternate;e!==null&&(t.alternate=null,Rw(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[An],delete e[bl],delete e[Vm],delete e[DI],delete e[UI])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Mw(t){return t.tag===5||t.tag===3||t.tag===4}function b0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Mw(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Xm(t,e,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?s.nodeType===8?s.parentNode.insertBefore(t,e):s.insertBefore(t,e):(s.nodeType===8?(e=s.parentNode,e.insertBefore(t,s)):(e=s,e.appendChild(t)),s=s._reactRootContainer,s!=null||e.onclick!==null||(e.onclick=Id));else if(n!==4&&(t=t.child,t!==null))for(Xm(t,e,s),t=t.sibling;t!==null;)Xm(t,e,s),t=t.sibling}function Zm(t,e,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?s.insertBefore(t,e):s.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Zm(t,e,s),t=t.sibling;t!==null;)Zm(t,e,s),t=t.sibling}var Wt=null,dn=!1;function wr(t,e,s){for(s=s.child;s!==null;)Ow(t,e,s),s=s.sibling}function Ow(t,e,s){if(Pn&&typeof Pn.onCommitFiberUnmount=="function")try{Pn.onCommitFiberUnmount(mu,s)}catch{}switch(s.tag){case 5:rs||ka(s,e);case 6:var n=Wt,r=dn;Wt=null,wr(t,e,s),Wt=n,dn=r,Wt!==null&&(dn?(t=Wt,s=s.stateNode,t.nodeType===8?t.parentNode.removeChild(s):t.removeChild(s)):Wt.removeChild(s.stateNode));break;case 18:Wt!==null&&(dn?(t=Wt,s=s.stateNode,t.nodeType===8?Th(t.parentNode,s):t.nodeType===1&&Th(t,s),pl(t)):Th(Wt,s.stateNode));break;case 4:n=Wt,r=dn,Wt=s.stateNode.containerInfo,dn=!0,wr(t,e,s),Wt=n,dn=r;break;case 0:case 11:case 14:case 15:if(!rs&&(n=s.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){r=n=n.next;do{var a=r,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&Jm(s,e,o),r=r.next}while(r!==n)}wr(t,e,s);break;case 1:if(!rs&&(ka(s,e),n=s.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=s.memoizedProps,n.state=s.memoizedState,n.componentWillUnmount()}catch(l){bt(s,e,l)}wr(t,e,s);break;case 21:wr(t,e,s);break;case 22:s.mode&1?(rs=(n=rs)||s.memoizedState!==null,wr(t,e,s),rs=n):wr(t,e,s);break;default:wr(t,e,s)}}function w0(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var s=t.stateNode;s===null&&(s=t.stateNode=new nS),e.forEach(function(n){var r=mS.bind(null,t,n);s.has(n)||(s.add(n),n.then(r,r))})}}function ln(t,e){var s=e.deletions;if(s!==null)for(var n=0;n<s.length;n++){var r=s[n];try{var a=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:Wt=l.stateNode,dn=!1;break e;case 3:Wt=l.stateNode.containerInfo,dn=!0;break e;case 4:Wt=l.stateNode.containerInfo,dn=!0;break e}l=l.return}if(Wt===null)throw Error(te(160));Ow(a,o,r),Wt=null,dn=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(u){bt(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Lw(e,t),e=e.sibling}function Lw(t,e){var s=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ln(e,t),Sn(t),n&4){try{el(3,t,t.return),wu(3,t)}catch(S){bt(t,t.return,S)}try{el(5,t,t.return)}catch(S){bt(t,t.return,S)}}break;case 1:ln(e,t),Sn(t),n&512&&s!==null&&ka(s,s.return);break;case 5:if(ln(e,t),Sn(t),n&512&&s!==null&&ka(s,s.return),t.flags&32){var r=t.stateNode;try{ul(r,"")}catch(S){bt(t,t.return,S)}}if(n&4&&(r=t.stateNode,r!=null)){var a=t.memoizedProps,o=s!==null?s.memoizedProps:a,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&a.type==="radio"&&a.name!=null&&rb(r,a),Nm(l,o);var u=Nm(l,a);for(o=0;o<c.length;o+=2){var h=c[o],m=c[o+1];h==="style"?cb(r,m):h==="dangerouslySetInnerHTML"?ob(r,m):h==="children"?ul(r,m):qf(r,h,m,u)}switch(l){case"input":ym(r,a);break;case"textarea":ib(r,a);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var y=a.value;y!=null?Aa(r,!!a.multiple,y,!1):f!==!!a.multiple&&(a.defaultValue!=null?Aa(r,!!a.multiple,a.defaultValue,!0):Aa(r,!!a.multiple,a.multiple?[]:"",!1))}r[bl]=a}catch(S){bt(t,t.return,S)}}break;case 6:if(ln(e,t),Sn(t),n&4){if(t.stateNode===null)throw Error(te(162));r=t.stateNode,a=t.memoizedProps;try{r.nodeValue=a}catch(S){bt(t,t.return,S)}}break;case 3:if(ln(e,t),Sn(t),n&4&&s!==null&&s.memoizedState.isDehydrated)try{pl(e.containerInfo)}catch(S){bt(t,t.return,S)}break;case 4:ln(e,t),Sn(t);break;case 13:ln(e,t),Sn(t),r=t.child,r.flags&8192&&(a=r.memoizedState!==null,r.stateNode.isHidden=a,!a||r.alternate!==null&&r.alternate.memoizedState!==null||(jp=St())),n&4&&w0(t);break;case 22:if(h=s!==null&&s.memoizedState!==null,t.mode&1?(rs=(u=rs)||h,ln(e,t),rs=u):ln(e,t),Sn(t),n&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!h&&t.mode&1)for(me=t,h=t.child;h!==null;){for(m=me=h;me!==null;){switch(f=me,y=f.child,f.tag){case 0:case 11:case 14:case 15:el(4,f,f.return);break;case 1:ka(f,f.return);var _=f.stateNode;if(typeof _.componentWillUnmount=="function"){n=f,s=f.return;try{e=n,_.props=e.memoizedProps,_.state=e.memoizedState,_.componentWillUnmount()}catch(S){bt(n,s,S)}}break;case 5:ka(f,f.return);break;case 22:if(f.memoizedState!==null){N0(m);continue}}y!==null?(y.return=f,me=y):N0(m)}h=h.sibling}e:for(h=null,m=t;;){if(m.tag===5){if(h===null){h=m;try{r=m.stateNode,u?(a=r.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(l=m.stateNode,c=m.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=lb("display",o))}catch(S){bt(t,t.return,S)}}}else if(m.tag===6){if(h===null)try{m.stateNode.nodeValue=u?"":m.memoizedProps}catch(S){bt(t,t.return,S)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;h===m&&(h=null),m=m.return}h===m&&(h=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:ln(e,t),Sn(t),n&4&&w0(t);break;case 21:break;default:ln(e,t),Sn(t)}}function Sn(t){var e=t.flags;if(e&2){try{e:{for(var s=t.return;s!==null;){if(Mw(s)){var n=s;break e}s=s.return}throw Error(te(160))}switch(n.tag){case 5:var r=n.stateNode;n.flags&32&&(ul(r,""),n.flags&=-33);var a=b0(t);Zm(t,a,r);break;case 3:case 4:var o=n.stateNode.containerInfo,l=b0(t);Xm(t,l,o);break;default:throw Error(te(161))}}catch(c){bt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function iS(t,e,s){me=t,Vw(t)}function Vw(t,e,s){for(var n=(t.mode&1)!==0;me!==null;){var r=me,a=r.child;if(r.tag===22&&n){var o=r.memoizedState!==null||Pc;if(!o){var l=r.alternate,c=l!==null&&l.memoizedState!==null||rs;l=Pc;var u=rs;if(Pc=o,(rs=c)&&!u)for(me=r;me!==null;)o=me,c=o.child,o.tag===22&&o.memoizedState!==null?j0(r):c!==null?(c.return=o,me=c):j0(r);for(;a!==null;)me=a,Vw(a),a=a.sibling;me=r,Pc=l,rs=u}_0(t)}else r.subtreeFlags&8772&&a!==null?(a.return=r,me=a):_0(t)}}function _0(t){for(;me!==null;){var e=me;if(e.flags&8772){var s=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:rs||wu(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!rs)if(s===null)n.componentDidMount();else{var r=e.elementType===e.type?s.memoizedProps:cn(e.type,s.memoizedProps);n.componentDidUpdate(r,s.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&a0(e,a,n);break;case 3:var o=e.updateQueue;if(o!==null){if(s=null,e.child!==null)switch(e.child.tag){case 5:s=e.child.stateNode;break;case 1:s=e.child.stateNode}a0(e,o,s)}break;case 5:var l=e.stateNode;if(s===null&&e.flags&4){s=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&s.focus();break;case"img":c.src&&(s.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var m=h.dehydrated;m!==null&&pl(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(te(163))}rs||e.flags&512&&Ym(e)}catch(f){bt(e,e.return,f)}}if(e===t){me=null;break}if(s=e.sibling,s!==null){s.return=e.return,me=s;break}me=e.return}}function N0(t){for(;me!==null;){var e=me;if(e===t){me=null;break}var s=e.sibling;if(s!==null){s.return=e.return,me=s;break}me=e.return}}function j0(t){for(;me!==null;){var e=me;try{switch(e.tag){case 0:case 11:case 15:var s=e.return;try{wu(4,e)}catch(c){bt(e,s,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var r=e.return;try{n.componentDidMount()}catch(c){bt(e,r,c)}}var a=e.return;try{Ym(e)}catch(c){bt(e,a,c)}break;case 5:var o=e.return;try{Ym(e)}catch(c){bt(e,o,c)}}}catch(c){bt(e,e.return,c)}if(e===t){me=null;break}var l=e.sibling;if(l!==null){l.return=e.return,me=l;break}me=e.return}}var aS=Math.ceil,Ld=ur.ReactCurrentDispatcher,_p=ur.ReactCurrentOwner,Xs=ur.ReactCurrentBatchConfig,We=0,zt=null,Tt=null,Qt=0,Os=0,Ea=ni(0),Lt=0,Sl=null,Oi=0,_u=0,Np=0,tl=null,_s=null,jp=0,Ka=1/0,Hn=null,Vd=!1,ef=null,Br=null,Rc=!1,Or=null,$d=0,sl=0,tf=null,nd=-1,rd=0;function ms(){return We&6?St():nd!==-1?nd:nd=St()}function zr(t){return t.mode&1?We&2&&Qt!==0?Qt&-Qt:zI.transition!==null?(rd===0&&(rd=wb()),rd):(t=Xe,t!==0||(t=window.event,t=t===void 0?16:Eb(t.type)),t):1}function fn(t,e,s,n){if(50<sl)throw sl=0,tf=null,Error(te(185));zl(t,s,n),(!(We&2)||t!==zt)&&(t===zt&&(!(We&2)&&(_u|=s),Lt===4&&kr(t,Qt)),Es(t,n),s===1&&We===0&&!(e.mode&1)&&(Ka=St()+500,yu&&ri()))}function Es(t,e){var s=t.callbackNode;z2(t,e);var n=wd(t,t===zt?Qt:0);if(n===0)s!==null&&Rx(s),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(s!=null&&Rx(s),e===1)t.tag===0?BI(I0.bind(null,t)):Kb(I0.bind(null,t)),$I(function(){!(We&6)&&ri()}),s=null;else{switch(_b(n)){case 1:s=Jf;break;case 4:s=vb;break;case 16:s=bd;break;case 536870912:s=bb;break;default:s=bd}s=qw(s,$w.bind(null,t))}t.callbackPriority=e,t.callbackNode=s}}function $w(t,e){if(nd=-1,rd=0,We&6)throw Error(te(327));var s=t.callbackNode;if(Oa()&&t.callbackNode!==s)return null;var n=wd(t,t===zt?Qt:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=Fd(t,n);else{e=n;var r=We;We|=2;var a=Dw();(zt!==t||Qt!==e)&&(Hn=null,Ka=St()+500,Si(t,e));do try{cS();break}catch(l){Fw(t,l)}while(!0);cp(),Ld.current=a,We=r,Tt!==null?e=0:(zt=null,Qt=0,e=Lt)}if(e!==0){if(e===2&&(r=Em(t),r!==0&&(n=r,e=sf(t,r))),e===1)throw s=Sl,Si(t,0),kr(t,n),Es(t,St()),s;if(e===6)kr(t,n);else{if(r=t.current.alternate,!(n&30)&&!oS(r)&&(e=Fd(t,n),e===2&&(a=Em(t),a!==0&&(n=a,e=sf(t,a))),e===1))throw s=Sl,Si(t,0),kr(t,n),Es(t,St()),s;switch(t.finishedWork=r,t.finishedLanes=n,e){case 0:case 1:throw Error(te(345));case 2:yi(t,_s,Hn);break;case 3:if(kr(t,n),(n&130023424)===n&&(e=jp+500-St(),10<e)){if(wd(t,0)!==0)break;if(r=t.suspendedLanes,(r&n)!==n){ms(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Lm(yi.bind(null,t,_s,Hn),e);break}yi(t,_s,Hn);break;case 4:if(kr(t,n),(n&4194240)===n)break;for(e=t.eventTimes,r=-1;0<n;){var o=31-mn(n);a=1<<o,o=e[o],o>r&&(r=o),n&=~a}if(n=r,n=St()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*aS(n/1960))-n,10<n){t.timeoutHandle=Lm(yi.bind(null,t,_s,Hn),n);break}yi(t,_s,Hn);break;case 5:yi(t,_s,Hn);break;default:throw Error(te(329))}}}return Es(t,St()),t.callbackNode===s?$w.bind(null,t):null}function sf(t,e){var s=tl;return t.current.memoizedState.isDehydrated&&(Si(t,e).flags|=256),t=Fd(t,e),t!==2&&(e=_s,_s=s,e!==null&&nf(e)),t}function nf(t){_s===null?_s=t:_s.push.apply(_s,t)}function oS(t){for(var e=t;;){if(e.flags&16384){var s=e.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var n=0;n<s.length;n++){var r=s[n],a=r.getSnapshot;r=r.value;try{if(!gn(a(),r))return!1}catch{return!1}}}if(s=e.child,e.subtreeFlags&16384&&s!==null)s.return=e,e=s;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function kr(t,e){for(e&=~Np,e&=~_u,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var s=31-mn(e),n=1<<s;t[s]=-1,e&=~n}}function I0(t){if(We&6)throw Error(te(327));Oa();var e=wd(t,0);if(!(e&1))return Es(t,St()),null;var s=Fd(t,e);if(t.tag!==0&&s===2){var n=Em(t);n!==0&&(e=n,s=sf(t,n))}if(s===1)throw s=Sl,Si(t,0),kr(t,e),Es(t,St()),s;if(s===6)throw Error(te(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,yi(t,_s,Hn),Es(t,St()),null}function Ip(t,e){var s=We;We|=1;try{return t(e)}finally{We=s,We===0&&(Ka=St()+500,yu&&ri())}}function Li(t){Or!==null&&Or.tag===0&&!(We&6)&&Oa();var e=We;We|=1;var s=Xs.transition,n=Xe;try{if(Xs.transition=null,Xe=1,t)return t()}finally{Xe=n,Xs.transition=s,We=e,!(We&6)&&ri()}}function Sp(){Os=Ea.current,lt(Ea)}function Si(t,e){t.finishedWork=null,t.finishedLanes=0;var s=t.timeoutHandle;if(s!==-1&&(t.timeoutHandle=-1,VI(s)),Tt!==null)for(s=Tt.return;s!==null;){var n=s;switch(ap(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Sd();break;case 3:qa(),lt(Ss),lt(ls),pp();break;case 5:fp(n);break;case 4:qa();break;case 13:lt(ft);break;case 19:lt(ft);break;case 10:dp(n.type._context);break;case 22:case 23:Sp()}s=s.return}if(zt=t,Tt=t=Hr(t.current,null),Qt=Os=e,Lt=0,Sl=null,Np=_u=Oi=0,_s=tl=null,wi!==null){for(e=0;e<wi.length;e++)if(s=wi[e],n=s.interleaved,n!==null){s.interleaved=null;var r=n.next,a=s.pending;if(a!==null){var o=a.next;a.next=r,n.next=o}s.pending=n}wi=null}return t}function Fw(t,e){do{var s=Tt;try{if(cp(),ed.current=Od,Md){for(var n=pt.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}Md=!1}if(Mi=0,Bt=Ot=pt=null,Zo=!1,Nl=0,_p.current=null,s===null||s.return===null){Lt=1,Sl=e,Tt=null;break}e:{var a=t,o=s.return,l=s,c=e;if(e=Qt,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,h=l,m=h.tag;if(!(h.mode&1)&&(m===0||m===11||m===15)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=h0(o);if(y!==null){y.flags&=-257,m0(y,o,l,a,e),y.mode&1&&u0(a,u,e),e=y,c=u;var _=e.updateQueue;if(_===null){var S=new Set;S.add(c),e.updateQueue=S}else _.add(c);break e}else{if(!(e&1)){u0(a,u,e),kp();break e}c=Error(te(426))}}else if(ut&&l.mode&1){var R=h0(o);if(R!==null){!(R.flags&65536)&&(R.flags|=256),m0(R,o,l,a,e),op(Wa(c,l));break e}}a=c=Wa(c,l),Lt!==4&&(Lt=2),tl===null?tl=[a]:tl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var k=_w(a,c,e);i0(a,k);break e;case 1:l=c;var x=a.type,A=a.stateNode;if(!(a.flags&128)&&(typeof x.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(Br===null||!Br.has(A)))){a.flags|=65536,e&=-e,a.lanes|=e;var M=Nw(a,l,e);i0(a,M);break e}}a=a.return}while(a!==null)}Bw(s)}catch(D){e=D,Tt===s&&s!==null&&(Tt=s=s.return);continue}break}while(!0)}function Dw(){var t=Ld.current;return Ld.current=Od,t===null?Od:t}function kp(){(Lt===0||Lt===3||Lt===2)&&(Lt=4),zt===null||!(Oi&268435455)&&!(_u&268435455)||kr(zt,Qt)}function Fd(t,e){var s=We;We|=2;var n=Dw();(zt!==t||Qt!==e)&&(Hn=null,Si(t,e));do try{lS();break}catch(r){Fw(t,r)}while(!0);if(cp(),We=s,Ld.current=n,Tt!==null)throw Error(te(261));return zt=null,Qt=0,Lt}function lS(){for(;Tt!==null;)Uw(Tt)}function cS(){for(;Tt!==null&&!M2();)Uw(Tt)}function Uw(t){var e=Hw(t.alternate,t,Os);t.memoizedProps=t.pendingProps,e===null?Bw(t):Tt=e,_p.current=null}function Bw(t){var e=t;do{var s=e.alternate;if(t=e.return,e.flags&32768){if(s=sS(s,e),s!==null){s.flags&=32767,Tt=s;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Lt=6,Tt=null;return}}else if(s=tS(s,e,Os),s!==null){Tt=s;return}if(e=e.sibling,e!==null){Tt=e;return}Tt=e=t}while(e!==null);Lt===0&&(Lt=5)}function yi(t,e,s){var n=Xe,r=Xs.transition;try{Xs.transition=null,Xe=1,dS(t,e,s,n)}finally{Xs.transition=r,Xe=n}return null}function dS(t,e,s,n){do Oa();while(Or!==null);if(We&6)throw Error(te(327));s=t.finishedWork;var r=t.finishedLanes;if(s===null)return null;if(t.finishedWork=null,t.finishedLanes=0,s===t.current)throw Error(te(177));t.callbackNode=null,t.callbackPriority=0;var a=s.lanes|s.childLanes;if(H2(t,a),t===zt&&(Tt=zt=null,Qt=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||Rc||(Rc=!0,qw(bd,function(){return Oa(),null})),a=(s.flags&15990)!==0,s.subtreeFlags&15990||a){a=Xs.transition,Xs.transition=null;var o=Xe;Xe=1;var l=We;We|=4,_p.current=null,rS(t,s),Lw(s,t),AI(Mm),_d=!!Rm,Mm=Rm=null,t.current=s,iS(s),O2(),We=l,Xe=o,Xs.transition=a}else t.current=s;if(Rc&&(Rc=!1,Or=t,$d=r),a=t.pendingLanes,a===0&&(Br=null),$2(s.stateNode),Es(t,St()),e!==null)for(n=t.onRecoverableError,s=0;s<e.length;s++)r=e[s],n(r.value,{componentStack:r.stack,digest:r.digest});if(Vd)throw Vd=!1,t=ef,ef=null,t;return $d&1&&t.tag!==0&&Oa(),a=t.pendingLanes,a&1?t===tf?sl++:(sl=0,tf=t):sl=0,ri(),null}function Oa(){if(Or!==null){var t=_b($d),e=Xs.transition,s=Xe;try{if(Xs.transition=null,Xe=16>t?16:t,Or===null)var n=!1;else{if(t=Or,Or=null,$d=0,We&6)throw Error(te(331));var r=We;for(We|=4,me=t.current;me!==null;){var a=me,o=a.child;if(me.flags&16){var l=a.deletions;if(l!==null){for(var c=0;c<l.length;c++){var u=l[c];for(me=u;me!==null;){var h=me;switch(h.tag){case 0:case 11:case 15:el(8,h,a)}var m=h.child;if(m!==null)m.return=h,me=m;else for(;me!==null;){h=me;var f=h.sibling,y=h.return;if(Rw(h),h===u){me=null;break}if(f!==null){f.return=y,me=f;break}me=y}}}var _=a.alternate;if(_!==null){var S=_.child;if(S!==null){_.child=null;do{var R=S.sibling;S.sibling=null,S=R}while(S!==null)}}me=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,me=o;else e:for(;me!==null;){if(a=me,a.flags&2048)switch(a.tag){case 0:case 11:case 15:el(9,a,a.return)}var k=a.sibling;if(k!==null){k.return=a.return,me=k;break e}me=a.return}}var x=t.current;for(me=x;me!==null;){o=me;var A=o.child;if(o.subtreeFlags&2064&&A!==null)A.return=o,me=A;else e:for(o=x;me!==null;){if(l=me,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:wu(9,l)}}catch(D){bt(l,l.return,D)}if(l===o){me=null;break e}var M=l.sibling;if(M!==null){M.return=l.return,me=M;break e}me=l.return}}if(We=r,ri(),Pn&&typeof Pn.onPostCommitFiberRoot=="function")try{Pn.onPostCommitFiberRoot(mu,t)}catch{}n=!0}return n}finally{Xe=s,Xs.transition=e}}return!1}function S0(t,e,s){e=Wa(s,e),e=_w(t,e,1),t=Ur(t,e,1),e=ms(),t!==null&&(zl(t,1,e),Es(t,e))}function bt(t,e,s){if(t.tag===3)S0(t,t,s);else for(;e!==null;){if(e.tag===3){S0(e,t,s);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Br===null||!Br.has(n))){t=Wa(s,t),t=Nw(e,t,1),e=Ur(e,t,1),t=ms(),e!==null&&(zl(e,1,t),Es(e,t));break}}e=e.return}}function uS(t,e,s){var n=t.pingCache;n!==null&&n.delete(e),e=ms(),t.pingedLanes|=t.suspendedLanes&s,zt===t&&(Qt&s)===s&&(Lt===4||Lt===3&&(Qt&130023424)===Qt&&500>St()-jp?Si(t,0):Np|=s),Es(t,e)}function zw(t,e){e===0&&(t.mode&1?(e=Nc,Nc<<=1,!(Nc&130023424)&&(Nc=4194304)):e=1);var s=ms();t=rr(t,e),t!==null&&(zl(t,e,s),Es(t,s))}function hS(t){var e=t.memoizedState,s=0;e!==null&&(s=e.retryLane),zw(t,s)}function mS(t,e){var s=0;switch(t.tag){case 13:var n=t.stateNode,r=t.memoizedState;r!==null&&(s=r.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(te(314))}n!==null&&n.delete(e),zw(t,s)}var Hw;Hw=function(t,e,s){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ss.current)js=!0;else{if(!(t.lanes&s)&&!(e.flags&128))return js=!1,eS(t,e,s);js=!!(t.flags&131072)}else js=!1,ut&&e.flags&1048576&&Gb(e,Td,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;sd(t,e),t=e.pendingProps;var r=Ba(e,ls.current);Ma(e,s),r=xp(null,e,n,t,r,s);var a=yp();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ks(n)?(a=!0,kd(e)):a=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,hp(e),r.updater=bu,e.stateNode=r,r._reactInternals=e,zm(e,n,t,s),e=Wm(null,e,n,!0,a,s)):(e.tag=0,ut&&a&&ip(e),us(null,e,r,s),e=e.child),e;case 16:n=e.elementType;e:{switch(sd(t,e),t=e.pendingProps,r=n._init,n=r(n._payload),e.type=n,r=e.tag=pS(n),t=cn(n,t),r){case 0:e=qm(null,e,n,t,s);break e;case 1:e=g0(null,e,n,t,s);break e;case 11:e=f0(null,e,n,t,s);break e;case 14:e=p0(null,e,n,cn(n.type,t),s);break e}throw Error(te(306,n,""))}return e;case 0:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:cn(n,r),qm(t,e,n,r,s);case 1:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:cn(n,r),g0(t,e,n,r,s);case 3:e:{if(kw(e),t===null)throw Error(te(387));n=e.pendingProps,a=e.memoizedState,r=a.element,ew(t,e),Pd(e,n,null,s);var o=e.memoizedState;if(n=o.element,a.isDehydrated)if(a={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){r=Wa(Error(te(423)),e),e=x0(t,e,n,s,r);break e}else if(n!==r){r=Wa(Error(te(424)),e),e=x0(t,e,n,s,r);break e}else for($s=Dr(e.stateNode.containerInfo.firstChild),Us=e,ut=!0,un=null,s=Xb(e,null,n,s),e.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(za(),n===r){e=ir(t,e,s);break e}us(t,e,n,s)}e=e.child}return e;case 5:return tw(e),t===null&&Dm(e),n=e.type,r=e.pendingProps,a=t!==null?t.memoizedProps:null,o=r.children,Om(n,r)?o=null:a!==null&&Om(n,a)&&(e.flags|=32),Sw(t,e),us(t,e,o,s),e.child;case 6:return t===null&&Dm(e),null;case 13:return Ew(t,e,s);case 4:return mp(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=Ha(e,null,n,s):us(t,e,n,s),e.child;case 11:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:cn(n,r),f0(t,e,n,r,s);case 7:return us(t,e,e.pendingProps,s),e.child;case 8:return us(t,e,e.pendingProps.children,s),e.child;case 12:return us(t,e,e.pendingProps.children,s),e.child;case 10:e:{if(n=e.type._context,r=e.pendingProps,a=e.memoizedProps,o=r.value,at(Ad,n._currentValue),n._currentValue=o,a!==null)if(gn(a.value,o)){if(a.children===r.children&&!Ss.current){e=ir(t,e,s);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){o=a.child;for(var c=l.firstContext;c!==null;){if(c.context===n){if(a.tag===1){c=Xn(-1,s&-s),c.tag=2;var u=a.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}a.lanes|=s,c=a.alternate,c!==null&&(c.lanes|=s),Um(a.return,s,e),l.lanes|=s;break}c=c.next}}else if(a.tag===10)o=a.type===e.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(te(341));o.lanes|=s,l=o.alternate,l!==null&&(l.lanes|=s),Um(o,s,e),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}us(t,e,r.children,s),e=e.child}return e;case 9:return r=e.type,n=e.pendingProps.children,Ma(e,s),r=en(r),n=n(r),e.flags|=1,us(t,e,n,s),e.child;case 14:return n=e.type,r=cn(n,e.pendingProps),r=cn(n.type,r),p0(t,e,n,r,s);case 15:return jw(t,e,e.type,e.pendingProps,s);case 17:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:cn(n,r),sd(t,e),e.tag=1,ks(n)?(t=!0,kd(e)):t=!1,Ma(e,s),ww(e,n,r),zm(e,n,r,s),Wm(null,e,n,!0,t,s);case 19:return Tw(t,e,s);case 22:return Iw(t,e,s)}throw Error(te(156,e.tag))};function qw(t,e){return yb(t,e)}function fS(t,e,s,n){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ys(t,e,s,n){return new fS(t,e,s,n)}function Ep(t){return t=t.prototype,!(!t||!t.isReactComponent)}function pS(t){if(typeof t=="function")return Ep(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Kf)return 11;if(t===Gf)return 14}return 2}function Hr(t,e){var s=t.alternate;return s===null?(s=Ys(t.tag,e,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=e,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&14680064,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,e=t.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s}function id(t,e,s,n,r,a){var o=2;if(n=t,typeof t=="function")Ep(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case ya:return ki(s.children,r,a,e);case Wf:o=8,r|=8;break;case mm:return t=Ys(12,s,e,r|2),t.elementType=mm,t.lanes=a,t;case fm:return t=Ys(13,s,e,r),t.elementType=fm,t.lanes=a,t;case pm:return t=Ys(19,s,e,r),t.elementType=pm,t.lanes=a,t;case tb:return Nu(s,r,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Zv:o=10;break e;case eb:o=9;break e;case Kf:o=11;break e;case Gf:o=14;break e;case jr:o=16,n=null;break e}throw Error(te(130,t==null?t:typeof t,""))}return e=Ys(o,s,e,r),e.elementType=t,e.type=n,e.lanes=a,e}function ki(t,e,s,n){return t=Ys(7,t,n,e),t.lanes=s,t}function Nu(t,e,s,n){return t=Ys(22,t,n,e),t.elementType=tb,t.lanes=s,t.stateNode={isHidden:!1},t}function Vh(t,e,s){return t=Ys(6,t,null,e),t.lanes=s,t}function $h(t,e,s){return e=Ys(4,t.children!==null?t.children:[],t.key,e),e.lanes=s,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function gS(t,e,s,n,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yh(0),this.expirationTimes=yh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yh(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Tp(t,e,s,n,r,a,o,l,c){return t=new gS(t,e,s,l,c),e===1?(e=1,a===!0&&(e|=8)):e=0,a=Ys(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:n,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},hp(a),t}function xS(t,e,s){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xa,key:n==null?null:""+n,children:t,containerInfo:e,implementation:s}}function Ww(t){if(!t)return Qr;t=t._reactInternals;e:{if(Ki(t)!==t||t.tag!==1)throw Error(te(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ks(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(te(171))}if(t.tag===1){var s=t.type;if(ks(s))return Wb(t,s,e)}return e}function Kw(t,e,s,n,r,a,o,l,c){return t=Tp(s,n,!0,t,r,a,o,l,c),t.context=Ww(null),s=t.current,n=ms(),r=zr(s),a=Xn(n,r),a.callback=e??null,Ur(s,a,r),t.current.lanes=r,zl(t,r,n),Es(t,n),t}function ju(t,e,s,n){var r=e.current,a=ms(),o=zr(r);return s=Ww(s),e.context===null?e.context=s:e.pendingContext=s,e=Xn(a,o),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=Ur(r,e,o),t!==null&&(fn(t,r,o,a),Zc(t,r,o)),o}function Dd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function k0(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<e?s:e}}function Ap(t,e){k0(t,e),(t=t.alternate)&&k0(t,e)}function yS(){return null}var Gw=typeof reportError=="function"?reportError:function(t){console.error(t)};function Cp(t){this._internalRoot=t}Iu.prototype.render=Cp.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(te(409));ju(t,e,null,null)};Iu.prototype.unmount=Cp.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Li(function(){ju(null,t,null,null)}),e[nr]=null}};function Iu(t){this._internalRoot=t}Iu.prototype.unstable_scheduleHydration=function(t){if(t){var e=Ib();t={blockedOn:null,target:t,priority:e};for(var s=0;s<Sr.length&&e!==0&&e<Sr[s].priority;s++);Sr.splice(s,0,t),s===0&&kb(t)}};function Pp(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Su(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function E0(){}function vS(t,e,s,n,r){if(r){if(typeof n=="function"){var a=n;n=function(){var u=Dd(o);a.call(u)}}var o=Kw(e,n,t,0,null,!1,!1,"",E0);return t._reactRootContainer=o,t[nr]=o.current,yl(t.nodeType===8?t.parentNode:t),Li(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof n=="function"){var l=n;n=function(){var u=Dd(c);l.call(u)}}var c=Tp(t,0,!1,null,null,!1,!1,"",E0);return t._reactRootContainer=c,t[nr]=c.current,yl(t.nodeType===8?t.parentNode:t),Li(function(){ju(e,c,s,n)}),c}function ku(t,e,s,n,r){var a=s._reactRootContainer;if(a){var o=a;if(typeof r=="function"){var l=r;r=function(){var c=Dd(o);l.call(c)}}ju(e,o,t,r)}else o=vS(s,e,t,r,n);return Dd(o)}Nb=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var s=$o(e.pendingLanes);s!==0&&(Yf(e,s|1),Es(e,St()),!(We&6)&&(Ka=St()+500,ri()))}break;case 13:Li(function(){var n=rr(t,1);if(n!==null){var r=ms();fn(n,t,1,r)}}),Ap(t,1)}};Xf=function(t){if(t.tag===13){var e=rr(t,134217728);if(e!==null){var s=ms();fn(e,t,134217728,s)}Ap(t,134217728)}};jb=function(t){if(t.tag===13){var e=zr(t),s=rr(t,e);if(s!==null){var n=ms();fn(s,t,e,n)}Ap(t,e)}};Ib=function(){return Xe};Sb=function(t,e){var s=Xe;try{return Xe=t,e()}finally{Xe=s}};Im=function(t,e,s){switch(e){case"input":if(ym(t,s),e=s.name,s.type==="radio"&&e!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<s.length;e++){var n=s[e];if(n!==t&&n.form===t.form){var r=xu(n);if(!r)throw Error(te(90));nb(n),ym(n,r)}}}break;case"textarea":ib(t,s);break;case"select":e=s.value,e!=null&&Aa(t,!!s.multiple,e,!1)}};hb=Ip;mb=Li;var bS={usingClientEntryPoint:!1,Events:[ql,_a,xu,db,ub,Ip]},Mo={findFiberByHostInstance:bi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},wS={bundleType:Mo.bundleType,version:Mo.version,rendererPackageName:Mo.rendererPackageName,rendererConfig:Mo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ur.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=gb(t),t===null?null:t.stateNode},findFiberByHostInstance:Mo.findFiberByHostInstance||yS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mc.isDisabled&&Mc.supportsFiber)try{mu=Mc.inject(wS),Pn=Mc}catch{}}Hs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bS;Hs.createPortal=function(t,e){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Pp(e))throw Error(te(200));return xS(t,e,null,s)};Hs.createRoot=function(t,e){if(!Pp(t))throw Error(te(299));var s=!1,n="",r=Gw;return e!=null&&(e.unstable_strictMode===!0&&(s=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Tp(t,1,!1,null,null,s,!1,n,r),t[nr]=e.current,yl(t.nodeType===8?t.parentNode:t),new Cp(e)};Hs.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(te(188)):(t=Object.keys(t).join(","),Error(te(268,t)));return t=gb(e),t=t===null?null:t.stateNode,t};Hs.flushSync=function(t){return Li(t)};Hs.hydrate=function(t,e,s){if(!Su(e))throw Error(te(200));return ku(null,t,e,!0,s)};Hs.hydrateRoot=function(t,e,s){if(!Pp(t))throw Error(te(405));var n=s!=null&&s.hydratedSources||null,r=!1,a="",o=Gw;if(s!=null&&(s.unstable_strictMode===!0&&(r=!0),s.identifierPrefix!==void 0&&(a=s.identifierPrefix),s.onRecoverableError!==void 0&&(o=s.onRecoverableError)),e=Kw(e,null,t,1,s??null,r,!1,a,o),t[nr]=e.current,yl(t),n)for(t=0;t<n.length;t++)s=n[t],r=s._getVersion,r=r(s._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[s,r]:e.mutableSourceEagerHydrationData.push(s,r);return new Iu(e)};Hs.render=function(t,e,s){if(!Su(e))throw Error(te(200));return ku(null,t,e,!1,s)};Hs.unmountComponentAtNode=function(t){if(!Su(t))throw Error(te(40));return t._reactRootContainer?(Li(function(){ku(null,null,t,!1,function(){t._reactRootContainer=null,t[nr]=null})}),!0):!1};Hs.unstable_batchedUpdates=Ip;Hs.unstable_renderSubtreeIntoContainer=function(t,e,s,n){if(!Su(s))throw Error(te(200));if(t==null||t._reactInternals===void 0)throw Error(te(38));return ku(t,e,s,!1,n)};Hs.version="18.3.1-next-f1338f8080-20240426";function Qw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Qw)}catch(t){console.error(t)}}Qw(),Qv.exports=Hs;var _S=Qv.exports,T0=_S;um.createRoot=T0.createRoot,um.hydrateRoot=T0.hydrateRoot;const Fh="http://localhost:8000",NS={TRIAGE:`${Fh}/api/triage`,TRIAGE_STREAM:t=>`${Fh}/api/triage/stream/${t}`,HEALTH:`${Fh}/health`},jS=()=>({"Content-Type":"application/json"}),IS=async t=>{try{const e=`${NS.TRIAGE.replace("/triage","/character")}`,s=await fetch(e,{method:"POST",headers:jS(),body:JSON.stringify(t),signal:AbortSignal.timeout(3e4)});if(!s.ok){const n=await s.json().catch(()=>({detail:"Unknown error"}));throw new Error(n.detail||`HTTP ${s.status}`)}return await s.json()}catch(e){throw console.warn("[requestCharacter]  API :",e),e}},Dt="/ai-factory/",A0={dog:`${Dt}icon/main-image/dog_main-removebg-preview.png`,cat:`${Dt}icon/main-image/Cat_main-removebg-preview.png`,rabbit:`${Dt}icon/main-image/rabbit_main-removebg-preview.png`,hamster:`${Dt}icon/main-image/hamster_main-removebg-preview.png`,bird:`${Dt}icon/main-image/bird_main-removebg-preview.png`,hedgehog:`${Dt}icon/main-image/hedgehog_main-removebg-preview.png`,reptile:`${Dt}icon/main-image/reptile_main-removebg-preview.png`,etc:`${Dt}icon/main-image/etc_main-removebg-preview.png`,other:`${Dt}icon/main-image/etc_main-removebg-preview.png`},Ls={dog:`${Dt}icon/profile_background_less/dog-removebg-preview.png`,cat:`${Dt}icon/profile_background_less/cat-removebg-preview.png`,rabbit:`${Dt}icon/profile_background_less/rabbit-removebg-preview.png`,hamster:`${Dt}icon/profile_background_less/hamster-removebg-preview.png`,bird:`${Dt}icon/profile_background_less/bird-removebg-preview.png`,hedgehog:`${Dt}icon/profile_background_less/hedgehog-removebg-preview.png`,reptile:`${Dt}icon/profile_background_less/reptile-removebg-preview.png`,etc:`${Dt}icon/profile_background_less/etc-removebg-preview.png`,other:`${Dt}icon/profile_background_less/etc-removebg-preview.png`};function Ta(t="dog"){return A0[t]||A0.other}function rf(t="dog"){return Ls[t]||Ls.other}function Is(t,e=!1){if(!t)return e?Ta():rf();if(t.profileImage)return t.profileImage;const s=t.species||"dog";return e?Ta(s):rf(s)}const SS="modulepreload",kS=function(t){return"/ai-factory/"+t},C0={},Ud=function(e,s,n){let r=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.allSettled(s.map(c=>{if(c=kS(c),c in C0)return;C0[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":SS,u||(m.as="script"),m.crossOrigin="",m.href=c,l&&m.setAttribute("nonce",l),document.head.appendChild(m),u)return new Promise((f,y)=>{m.addEventListener("load",f),m.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return r.then(o=>{for(const l of o||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})},ES=()=>{};var P0={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jw=function(t){const e=[];let s=0;for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);r<128?e[s++]=r:r<2048?(e[s++]=r>>6|192,e[s++]=r&63|128):(r&64512)===55296&&n+1<t.length&&(t.charCodeAt(n+1)&64512)===56320?(r=65536+((r&1023)<<10)+(t.charCodeAt(++n)&1023),e[s++]=r>>18|240,e[s++]=r>>12&63|128,e[s++]=r>>6&63|128,e[s++]=r&63|128):(e[s++]=r>>12|224,e[s++]=r>>6&63|128,e[s++]=r&63|128)}return e},TS=function(t){const e=[];let s=0,n=0;for(;s<t.length;){const r=t[s++];if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){const a=t[s++];e[n++]=String.fromCharCode((r&31)<<6|a&63)}else if(r>239&&r<365){const a=t[s++],o=t[s++],l=t[s++],c=((r&7)<<18|(a&63)<<12|(o&63)<<6|l&63)-65536;e[n++]=String.fromCharCode(55296+(c>>10)),e[n++]=String.fromCharCode(56320+(c&1023))}else{const a=t[s++],o=t[s++];e[n++]=String.fromCharCode((r&15)<<12|(a&63)<<6|o&63)}}return e.join("")},Yw={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let r=0;r<t.length;r+=3){const a=t[r],o=r+1<t.length,l=o?t[r+1]:0,c=r+2<t.length,u=c?t[r+2]:0,h=a>>2,m=(a&3)<<4|l>>4;let f=(l&15)<<2|u>>6,y=u&63;c||(y=64,o||(f=64)),n.push(s[h],s[m],s[f],s[y])}return n.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Jw(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):TS(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const s=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let r=0;r<t.length;){const a=s[t.charAt(r++)],l=r<t.length?s[t.charAt(r)]:0;++r;const u=r<t.length?s[t.charAt(r)]:64;++r;const m=r<t.length?s[t.charAt(r)]:64;if(++r,a==null||l==null||u==null||m==null)throw new AS;const f=a<<2|l>>4;if(n.push(f),u!==64){const y=l<<4&240|u>>2;if(n.push(y),m!==64){const _=u<<6&192|m;n.push(_)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class AS extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const CS=function(t){const e=Jw(t);return Yw.encodeByteArray(e,!0)},Bd=function(t){return CS(t).replace(/\./g,"")},Xw=function(t){try{return Yw.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PS(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RS=()=>PS().__FIREBASE_DEFAULTS__,MS=()=>{if(typeof process>"u"||typeof P0>"u")return;const t=P0.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},OS=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Xw(t[1]);return e&&JSON.parse(e)},Eu=()=>{try{return ES()||RS()||MS()||OS()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Zw=t=>{var e,s;return(s=(e=Eu())==null?void 0:e.emulatorHosts)==null?void 0:s[t]},e_=t=>{const e=Zw(t);if(!e)return;const s=e.lastIndexOf(":");if(s<=0||s+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(s+1),10);return e[0]==="["?[e.substring(1,s-1),n]:[e.substring(0,s),n]},t_=()=>{var t;return(t=Eu())==null?void 0:t.config},s_=t=>{var e;return(e=Eu())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LS{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}wrapCallback(e){return(s,n)=>{s?this.reject(s):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(s):e(s,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ii(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Rp(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n_(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},n=e||"demo-project",r=t.iat||0,a=t.sub||t.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Bd(JSON.stringify(s)),Bd(JSON.stringify(o)),""].join(".")}const nl={};function VS(){const t={prod:[],emulator:[]};for(const e of Object.keys(nl))nl[e]?t.emulator.push(e):t.prod.push(e);return t}function $S(t){let e=document.getElementById(t),s=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),s=!0),{created:s,element:e}}let R0=!1;function Mp(t,e){if(typeof window>"u"||typeof document>"u"||!ii(window.location.host)||nl[t]===e||nl[t]||R0)return;nl[t]=e;function s(f){return`__firebase__banner__${f}`}const n="__firebase__banner",a=VS().prod.length>0;function o(){const f=document.getElementById(n);f&&f.remove()}function l(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,y){f.setAttribute("width","24"),f.setAttribute("id",y),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function u(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{R0=!0,o()},f}function h(f,y){f.setAttribute("id",y),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function m(){const f=$S(n),y=s("text"),_=document.getElementById(y)||document.createElement("span"),S=s("learnmore"),R=document.getElementById(S)||document.createElement("a"),k=s("preprendIcon"),x=document.getElementById(k)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const A=f.element;l(A),h(R,S);const M=u();c(x,k),A.append(x,_,R,M),document.body.appendChild(A)}a?(_.innerText="Preview backend disconnected.",x.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(x.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,_.innerText="Preview backend running in this workspace."),_.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cs(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function FS(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(cs())}function DS(){var e;const t=(e=Eu())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function US(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function BS(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function zS(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function HS(){const t=cs();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function qS(){return!DS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function r_(){try{return typeof indexedDB=="object"}catch{return!1}}function i_(){return new Promise((t,e)=>{try{let s=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),s||self.indexedDB.deleteDatabase(n),t(!0)},r.onupgradeneeded=()=>{s=!1},r.onerror=()=>{var a;e(((a=r.error)==null?void 0:a.message)||"")}}catch(s){e(s)}})}function WS(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KS="FirebaseError";class vn extends Error{constructor(e,s,n){super(s),this.code=e,this.customData=n,this.name=KS,Object.setPrototypeOf(this,vn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Gi.prototype.create)}}class Gi{constructor(e,s,n){this.service=e,this.serviceName=s,this.errors=n}create(e,...s){const n=s[0]||{},r=`${this.service}/${e}`,a=this.errors[e],o=a?GS(a,n):"Error",l=`${this.serviceName}: ${o} (${r}).`;return new vn(r,l,n)}}function GS(t,e){return t.replace(QS,(s,n)=>{const r=e[n];return r!=null?String(r):`<${n}?>`})}const QS=/\{\$([^}]+)}/g;function JS(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Vi(t,e){if(t===e)return!0;const s=Object.keys(t),n=Object.keys(e);for(const r of s){if(!n.includes(r))return!1;const a=t[r],o=e[r];if(M0(a)&&M0(o)){if(!Vi(a,o))return!1}else if(a!==o)return!1}for(const r of n)if(!s.includes(r))return!1;return!0}function M0(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kl(t){const e=[];for(const[s,n]of Object.entries(t))Array.isArray(n)?n.forEach(r=>{e.push(encodeURIComponent(s)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(s)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Do(t){const e={};return t.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[r,a]=n.split("=");e[decodeURIComponent(r)]=decodeURIComponent(a)}}),e}function Uo(t){const e=t.indexOf("?");if(!e)return"";const s=t.indexOf("#",e);return t.substring(e,s>0?s:void 0)}function YS(t,e){const s=new XS(t,e);return s.subscribe.bind(s)}class XS{constructor(e,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(s=>{s.next(e)})}error(e){this.forEachObserver(s=>{s.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,s,n){let r;if(e===void 0&&s===void 0&&n===void 0)throw new Error("Missing Observer.");ZS(e,["next","error","complete"])?r=e:r={next:e,error:s,complete:n},r.next===void 0&&(r.next=Dh),r.error===void 0&&(r.error=Dh),r.complete===void 0&&(r.complete=Dh);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,e)}sendOne(e,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{s(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ZS(t,e){if(typeof t!="object"||t===null)return!1;for(const s of e)if(s in t&&typeof t[s]=="function")return!0;return!1}function Dh(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nt(t){return t&&t._delegate?t._delegate:t}class sn{constructor(e,s,n){this.name=e,this.instanceFactory=s,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ek{constructor(e,s){this.name=e,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const s=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(s)){const n=new LS;if(this.instancesDeferred.set(s,n),this.isInitialized(s)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:s});r&&n.resolve(r)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(e){const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),n=(e==null?void 0:e.optional)??!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(r){if(n)return null;throw r}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(sk(e))try{this.getOrInitializeService({instanceIdentifier:vi})}catch{}for(const[s,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(s);try{const a=this.getOrInitializeService({instanceIdentifier:r});n.resolve(a)}catch{}}}}clearInstance(e=vi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...e.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=vi){return this.instances.has(e)}getOptions(e=vi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:s={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:s});for(const[a,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(a);n===l&&o.resolve(r)}return r}onInit(e,s){const n=this.normalizeInstanceIdentifier(s),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);const a=this.instances.get(n);return a&&e(a,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,s){const n=this.onInitCallbacks.get(s);if(n)for(const r of n)try{r(e,s)}catch{}}getOrInitializeService({instanceIdentifier:e,options:s={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:tk(e),options:s}),this.instances.set(e,n),this.instancesOptions.set(e,s),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=vi){return this.component?this.component.multipleInstances?e:vi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function tk(t){return t===vi?void 0:t}function sk(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const s=this.getProvider(e.name);if(s.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);s.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const s=new ek(e,this);return this.providers.set(e,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var De;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(De||(De={}));const rk={debug:De.DEBUG,verbose:De.VERBOSE,info:De.INFO,warn:De.WARN,error:De.ERROR,silent:De.SILENT},ik=De.INFO,ak={[De.DEBUG]:"log",[De.VERBOSE]:"log",[De.INFO]:"info",[De.WARN]:"warn",[De.ERROR]:"error"},ok=(t,e,...s)=>{if(e<t.logLevel)return;const n=new Date().toISOString(),r=ak[e];if(r)console[r](`[${n}]  ${t.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Op{constructor(e){this.name=e,this._logLevel=ik,this._logHandler=ok,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in De))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?rk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,De.DEBUG,...e),this._logHandler(this,De.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,De.VERBOSE,...e),this._logHandler(this,De.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,De.INFO,...e),this._logHandler(this,De.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,De.WARN,...e),this._logHandler(this,De.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,De.ERROR,...e),this._logHandler(this,De.ERROR,...e)}}const lk=(t,e)=>e.some(s=>t instanceof s);let O0,L0;function ck(){return O0||(O0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function dk(){return L0||(L0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const a_=new WeakMap,af=new WeakMap,o_=new WeakMap,Uh=new WeakMap,Lp=new WeakMap;function uk(t){const e=new Promise((s,n)=>{const r=()=>{t.removeEventListener("success",a),t.removeEventListener("error",o)},a=()=>{s(Zn(t.result)),r()},o=()=>{n(t.error),r()};t.addEventListener("success",a),t.addEventListener("error",o)});return e.then(s=>{s instanceof IDBCursor&&a_.set(s,t)}).catch(()=>{}),Lp.set(e,t),e}function hk(t){if(af.has(t))return;const e=new Promise((s,n)=>{const r=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",o),t.removeEventListener("abort",o)},a=()=>{s(),r()},o=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",a),t.addEventListener("error",o),t.addEventListener("abort",o)});af.set(t,e)}let of={get(t,e,s){if(t instanceof IDBTransaction){if(e==="done")return af.get(t);if(e==="objectStoreNames")return t.objectStoreNames||o_.get(t);if(e==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return Zn(t[e])},set(t,e,s){return t[e]=s,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function mk(t){of=t(of)}function fk(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...s){const n=t.call(Bh(this),e,...s);return o_.set(n,e.sort?e.sort():[e]),Zn(n)}:dk().includes(t)?function(...e){return t.apply(Bh(this),e),Zn(a_.get(this))}:function(...e){return Zn(t.apply(Bh(this),e))}}function pk(t){return typeof t=="function"?fk(t):(t instanceof IDBTransaction&&hk(t),lk(t,ck())?new Proxy(t,of):t)}function Zn(t){if(t instanceof IDBRequest)return uk(t);if(Uh.has(t))return Uh.get(t);const e=pk(t);return e!==t&&(Uh.set(t,e),Lp.set(e,t)),e}const Bh=t=>Lp.get(t);function Tu(t,e,{blocked:s,upgrade:n,blocking:r,terminated:a}={}){const o=indexedDB.open(t,e),l=Zn(o);return n&&o.addEventListener("upgradeneeded",c=>{n(Zn(o.result),c.oldVersion,c.newVersion,Zn(o.transaction),c)}),s&&o.addEventListener("blocked",c=>s(c.oldVersion,c.newVersion,c)),l.then(c=>{a&&c.addEventListener("close",()=>a()),r&&c.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}function zh(t,{blocked:e}={}){const s=indexedDB.deleteDatabase(t);return e&&s.addEventListener("blocked",n=>e(n.oldVersion,n)),Zn(s).then(()=>{})}const gk=["get","getKey","getAll","getAllKeys","count"],xk=["put","add","delete","clear"],Hh=new Map;function V0(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Hh.get(e))return Hh.get(e);const s=e.replace(/FromIndex$/,""),n=e!==s,r=xk.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!(r||gk.includes(s)))return;const a=async function(o,...l){const c=this.transaction(o,r?"readwrite":"readonly");let u=c.store;return n&&(u=u.index(l.shift())),(await Promise.all([u[s](...l),r&&c.done]))[0]};return Hh.set(e,a),a}mk(t=>({...t,get:(e,s,n)=>V0(e,s)||t.get(e,s,n),has:(e,s)=>!!V0(e,s)||t.has(e,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(vk(s)){const n=s.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(s=>s).join(" ")}}function vk(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const lf="@firebase/app",$0="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ar=new Op("@firebase/app"),bk="@firebase/app-compat",wk="@firebase/analytics-compat",_k="@firebase/analytics",Nk="@firebase/app-check-compat",jk="@firebase/app-check",Ik="@firebase/auth",Sk="@firebase/auth-compat",kk="@firebase/database",Ek="@firebase/data-connect",Tk="@firebase/database-compat",Ak="@firebase/functions",Ck="@firebase/functions-compat",Pk="@firebase/installations",Rk="@firebase/installations-compat",Mk="@firebase/messaging",Ok="@firebase/messaging-compat",Lk="@firebase/performance",Vk="@firebase/performance-compat",$k="@firebase/remote-config",Fk="@firebase/remote-config-compat",Dk="@firebase/storage",Uk="@firebase/storage-compat",Bk="@firebase/firestore",zk="@firebase/ai",Hk="@firebase/firestore-compat",qk="firebase",Wk="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cf="[DEFAULT]",Kk={[lf]:"fire-core",[bk]:"fire-core-compat",[_k]:"fire-analytics",[wk]:"fire-analytics-compat",[jk]:"fire-app-check",[Nk]:"fire-app-check-compat",[Ik]:"fire-auth",[Sk]:"fire-auth-compat",[kk]:"fire-rtdb",[Ek]:"fire-data-connect",[Tk]:"fire-rtdb-compat",[Ak]:"fire-fn",[Ck]:"fire-fn-compat",[Pk]:"fire-iid",[Rk]:"fire-iid-compat",[Mk]:"fire-fcm",[Ok]:"fire-fcm-compat",[Lk]:"fire-perf",[Vk]:"fire-perf-compat",[$k]:"fire-rc",[Fk]:"fire-rc-compat",[Dk]:"fire-gcs",[Uk]:"fire-gcs-compat",[Bk]:"fire-fst",[Hk]:"fire-fst-compat",[zk]:"fire-vertex","fire-js":"fire-js",[qk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zd=new Map,Gk=new Map,df=new Map;function F0(t,e){try{t.container.addComponent(e)}catch(s){ar.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,s)}}function xn(t){const e=t.name;if(df.has(e))return ar.debug(`There were multiple attempts to register component ${e}.`),!1;df.set(e,t);for(const s of zd.values())F0(s,t);for(const s of Gk.values())F0(s,t);return!0}function Qi(t,e){const s=t.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),t.container.getProvider(e)}function hs(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},qr=new Gi("app","Firebase",Qk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jk{constructor(e,s,n){this._isDeleted=!1,this._options={...e},this._config={...s},this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new sn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw qr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ji=Wk;function l_(t,e={}){let s=t;typeof e!="object"&&(e={name:e});const n={name:cf,automaticDataCollectionEnabled:!0,...e},r=n.name;if(typeof r!="string"||!r)throw qr.create("bad-app-name",{appName:String(r)});if(s||(s=t_()),!s)throw qr.create("no-options");const a=zd.get(r);if(a){if(Vi(s,a.options)&&Vi(n,a.config))return a;throw qr.create("duplicate-app",{appName:r})}const o=new nk(r);for(const c of df.values())o.addComponent(c);const l=new Jk(s,n,o);return zd.set(r,l),l}function Au(t=cf){const e=zd.get(t);if(!e&&t===cf&&t_())return l_();if(!e)throw qr.create("no-app",{appName:t});return e}function Ts(t,e,s){let n=Kk[t]??t;s&&(n+=`-${s}`);const r=n.match(/\s|\//),a=e.match(/\s|\//);if(r||a){const o=[`Unable to register library "${n}" with version "${e}":`];r&&o.push(`library name "${n}" contains illegal characters (whitespace or "/")`),r&&a&&o.push("and"),a&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ar.warn(o.join(" "));return}xn(new sn(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yk="firebase-heartbeat-database",Xk=1,kl="firebase-heartbeat-store";let qh=null;function c_(){return qh||(qh=Tu(Yk,Xk,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(kl)}catch(s){console.warn(s)}}}}).catch(t=>{throw qr.create("idb-open",{originalErrorMessage:t.message})})),qh}async function Zk(t){try{const s=(await c_()).transaction(kl),n=await s.objectStore(kl).get(d_(t));return await s.done,n}catch(e){if(e instanceof vn)ar.warn(e.message);else{const s=qr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ar.warn(s.message)}}}async function D0(t,e){try{const n=(await c_()).transaction(kl,"readwrite");await n.objectStore(kl).put(e,d_(t)),await n.done}catch(s){if(s instanceof vn)ar.warn(s.message);else{const n=qr.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});ar.warn(n.message)}}}function d_(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eE=1024,tE=30;class sE{constructor(e){this.container=e,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new rE(s),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,s;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=U0();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)==null?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(o=>o.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:r}),this._heartbeatsCache.heartbeats.length>tE){const o=iE(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){ar.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=U0(),{heartbeatsToSend:n,unsentEntries:r}=nE(this._heartbeatsCache.heartbeats),a=Bd(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=s,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(s){return ar.warn(s),""}}}function U0(){return new Date().toISOString().substring(0,10)}function nE(t,e=eE){const s=[];let n=t.slice();for(const r of t){const a=s.find(o=>o.agent===r.agent);if(a){if(a.dates.push(r.date),B0(s)>e){a.dates.pop();break}}else if(s.push({agent:r.agent,dates:[r.date]}),B0(s)>e){s.pop();break}n=n.slice(1)}return{heartbeatsToSend:s,unsentEntries:n}}class rE{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return r_()?i_().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await Zk(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return D0(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return D0(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function B0(t){return Bd(JSON.stringify({version:2,heartbeats:t})).length}function iE(t){if(t.length===0)return-1;let e=0,s=t[0].date;for(let n=1;n<t.length;n++)t[n].date<s&&(s=t[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aE(t){xn(new sn("platform-logger",e=>new yk(e),"PRIVATE")),xn(new sn("heartbeat",e=>new sE(e),"PRIVATE")),Ts(lf,$0,t),Ts(lf,$0,"esm2020"),Ts("fire-js","")}aE("");var oE="firebase",lE="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ts(oE,lE,"app");var z0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Wr,u_;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(v,N){function w(){}w.prototype=N.prototype,v.F=N.prototype,v.prototype=new w,v.prototype.constructor=v,v.D=function(E,C,P){for(var j=Array(arguments.length-2),re=2;re<arguments.length;re++)j[re-2]=arguments[re];return N.prototype[C].apply(E,j)}}function s(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(n,s),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(v,N,w){w||(w=0);const E=Array(16);if(typeof N=="string")for(var C=0;C<16;++C)E[C]=N.charCodeAt(w++)|N.charCodeAt(w++)<<8|N.charCodeAt(w++)<<16|N.charCodeAt(w++)<<24;else for(C=0;C<16;++C)E[C]=N[w++]|N[w++]<<8|N[w++]<<16|N[w++]<<24;N=v.g[0],w=v.g[1],C=v.g[2];let P=v.g[3],j;j=N+(P^w&(C^P))+E[0]+3614090360&4294967295,N=w+(j<<7&4294967295|j>>>25),j=P+(C^N&(w^C))+E[1]+3905402710&4294967295,P=N+(j<<12&4294967295|j>>>20),j=C+(w^P&(N^w))+E[2]+606105819&4294967295,C=P+(j<<17&4294967295|j>>>15),j=w+(N^C&(P^N))+E[3]+3250441966&4294967295,w=C+(j<<22&4294967295|j>>>10),j=N+(P^w&(C^P))+E[4]+4118548399&4294967295,N=w+(j<<7&4294967295|j>>>25),j=P+(C^N&(w^C))+E[5]+1200080426&4294967295,P=N+(j<<12&4294967295|j>>>20),j=C+(w^P&(N^w))+E[6]+2821735955&4294967295,C=P+(j<<17&4294967295|j>>>15),j=w+(N^C&(P^N))+E[7]+4249261313&4294967295,w=C+(j<<22&4294967295|j>>>10),j=N+(P^w&(C^P))+E[8]+1770035416&4294967295,N=w+(j<<7&4294967295|j>>>25),j=P+(C^N&(w^C))+E[9]+2336552879&4294967295,P=N+(j<<12&4294967295|j>>>20),j=C+(w^P&(N^w))+E[10]+4294925233&4294967295,C=P+(j<<17&4294967295|j>>>15),j=w+(N^C&(P^N))+E[11]+2304563134&4294967295,w=C+(j<<22&4294967295|j>>>10),j=N+(P^w&(C^P))+E[12]+1804603682&4294967295,N=w+(j<<7&4294967295|j>>>25),j=P+(C^N&(w^C))+E[13]+4254626195&4294967295,P=N+(j<<12&4294967295|j>>>20),j=C+(w^P&(N^w))+E[14]+2792965006&4294967295,C=P+(j<<17&4294967295|j>>>15),j=w+(N^C&(P^N))+E[15]+1236535329&4294967295,w=C+(j<<22&4294967295|j>>>10),j=N+(C^P&(w^C))+E[1]+4129170786&4294967295,N=w+(j<<5&4294967295|j>>>27),j=P+(w^C&(N^w))+E[6]+3225465664&4294967295,P=N+(j<<9&4294967295|j>>>23),j=C+(N^w&(P^N))+E[11]+643717713&4294967295,C=P+(j<<14&4294967295|j>>>18),j=w+(P^N&(C^P))+E[0]+3921069994&4294967295,w=C+(j<<20&4294967295|j>>>12),j=N+(C^P&(w^C))+E[5]+3593408605&4294967295,N=w+(j<<5&4294967295|j>>>27),j=P+(w^C&(N^w))+E[10]+38016083&4294967295,P=N+(j<<9&4294967295|j>>>23),j=C+(N^w&(P^N))+E[15]+3634488961&4294967295,C=P+(j<<14&4294967295|j>>>18),j=w+(P^N&(C^P))+E[4]+3889429448&4294967295,w=C+(j<<20&4294967295|j>>>12),j=N+(C^P&(w^C))+E[9]+568446438&4294967295,N=w+(j<<5&4294967295|j>>>27),j=P+(w^C&(N^w))+E[14]+3275163606&4294967295,P=N+(j<<9&4294967295|j>>>23),j=C+(N^w&(P^N))+E[3]+4107603335&4294967295,C=P+(j<<14&4294967295|j>>>18),j=w+(P^N&(C^P))+E[8]+1163531501&4294967295,w=C+(j<<20&4294967295|j>>>12),j=N+(C^P&(w^C))+E[13]+2850285829&4294967295,N=w+(j<<5&4294967295|j>>>27),j=P+(w^C&(N^w))+E[2]+4243563512&4294967295,P=N+(j<<9&4294967295|j>>>23),j=C+(N^w&(P^N))+E[7]+1735328473&4294967295,C=P+(j<<14&4294967295|j>>>18),j=w+(P^N&(C^P))+E[12]+2368359562&4294967295,w=C+(j<<20&4294967295|j>>>12),j=N+(w^C^P)+E[5]+4294588738&4294967295,N=w+(j<<4&4294967295|j>>>28),j=P+(N^w^C)+E[8]+2272392833&4294967295,P=N+(j<<11&4294967295|j>>>21),j=C+(P^N^w)+E[11]+1839030562&4294967295,C=P+(j<<16&4294967295|j>>>16),j=w+(C^P^N)+E[14]+4259657740&4294967295,w=C+(j<<23&4294967295|j>>>9),j=N+(w^C^P)+E[1]+2763975236&4294967295,N=w+(j<<4&4294967295|j>>>28),j=P+(N^w^C)+E[4]+1272893353&4294967295,P=N+(j<<11&4294967295|j>>>21),j=C+(P^N^w)+E[7]+4139469664&4294967295,C=P+(j<<16&4294967295|j>>>16),j=w+(C^P^N)+E[10]+3200236656&4294967295,w=C+(j<<23&4294967295|j>>>9),j=N+(w^C^P)+E[13]+681279174&4294967295,N=w+(j<<4&4294967295|j>>>28),j=P+(N^w^C)+E[0]+3936430074&4294967295,P=N+(j<<11&4294967295|j>>>21),j=C+(P^N^w)+E[3]+3572445317&4294967295,C=P+(j<<16&4294967295|j>>>16),j=w+(C^P^N)+E[6]+76029189&4294967295,w=C+(j<<23&4294967295|j>>>9),j=N+(w^C^P)+E[9]+3654602809&4294967295,N=w+(j<<4&4294967295|j>>>28),j=P+(N^w^C)+E[12]+3873151461&4294967295,P=N+(j<<11&4294967295|j>>>21),j=C+(P^N^w)+E[15]+530742520&4294967295,C=P+(j<<16&4294967295|j>>>16),j=w+(C^P^N)+E[2]+3299628645&4294967295,w=C+(j<<23&4294967295|j>>>9),j=N+(C^(w|~P))+E[0]+4096336452&4294967295,N=w+(j<<6&4294967295|j>>>26),j=P+(w^(N|~C))+E[7]+1126891415&4294967295,P=N+(j<<10&4294967295|j>>>22),j=C+(N^(P|~w))+E[14]+2878612391&4294967295,C=P+(j<<15&4294967295|j>>>17),j=w+(P^(C|~N))+E[5]+4237533241&4294967295,w=C+(j<<21&4294967295|j>>>11),j=N+(C^(w|~P))+E[12]+1700485571&4294967295,N=w+(j<<6&4294967295|j>>>26),j=P+(w^(N|~C))+E[3]+2399980690&4294967295,P=N+(j<<10&4294967295|j>>>22),j=C+(N^(P|~w))+E[10]+4293915773&4294967295,C=P+(j<<15&4294967295|j>>>17),j=w+(P^(C|~N))+E[1]+2240044497&4294967295,w=C+(j<<21&4294967295|j>>>11),j=N+(C^(w|~P))+E[8]+1873313359&4294967295,N=w+(j<<6&4294967295|j>>>26),j=P+(w^(N|~C))+E[15]+4264355552&4294967295,P=N+(j<<10&4294967295|j>>>22),j=C+(N^(P|~w))+E[6]+2734768916&4294967295,C=P+(j<<15&4294967295|j>>>17),j=w+(P^(C|~N))+E[13]+1309151649&4294967295,w=C+(j<<21&4294967295|j>>>11),j=N+(C^(w|~P))+E[4]+4149444226&4294967295,N=w+(j<<6&4294967295|j>>>26),j=P+(w^(N|~C))+E[11]+3174756917&4294967295,P=N+(j<<10&4294967295|j>>>22),j=C+(N^(P|~w))+E[2]+718787259&4294967295,C=P+(j<<15&4294967295|j>>>17),j=w+(P^(C|~N))+E[9]+3951481745&4294967295,v.g[0]=v.g[0]+N&4294967295,v.g[1]=v.g[1]+(C+(j<<21&4294967295|j>>>11))&4294967295,v.g[2]=v.g[2]+C&4294967295,v.g[3]=v.g[3]+P&4294967295}n.prototype.v=function(v,N){N===void 0&&(N=v.length);const w=N-this.blockSize,E=this.C;let C=this.h,P=0;for(;P<N;){if(C==0)for(;P<=w;)r(this,v,P),P+=this.blockSize;if(typeof v=="string"){for(;P<N;)if(E[C++]=v.charCodeAt(P++),C==this.blockSize){r(this,E),C=0;break}}else for(;P<N;)if(E[C++]=v[P++],C==this.blockSize){r(this,E),C=0;break}}this.h=C,this.o+=N},n.prototype.A=function(){var v=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);v[0]=128;for(var N=1;N<v.length-8;++N)v[N]=0;N=this.o*8;for(var w=v.length-8;w<v.length;++w)v[w]=N&255,N/=256;for(this.v(v),v=Array(16),N=0,w=0;w<4;++w)for(let E=0;E<32;E+=8)v[N++]=this.g[w]>>>E&255;return v};function a(v,N){var w=l;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=N(v)}function o(v,N){this.h=N;const w=[];let E=!0;for(let C=v.length-1;C>=0;C--){const P=v[C]|0;E&&P==N||(w[C]=P,E=!1)}this.g=w}var l={};function c(v){return-128<=v&&v<128?a(v,function(N){return new o([N|0],N<0?-1:0)}):new o([v|0],v<0?-1:0)}function u(v){if(isNaN(v)||!isFinite(v))return m;if(v<0)return R(u(-v));const N=[];let w=1;for(let E=0;v>=w;E++)N[E]=v/w|0,w*=4294967296;return new o(N,0)}function h(v,N){if(v.length==0)throw Error("number format error: empty string");if(N=N||10,N<2||36<N)throw Error("radix out of range: "+N);if(v.charAt(0)=="-")return R(h(v.substring(1),N));if(v.indexOf("-")>=0)throw Error('number format error: interior "-" character');const w=u(Math.pow(N,8));let E=m;for(let P=0;P<v.length;P+=8){var C=Math.min(8,v.length-P);const j=parseInt(v.substring(P,P+C),N);C<8?(C=u(Math.pow(N,C)),E=E.j(C).add(u(j))):(E=E.j(w),E=E.add(u(j)))}return E}var m=c(0),f=c(1),y=c(16777216);t=o.prototype,t.m=function(){if(S(this))return-R(this).m();let v=0,N=1;for(let w=0;w<this.g.length;w++){const E=this.i(w);v+=(E>=0?E:4294967296+E)*N,N*=4294967296}return v},t.toString=function(v){if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(_(this))return"0";if(S(this))return"-"+R(this).toString(v);const N=u(Math.pow(v,6));var w=this;let E="";for(;;){const C=M(w,N).g;w=k(w,C.j(N));let P=((w.g.length>0?w.g[0]:w.h)>>>0).toString(v);if(w=C,_(w))return P+E;for(;P.length<6;)P="0"+P;E=P+E}},t.i=function(v){return v<0?0:v<this.g.length?this.g[v]:this.h};function _(v){if(v.h!=0)return!1;for(let N=0;N<v.g.length;N++)if(v.g[N]!=0)return!1;return!0}function S(v){return v.h==-1}t.l=function(v){return v=k(this,v),S(v)?-1:_(v)?0:1};function R(v){const N=v.g.length,w=[];for(let E=0;E<N;E++)w[E]=~v.g[E];return new o(w,~v.h).add(f)}t.abs=function(){return S(this)?R(this):this},t.add=function(v){const N=Math.max(this.g.length,v.g.length),w=[];let E=0;for(let C=0;C<=N;C++){let P=E+(this.i(C)&65535)+(v.i(C)&65535),j=(P>>>16)+(this.i(C)>>>16)+(v.i(C)>>>16);E=j>>>16,P&=65535,j&=65535,w[C]=j<<16|P}return new o(w,w[w.length-1]&-2147483648?-1:0)};function k(v,N){return v.add(R(N))}t.j=function(v){if(_(this)||_(v))return m;if(S(this))return S(v)?R(this).j(R(v)):R(R(this).j(v));if(S(v))return R(this.j(R(v)));if(this.l(y)<0&&v.l(y)<0)return u(this.m()*v.m());const N=this.g.length+v.g.length,w=[];for(var E=0;E<2*N;E++)w[E]=0;for(E=0;E<this.g.length;E++)for(let C=0;C<v.g.length;C++){const P=this.i(E)>>>16,j=this.i(E)&65535,re=v.i(C)>>>16,Z=v.i(C)&65535;w[2*E+2*C]+=j*Z,x(w,2*E+2*C),w[2*E+2*C+1]+=P*Z,x(w,2*E+2*C+1),w[2*E+2*C+1]+=j*re,x(w,2*E+2*C+1),w[2*E+2*C+2]+=P*re,x(w,2*E+2*C+2)}for(v=0;v<N;v++)w[v]=w[2*v+1]<<16|w[2*v];for(v=N;v<2*N;v++)w[v]=0;return new o(w,0)};function x(v,N){for(;(v[N]&65535)!=v[N];)v[N+1]+=v[N]>>>16,v[N]&=65535,N++}function A(v,N){this.g=v,this.h=N}function M(v,N){if(_(N))throw Error("division by zero");if(_(v))return new A(m,m);if(S(v))return N=M(R(v),N),new A(R(N.g),R(N.h));if(S(N))return N=M(v,R(N)),new A(R(N.g),N.h);if(v.g.length>30){if(S(v)||S(N))throw Error("slowDivide_ only works with positive integers.");for(var w=f,E=N;E.l(v)<=0;)w=D(w),E=D(E);var C=B(w,1),P=B(E,1);for(E=B(E,2),w=B(w,2);!_(E);){var j=P.add(E);j.l(v)<=0&&(C=C.add(w),P=j),E=B(E,1),w=B(w,1)}return N=k(v,C.j(N)),new A(C,N)}for(C=m;v.l(N)>=0;){for(w=Math.max(1,Math.floor(v.m()/N.m())),E=Math.ceil(Math.log(w)/Math.LN2),E=E<=48?1:Math.pow(2,E-48),P=u(w),j=P.j(N);S(j)||j.l(v)>0;)w-=E,P=u(w),j=P.j(N);_(P)&&(P=f),C=C.add(P),v=k(v,j)}return new A(C,v)}t.B=function(v){return M(this,v).h},t.and=function(v){const N=Math.max(this.g.length,v.g.length),w=[];for(let E=0;E<N;E++)w[E]=this.i(E)&v.i(E);return new o(w,this.h&v.h)},t.or=function(v){const N=Math.max(this.g.length,v.g.length),w=[];for(let E=0;E<N;E++)w[E]=this.i(E)|v.i(E);return new o(w,this.h|v.h)},t.xor=function(v){const N=Math.max(this.g.length,v.g.length),w=[];for(let E=0;E<N;E++)w[E]=this.i(E)^v.i(E);return new o(w,this.h^v.h)};function D(v){const N=v.g.length+1,w=[];for(let E=0;E<N;E++)w[E]=v.i(E)<<1|v.i(E-1)>>>31;return new o(w,v.h)}function B(v,N){const w=N>>5;N%=32;const E=v.g.length-w,C=[];for(let P=0;P<E;P++)C[P]=N>0?v.i(P+w)>>>N|v.i(P+w+1)<<32-N:v.i(P+w);return new o(C,v.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,u_=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Wr=o}).apply(typeof z0<"u"?z0:typeof self<"u"?self:typeof window<"u"?window:{});var Oc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var h_,Bo,m_,ad,uf,f_,p_,g_;(function(){var t,e=Object.defineProperty;function s(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof Oc=="object"&&Oc];for(var p=0;p<d.length;++p){var g=d[p];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var n=s(this);function r(d,p){if(p)e:{var g=n;d=d.split(".");for(var T=0;T<d.length-1;T++){var U=d[T];if(!(U in g))break e;g=g[U]}d=d[d.length-1],T=g[d],p=p(T),p!=T&&p!=null&&e(g,d,{configurable:!0,writable:!0,value:p})}}r("Symbol.dispose",function(d){return d||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(d){return d||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(d){return d||function(p){var g=[],T;for(T in p)Object.prototype.hasOwnProperty.call(p,T)&&g.push([T,p[T]]);return g}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},o=this||self;function l(d){var p=typeof d;return p=="object"&&d!=null||p=="function"}function c(d,p,g){return d.call.apply(d.bind,arguments)}function u(d,p,g){return u=c,u.apply(null,arguments)}function h(d,p){var g=Array.prototype.slice.call(arguments,1);return function(){var T=g.slice();return T.push.apply(T,arguments),d.apply(this,T)}}function m(d,p){function g(){}g.prototype=p.prototype,d.Z=p.prototype,d.prototype=new g,d.prototype.constructor=d,d.Ob=function(T,U,H){for(var ne=Array(arguments.length-2),Le=2;Le<arguments.length;Le++)ne[Le-2]=arguments[Le];return p.prototype[U].apply(T,ne)}}var f=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?d=>d&&AsyncContext.Snapshot.wrap(d):d=>d;function y(d){const p=d.length;if(p>0){const g=Array(p);for(let T=0;T<p;T++)g[T]=d[T];return g}return[]}function _(d,p){for(let T=1;T<arguments.length;T++){const U=arguments[T];var g=typeof U;if(g=g!="object"?g:U?Array.isArray(U)?"array":g:"null",g=="array"||g=="object"&&typeof U.length=="number"){g=d.length||0;const H=U.length||0;d.length=g+H;for(let ne=0;ne<H;ne++)d[g+ne]=U[ne]}else d.push(U)}}class S{constructor(p,g){this.i=p,this.j=g,this.h=0,this.g=null}get(){let p;return this.h>0?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function R(d){o.setTimeout(()=>{throw d},0)}function k(){var d=v;let p=null;return d.g&&(p=d.g,d.g=d.g.next,d.g||(d.h=null),p.next=null),p}class x{constructor(){this.h=this.g=null}add(p,g){const T=A.get();T.set(p,g),this.h?this.h.next=T:this.g=T,this.h=T}}var A=new S(()=>new M,d=>d.reset());class M{constructor(){this.next=this.g=this.h=null}set(p,g){this.h=p,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let D,B=!1,v=new x,N=()=>{const d=Promise.resolve(void 0);D=()=>{d.then(w)}};function w(){for(var d;d=k();){try{d.h.call(d.g)}catch(g){R(g)}var p=A;p.j(d),p.h<100&&(p.h++,d.next=p.g,p.g=d)}B=!1}function E(){this.u=this.u,this.C=this.C}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function C(d,p){this.type=d,this.g=this.target=p,this.defaultPrevented=!1}C.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var d=!1,p=Object.defineProperty({},"passive",{get:function(){d=!0}});try{const g=()=>{};o.addEventListener("test",g,p),o.removeEventListener("test",g,p)}catch{}return d}();function j(d){return/^[\s\xa0]*$/.test(d)}function re(d,p){C.call(this,d?d.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,d&&this.init(d,p)}m(re,C),re.prototype.init=function(d,p){const g=this.type=d.type,T=d.changedTouches&&d.changedTouches.length?d.changedTouches[0]:null;this.target=d.target||d.srcElement,this.g=p,p=d.relatedTarget,p||(g=="mouseover"?p=d.fromElement:g=="mouseout"&&(p=d.toElement)),this.relatedTarget=p,T?(this.clientX=T.clientX!==void 0?T.clientX:T.pageX,this.clientY=T.clientY!==void 0?T.clientY:T.pageY,this.screenX=T.screenX||0,this.screenY=T.screenY||0):(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=d.button,this.key=d.key||"",this.ctrlKey=d.ctrlKey,this.altKey=d.altKey,this.shiftKey=d.shiftKey,this.metaKey=d.metaKey,this.pointerId=d.pointerId||0,this.pointerType=d.pointerType,this.state=d.state,this.i=d,d.defaultPrevented&&re.Z.h.call(this)},re.prototype.h=function(){re.Z.h.call(this);const d=this.i;d.preventDefault?d.preventDefault():d.returnValue=!1};var Z="closure_listenable_"+(Math.random()*1e6|0),le=0;function ce(d,p,g,T,U){this.listener=d,this.proxy=null,this.src=p,this.type=g,this.capture=!!T,this.ha=U,this.key=++le,this.da=this.fa=!1}function F(d){d.da=!0,d.listener=null,d.proxy=null,d.src=null,d.ha=null}function Q(d,p,g){for(const T in d)p.call(g,d[T],T,d)}function K(d,p){for(const g in d)p.call(void 0,d[g],g,d)}function I(d){const p={};for(const g in d)p[g]=d[g];return p}const L="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function W(d,p){let g,T;for(let U=1;U<arguments.length;U++){T=arguments[U];for(g in T)d[g]=T[g];for(let H=0;H<L.length;H++)g=L[H],Object.prototype.hasOwnProperty.call(T,g)&&(d[g]=T[g])}}function b(d){this.src=d,this.g={},this.h=0}b.prototype.add=function(d,p,g,T,U){const H=d.toString();d=this.g[H],d||(d=this.g[H]=[],this.h++);const ne=J(d,p,T,U);return ne>-1?(p=d[ne],g||(p.fa=!1)):(p=new ce(p,this.src,H,!!T,U),p.fa=g,d.push(p)),p};function V(d,p){const g=p.type;if(g in d.g){var T=d.g[g],U=Array.prototype.indexOf.call(T,p,void 0),H;(H=U>=0)&&Array.prototype.splice.call(T,U,1),H&&(F(p),d.g[g].length==0&&(delete d.g[g],d.h--))}}function J(d,p,g,T){for(let U=0;U<d.length;++U){const H=d[U];if(!H.da&&H.listener==p&&H.capture==!!g&&H.ha==T)return U}return-1}var z="closure_lm_"+(Math.random()*1e6|0),q={};function ae(d,p,g,T,U){if(Array.isArray(p)){for(let H=0;H<p.length;H++)ae(d,p[H],g,T,U);return null}return g=Te(g),d&&d[Z]?d.J(p,g,l(T)?!!T.capture:!1,U):je(d,p,g,!1,T,U)}function je(d,p,g,T,U,H){if(!p)throw Error("Invalid event type");const ne=l(U)?!!U.capture:!!U;let Le=jt(d);if(Le||(d[z]=Le=new b(d)),g=Le.add(p,g,T,ne,H),g.proxy)return g;if(T=Ve(),g.proxy=T,T.src=d,T.listener=g,d.addEventListener)P||(U=ne),U===void 0&&(U=!1),d.addEventListener(p.toString(),T,U);else if(d.attachEvent)d.attachEvent(Qe(p.toString()),T);else if(d.addListener&&d.removeListener)d.addListener(T);else throw Error("addEventListener and attachEvent are unavailable.");return g}function Ve(){function d(g){return p.call(d.src,d.listener,g)}const p=an;return d}function ye(d,p,g,T,U){if(Array.isArray(p))for(var H=0;H<p.length;H++)ye(d,p[H],g,T,U);else T=l(T)?!!T.capture:!!T,g=Te(g),d&&d[Z]?(d=d.i,H=String(p).toString(),H in d.g&&(p=d.g[H],g=J(p,g,T,U),g>-1&&(F(p[g]),Array.prototype.splice.call(p,g,1),p.length==0&&(delete d.g[H],d.h--)))):d&&(d=jt(d))&&(p=d.g[p.toString()],d=-1,p&&(d=J(p,g,T,U)),(g=d>-1?p[d]:null)&&ht(g))}function ht(d){if(typeof d!="number"&&d&&!d.da){var p=d.src;if(p&&p[Z])V(p.i,d);else{var g=d.type,T=d.proxy;p.removeEventListener?p.removeEventListener(g,T,d.capture):p.detachEvent?p.detachEvent(Qe(g),T):p.addListener&&p.removeListener&&p.removeListener(T),(g=jt(p))?(V(g,d),g.h==0&&(g.src=null,p[z]=null)):F(d)}}}function Qe(d){return d in q?q[d]:q[d]="on"+d}function an(d,p){if(d.da)d=!0;else{p=new re(p,this);const g=d.listener,T=d.ha||d.src;d.fa&&ht(d),d=g.call(T,p)}return d}function jt(d){return d=d[z],d instanceof b?d:null}var ie="__closure_events_fn_"+(Math.random()*1e9>>>0);function Te(d){return typeof d=="function"?d:(d[ie]||(d[ie]=function(p){return d.handleEvent(p)}),d[ie])}function Ee(){E.call(this),this.i=new b(this),this.M=this,this.G=null}m(Ee,E),Ee.prototype[Z]=!0,Ee.prototype.removeEventListener=function(d,p,g,T){ye(this,d,p,g,T)};function Ce(d,p){var g,T=d.G;if(T)for(g=[];T;T=T.G)g.push(T);if(d=d.M,T=p.type||p,typeof p=="string")p=new C(p,d);else if(p instanceof C)p.target=p.target||d;else{var U=p;p=new C(T,d),W(p,U)}U=!0;let H,ne;if(g)for(ne=g.length-1;ne>=0;ne--)H=p.g=g[ne],U=ze(H,T,!0,p)&&U;if(H=p.g=d,U=ze(H,T,!0,p)&&U,U=ze(H,T,!1,p)&&U,g)for(ne=0;ne<g.length;ne++)H=p.g=g[ne],U=ze(H,T,!1,p)&&U}Ee.prototype.N=function(){if(Ee.Z.N.call(this),this.i){var d=this.i;for(const p in d.g){const g=d.g[p];for(let T=0;T<g.length;T++)F(g[T]);delete d.g[p],d.h--}}this.G=null},Ee.prototype.J=function(d,p,g,T){return this.i.add(String(d),p,!1,g,T)},Ee.prototype.K=function(d,p,g,T){return this.i.add(String(d),p,!0,g,T)};function ze(d,p,g,T){if(p=d.i.g[String(p)],!p)return!0;p=p.concat();let U=!0;for(let H=0;H<p.length;++H){const ne=p[H];if(ne&&!ne.da&&ne.capture==g){const Le=ne.listener,Mt=ne.ha||ne.src;ne.fa&&V(d.i,ne),U=Le.call(Mt,T)!==!1&&U}}return U&&!T.defaultPrevented}function ct(d,p){if(typeof d!="function")if(d&&typeof d.handleEvent=="function")d=u(d.handleEvent,d);else throw Error("Invalid listener argument");return Number(p)>2147483647?-1:o.setTimeout(d,p||0)}function Ne(d){d.g=ct(()=>{d.g=null,d.i&&(d.i=!1,Ne(d))},d.l);const p=d.h;d.h=null,d.m.apply(null,p)}class Oe extends E{constructor(p,g){super(),this.m=p,this.l=g,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Ne(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ze(d){E.call(this),this.h=d,this.g={}}m(Ze,E);var Ws=[];function xs(d){Q(d.g,function(p,g){this.g.hasOwnProperty(g)&&ht(p)},d),d.g={}}Ze.prototype.N=function(){Ze.Z.N.call(this),xs(this)},Ze.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ps=o.JSON.stringify,li=o.JSON.parse,ci=class{stringify(d){return o.JSON.stringify(d,void 0)}parse(d){return o.JSON.parse(d,void 0)}};function di(){}function ui(){}var wn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function fr(){C.call(this,"d")}m(fr,C);function Y(){C.call(this,"c")}m(Y,C);var he={},de=null;function ke(){return de=de||new Ee}he.Ia="serverreachability";function dt(d){C.call(this,he.Ia,d)}m(dt,C);function $e(d){const p=ke();Ce(p,new dt(p))}he.STAT_EVENT="statevent";function Rt(d,p){C.call(this,he.STAT_EVENT,d),this.stat=p}m(Rt,C);function we(d){const p=ke();Ce(p,new Rt(p,d))}he.Ja="timingevent";function $t(d,p){C.call(this,he.Ja,d),this.size=p}m($t,C);function Rs(d,p){if(typeof d!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){d()},p)}function _n(){this.g=!0}_n.prototype.ua=function(){this.g=!1};function Bn(d,p,g,T,U,H){d.info(function(){if(d.g)if(H){var ne="",Le=H.split("&");for(let tt=0;tt<Le.length;tt++){var Mt=Le[tt].split("=");if(Mt.length>1){const Ft=Mt[0];Mt=Mt[1];const In=Ft.split("_");ne=In.length>=2&&In[1]=="type"?ne+(Ft+"="+Mt+"&"):ne+(Ft+"=redacted&")}}}else ne=null;else ne=H;return"XMLHTTP REQ ("+T+") [attempt "+U+"]: "+p+`
`+g+`
`+ne})}function Nn(d,p,g,T,U,H,ne){d.info(function(){return"XMLHTTP RESP ("+T+") [ attempt "+U+"]: "+p+`
`+g+`
`+H+" "+ne})}function Ks(d,p,g,T){d.info(function(){return"XMLHTTP TEXT ("+p+"): "+ac(d,g)+(T?" "+T:"")})}function ic(d,p){d.info(function(){return"TIMEOUT: "+p})}_n.prototype.info=function(){};function ac(d,p){if(!d.g)return p;if(!p)return null;try{const H=JSON.parse(p);if(H){for(d=0;d<H.length;d++)if(Array.isArray(H[d])){var g=H[d];if(!(g.length<2)){var T=g[1];if(Array.isArray(T)&&!(T.length<1)){var U=T[0];if(U!="noop"&&U!="stop"&&U!="close")for(let ne=1;ne<T.length;ne++)T[ne]=""}}}}return Ps(H)}catch{return p}}var hi={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},uo={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ho;function ta(){}m(ta,di),ta.prototype.g=function(){return new XMLHttpRequest},ho=new ta;function pr(d){return encodeURIComponent(String(d))}function oc(d){var p=1;d=d.split(":");const g=[];for(;p>0&&d.length;)g.push(d.shift()),p--;return d.length&&g.push(d.join(":")),g}function on(d,p,g,T){this.j=d,this.i=p,this.l=g,this.S=T||1,this.V=new Ze(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new mo}function mo(){this.i=null,this.g="",this.h=!1}var fo={},sa={};function na(d,p,g){d.M=1,d.A=ge(Ke(p)),d.u=g,d.R=!0,po(d,null)}function po(d,p){d.F=Date.now(),mi(d),d.B=Ke(d.A);var g=d.B,T=d.S;Array.isArray(T)||(T=[String(T)]),Zg(g.i,"t",T),d.C=0,g=d.j.L,d.h=new mo,d.g=xx(d.j,g?p:null,!d.u),d.P>0&&(d.O=new Oe(u(d.Y,d,d.g),d.P)),p=d.V,g=d.g,T=d.ba;var U="readystatechange";Array.isArray(U)||(U&&(Ws[0]=U.toString()),U=Ws);for(let H=0;H<U.length;H++){const ne=ae(g,U[H],T||p.handleEvent,!1,p.h||p);if(!ne)break;p.g[ne.key]=ne}p=d.J?I(d.J):{},d.u?(d.v||(d.v="POST"),p["Content-Type"]="application/x-www-form-urlencoded",d.g.ea(d.B,d.v,d.u,p)):(d.v="GET",d.g.ea(d.B,d.v,null,p)),$e(),Bn(d.i,d.v,d.B,d.l,d.S,d.u)}on.prototype.ba=function(d){d=d.target;const p=this.O;p&&yr(d)==3?p.j():this.Y(d)},on.prototype.Y=function(d){try{if(d==this.g)e:{const Le=yr(this.g),Mt=this.g.ya(),tt=this.g.ca();if(!(Le<3)&&(Le!=3||this.g&&(this.h.h||this.g.la()||ax(this.g)))){this.K||Le!=4||Mt==7||(Mt==8||tt<=0?$e(3):$e(2)),ra(this);var p=this.g.ca();this.X=p;var g=lc(this);if(this.o=p==200,Nn(this.i,this.v,this.B,this.l,this.S,Le,p),this.o){if(this.U&&!this.L){t:{if(this.g){var T,U=this.g;if((T=U.g?U.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(T)){var H=T;break t}}H=null}if(d=H)Ks(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ia(this,d);else{this.o=!1,this.m=3,we(12),jn(this),gr(this);break e}}if(this.R){d=!0;let Ft;for(;!this.K&&this.C<g.length;)if(Ft=cc(this,g),Ft==sa){Le==4&&(this.m=4,we(14),d=!1),Ks(this.i,this.l,null,"[Incomplete Response]");break}else if(Ft==fo){this.m=4,we(15),Ks(this.i,this.l,g,"[Invalid Chunk]"),d=!1;break}else Ks(this.i,this.l,Ft,null),ia(this,Ft);if(go(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Le!=4||g.length!=0||this.h.h||(this.m=1,we(16),d=!1),this.o=this.o&&d,!d)Ks(this.i,this.l,g,"[Invalid Chunked Response]"),jn(this),gr(this);else if(g.length>0&&!this.W){this.W=!0;var ne=this.j;ne.g==this&&ne.aa&&!ne.P&&(ne.j.info("Great, no buffering proxy detected. Bytes received: "+g.length),uh(ne),ne.P=!0,we(11))}}else Ks(this.i,this.l,g,null),ia(this,g);Le==4&&jn(this),this.o&&!this.K&&(Le==4?mx(this.j,this):(this.o=!1,mi(this)))}else Kj(this.g),p==400&&g.indexOf("Unknown SID")>0?(this.m=3,we(12)):(this.m=0,we(13)),jn(this),gr(this)}}}catch{}finally{}};function lc(d){if(!go(d))return d.g.la();const p=ax(d.g);if(p==="")return"";let g="";const T=p.length,U=yr(d.g)==4;if(!d.h.i){if(typeof TextDecoder>"u")return jn(d),gr(d),"";d.h.i=new o.TextDecoder}for(let H=0;H<T;H++)d.h.h=!0,g+=d.h.i.decode(p[H],{stream:!(U&&H==T-1)});return p.length=0,d.h.g+=g,d.C=0,d.h.g}function go(d){return d.g?d.v=="GET"&&d.M!=2&&d.j.Aa:!1}function cc(d,p){var g=d.C,T=p.indexOf(`
`,g);return T==-1?sa:(g=Number(p.substring(g,T)),isNaN(g)?fo:(T+=1,T+g>p.length?sa:(p=p.slice(T,T+g),d.C=T+g,p)))}on.prototype.cancel=function(){this.K=!0,jn(this)};function mi(d){d.T=Date.now()+d.H,xo(d,d.H)}function xo(d,p){if(d.D!=null)throw Error("WatchDog timer not null");d.D=Rs(u(d.aa,d),p)}function ra(d){d.D&&(o.clearTimeout(d.D),d.D=null)}on.prototype.aa=function(){this.D=null;const d=Date.now();d-this.T>=0?(ic(this.i,this.B),this.M!=2&&($e(),we(17)),jn(this),this.m=2,gr(this)):xo(this,this.T-d)};function gr(d){d.j.I==0||d.K||mx(d.j,d)}function jn(d){ra(d);var p=d.O;p&&typeof p.dispose=="function"&&p.dispose(),d.O=null,xs(d.V),d.g&&(p=d.g,d.g=null,p.abort(),p.dispose())}function ia(d,p){try{var g=d.j;if(g.I!=0&&(g.g==d||aa(g.h,d))){if(!d.L&&aa(g.h,d)&&g.I==3){try{var T=g.Ba.g.parse(p)}catch{T=null}if(Array.isArray(T)&&T.length==3){var U=T;if(U[0]==0){e:if(!g.v){if(g.g)if(g.g.F+3e3<d.F)pc(g),mc(g);else break e;dh(g),we(18)}}else g.xa=U[1],0<g.xa-g.K&&U[2]<37500&&g.F&&g.A==0&&!g.C&&(g.C=Rs(u(g.Va,g),6e3));bo(g.h)<=1&&g.ta&&(g.ta=void 0)}else pi(g,11)}else if((d.L||g.g==d)&&pc(g),!j(p))for(U=g.Ba.g.parse(p),p=0;p<U.length;p++){let tt=U[p];const Ft=tt[0];if(!(Ft<=g.K))if(g.K=Ft,tt=tt[1],g.I==2)if(tt[0]=="c"){g.M=tt[1],g.ba=tt[2];const In=tt[3];In!=null&&(g.ka=In,g.j.info("VER="+g.ka));const gi=tt[4];gi!=null&&(g.za=gi,g.j.info("SVER="+g.za));const vr=tt[5];vr!=null&&typeof vr=="number"&&vr>0&&(T=1.5*vr,g.O=T,g.j.info("backChannelRequestTimeoutMs_="+T)),T=g;const br=d.g;if(br){const xc=br.g?br.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(xc){var H=T.h;H.g||xc.indexOf("spdy")==-1&&xc.indexOf("quic")==-1&&xc.indexOf("h2")==-1||(H.j=H.l,H.g=new Set,H.h&&(oa(H,H.h),H.h=null))}if(T.G){const hh=br.g?br.g.getResponseHeader("X-HTTP-Session-Id"):null;hh&&(T.wa=hh,ve(T.J,T.G,hh))}}g.I=3,g.l&&g.l.ra(),g.aa&&(g.T=Date.now()-d.F,g.j.info("Handshake RTT: "+g.T+"ms")),T=g;var ne=d;if(T.na=gx(T,T.L?T.ba:null,T.W),ne.L){wo(T.h,ne);var Le=ne,Mt=T.O;Mt&&(Le.H=Mt),Le.D&&(ra(Le),mi(Le)),T.g=ne}else ux(T);g.i.length>0&&fc(g)}else tt[0]!="stop"&&tt[0]!="close"||pi(g,7);else g.I==3&&(tt[0]=="stop"||tt[0]=="close"?tt[0]=="stop"?pi(g,7):ch(g):tt[0]!="noop"&&g.l&&g.l.qa(tt),g.A=0)}}$e(4)}catch{}}var dc=class{constructor(d,p){this.g=d,this.map=p}};function yo(d){this.l=d||10,o.PerformanceNavigationTiming?(d=o.performance.getEntriesByType("navigation"),d=d.length>0&&(d[0].nextHopProtocol=="hq"||d[0].nextHopProtocol=="h2")):d=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=d?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function vo(d){return d.h?!0:d.g?d.g.size>=d.j:!1}function bo(d){return d.h?1:d.g?d.g.size:0}function aa(d,p){return d.h?d.h==p:d.g?d.g.has(p):!1}function oa(d,p){d.g?d.g.add(p):d.h=p}function wo(d,p){d.h&&d.h==p?d.h=null:d.g&&d.g.has(p)&&d.g.delete(p)}yo.prototype.cancel=function(){if(this.i=$(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const d of this.g.values())d.cancel();this.g.clear()}};function $(d){if(d.h!=null)return d.i.concat(d.h.G);if(d.g!=null&&d.g.size!==0){let p=d.i;for(const g of d.g.values())p=p.concat(g.G);return p}return y(d.i)}var G=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xe(d,p){if(d){d=d.split("&");for(let g=0;g<d.length;g++){const T=d[g].indexOf("=");let U,H=null;T>=0?(U=d[g].substring(0,T),H=d[g].substring(T+1)):U=d[g],p(U,H?decodeURIComponent(H.replace(/\+/g," ")):"")}}}function Me(d){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let p;d instanceof Me?(this.l=d.l,Ge(this,d.j),this.o=d.o,this.g=d.g,kt(this,d.u),this.h=d.h,Xt(this,ex(d.i)),this.m=d.m):d&&(p=String(d).match(G))?(this.l=!1,Ge(this,p[1]||"",!0),this.o=He(p[2]||""),this.g=He(p[3]||"",!0),kt(this,p[4]),this.h=He(p[5]||"",!0),Xt(this,p[6]||"",!0),this.m=He(p[7]||"")):(this.l=!1,this.i=new _o(null,this.l))}Me.prototype.toString=function(){const d=[];var p=this.j;p&&d.push(yt(p,ys,!0),":");var g=this.g;return(g||p=="file")&&(d.push("//"),(p=this.o)&&d.push(yt(p,ys,!0),"@"),d.push(pr(g).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.u,g!=null&&d.push(":",String(g))),(g=this.h)&&(this.g&&g.charAt(0)!="/"&&d.push("/"),d.push(yt(g,g.charAt(0)=="/"?ah:la,!0))),(g=this.i.toString())&&d.push("?",g),(g=this.m)&&d.push("#",yt(g,Dj)),d.join("")},Me.prototype.resolve=function(d){const p=Ke(this);let g=!!d.j;g?Ge(p,d.j):g=!!d.o,g?p.o=d.o:g=!!d.g,g?p.g=d.g:g=d.u!=null;var T=d.h;if(g)kt(p,d.u);else if(g=!!d.h){if(T.charAt(0)!="/")if(this.g&&!this.h)T="/"+T;else{var U=p.h.lastIndexOf("/");U!=-1&&(T=p.h.slice(0,U+1)+T)}if(U=T,U==".."||U==".")T="";else if(U.indexOf("./")!=-1||U.indexOf("/.")!=-1){T=U.lastIndexOf("/",0)==0,U=U.split("/");const H=[];for(let ne=0;ne<U.length;){const Le=U[ne++];Le=="."?T&&ne==U.length&&H.push(""):Le==".."?((H.length>1||H.length==1&&H[0]!="")&&H.pop(),T&&ne==U.length&&H.push("")):(H.push(Le),T=!0)}T=H.join("/")}else T=U}return g?p.h=T:g=d.i.toString()!=="",g?Xt(p,ex(d.i)):g=!!d.m,g&&(p.m=d.m),p};function Ke(d){return new Me(d)}function Ge(d,p,g){d.j=g?He(p,!0):p,d.j&&(d.j=d.j.replace(/:$/,""))}function kt(d,p){if(p){if(p=Number(p),isNaN(p)||p<0)throw Error("Bad port number "+p);d.u=p}else d.u=null}function Xt(d,p,g){p instanceof _o?(d.i=p,Uj(d.i,d.l)):(g||(p=yt(p,Fj)),d.i=new _o(p,d.l))}function ve(d,p,g){d.i.set(p,g)}function ge(d){return ve(d,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),d}function He(d,p){return d?p?decodeURI(d.replace(/%25/g,"%2525")):decodeURIComponent(d):""}function yt(d,p,g){return typeof d=="string"?(d=encodeURI(d).replace(p,Zt),g&&(d=d.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d):null}function Zt(d){return d=d.charCodeAt(0),"%"+(d>>4&15).toString(16)+(d&15).toString(16)}var ys=/[#\/\?@]/g,la=/[#\?:]/g,ah=/[#\?]/g,Fj=/[#\?@]/g,Dj=/#/g;function _o(d,p){this.h=this.g=null,this.i=d||null,this.j=!!p}function fi(d){d.g||(d.g=new Map,d.h=0,d.i&&xe(d.i,function(p,g){d.add(decodeURIComponent(p.replace(/\+/g," ")),g)}))}t=_o.prototype,t.add=function(d,p){fi(this),this.i=null,d=ca(this,d);let g=this.g.get(d);return g||this.g.set(d,g=[]),g.push(p),this.h+=1,this};function Jg(d,p){fi(d),p=ca(d,p),d.g.has(p)&&(d.i=null,d.h-=d.g.get(p).length,d.g.delete(p))}function Yg(d,p){return fi(d),p=ca(d,p),d.g.has(p)}t.forEach=function(d,p){fi(this),this.g.forEach(function(g,T){g.forEach(function(U){d.call(p,U,T,this)},this)},this)};function Xg(d,p){fi(d);let g=[];if(typeof p=="string")Yg(d,p)&&(g=g.concat(d.g.get(ca(d,p))));else for(d=Array.from(d.g.values()),p=0;p<d.length;p++)g=g.concat(d[p]);return g}t.set=function(d,p){return fi(this),this.i=null,d=ca(this,d),Yg(this,d)&&(this.h-=this.g.get(d).length),this.g.set(d,[p]),this.h+=1,this},t.get=function(d,p){return d?(d=Xg(this,d),d.length>0?String(d[0]):p):p};function Zg(d,p,g){Jg(d,p),g.length>0&&(d.i=null,d.g.set(ca(d,p),y(g)),d.h+=g.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const d=[],p=Array.from(this.g.keys());for(let T=0;T<p.length;T++){var g=p[T];const U=pr(g);g=Xg(this,g);for(let H=0;H<g.length;H++){let ne=U;g[H]!==""&&(ne+="="+pr(g[H])),d.push(ne)}}return this.i=d.join("&")};function ex(d){const p=new _o;return p.i=d.i,d.g&&(p.g=new Map(d.g),p.h=d.h),p}function ca(d,p){return p=String(p),d.j&&(p=p.toLowerCase()),p}function Uj(d,p){p&&!d.j&&(fi(d),d.i=null,d.g.forEach(function(g,T){const U=T.toLowerCase();T!=U&&(Jg(this,T),Zg(this,U,g))},d)),d.j=p}function Bj(d,p){const g=new _n;if(o.Image){const T=new Image;T.onload=h(xr,g,"TestLoadImage: loaded",!0,p,T),T.onerror=h(xr,g,"TestLoadImage: error",!1,p,T),T.onabort=h(xr,g,"TestLoadImage: abort",!1,p,T),T.ontimeout=h(xr,g,"TestLoadImage: timeout",!1,p,T),o.setTimeout(function(){T.ontimeout&&T.ontimeout()},1e4),T.src=d}else p(!1)}function zj(d,p){const g=new _n,T=new AbortController,U=setTimeout(()=>{T.abort(),xr(g,"TestPingServer: timeout",!1,p)},1e4);fetch(d,{signal:T.signal}).then(H=>{clearTimeout(U),H.ok?xr(g,"TestPingServer: ok",!0,p):xr(g,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(U),xr(g,"TestPingServer: error",!1,p)})}function xr(d,p,g,T,U){try{U&&(U.onload=null,U.onerror=null,U.onabort=null,U.ontimeout=null),T(g)}catch{}}function Hj(){this.g=new ci}function oh(d){this.i=d.Sb||null,this.h=d.ab||!1}m(oh,di),oh.prototype.g=function(){return new uc(this.i,this.h)};function uc(d,p){Ee.call(this),this.H=d,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(uc,Ee),t=uc.prototype,t.open=function(d,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=d,this.D=p,this.readyState=1,jo(this)},t.send=function(d){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const p={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};d&&(p.body=d),(this.H||o).fetch(new Request(this.D,p)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,No(this)),this.readyState=0},t.Pa=function(d){if(this.g&&(this.l=d,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=d.headers,this.readyState=2,jo(this)),this.g&&(this.readyState=3,jo(this),this.g)))if(this.responseType==="arraybuffer")d.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in d){if(this.j=d.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tx(this)}else d.text().then(this.Oa.bind(this),this.ga.bind(this))};function tx(d){d.j.read().then(d.Ma.bind(d)).catch(d.ga.bind(d))}t.Ma=function(d){if(this.g){if(this.o&&d.value)this.response.push(d.value);else if(!this.o){var p=d.value?d.value:new Uint8Array(0);(p=this.B.decode(p,{stream:!d.done}))&&(this.response=this.responseText+=p)}d.done?No(this):jo(this),this.readyState==3&&tx(this)}},t.Oa=function(d){this.g&&(this.response=this.responseText=d,No(this))},t.Na=function(d){this.g&&(this.response=d,No(this))},t.ga=function(){this.g&&No(this)};function No(d){d.readyState=4,d.l=null,d.j=null,d.B=null,jo(d)}t.setRequestHeader=function(d,p){this.A.append(d,p)},t.getResponseHeader=function(d){return this.h&&this.h.get(d.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const d=[],p=this.h.entries();for(var g=p.next();!g.done;)g=g.value,d.push(g[0]+": "+g[1]),g=p.next();return d.join(`\r
`)};function jo(d){d.onreadystatechange&&d.onreadystatechange.call(d)}Object.defineProperty(uc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(d){this.m=d?"include":"same-origin"}});function sx(d){let p="";return Q(d,function(g,T){p+=T,p+=":",p+=g,p+=`\r
`}),p}function lh(d,p,g){e:{for(T in g){var T=!1;break e}T=!0}T||(g=sx(g),typeof d=="string"?g!=null&&pr(g):ve(d,p,g))}function vt(d){Ee.call(this),this.headers=new Map,this.L=d||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(vt,Ee);var qj=/^https?$/i,Wj=["POST","PUT"];t=vt.prototype,t.Fa=function(d){this.H=d},t.ea=function(d,p,g,T){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+d);p=p?p.toUpperCase():"GET",this.D=d,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ho.g(),this.g.onreadystatechange=f(u(this.Ca,this));try{this.B=!0,this.g.open(p,String(d),!0),this.B=!1}catch(H){nx(this,H);return}if(d=g||"",g=new Map(this.headers),T)if(Object.getPrototypeOf(T)===Object.prototype)for(var U in T)g.set(U,T[U]);else if(typeof T.keys=="function"&&typeof T.get=="function")for(const H of T.keys())g.set(H,T.get(H));else throw Error("Unknown input type for opt_headers: "+String(T));T=Array.from(g.keys()).find(H=>H.toLowerCase()=="content-type"),U=o.FormData&&d instanceof o.FormData,!(Array.prototype.indexOf.call(Wj,p,void 0)>=0)||T||U||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[H,ne]of g)this.g.setRequestHeader(H,ne);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(d),this.v=!1}catch(H){nx(this,H)}};function nx(d,p){d.h=!1,d.g&&(d.j=!0,d.g.abort(),d.j=!1),d.l=p,d.o=5,rx(d),hc(d)}function rx(d){d.A||(d.A=!0,Ce(d,"complete"),Ce(d,"error"))}t.abort=function(d){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=d||7,Ce(this,"complete"),Ce(this,"abort"),hc(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),hc(this,!0)),vt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?ix(this):this.Xa())},t.Xa=function(){ix(this)};function ix(d){if(d.h&&typeof a<"u"){if(d.v&&yr(d)==4)setTimeout(d.Ca.bind(d),0);else if(Ce(d,"readystatechange"),yr(d)==4){d.h=!1;try{const H=d.ca();e:switch(H){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var g;if(!(g=p)){var T;if(T=H===0){let ne=String(d.D).match(G)[1]||null;!ne&&o.self&&o.self.location&&(ne=o.self.location.protocol.slice(0,-1)),T=!qj.test(ne?ne.toLowerCase():"")}g=T}if(g)Ce(d,"complete"),Ce(d,"success");else{d.o=6;try{var U=yr(d)>2?d.g.statusText:""}catch{U=""}d.l=U+" ["+d.ca()+"]",rx(d)}}finally{hc(d)}}}}function hc(d,p){if(d.g){d.m&&(clearTimeout(d.m),d.m=null);const g=d.g;d.g=null,p||Ce(d,"ready");try{g.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function yr(d){return d.g?d.g.readyState:0}t.ca=function(){try{return yr(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(d){if(this.g){var p=this.g.responseText;return d&&p.indexOf(d)==0&&(p=p.substring(d.length)),li(p)}};function ax(d){try{if(!d.g)return null;if("response"in d.g)return d.g.response;switch(d.F){case"":case"text":return d.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in d.g)return d.g.mozResponseArrayBuffer}return null}catch{return null}}function Kj(d){const p={};d=(d.g&&yr(d)>=2&&d.g.getAllResponseHeaders()||"").split(`\r
`);for(let T=0;T<d.length;T++){if(j(d[T]))continue;var g=oc(d[T]);const U=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const H=p[U]||[];p[U]=H,H.push(g)}K(p,function(T){return T.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Io(d,p,g){return g&&g.internalChannelParams&&g.internalChannelParams[d]||p}function ox(d){this.za=0,this.i=[],this.j=new _n,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Io("failFast",!1,d),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Io("baseRetryDelayMs",5e3,d),this.Za=Io("retryDelaySeedMs",1e4,d),this.Ta=Io("forwardChannelMaxRetries",2,d),this.va=Io("forwardChannelRequestTimeoutMs",2e4,d),this.ma=d&&d.xmlHttpFactory||void 0,this.Ua=d&&d.Rb||void 0,this.Aa=d&&d.useFetchStreams||!1,this.O=void 0,this.L=d&&d.supportsCrossDomainXhr||!1,this.M="",this.h=new yo(d&&d.concurrentRequestLimit),this.Ba=new Hj,this.S=d&&d.fastHandshake||!1,this.R=d&&d.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=d&&d.Pb||!1,d&&d.ua&&this.j.ua(),d&&d.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&d&&d.detectBufferingProxy||!1,this.ia=void 0,d&&d.longPollingTimeout&&d.longPollingTimeout>0&&(this.ia=d.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=ox.prototype,t.ka=8,t.I=1,t.connect=function(d,p,g,T){we(0),this.W=d,this.H=p||{},g&&T!==void 0&&(this.H.OSID=g,this.H.OAID=T),this.F=this.X,this.J=gx(this,null,this.W),fc(this)};function ch(d){if(lx(d),d.I==3){var p=d.V++,g=Ke(d.J);if(ve(g,"SID",d.M),ve(g,"RID",p),ve(g,"TYPE","terminate"),So(d,g),p=new on(d,d.j,p),p.M=2,p.A=ge(Ke(g)),g=!1,o.navigator&&o.navigator.sendBeacon)try{g=o.navigator.sendBeacon(p.A.toString(),"")}catch{}!g&&o.Image&&(new Image().src=p.A,g=!0),g||(p.g=xx(p.j,null),p.g.ea(p.A)),p.F=Date.now(),mi(p)}px(d)}function mc(d){d.g&&(uh(d),d.g.cancel(),d.g=null)}function lx(d){mc(d),d.v&&(o.clearTimeout(d.v),d.v=null),pc(d),d.h.cancel(),d.m&&(typeof d.m=="number"&&o.clearTimeout(d.m),d.m=null)}function fc(d){if(!vo(d.h)&&!d.m){d.m=!0;var p=d.Ea;D||N(),B||(D(),B=!0),v.add(p,d),d.D=0}}function Gj(d,p){return bo(d.h)>=d.h.j-(d.m?1:0)?!1:d.m?(d.i=p.G.concat(d.i),!0):d.I==1||d.I==2||d.D>=(d.Sa?0:d.Ta)?!1:(d.m=Rs(u(d.Ea,d,p),fx(d,d.D)),d.D++,!0)}t.Ea=function(d){if(this.m)if(this.m=null,this.I==1){if(!d){this.V=Math.floor(Math.random()*1e5),d=this.V++;const U=new on(this,this.j,d);let H=this.o;if(this.U&&(H?(H=I(H),W(H,this.U)):H=this.U),this.u!==null||this.R||(U.J=H,H=null),this.S)e:{for(var p=0,g=0;g<this.i.length;g++){t:{var T=this.i[g];if("__data__"in T.map&&(T=T.map.__data__,typeof T=="string")){T=T.length;break t}T=void 0}if(T===void 0)break;if(p+=T,p>4096){p=g;break e}if(p===4096||g===this.i.length-1){p=g+1;break e}}p=1e3}else p=1e3;p=dx(this,U,p),g=Ke(this.J),ve(g,"RID",d),ve(g,"CVER",22),this.G&&ve(g,"X-HTTP-Session-Id",this.G),So(this,g),H&&(this.R?p="headers="+pr(sx(H))+"&"+p:this.u&&lh(g,this.u,H)),oa(this.h,U),this.Ra&&ve(g,"TYPE","init"),this.S?(ve(g,"$req",p),ve(g,"SID","null"),U.U=!0,na(U,g,null)):na(U,g,p),this.I=2}}else this.I==3&&(d?cx(this,d):this.i.length==0||vo(this.h)||cx(this))};function cx(d,p){var g;p?g=p.l:g=d.V++;const T=Ke(d.J);ve(T,"SID",d.M),ve(T,"RID",g),ve(T,"AID",d.K),So(d,T),d.u&&d.o&&lh(T,d.u,d.o),g=new on(d,d.j,g,d.D+1),d.u===null&&(g.J=d.o),p&&(d.i=p.G.concat(d.i)),p=dx(d,g,1e3),g.H=Math.round(d.va*.5)+Math.round(d.va*.5*Math.random()),oa(d.h,g),na(g,T,p)}function So(d,p){d.H&&Q(d.H,function(g,T){ve(p,T,g)}),d.l&&Q({},function(g,T){ve(p,T,g)})}function dx(d,p,g){g=Math.min(d.i.length,g);const T=d.l?u(d.l.Ka,d.l,d):null;e:{var U=d.i;let Le=-1;for(;;){const Mt=["count="+g];Le==-1?g>0?(Le=U[0].g,Mt.push("ofs="+Le)):Le=0:Mt.push("ofs="+Le);let tt=!0;for(let Ft=0;Ft<g;Ft++){var H=U[Ft].g;const In=U[Ft].map;if(H-=Le,H<0)Le=Math.max(0,U[Ft].g-100),tt=!1;else try{H="req"+H+"_"||"";try{var ne=In instanceof Map?In:Object.entries(In);for(const[gi,vr]of ne){let br=vr;l(vr)&&(br=Ps(vr)),Mt.push(H+gi+"="+encodeURIComponent(br))}}catch(gi){throw Mt.push(H+"type="+encodeURIComponent("_badmap")),gi}}catch{T&&T(In)}}if(tt){ne=Mt.join("&");break e}}ne=void 0}return d=d.i.splice(0,g),p.G=d,ne}function ux(d){if(!d.g&&!d.v){d.Y=1;var p=d.Da;D||N(),B||(D(),B=!0),v.add(p,d),d.A=0}}function dh(d){return d.g||d.v||d.A>=3?!1:(d.Y++,d.v=Rs(u(d.Da,d),fx(d,d.A)),d.A++,!0)}t.Da=function(){if(this.v=null,hx(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var d=4*this.T;this.j.info("BP detection timer enabled: "+d),this.B=Rs(u(this.Wa,this),d)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,we(10),mc(this),hx(this))};function uh(d){d.B!=null&&(o.clearTimeout(d.B),d.B=null)}function hx(d){d.g=new on(d,d.j,"rpc",d.Y),d.u===null&&(d.g.J=d.o),d.g.P=0;var p=Ke(d.na);ve(p,"RID","rpc"),ve(p,"SID",d.M),ve(p,"AID",d.K),ve(p,"CI",d.F?"0":"1"),!d.F&&d.ia&&ve(p,"TO",d.ia),ve(p,"TYPE","xmlhttp"),So(d,p),d.u&&d.o&&lh(p,d.u,d.o),d.O&&(d.g.H=d.O);var g=d.g;d=d.ba,g.M=1,g.A=ge(Ke(p)),g.u=null,g.R=!0,po(g,d)}t.Va=function(){this.C!=null&&(this.C=null,mc(this),dh(this),we(19))};function pc(d){d.C!=null&&(o.clearTimeout(d.C),d.C=null)}function mx(d,p){var g=null;if(d.g==p){pc(d),uh(d),d.g=null;var T=2}else if(aa(d.h,p))g=p.G,wo(d.h,p),T=1;else return;if(d.I!=0){if(p.o)if(T==1){g=p.u?p.u.length:0,p=Date.now()-p.F;var U=d.D;T=ke(),Ce(T,new $t(T,g)),fc(d)}else ux(d);else if(U=p.m,U==3||U==0&&p.X>0||!(T==1&&Gj(d,p)||T==2&&dh(d)))switch(g&&g.length>0&&(p=d.h,p.i=p.i.concat(g)),U){case 1:pi(d,5);break;case 4:pi(d,10);break;case 3:pi(d,6);break;default:pi(d,2)}}}function fx(d,p){let g=d.Qa+Math.floor(Math.random()*d.Za);return d.isActive()||(g*=2),g*p}function pi(d,p){if(d.j.info("Error code "+p),p==2){var g=u(d.bb,d),T=d.Ua;const U=!T;T=new Me(T||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Ge(T,"https"),ge(T),U?Bj(T.toString(),g):zj(T.toString(),g)}else we(2);d.I=0,d.l&&d.l.pa(p),px(d),lx(d)}t.bb=function(d){d?(this.j.info("Successfully pinged google.com"),we(2)):(this.j.info("Failed to ping google.com"),we(1))};function px(d){if(d.I=0,d.ja=[],d.l){const p=$(d.h);(p.length!=0||d.i.length!=0)&&(_(d.ja,p),_(d.ja,d.i),d.h.i.length=0,y(d.i),d.i.length=0),d.l.oa()}}function gx(d,p,g){var T=g instanceof Me?Ke(g):new Me(g);if(T.g!="")p&&(T.g=p+"."+T.g),kt(T,T.u);else{var U=o.location;T=U.protocol,p=p?p+"."+U.hostname:U.hostname,U=+U.port;const H=new Me(null);T&&Ge(H,T),p&&(H.g=p),U&&kt(H,U),g&&(H.h=g),T=H}return g=d.G,p=d.wa,g&&p&&ve(T,g,p),ve(T,"VER",d.ka),So(d,T),T}function xx(d,p,g){if(p&&!d.L)throw Error("Can't create secondary domain capable XhrIo object.");return p=d.Aa&&!d.ma?new vt(new oh({ab:g})):new vt(d.ma),p.Fa(d.L),p}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function yx(){}t=yx.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function gc(){}gc.prototype.g=function(d,p){return new Ms(d,p)};function Ms(d,p){Ee.call(this),this.g=new ox(p),this.l=d,this.h=p&&p.messageUrlParams||null,d=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(d?d["X-Client-Protocol"]="webchannel":d={"X-Client-Protocol":"webchannel"}),this.g.o=d,d=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(d?d["X-WebChannel-Content-Type"]=p.messageContentType:d={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.sa&&(d?d["X-WebChannel-Client-Profile"]=p.sa:d={"X-WebChannel-Client-Profile":p.sa}),this.g.U=d,(d=p&&p.Qb)&&!j(d)&&(this.g.u=d),this.A=p&&p.supportsCrossDomainXhr||!1,this.v=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!j(p)&&(this.g.G=p,d=this.h,d!==null&&p in d&&(d=this.h,p in d&&delete d[p])),this.j=new da(this)}m(Ms,Ee),Ms.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ms.prototype.close=function(){ch(this.g)},Ms.prototype.o=function(d){var p=this.g;if(typeof d=="string"){var g={};g.__data__=d,d=g}else this.v&&(g={},g.__data__=Ps(d),d=g);p.i.push(new dc(p.Ya++,d)),p.I==3&&fc(p)},Ms.prototype.N=function(){this.g.l=null,delete this.j,ch(this.g),delete this.g,Ms.Z.N.call(this)};function vx(d){fr.call(this),d.__headers__&&(this.headers=d.__headers__,this.statusCode=d.__status__,delete d.__headers__,delete d.__status__);var p=d.__sm__;if(p){e:{for(const g in p){d=g;break e}d=void 0}(this.i=d)&&(d=this.i,p=p!==null&&d in p?p[d]:void 0),this.data=p}else this.data=d}m(vx,fr);function bx(){Y.call(this),this.status=1}m(bx,Y);function da(d){this.g=d}m(da,yx),da.prototype.ra=function(){Ce(this.g,"a")},da.prototype.qa=function(d){Ce(this.g,new vx(d))},da.prototype.pa=function(d){Ce(this.g,new bx)},da.prototype.oa=function(){Ce(this.g,"b")},gc.prototype.createWebChannel=gc.prototype.g,Ms.prototype.send=Ms.prototype.o,Ms.prototype.open=Ms.prototype.m,Ms.prototype.close=Ms.prototype.close,g_=function(){return new gc},p_=function(){return ke()},f_=he,uf={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},hi.NO_ERROR=0,hi.TIMEOUT=8,hi.HTTP_ERROR=6,ad=hi,uo.COMPLETE="complete",m_=uo,ui.EventType=wn,wn.OPEN="a",wn.CLOSE="b",wn.ERROR="c",wn.MESSAGE="d",Ee.prototype.listen=Ee.prototype.J,Bo=ui,vt.prototype.listenOnce=vt.prototype.K,vt.prototype.getLastError=vt.prototype.Ha,vt.prototype.getLastErrorCode=vt.prototype.ya,vt.prototype.getStatus=vt.prototype.ca,vt.prototype.getResponseJson=vt.prototype.La,vt.prototype.getResponseText=vt.prototype.la,vt.prototype.send=vt.prototype.ea,vt.prototype.setWithCredentials=vt.prototype.Fa,h_=vt}).apply(typeof Oc<"u"?Oc:typeof self<"u"?self:typeof window<"u"?window:{});const H0="@firebase/firestore",q0="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ns{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ns.UNAUTHENTICATED=new ns(null),ns.GOOGLE_CREDENTIALS=new ns("google-credentials-uid"),ns.FIRST_PARTY=new ns("first-party-uid"),ns.MOCK_USER=new ns("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ro="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $i=new Op("@firebase/firestore");function ha(){return $i.logLevel}function ue(t,...e){if($i.logLevel<=De.DEBUG){const s=e.map(Vp);$i.debug(`Firestore (${ro}): ${t}`,...s)}}function or(t,...e){if($i.logLevel<=De.ERROR){const s=e.map(Vp);$i.error(`Firestore (${ro}): ${t}`,...s)}}function Ga(t,...e){if($i.logLevel<=De.WARN){const s=e.map(Vp);$i.warn(`Firestore (${ro}): ${t}`,...s)}}function Vp(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Se(t,e,s){let n="Unexpected state";typeof e=="string"?n=e:s=e,x_(t,n,s)}function x_(t,e,s){let n=`FIRESTORE (${ro}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(s!==void 0)try{n+=" CONTEXT: "+JSON.stringify(s)}catch{n+=" CONTEXT: "+s}throw or(n),new Error(n)}function Je(t,e,s,n){let r="Unexpected state";typeof s=="string"?r=s:n=s,t||x_(e,r,n)}function Re(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class oe extends vn{constructor(e,s){super(e,s),this.code=e,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(){this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y_{constructor(e,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class cE{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,s){e.enqueueRetryable(()=>s(ns.UNAUTHENTICATED))}shutdown(){}}class dE{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,s){this.changeListener=s,e.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class uE{constructor(e){this.t=e,this.currentUser=ns.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,s){Je(this.o===void 0,42304);let n=this.i;const r=c=>this.i!==n?(n=this.i,s(c)):Promise.resolve();let a=new er;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new er,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const c=a;e.enqueueRetryable(async()=>{await c.promise,await r(this.currentUser)})},l=c=>{ue("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(ue("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new er)}},0),o()}getToken(){const e=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(n=>this.i!==e?(ue("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(Je(typeof n.accessToken=="string",31837,{l:n}),new y_(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Je(e===null||typeof e=="string",2055,{h:e}),new ns(e)}}class hE{constructor(e,s,n){this.P=e,this.T=s,this.I=n,this.type="FirstParty",this.user=ns.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class mE{constructor(e,s,n){this.P=e,this.T=s,this.I=n}getToken(){return Promise.resolve(new hE(this.P,this.T,this.I))}start(e,s){e.enqueueRetryable(()=>s(ns.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class W0{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class fE{constructor(e,s){this.V=s,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,hs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,s){Je(this.o===void 0,3512);const n=a=>{a.error!=null&&ue("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const o=a.token!==this.m;return this.m=a.token,ue("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?s(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable(()=>n(a))};const r=a=>{ue("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(a=>r(a)),setTimeout(()=>{if(!this.appCheck){const a=this.V.getImmediate({optional:!0});a?r(a):ue("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new W0(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(s=>s?(Je(typeof s.token=="string",44558,{tokenResult:s}),this.m=s.token,new W0(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pE(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(s);else for(let n=0;n<t;n++)s[n]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const r=pE(40);for(let a=0;a<r.length;++a)n.length<20&&r[a]<s&&(n+=e.charAt(r[a]%62))}return n}}function Ue(t,e){return t<e?-1:t>e?1:0}function hf(t,e){const s=Math.min(t.length,e.length);for(let n=0;n<s;n++){const r=t.charAt(n),a=e.charAt(n);if(r!==a)return Wh(r)===Wh(a)?Ue(r,a):Wh(r)?1:-1}return Ue(t.length,e.length)}const gE=55296,xE=57343;function Wh(t){const e=t.charCodeAt(0);return e>=gE&&e<=xE}function Qa(t,e,s){return t.length===e.length&&t.every((n,r)=>s(n,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K0="__name__";class Tn{constructor(e,s,n){s===void 0?s=0:s>e.length&&Se(637,{offset:s,range:e.length}),n===void 0?n=e.length-s:n>e.length-s&&Se(1746,{length:n,range:e.length-s}),this.segments=e,this.offset=s,this.len=n}get length(){return this.len}isEqual(e){return Tn.comparator(this,e)===0}child(e){const s=this.segments.slice(this.offset,this.limit());return e instanceof Tn?e.forEach(n=>{s.push(n)}):s.push(e),this.construct(s)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==e.get(s))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==e.get(s))return!1;return!0}forEach(e){for(let s=this.offset,n=this.limit();s<n;s++)e(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,s){const n=Math.min(e.length,s.length);for(let r=0;r<n;r++){const a=Tn.compareSegments(e.get(r),s.get(r));if(a!==0)return a}return Ue(e.length,s.length)}static compareSegments(e,s){const n=Tn.isNumericId(e),r=Tn.isNumericId(s);return n&&!r?-1:!n&&r?1:n&&r?Tn.extractNumericId(e).compare(Tn.extractNumericId(s)):hf(e,s)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Wr.fromString(e.substring(4,e.length-2))}}class rt extends Tn{construct(e,s,n){return new rt(e,s,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const s=[];for(const n of e){if(n.indexOf("//")>=0)throw new oe(X.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);s.push(...n.split("/").filter(r=>r.length>0))}return new rt(s)}static emptyPath(){return new rt([])}}const yE=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Gt extends Tn{construct(e,s,n){return new Gt(e,s,n)}static isValidIdentifier(e){return yE.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Gt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===K0}static keyField(){return new Gt([K0])}static fromServerFormat(e){const s=[];let n="",r=0;const a=()=>{if(n.length===0)throw new oe(X.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(n),n=""};let o=!1;for(;r<e.length;){const l=e[r];if(l==="\\"){if(r+1===e.length)throw new oe(X.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new oe(X.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,r+=2}else l==="`"?(o=!o,r++):l!=="."||o?(n+=l,r++):(a(),r++)}if(a(),o)throw new oe(X.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Gt(s)}static emptyPath(){return new Gt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class be{constructor(e){this.path=e}static fromPath(e){return new be(rt.fromString(e))}static fromName(e){return new be(rt.fromString(e).popFirst(5))}static empty(){return new be(rt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&rt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,s){return rt.comparator(e.path,s.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new be(new rt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v_(t,e,s){if(!s)throw new oe(X.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function vE(t,e,s,n){if(e===!0&&n===!0)throw new oe(X.INVALID_ARGUMENT,`${t} and ${s} cannot be used together.`)}function G0(t){if(!be.isDocumentKey(t))throw new oe(X.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Q0(t){if(be.isDocumentKey(t))throw new oe(X.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function b_(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Cu(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Se(12329,{type:typeof t})}function As(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new oe(X.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=Cu(t);throw new oe(X.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${s}`)}}return t}function bE(t,e){if(e<=0)throw new oe(X.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ct(t,e){const s={typeString:t};return e&&(s.value=e),s}function Gl(t,e){if(!b_(t))throw new oe(X.INVALID_ARGUMENT,"JSON must be an object");let s;for(const n in e)if(e[n]){const r=e[n].typeString,a="value"in e[n]?{value:e[n].value}:void 0;if(!(n in t)){s=`JSON missing required field: '${n}'`;break}const o=t[n];if(r&&typeof o!==r){s=`JSON field '${n}' must be a ${r}.`;break}if(a!==void 0&&o!==a.value){s=`Expected '${n}' field to equal '${a.value}'`;break}}if(s)throw new oe(X.INVALID_ARGUMENT,s);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J0=-62135596800,Y0=1e6;class it{static now(){return it.fromMillis(Date.now())}static fromDate(e){return it.fromMillis(e.getTime())}static fromMillis(e){const s=Math.floor(e/1e3),n=Math.floor((e-1e3*s)*Y0);return new it(s,n)}constructor(e,s){if(this.seconds=e,this.nanoseconds=s,s<0)throw new oe(X.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new oe(X.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(e<J0)throw new oe(X.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new oe(X.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Y0}_compareTo(e){return this.seconds===e.seconds?Ue(this.nanoseconds,e.nanoseconds):Ue(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:it._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Gl(e,it._jsonSchema))return new it(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-J0;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}it._jsonSchemaVersion="firestore/timestamp/1.0",it._jsonSchema={type:Ct("string",it._jsonSchemaVersion),seconds:Ct("number"),nanoseconds:Ct("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ae{static fromTimestamp(e){return new Ae(e)}static min(){return new Ae(new it(0,0))}static max(){return new Ae(new it(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const El=-1;function wE(t,e){const s=t.toTimestamp().seconds,n=t.toTimestamp().nanoseconds+1,r=Ae.fromTimestamp(n===1e9?new it(s+1,0):new it(s,n));return new Jr(r,be.empty(),e)}function _E(t){return new Jr(t.readTime,t.key,El)}class Jr{constructor(e,s,n){this.readTime=e,this.documentKey=s,this.largestBatchId=n}static min(){return new Jr(Ae.min(),be.empty(),El)}static max(){return new Jr(Ae.max(),be.empty(),El)}}function NE(t,e){let s=t.readTime.compareTo(e.readTime);return s!==0?s:(s=be.comparator(t.documentKey,e.documentKey),s!==0?s:Ue(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class IE{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function io(t){if(t.code!==X.FAILED_PRECONDITION||t.message!==jE)throw t;ue("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(e){return this.next(void 0,e)}next(e,s){return this.callbackAttached&&Se(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(e,this.result):new ee((n,r)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(n,r)},this.catchCallback=a=>{this.wrapFailure(s,a).next(n,r)}})}toPromise(){return new Promise((e,s)=>{this.next(e,s)})}wrapUserFunction(e){try{const s=e();return s instanceof ee?s:ee.resolve(s)}catch(s){return ee.reject(s)}}wrapSuccess(e,s){return e?this.wrapUserFunction(()=>e(s)):ee.resolve(s)}wrapFailure(e,s){return e?this.wrapUserFunction(()=>e(s)):ee.reject(s)}static resolve(e){return new ee((s,n)=>{s(e)})}static reject(e){return new ee((s,n)=>{n(e)})}static waitFor(e){return new ee((s,n)=>{let r=0,a=0,o=!1;e.forEach(l=>{++r,l.next(()=>{++a,o&&a===r&&s()},c=>n(c))}),o=!0,a===r&&s()})}static or(e){let s=ee.resolve(!1);for(const n of e)s=s.next(r=>r?ee.resolve(r):n());return s}static forEach(e,s){const n=[];return e.forEach((r,a)=>{n.push(s.call(this,r,a))}),this.waitFor(n)}static mapArray(e,s){return new ee((n,r)=>{const a=e.length,o=new Array(a);let l=0;for(let c=0;c<a;c++){const u=c;s(e[u]).next(h=>{o[u]=h,++l,l===a&&n(o)},h=>r(h))}})}static doWhile(e,s){return new ee((n,r)=>{const a=()=>{e()===!0?s().next(()=>{a()},r):n()};a()})}}function SE(t){const e=t.match(/Android ([\d.]+)/i),s=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function ao(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pu{constructor(e,s){this.previousValue=e,s&&(s.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>s.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Pu.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fp=-1;function Ru(t){return t==null}function Hd(t){return t===0&&1/t==-1/0}function kE(t){return typeof t=="number"&&Number.isInteger(t)&&!Hd(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w_="";function EE(t){let e="";for(let s=0;s<t.length;s++)e.length>0&&(e=X0(e)),e=TE(t.get(s),e);return X0(e)}function TE(t,e){let s=e;const n=t.length;for(let r=0;r<n;r++){const a=t.charAt(r);switch(a){case"\0":s+="";break;case w_:s+="";break;default:s+=a}}return s}function X0(t){return t+w_+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z0(t){let e=0;for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&e++;return e}function ai(t,e){for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&e(s,t[s])}function __(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e,s){this.comparator=e,this.root=s||Kt.EMPTY}insert(e,s){return new xt(this.comparator,this.root.insert(e,s,this.comparator).copy(null,null,Kt.BLACK,null,null))}remove(e){return new xt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Kt.BLACK,null,null))}get(e){let s=this.root;for(;!s.isEmpty();){const n=this.comparator(e,s.key);if(n===0)return s.value;n<0?s=s.left:n>0&&(s=s.right)}return null}indexOf(e){let s=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return s+n.left.size;r<0?n=n.left:(s+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((s,n)=>(e(s,n),!1))}toString(){const e=[];return this.inorderTraversal((s,n)=>(e.push(`${s}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Lc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Lc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Lc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Lc(this.root,e,this.comparator,!0)}}class Lc{constructor(e,s,n,r){this.isReverse=r,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=s?n(e.key,s):1,s&&r&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const s={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Kt{constructor(e,s,n,r,a){this.key=e,this.value=s,this.color=n??Kt.RED,this.left=r??Kt.EMPTY,this.right=a??Kt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,s,n,r,a){return new Kt(e??this.key,s??this.value,n??this.color,r??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,s,n){let r=this;const a=n(e,r.key);return r=a<0?r.copy(null,null,null,r.left.insert(e,s,n),null):a===0?r.copy(null,s,null,null,null):r.copy(null,null,null,null,r.right.insert(e,s,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Kt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,s){let n,r=this;if(s(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,s),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),s(e,r.key)===0){if(r.right.isEmpty())return Kt.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,s))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Kt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Kt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,s)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Se(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Se(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Se(27949);return e+(this.isRed()?0:1)}}Kt.EMPTY=null,Kt.RED=!0,Kt.BLACK=!1;Kt.EMPTY=new class{constructor(){this.size=0}get key(){throw Se(57766)}get value(){throw Se(16141)}get color(){throw Se(16727)}get left(){throw Se(29726)}get right(){throw Se(36894)}copy(e,s,n,r,a){return this}insert(e,s,n){return new Kt(e,s)}remove(e,s){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e){this.comparator=e,this.data=new xt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((s,n)=>(e(s),!1))}forEachInRange(e,s){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;s(r.key)}}forEachWhile(e,s){let n;for(n=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const s=this.data.getIteratorFrom(e);return s.hasNext()?s.getNext().key:null}getIterator(){return new ey(this.data.getIterator())}getIteratorFrom(e){return new ey(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let s=this;return s.size<e.size&&(s=e,e=this),e.forEach(n=>{s=s.add(n)}),s}isEqual(e){if(!(e instanceof Vt)||this.size!==e.size)return!1;const s=this.data.getIterator(),n=e.data.getIterator();for(;s.hasNext();){const r=s.getNext().key,a=n.getNext().key;if(this.comparator(r,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(s=>{e.push(s)}),e}toString(){const e=[];return this.forEach(s=>e.push(s)),"SortedSet("+e.toString()+")"}copy(e){const s=new Vt(this.comparator);return s.data=e,s}}class ey{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs{constructor(e){this.fields=e,e.sort(Gt.comparator)}static empty(){return new Fs([])}unionWith(e){let s=new Vt(Gt.comparator);for(const n of this.fields)s=s.add(n);for(const n of e)s=s.add(n);return new Fs(s.toArray())}covers(e){for(const s of this.fields)if(s.isPrefixOf(e))return!0;return!1}isEqual(e){return Qa(this.fields,e.fields,(s,n)=>s.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N_ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e){this.binaryString=e}static fromBase64String(e){const s=function(r){try{return atob(r)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new N_("Invalid base64 string: "+a):a}}(e);return new Yt(s)}static fromUint8Array(e){const s=function(r){let a="";for(let o=0;o<r.length;++o)a+=String.fromCharCode(r[o]);return a}(e);return new Yt(s)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const n=new Uint8Array(s.length);for(let r=0;r<s.length;r++)n[r]=s.charCodeAt(r);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ue(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Yt.EMPTY_BYTE_STRING=new Yt("");const AE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Yr(t){if(Je(!!t,39018),typeof t=="string"){let e=0;const s=AE.exec(t);if(Je(!!s,46558,{timestamp:t}),s[1]){let r=s[1];r=(r+"000000000").substr(0,9),e=Number(r)}const n=new Date(t);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:It(t.seconds),nanos:It(t.nanos)}}function It(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Xr(t){return typeof t=="string"?Yt.fromBase64String(t):Yt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j_="server_timestamp",I_="__type__",S_="__previous_value__",k_="__local_write_time__";function Dp(t){var s,n;return((n=(((s=t==null?void 0:t.mapValue)==null?void 0:s.fields)||{})[I_])==null?void 0:n.stringValue)===j_}function Mu(t){const e=t.mapValue.fields[S_];return Dp(e)?Mu(e):e}function Tl(t){const e=Yr(t.mapValue.fields[k_].timestampValue);return new it(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(e,s,n,r,a,o,l,c,u,h){this.databaseId=e,this.appId=s,this.persistenceKey=n,this.host=r,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=u,this.isUsingEmulator=h}}const qd="(default)";class Al{constructor(e,s){this.projectId=e,this.database=s||qd}static empty(){return new Al("","")}get isDefaultDatabase(){return this.database===qd}isEqual(e){return e instanceof Al&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E_="__type__",PE="__max__",Vc={mapValue:{}},T_="__vector__",Wd="value";function Zr(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Dp(t)?4:ME(t)?9007199254740991:RE(t)?10:11:Se(28295,{value:t})}function Dn(t,e){if(t===e)return!0;const s=Zr(t);if(s!==Zr(e))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Tl(t).isEqual(Tl(e));case 3:return function(r,a){if(typeof r.timestampValue=="string"&&typeof a.timestampValue=="string"&&r.timestampValue.length===a.timestampValue.length)return r.timestampValue===a.timestampValue;const o=Yr(r.timestampValue),l=Yr(a.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(r,a){return Xr(r.bytesValue).isEqual(Xr(a.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(r,a){return It(r.geoPointValue.latitude)===It(a.geoPointValue.latitude)&&It(r.geoPointValue.longitude)===It(a.geoPointValue.longitude)}(t,e);case 2:return function(r,a){if("integerValue"in r&&"integerValue"in a)return It(r.integerValue)===It(a.integerValue);if("doubleValue"in r&&"doubleValue"in a){const o=It(r.doubleValue),l=It(a.doubleValue);return o===l?Hd(o)===Hd(l):isNaN(o)&&isNaN(l)}return!1}(t,e);case 9:return Qa(t.arrayValue.values||[],e.arrayValue.values||[],Dn);case 10:case 11:return function(r,a){const o=r.mapValue.fields||{},l=a.mapValue.fields||{};if(Z0(o)!==Z0(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!Dn(o[c],l[c])))return!1;return!0}(t,e);default:return Se(52216,{left:t})}}function Cl(t,e){return(t.values||[]).find(s=>Dn(s,e))!==void 0}function Ja(t,e){if(t===e)return 0;const s=Zr(t),n=Zr(e);if(s!==n)return Ue(s,n);switch(s){case 0:case 9007199254740991:return 0;case 1:return Ue(t.booleanValue,e.booleanValue);case 2:return function(a,o){const l=It(a.integerValue||a.doubleValue),c=It(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(t,e);case 3:return ty(t.timestampValue,e.timestampValue);case 4:return ty(Tl(t),Tl(e));case 5:return hf(t.stringValue,e.stringValue);case 6:return function(a,o){const l=Xr(a),c=Xr(o);return l.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(a,o){const l=a.split("/"),c=o.split("/");for(let u=0;u<l.length&&u<c.length;u++){const h=Ue(l[u],c[u]);if(h!==0)return h}return Ue(l.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(a,o){const l=Ue(It(a.latitude),It(o.latitude));return l!==0?l:Ue(It(a.longitude),It(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return sy(t.arrayValue,e.arrayValue);case 10:return function(a,o){var f,y,_,S;const l=a.fields||{},c=o.fields||{},u=(f=l[Wd])==null?void 0:f.arrayValue,h=(y=c[Wd])==null?void 0:y.arrayValue,m=Ue(((_=u==null?void 0:u.values)==null?void 0:_.length)||0,((S=h==null?void 0:h.values)==null?void 0:S.length)||0);return m!==0?m:sy(u,h)}(t.mapValue,e.mapValue);case 11:return function(a,o){if(a===Vc.mapValue&&o===Vc.mapValue)return 0;if(a===Vc.mapValue)return 1;if(o===Vc.mapValue)return-1;const l=a.fields||{},c=Object.keys(l),u=o.fields||{},h=Object.keys(u);c.sort(),h.sort();for(let m=0;m<c.length&&m<h.length;++m){const f=hf(c[m],h[m]);if(f!==0)return f;const y=Ja(l[c[m]],u[h[m]]);if(y!==0)return y}return Ue(c.length,h.length)}(t.mapValue,e.mapValue);default:throw Se(23264,{he:s})}}function ty(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Ue(t,e);const s=Yr(t),n=Yr(e),r=Ue(s.seconds,n.seconds);return r!==0?r:Ue(s.nanos,n.nanos)}function sy(t,e){const s=t.values||[],n=e.values||[];for(let r=0;r<s.length&&r<n.length;++r){const a=Ja(s[r],n[r]);if(a)return a}return Ue(s.length,n.length)}function Ya(t){return mf(t)}function mf(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(s){const n=Yr(s);return`time(${n.seconds},${n.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(s){return Xr(s).toBase64()}(t.bytesValue):"referenceValue"in t?function(s){return be.fromName(s).toString()}(t.referenceValue):"geoPointValue"in t?function(s){return`geo(${s.latitude},${s.longitude})`}(t.geoPointValue):"arrayValue"in t?function(s){let n="[",r=!0;for(const a of s.values||[])r?r=!1:n+=",",n+=mf(a);return n+"]"}(t.arrayValue):"mapValue"in t?function(s){const n=Object.keys(s.fields||{}).sort();let r="{",a=!0;for(const o of n)a?a=!1:r+=",",r+=`${o}:${mf(s.fields[o])}`;return r+"}"}(t.mapValue):Se(61005,{value:t})}function od(t){switch(Zr(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Mu(t);return e?16+od(e):16;case 5:return 2*t.stringValue.length;case 6:return Xr(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((r,a)=>r+od(a),0)}(t.arrayValue);case 10:case 11:return function(n){let r=0;return ai(n.fields,(a,o)=>{r+=a.length+od(o)}),r}(t.mapValue);default:throw Se(13486,{value:t})}}function ny(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function ff(t){return!!t&&"integerValue"in t}function Up(t){return!!t&&"arrayValue"in t}function ry(t){return!!t&&"nullValue"in t}function iy(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ld(t){return!!t&&"mapValue"in t}function RE(t){var s,n;return((n=(((s=t==null?void 0:t.mapValue)==null?void 0:s.fields)||{})[E_])==null?void 0:n.stringValue)===T_}function rl(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return ai(t.mapValue.fields,(s,n)=>e.mapValue.fields[s]=rl(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let s=0;s<(t.arrayValue.values||[]).length;++s)e.arrayValue.values[s]=rl(t.arrayValue.values[s]);return e}return{...t}}function ME(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===PE}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(e){this.value=e}static empty(){return new Ns({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let s=this.value;for(let n=0;n<e.length-1;++n)if(s=(s.mapValue.fields||{})[e.get(n)],!ld(s))return null;return s=(s.mapValue.fields||{})[e.lastSegment()],s||null}}set(e,s){this.getFieldsMap(e.popLast())[e.lastSegment()]=rl(s)}setAll(e){let s=Gt.emptyPath(),n={},r=[];e.forEach((o,l)=>{if(!s.isImmediateParentOf(l)){const c=this.getFieldsMap(s);this.applyChanges(c,n,r),n={},r=[],s=l.popLast()}o?n[l.lastSegment()]=rl(o):r.push(l.lastSegment())});const a=this.getFieldsMap(s);this.applyChanges(a,n,r)}delete(e){const s=this.field(e.popLast());ld(s)&&s.mapValue.fields&&delete s.mapValue.fields[e.lastSegment()]}isEqual(e){return Dn(this.value,e.value)}getFieldsMap(e){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=s.mapValue.fields[e.get(n)];ld(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},s.mapValue.fields[e.get(n)]=r),s=r}return s.mapValue.fields}applyChanges(e,s,n){ai(s,(r,a)=>e[r]=a);for(const r of n)delete e[r]}clone(){return new Ns(rl(this.value))}}function A_(t){const e=[];return ai(t.fields,(s,n)=>{const r=new Gt([s]);if(ld(n)){const a=A_(n.mapValue).fields;if(a.length===0)e.push(r);else for(const o of a)e.push(r.child(o))}else e.push(r)}),new Fs(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e,s,n,r,a,o,l){this.key=e,this.documentType=s,this.version=n,this.readTime=r,this.createTime=a,this.data=o,this.documentState=l}static newInvalidDocument(e){return new is(e,0,Ae.min(),Ae.min(),Ae.min(),Ns.empty(),0)}static newFoundDocument(e,s,n,r){return new is(e,1,s,Ae.min(),n,r,0)}static newNoDocument(e,s){return new is(e,2,s,Ae.min(),Ae.min(),Ns.empty(),0)}static newUnknownDocument(e,s){return new is(e,3,s,Ae.min(),Ae.min(),Ns.empty(),2)}convertToFoundDocument(e,s){return!this.createTime.isEqual(Ae.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ns.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ns.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ae.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof is&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new is(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e,s){this.position=e,this.inclusive=s}}function ay(t,e,s){let n=0;for(let r=0;r<t.position.length;r++){const a=e[r],o=t.position[r];if(a.field.isKeyField()?n=be.comparator(be.fromName(o.referenceValue),s.key):n=Ja(o,s.data.field(a.field)),a.dir==="desc"&&(n*=-1),n!==0)break}return n}function oy(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let s=0;s<t.position.length;s++)if(!Dn(t.position[s],e.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e,s="asc"){this.field=e,this.dir=s}}function OE(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C_{}class At extends C_{constructor(e,s,n){super(),this.field=e,this.op=s,this.value=n}static create(e,s,n){return e.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(e,s,n):new VE(e,s,n):s==="array-contains"?new DE(e,n):s==="in"?new UE(e,n):s==="not-in"?new BE(e,n):s==="array-contains-any"?new zE(e,n):new At(e,s,n)}static createKeyFieldInFilter(e,s,n){return s==="in"?new $E(e,n):new FE(e,n)}matches(e){const s=e.data.field(this.field);return this.op==="!="?s!==null&&s.nullValue===void 0&&this.matchesComparison(Ja(s,this.value)):s!==null&&Zr(this.value)===Zr(s)&&this.matchesComparison(Ja(s,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Se(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class yn extends C_{constructor(e,s){super(),this.filters=e,this.op=s,this.Pe=null}static create(e,s){return new yn(e,s)}matches(e){return P_(this)?this.filters.find(s=>!s.matches(e))===void 0:this.filters.find(s=>s.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,s)=>e.concat(s.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function P_(t){return t.op==="and"}function R_(t){return LE(t)&&P_(t)}function LE(t){for(const e of t.filters)if(e instanceof yn)return!1;return!0}function pf(t){if(t instanceof At)return t.field.canonicalString()+t.op.toString()+Ya(t.value);if(R_(t))return t.filters.map(e=>pf(e)).join(",");{const e=t.filters.map(s=>pf(s)).join(",");return`${t.op}(${e})`}}function M_(t,e){return t instanceof At?function(n,r){return r instanceof At&&n.op===r.op&&n.field.isEqual(r.field)&&Dn(n.value,r.value)}(t,e):t instanceof yn?function(n,r){return r instanceof yn&&n.op===r.op&&n.filters.length===r.filters.length?n.filters.reduce((a,o,l)=>a&&M_(o,r.filters[l]),!0):!1}(t,e):void Se(19439)}function O_(t){return t instanceof At?function(s){return`${s.field.canonicalString()} ${s.op} ${Ya(s.value)}`}(t):t instanceof yn?function(s){return s.op.toString()+" {"+s.getFilters().map(O_).join(" ,")+"}"}(t):"Filter"}class VE extends At{constructor(e,s,n){super(e,s,n),this.key=be.fromName(n.referenceValue)}matches(e){const s=be.comparator(e.key,this.key);return this.matchesComparison(s)}}class $E extends At{constructor(e,s){super(e,"in",s),this.keys=L_("in",s)}matches(e){return this.keys.some(s=>s.isEqual(e.key))}}class FE extends At{constructor(e,s){super(e,"not-in",s),this.keys=L_("not-in",s)}matches(e){return!this.keys.some(s=>s.isEqual(e.key))}}function L_(t,e){var s;return(((s=e.arrayValue)==null?void 0:s.values)||[]).map(n=>be.fromName(n.referenceValue))}class DE extends At{constructor(e,s){super(e,"array-contains",s)}matches(e){const s=e.data.field(this.field);return Up(s)&&Cl(s.arrayValue,this.value)}}class UE extends At{constructor(e,s){super(e,"in",s)}matches(e){const s=e.data.field(this.field);return s!==null&&Cl(this.value.arrayValue,s)}}class BE extends At{constructor(e,s){super(e,"not-in",s)}matches(e){if(Cl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=e.data.field(this.field);return s!==null&&s.nullValue===void 0&&!Cl(this.value.arrayValue,s)}}class zE extends At{constructor(e,s){super(e,"array-contains-any",s)}matches(e){const s=e.data.field(this.field);return!(!Up(s)||!s.arrayValue.values)&&s.arrayValue.values.some(n=>Cl(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HE{constructor(e,s=null,n=[],r=[],a=null,o=null,l=null){this.path=e,this.collectionGroup=s,this.orderBy=n,this.filters=r,this.limit=a,this.startAt=o,this.endAt=l,this.Te=null}}function ly(t,e=null,s=[],n=[],r=null,a=null,o=null){return new HE(t,e,s,n,r,a,o)}function Bp(t){const e=Re(t);if(e.Te===null){let s=e.path.canonicalString();e.collectionGroup!==null&&(s+="|cg:"+e.collectionGroup),s+="|f:",s+=e.filters.map(n=>pf(n)).join(","),s+="|ob:",s+=e.orderBy.map(n=>function(a){return a.field.canonicalString()+a.dir}(n)).join(","),Ru(e.limit)||(s+="|l:",s+=e.limit),e.startAt&&(s+="|lb:",s+=e.startAt.inclusive?"b:":"a:",s+=e.startAt.position.map(n=>Ya(n)).join(",")),e.endAt&&(s+="|ub:",s+=e.endAt.inclusive?"a:":"b:",s+=e.endAt.position.map(n=>Ya(n)).join(",")),e.Te=s}return e.Te}function zp(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<t.orderBy.length;s++)if(!OE(t.orderBy[s],e.orderBy[s]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(!M_(t.filters[s],e.filters[s]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!oy(t.startAt,e.startAt)&&oy(t.endAt,e.endAt)}function gf(t){return be.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(e,s=null,n=[],r=[],a=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=s,this.explicitOrderBy=n,this.filters=r,this.limit=a,this.limitType=o,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function qE(t,e,s,n,r,a,o,l){return new oo(t,e,s,n,r,a,o,l)}function Ou(t){return new oo(t)}function cy(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function V_(t){return t.collectionGroup!==null}function il(t){const e=Re(t);if(e.Ie===null){e.Ie=[];const s=new Set;for(const a of e.explicitOrderBy)e.Ie.push(a),s.add(a.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new Vt(Gt.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(l=l.add(u.field))})}),l})(e).forEach(a=>{s.has(a.canonicalString())||a.isKeyField()||e.Ie.push(new Pl(a,n))}),s.has(Gt.keyField().canonicalString())||e.Ie.push(new Pl(Gt.keyField(),n))}return e.Ie}function Mn(t){const e=Re(t);return e.Ee||(e.Ee=WE(e,il(t))),e.Ee}function WE(t,e){if(t.limitType==="F")return ly(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(r=>{const a=r.dir==="desc"?"asc":"desc";return new Pl(r.field,a)});const s=t.endAt?new Kd(t.endAt.position,t.endAt.inclusive):null,n=t.startAt?new Kd(t.startAt.position,t.startAt.inclusive):null;return ly(t.path,t.collectionGroup,e,t.filters,t.limit,s,n)}}function xf(t,e){const s=t.filters.concat([e]);return new oo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),s,t.limit,t.limitType,t.startAt,t.endAt)}function Gd(t,e,s){return new oo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,s,t.startAt,t.endAt)}function Lu(t,e){return zp(Mn(t),Mn(e))&&t.limitType===e.limitType}function $_(t){return`${Bp(Mn(t))}|lt:${t.limitType}`}function ma(t){return`Query(target=${function(s){let n=s.path.canonicalString();return s.collectionGroup!==null&&(n+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(n+=`, filters: [${s.filters.map(r=>O_(r)).join(", ")}]`),Ru(s.limit)||(n+=", limit: "+s.limit),s.orderBy.length>0&&(n+=`, orderBy: [${s.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),s.startAt&&(n+=", startAt: ",n+=s.startAt.inclusive?"b:":"a:",n+=s.startAt.position.map(r=>Ya(r)).join(",")),s.endAt&&(n+=", endAt: ",n+=s.endAt.inclusive?"a:":"b:",n+=s.endAt.position.map(r=>Ya(r)).join(",")),`Target(${n})`}(Mn(t))}; limitType=${t.limitType})`}function Vu(t,e){return e.isFoundDocument()&&function(n,r){const a=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(a):be.isDocumentKey(n.path)?n.path.isEqual(a):n.path.isImmediateParentOf(a)}(t,e)&&function(n,r){for(const a of il(n))if(!a.field.isKeyField()&&r.data.field(a.field)===null)return!1;return!0}(t,e)&&function(n,r){for(const a of n.filters)if(!a.matches(r))return!1;return!0}(t,e)&&function(n,r){return!(n.startAt&&!function(o,l,c){const u=ay(o,l,c);return o.inclusive?u<=0:u<0}(n.startAt,il(n),r)||n.endAt&&!function(o,l,c){const u=ay(o,l,c);return o.inclusive?u>=0:u>0}(n.endAt,il(n),r))}(t,e)}function KE(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function F_(t){return(e,s)=>{let n=!1;for(const r of il(t)){const a=GE(r,e,s);if(a!==0)return a;n=n||r.field.isKeyField()}return 0}}function GE(t,e,s){const n=t.field.isKeyField()?be.comparator(e.key,s.key):function(a,o,l){const c=o.data.field(a),u=l.data.field(a);return c!==null&&u!==null?Ja(c,u):Se(42886)}(t.field,e,s);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return Se(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e,s){this.mapKeyFn=e,this.equalsFn=s,this.inner={},this.innerSize=0}get(e){const s=this.mapKeyFn(e),n=this.inner[s];if(n!==void 0){for(const[r,a]of n)if(this.equalsFn(r,e))return a}}has(e){return this.get(e)!==void 0}set(e,s){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return this.inner[n]=[[e,s]],void this.innerSize++;for(let a=0;a<r.length;a++)if(this.equalsFn(r[a][0],e))return void(r[a]=[e,s]);r.push([e,s]),this.innerSize++}delete(e){const s=this.mapKeyFn(e),n=this.inner[s];if(n===void 0)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return n.length===1?delete this.inner[s]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ai(this.inner,(s,n)=>{for(const[r,a]of n)e(r,a)})}isEmpty(){return __(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QE=new xt(be.comparator);function lr(){return QE}const D_=new xt(be.comparator);function zo(...t){let e=D_;for(const s of t)e=e.insert(s.key,s);return e}function U_(t){let e=D_;return t.forEach((s,n)=>e=e.insert(s,n.overlayedDocument)),e}function Ni(){return al()}function B_(){return al()}function al(){return new Yi(t=>t.toString(),(t,e)=>t.isEqual(e))}const JE=new xt(be.comparator),YE=new Vt(be.comparator);function Be(...t){let e=YE;for(const s of t)e=e.add(s);return e}const XE=new Vt(Ue);function ZE(){return XE}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hp(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Hd(e)?"-0":e}}function z_(t){return{integerValue:""+t}}function H_(t,e){return kE(e)?z_(e):Hp(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $u{constructor(){this._=void 0}}function eT(t,e,s){return t instanceof Rl?function(r,a){const o={fields:{[I_]:{stringValue:j_},[k_]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return a&&Dp(a)&&(a=Mu(a)),a&&(o.fields[S_]=a),{mapValue:o}}(s,e):t instanceof Ml?W_(t,e):t instanceof Ol?K_(t,e):function(r,a){const o=q_(r,a),l=dy(o)+dy(r.Ae);return ff(o)&&ff(r.Ae)?z_(l):Hp(r.serializer,l)}(t,e)}function tT(t,e,s){return t instanceof Ml?W_(t,e):t instanceof Ol?K_(t,e):s}function q_(t,e){return t instanceof Ll?function(n){return ff(n)||function(a){return!!a&&"doubleValue"in a}(n)}(e)?e:{integerValue:0}:null}class Rl extends $u{}class Ml extends $u{constructor(e){super(),this.elements=e}}function W_(t,e){const s=G_(e);for(const n of t.elements)s.some(r=>Dn(r,n))||s.push(n);return{arrayValue:{values:s}}}class Ol extends $u{constructor(e){super(),this.elements=e}}function K_(t,e){let s=G_(e);for(const n of t.elements)s=s.filter(r=>!Dn(r,n));return{arrayValue:{values:s}}}class Ll extends $u{constructor(e,s){super(),this.serializer=e,this.Ae=s}}function dy(t){return It(t.integerValue||t.doubleValue)}function G_(t){return Up(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q_{constructor(e,s){this.field=e,this.transform=s}}function sT(t,e){return t.field.isEqual(e.field)&&function(n,r){return n instanceof Ml&&r instanceof Ml||n instanceof Ol&&r instanceof Ol?Qa(n.elements,r.elements,Dn):n instanceof Ll&&r instanceof Ll?Dn(n.Ae,r.Ae):n instanceof Rl&&r instanceof Rl}(t.transform,e.transform)}class nT{constructor(e,s){this.version=e,this.transformResults=s}}class Zs{constructor(e,s){this.updateTime=e,this.exists=s}static none(){return new Zs}static exists(e){return new Zs(void 0,e)}static updateTime(e){return new Zs(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function cd(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Fu{}function J_(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new qp(t.key,Zs.none()):new Ql(t.key,t.data,Zs.none());{const s=t.data,n=Ns.empty();let r=new Vt(Gt.comparator);for(let a of e.fields)if(!r.has(a)){let o=s.field(a);o===null&&a.length>1&&(a=a.popLast(),o=s.field(a)),o===null?n.delete(a):n.set(a,o),r=r.add(a)}return new oi(t.key,n,new Fs(r.toArray()),Zs.none())}}function rT(t,e,s){t instanceof Ql?function(r,a,o){const l=r.value.clone(),c=hy(r.fieldTransforms,a,o.transformResults);l.setAll(c),a.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,s):t instanceof oi?function(r,a,o){if(!cd(r.precondition,a))return void a.convertToUnknownDocument(o.version);const l=hy(r.fieldTransforms,a,o.transformResults),c=a.data;c.setAll(Y_(r)),c.setAll(l),a.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(t,e,s):function(r,a,o){a.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,s)}function ol(t,e,s,n){return t instanceof Ql?function(a,o,l,c){if(!cd(a.precondition,o))return l;const u=a.value.clone(),h=my(a.fieldTransforms,c,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(t,e,s,n):t instanceof oi?function(a,o,l,c){if(!cd(a.precondition,o))return l;const u=my(a.fieldTransforms,c,o),h=o.data;return h.setAll(Y_(a)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),l===null?null:l.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(m=>m.field))}(t,e,s,n):function(a,o,l){return cd(a.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(t,e,s)}function iT(t,e){let s=null;for(const n of t.fieldTransforms){const r=e.data.field(n.field),a=q_(n.transform,r||null);a!=null&&(s===null&&(s=Ns.empty()),s.set(n.field,a))}return s||null}function uy(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&Qa(n,r,(a,o)=>sT(a,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Ql extends Fu{constructor(e,s,n,r=[]){super(),this.key=e,this.value=s,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class oi extends Fu{constructor(e,s,n,r,a=[]){super(),this.key=e,this.data=s,this.fieldMask=n,this.precondition=r,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function Y_(t){const e=new Map;return t.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const n=t.data.field(s);e.set(s,n)}}),e}function hy(t,e,s){const n=new Map;Je(t.length===s.length,32656,{Re:s.length,Ve:t.length});for(let r=0;r<s.length;r++){const a=t[r],o=a.transform,l=e.data.field(a.field);n.set(a.field,tT(o,l,s[r]))}return n}function my(t,e,s){const n=new Map;for(const r of t){const a=r.transform,o=s.data.field(r.field);n.set(r.field,eT(a,o,e))}return n}class qp extends Fu{constructor(e,s){super(),this.key=e,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class aT extends Fu{constructor(e,s){super(),this.key=e,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oT{constructor(e,s,n,r){this.batchId=e,this.localWriteTime=s,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,s){const n=s.mutationResults;for(let r=0;r<this.mutations.length;r++){const a=this.mutations[r];a.key.isEqual(e.key)&&rT(a,e,n[r])}}applyToLocalView(e,s){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(s=ol(n,e,s,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(s=ol(n,e,s,this.localWriteTime));return s}applyToLocalDocumentSet(e,s){const n=B_();return this.mutations.forEach(r=>{const a=e.get(r.key),o=a.overlayedDocument;let l=this.applyToLocalView(o,a.mutatedFields);l=s.has(r.key)?null:l;const c=J_(o,l);c!==null&&n.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(Ae.min())}),n}keys(){return this.mutations.reduce((e,s)=>e.add(s.key),Be())}isEqual(e){return this.batchId===e.batchId&&Qa(this.mutations,e.mutations,(s,n)=>uy(s,n))&&Qa(this.baseMutations,e.baseMutations,(s,n)=>uy(s,n))}}class Wp{constructor(e,s,n,r){this.batch=e,this.commitVersion=s,this.mutationResults=n,this.docVersions=r}static from(e,s,n){Je(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=function(){return JE}();const a=e.mutations;for(let o=0;o<a.length;o++)r=r.insert(a[o].key,n[o].version);return new Wp(e,s,n,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lT{constructor(e,s){this.largestBatchId=e,this.mutation=s}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cT{constructor(e,s){this.count=e,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Et,qe;function dT(t){switch(t){case X.OK:return Se(64938);case X.CANCELLED:case X.UNKNOWN:case X.DEADLINE_EXCEEDED:case X.RESOURCE_EXHAUSTED:case X.INTERNAL:case X.UNAVAILABLE:case X.UNAUTHENTICATED:return!1;case X.INVALID_ARGUMENT:case X.NOT_FOUND:case X.ALREADY_EXISTS:case X.PERMISSION_DENIED:case X.FAILED_PRECONDITION:case X.ABORTED:case X.OUT_OF_RANGE:case X.UNIMPLEMENTED:case X.DATA_LOSS:return!0;default:return Se(15467,{code:t})}}function X_(t){if(t===void 0)return or("GRPC error has no .code"),X.UNKNOWN;switch(t){case Et.OK:return X.OK;case Et.CANCELLED:return X.CANCELLED;case Et.UNKNOWN:return X.UNKNOWN;case Et.DEADLINE_EXCEEDED:return X.DEADLINE_EXCEEDED;case Et.RESOURCE_EXHAUSTED:return X.RESOURCE_EXHAUSTED;case Et.INTERNAL:return X.INTERNAL;case Et.UNAVAILABLE:return X.UNAVAILABLE;case Et.UNAUTHENTICATED:return X.UNAUTHENTICATED;case Et.INVALID_ARGUMENT:return X.INVALID_ARGUMENT;case Et.NOT_FOUND:return X.NOT_FOUND;case Et.ALREADY_EXISTS:return X.ALREADY_EXISTS;case Et.PERMISSION_DENIED:return X.PERMISSION_DENIED;case Et.FAILED_PRECONDITION:return X.FAILED_PRECONDITION;case Et.ABORTED:return X.ABORTED;case Et.OUT_OF_RANGE:return X.OUT_OF_RANGE;case Et.UNIMPLEMENTED:return X.UNIMPLEMENTED;case Et.DATA_LOSS:return X.DATA_LOSS;default:return Se(39323,{code:t})}}(qe=Et||(Et={}))[qe.OK=0]="OK",qe[qe.CANCELLED=1]="CANCELLED",qe[qe.UNKNOWN=2]="UNKNOWN",qe[qe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",qe[qe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",qe[qe.NOT_FOUND=5]="NOT_FOUND",qe[qe.ALREADY_EXISTS=6]="ALREADY_EXISTS",qe[qe.PERMISSION_DENIED=7]="PERMISSION_DENIED",qe[qe.UNAUTHENTICATED=16]="UNAUTHENTICATED",qe[qe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",qe[qe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",qe[qe.ABORTED=10]="ABORTED",qe[qe.OUT_OF_RANGE=11]="OUT_OF_RANGE",qe[qe.UNIMPLEMENTED=12]="UNIMPLEMENTED",qe[qe.INTERNAL=13]="INTERNAL",qe[qe.UNAVAILABLE=14]="UNAVAILABLE",qe[qe.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uT(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hT=new Wr([4294967295,4294967295],0);function fy(t){const e=uT().encode(t),s=new u_;return s.update(e),new Uint8Array(s.digest())}function py(t){const e=new DataView(t.buffer),s=e.getUint32(0,!0),n=e.getUint32(4,!0),r=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new Wr([s,n],0),new Wr([r,a],0)]}class Kp{constructor(e,s,n){if(this.bitmap=e,this.padding=s,this.hashCount=n,s<0||s>=8)throw new Ho(`Invalid padding: ${s}`);if(n<0)throw new Ho(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Ho(`Invalid hash count: ${n}`);if(e.length===0&&s!==0)throw new Ho(`Invalid padding when bitmap length is 0: ${s}`);this.ge=8*e.length-s,this.pe=Wr.fromNumber(this.ge)}ye(e,s,n){let r=e.add(s.multiply(Wr.fromNumber(n)));return r.compare(hT)===1&&(r=new Wr([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const s=fy(e),[n,r]=py(s);for(let a=0;a<this.hashCount;a++){const o=this.ye(n,r,a);if(!this.we(o))return!1}return!0}static create(e,s,n){const r=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),o=new Kp(a,r,s);return n.forEach(l=>o.insert(l)),o}insert(e){if(this.ge===0)return;const s=fy(e),[n,r]=py(s);for(let a=0;a<this.hashCount;a++){const o=this.ye(n,r,a);this.Se(o)}}Se(e){const s=Math.floor(e/8),n=e%8;this.bitmap[s]|=1<<n}}class Ho extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du{constructor(e,s,n,r,a){this.snapshotVersion=e,this.targetChanges=s,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,s,n){const r=new Map;return r.set(e,Jl.createSynthesizedTargetChangeForCurrentChange(e,s,n)),new Du(Ae.min(),r,new xt(Ue),lr(),Be())}}class Jl{constructor(e,s,n,r,a){this.resumeToken=e,this.current=s,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,s,n){return new Jl(n,s,Be(),Be(),Be())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(e,s,n,r){this.be=e,this.removedTargetIds=s,this.key=n,this.De=r}}class Z_{constructor(e,s){this.targetId=e,this.Ce=s}}class eN{constructor(e,s,n=Yt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=s,this.resumeToken=n,this.cause=r}}class gy{constructor(){this.ve=0,this.Fe=xy(),this.Me=Yt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Be(),s=Be(),n=Be();return this.Fe.forEach((r,a)=>{switch(a){case 0:e=e.add(r);break;case 2:s=s.add(r);break;case 1:n=n.add(r);break;default:Se(38017,{changeType:a})}}),new Jl(this.Me,this.xe,e,s,n)}qe(){this.Oe=!1,this.Fe=xy()}Qe(e,s){this.Oe=!0,this.Fe=this.Fe.insert(e,s)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Je(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class mT{constructor(e){this.Ge=e,this.ze=new Map,this.je=lr(),this.Je=$c(),this.He=$c(),this.Ye=new xt(Ue)}Ze(e){for(const s of e.be)e.De&&e.De.isFoundDocument()?this.Xe(s,e.De):this.et(s,e.key,e.De);for(const s of e.removedTargetIds)this.et(s,e.key,e.De)}tt(e){this.forEachTarget(e,s=>{const n=this.nt(s);switch(e.state){case 0:this.rt(s)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(s);break;case 3:this.rt(s)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(s)&&(this.it(s),n.Le(e.resumeToken));break;default:Se(56790,{state:e.state})}})}forEachTarget(e,s){e.targetIds.length>0?e.targetIds.forEach(s):this.ze.forEach((n,r)=>{this.rt(r)&&s(r)})}st(e){const s=e.targetId,n=e.Ce.count,r=this.ot(s);if(r){const a=r.target;if(gf(a))if(n===0){const o=new be(a.path);this.et(s,o,is.newNoDocument(o,Ae.min()))}else Je(n===1,20013,{expectedCount:n});else{const o=this._t(s);if(o!==n){const l=this.ut(e),c=l?this.ct(l,e,o):1;if(c!==0){this.it(s);const u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(s,u)}}}}}ut(e){const s=e.Ce.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:a=0}=s;let o,l;try{o=Xr(n).toUint8Array()}catch(c){if(c instanceof N_)return Ga("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new Kp(o,r,a)}catch(c){return Ga(c instanceof Ho?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,s,n){return s.Ce.count===n-this.Pt(e,s.targetId)?0:2}Pt(e,s){const n=this.Ge.getRemoteKeysForTarget(s);let r=0;return n.forEach(a=>{const o=this.Ge.ht(),l=`projects/${o.projectId}/databases/${o.database}/documents/${a.path.canonicalString()}`;e.mightContain(l)||(this.et(s,a,null),r++)}),r}Tt(e){const s=new Map;this.ze.forEach((a,o)=>{const l=this.ot(o);if(l){if(a.current&&gf(l.target)){const c=new be(l.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,is.newNoDocument(c,e))}a.Be&&(s.set(o,a.ke()),a.qe())}});let n=Be();this.He.forEach((a,o)=>{let l=!0;o.forEachWhile(c=>{const u=this.ot(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(n=n.add(a))}),this.je.forEach((a,o)=>o.setReadTime(e));const r=new Du(e,s,this.Ye,this.je,n);return this.je=lr(),this.Je=$c(),this.He=$c(),this.Ye=new xt(Ue),r}Xe(e,s){if(!this.rt(e))return;const n=this.Et(e,s.key)?2:0;this.nt(e).Qe(s.key,n),this.je=this.je.insert(s.key,s),this.Je=this.Je.insert(s.key,this.It(s.key).add(e)),this.He=this.He.insert(s.key,this.dt(s.key).add(e))}et(e,s,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,s)?r.Qe(s,1):r.$e(s),this.He=this.He.insert(s,this.dt(s).delete(e)),this.He=this.He.insert(s,this.dt(s).add(e)),n&&(this.je=this.je.insert(s,n))}removeTarget(e){this.ze.delete(e)}_t(e){const s=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+s.addedDocuments.size-s.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let s=this.ze.get(e);return s||(s=new gy,this.ze.set(e,s)),s}dt(e){let s=this.He.get(e);return s||(s=new Vt(Ue),this.He=this.He.insert(e,s)),s}It(e){let s=this.Je.get(e);return s||(s=new Vt(Ue),this.Je=this.Je.insert(e,s)),s}rt(e){const s=this.ot(e)!==null;return s||ue("WatchChangeAggregator","Detected inactive target",e),s}ot(e){const s=this.ze.get(e);return s&&s.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new gy),this.Ge.getRemoteKeysForTarget(e).forEach(s=>{this.et(e,s,null)})}Et(e,s){return this.Ge.getRemoteKeysForTarget(e).has(s)}}function $c(){return new xt(be.comparator)}function xy(){return new xt(be.comparator)}const fT={asc:"ASCENDING",desc:"DESCENDING"},pT={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gT={and:"AND",or:"OR"};class xT{constructor(e,s){this.databaseId=e,this.useProto3Json=s}}function yf(t,e){return t.useProto3Json||Ru(e)?e:{value:e}}function Qd(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function tN(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function yT(t,e){return Qd(t,e.toTimestamp())}function On(t){return Je(!!t,49232),Ae.fromTimestamp(function(s){const n=Yr(s);return new it(n.seconds,n.nanos)}(t))}function Gp(t,e){return vf(t,e).canonicalString()}function vf(t,e){const s=function(r){return new rt(["projects",r.projectId,"databases",r.database])}(t).child("documents");return e===void 0?s:s.child(e)}function sN(t){const e=rt.fromString(t);return Je(oN(e),10190,{key:e.toString()}),e}function bf(t,e){return Gp(t.databaseId,e.path)}function Kh(t,e){const s=sN(e);if(s.get(1)!==t.databaseId.projectId)throw new oe(X.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+t.databaseId.projectId);if(s.get(3)!==t.databaseId.database)throw new oe(X.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+t.databaseId.database);return new be(rN(s))}function nN(t,e){return Gp(t.databaseId,e)}function vT(t){const e=sN(t);return e.length===4?rt.emptyPath():rN(e)}function wf(t){return new rt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function rN(t){return Je(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function yy(t,e,s){return{name:bf(t,e),fields:s.value.mapValue.fields}}function bT(t,e){let s;if("targetChange"in e){e.targetChange;const n=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:Se(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],a=function(u,h){return u.useProto3Json?(Je(h===void 0||typeof h=="string",58123),Yt.fromBase64String(h||"")):(Je(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Yt.fromUint8Array(h||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(u){const h=u.code===void 0?X.UNKNOWN:X_(u.code);return new oe(h,u.message||"")}(o);s=new eN(n,r,a,l||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const r=Kh(t,n.document.name),a=On(n.document.updateTime),o=n.document.createTime?On(n.document.createTime):Ae.min(),l=new Ns({mapValue:{fields:n.document.fields}}),c=is.newFoundDocument(r,a,o,l),u=n.targetIds||[],h=n.removedTargetIds||[];s=new dd(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const r=Kh(t,n.document),a=n.readTime?On(n.readTime):Ae.min(),o=is.newNoDocument(r,a),l=n.removedTargetIds||[];s=new dd([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const r=Kh(t,n.document),a=n.removedTargetIds||[];s=new dd([],a,r,null)}else{if(!("filter"in e))return Se(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:r=0,unchangedNames:a}=n,o=new cT(r,a),l=n.targetId;s=new Z_(l,o)}}return s}function wT(t,e){let s;if(e instanceof Ql)s={update:yy(t,e.key,e.value)};else if(e instanceof qp)s={delete:bf(t,e.key)};else if(e instanceof oi)s={update:yy(t,e.key,e.data),updateMask:AT(e.fieldMask)};else{if(!(e instanceof aT))return Se(16599,{Vt:e.type});s={verify:bf(t,e.key)}}return e.fieldTransforms.length>0&&(s.updateTransforms=e.fieldTransforms.map(n=>function(a,o){const l=o.transform;if(l instanceof Rl)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Ml)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Ol)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ll)return{fieldPath:o.field.canonicalString(),increment:l.Ae};throw Se(20930,{transform:o.transform})}(0,n))),e.precondition.isNone||(s.currentDocument=function(r,a){return a.updateTime!==void 0?{updateTime:yT(r,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:Se(27497)}(t,e.precondition)),s}function _T(t,e){return t&&t.length>0?(Je(e!==void 0,14353),t.map(s=>function(r,a){let o=r.updateTime?On(r.updateTime):On(a);return o.isEqual(Ae.min())&&(o=On(a)),new nT(o,r.transformResults||[])}(s,e))):[]}function NT(t,e){return{documents:[nN(t,e.path)]}}function jT(t,e){const s={structuredQuery:{}},n=e.path;let r;e.collectionGroup!==null?(r=n,s.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=n.popLast(),s.structuredQuery.from=[{collectionId:n.lastSegment()}]),s.parent=nN(t,r);const a=function(u){if(u.length!==0)return aN(yn.create(u,"and"))}(e.filters);a&&(s.structuredQuery.where=a);const o=function(u){if(u.length!==0)return u.map(h=>function(f){return{field:fa(f.field),direction:kT(f.dir)}}(h))}(e.orderBy);o&&(s.structuredQuery.orderBy=o);const l=yf(t,e.limit);return l!==null&&(s.structuredQuery.limit=l),e.startAt&&(s.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(s.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:s,parent:r}}function IT(t){let e=vT(t.parent);const s=t.structuredQuery,n=s.from?s.from.length:0;let r=null;if(n>0){Je(n===1,65062);const h=s.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let a=[];s.where&&(a=function(m){const f=iN(m);return f instanceof yn&&R_(f)?f.getFilters():[f]}(s.where));let o=[];s.orderBy&&(o=function(m){return m.map(f=>function(_){return new Pl(pa(_.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction))}(f))}(s.orderBy));let l=null;s.limit&&(l=function(m){let f;return f=typeof m=="object"?m.value:m,Ru(f)?null:f}(s.limit));let c=null;s.startAt&&(c=function(m){const f=!!m.before,y=m.values||[];return new Kd(y,f)}(s.startAt));let u=null;return s.endAt&&(u=function(m){const f=!m.before,y=m.values||[];return new Kd(y,f)}(s.endAt)),qE(e,r,o,a,l,"F",c,u)}function ST(t,e){const s=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Se(28987,{purpose:r})}}(e.purpose);return s==null?null:{"goog-listen-tags":s}}function iN(t){return t.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const n=pa(s.unaryFilter.field);return At.create(n,"==",{doubleValue:NaN});case"IS_NULL":const r=pa(s.unaryFilter.field);return At.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=pa(s.unaryFilter.field);return At.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=pa(s.unaryFilter.field);return At.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Se(61313);default:return Se(60726)}}(t):t.fieldFilter!==void 0?function(s){return At.create(pa(s.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Se(58110);default:return Se(50506)}}(s.fieldFilter.op),s.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(s){return yn.create(s.compositeFilter.filters.map(n=>iN(n)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Se(1026)}}(s.compositeFilter.op))}(t):Se(30097,{filter:t})}function kT(t){return fT[t]}function ET(t){return pT[t]}function TT(t){return gT[t]}function fa(t){return{fieldPath:t.canonicalString()}}function pa(t){return Gt.fromServerFormat(t.fieldPath)}function aN(t){return t instanceof At?function(s){if(s.op==="=="){if(iy(s.value))return{unaryFilter:{field:fa(s.field),op:"IS_NAN"}};if(ry(s.value))return{unaryFilter:{field:fa(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(iy(s.value))return{unaryFilter:{field:fa(s.field),op:"IS_NOT_NAN"}};if(ry(s.value))return{unaryFilter:{field:fa(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fa(s.field),op:ET(s.op),value:s.value}}}(t):t instanceof yn?function(s){const n=s.getFilters().map(r=>aN(r));return n.length===1?n[0]:{compositeFilter:{op:TT(s.op),filters:n}}}(t):Se(54877,{filter:t})}function AT(t){const e=[];return t.fields.forEach(s=>e.push(s.canonicalString())),{fieldPaths:e}}function oN(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lr{constructor(e,s,n,r,a=Ae.min(),o=Ae.min(),l=Yt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=s,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new Lr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,s){return new Lr(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Lr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Lr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CT{constructor(e){this.yt=e}}function PT(t){const e=IT({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Gd(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RT{constructor(){this.Cn=new MT}addToCollectionParentIndex(e,s){return this.Cn.add(s),ee.resolve()}getCollectionParents(e,s){return ee.resolve(this.Cn.getEntries(s))}addFieldIndex(e,s){return ee.resolve()}deleteFieldIndex(e,s){return ee.resolve()}deleteAllFieldIndexes(e){return ee.resolve()}createTargetIndexes(e,s){return ee.resolve()}getDocumentsMatchingTarget(e,s){return ee.resolve(null)}getIndexType(e,s){return ee.resolve(0)}getFieldIndexes(e,s){return ee.resolve([])}getNextCollectionGroupToUpdate(e){return ee.resolve(null)}getMinOffset(e,s){return ee.resolve(Jr.min())}getMinOffsetFromCollectionGroup(e,s){return ee.resolve(Jr.min())}updateCollectionGroup(e,s,n){return ee.resolve()}updateIndexEntries(e,s){return ee.resolve()}}class MT{constructor(){this.index={}}add(e){const s=e.lastSegment(),n=e.popLast(),r=this.index[s]||new Vt(rt.comparator),a=!r.has(n);return this.index[s]=r.add(n),a}has(e){const s=e.lastSegment(),n=e.popLast(),r=this.index[s];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Vt(rt.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},lN=41943040;class ws{static withCacheSize(e){return new ws(e,ws.DEFAULT_COLLECTION_PERCENTILE,ws.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,s,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=s,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ws.DEFAULT_COLLECTION_PERCENTILE=10,ws.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ws.DEFAULT=new ws(lN,ws.DEFAULT_COLLECTION_PERCENTILE,ws.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ws.DISABLED=new ws(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Xa(0)}static cr(){return new Xa(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const by="LruGarbageCollector",OT=1048576;function wy([t,e],[s,n]){const r=Ue(t,s);return r===0?Ue(e,n):r}class LT{constructor(e){this.Ir=e,this.buffer=new Vt(wy),this.Er=0}dr(){return++this.Er}Ar(e){const s=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(s);else{const n=this.buffer.last();wy(s,n)<0&&(this.buffer=this.buffer.delete(n).add(s))}}get maxValue(){return this.buffer.last()[0]}}class VT{constructor(e,s,n){this.garbageCollector=e,this.asyncQueue=s,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){ue(by,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(s){ao(s)?ue(by,"Ignoring IndexedDB error during garbage collection: ",s):await io(s)}await this.Vr(3e5)})}}class $T{constructor(e,s){this.mr=e,this.params=s}calculateTargetCount(e,s){return this.mr.gr(e).next(n=>Math.floor(s/100*n))}nthSequenceNumber(e,s){if(s===0)return ee.resolve(Pu.ce);const n=new LT(s);return this.mr.forEachTarget(e,r=>n.Ar(r.sequenceNumber)).next(()=>this.mr.pr(e,r=>n.Ar(r))).next(()=>n.maxValue)}removeTargets(e,s,n){return this.mr.removeTargets(e,s,n)}removeOrphanedDocuments(e,s){return this.mr.removeOrphanedDocuments(e,s)}collect(e,s){return this.params.cacheSizeCollectionThreshold===-1?(ue("LruGarbageCollector","Garbage collection skipped; disabled"),ee.resolve(vy)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(ue("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vy):this.yr(e,s))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,s){let n,r,a,o,l,c,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(ue("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),r=this.params.maximumSequenceNumbersToCollect):r=m,o=Date.now(),this.nthSequenceNumber(e,r))).next(m=>(n=m,l=Date.now(),this.removeTargets(e,n,s))).next(m=>(a=m,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(m=>(u=Date.now(),ha()<=De.DEBUG&&ue("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${r} in `+(l-o)+`ms
	Removed ${a} targets in `+(c-l)+`ms
	Removed ${m} documents in `+(u-c)+`ms
Total Duration: ${u-h}ms`),ee.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:a,documentsRemoved:m})))}}function FT(t,e){return new $T(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DT{constructor(){this.changes=new Yi(e=>e.toString(),(e,s)=>e.isEqual(s)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,s){this.assertNotApplied(),this.changes.set(e,is.newInvalidDocument(e).setReadTime(s))}getEntry(e,s){this.assertNotApplied();const n=this.changes.get(s);return n!==void 0?ee.resolve(n):this.getFromCache(e,s)}getEntries(e,s){return this.getAllFromCache(e,s)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UT{constructor(e,s){this.overlayedDocument=e,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BT{constructor(e,s,n,r){this.remoteDocumentCache=e,this.mutationQueue=s,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,s){let n=null;return this.documentOverlayCache.getOverlay(e,s).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,s))).next(r=>(n!==null&&ol(n.mutation,r,Fs.empty(),it.now()),r))}getDocuments(e,s){return this.remoteDocumentCache.getEntries(e,s).next(n=>this.getLocalViewOfDocuments(e,n,Be()).next(()=>n))}getLocalViewOfDocuments(e,s,n=Be()){const r=Ni();return this.populateOverlays(e,r,s).next(()=>this.computeViews(e,s,r,n).next(a=>{let o=zo();return a.forEach((l,c)=>{o=o.insert(l,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,s){const n=Ni();return this.populateOverlays(e,n,s).next(()=>this.computeViews(e,s,n,Be()))}populateOverlays(e,s,n){const r=[];return n.forEach(a=>{s.has(a)||r.push(a)}),this.documentOverlayCache.getOverlays(e,r).next(a=>{a.forEach((o,l)=>{s.set(o,l)})})}computeViews(e,s,n,r){let a=lr();const o=al(),l=function(){return al()}();return s.forEach((c,u)=>{const h=n.get(u.key);r.has(u.key)&&(h===void 0||h.mutation instanceof oi)?a=a.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),ol(h.mutation,u,h.mutation.getFieldMask(),it.now())):o.set(u.key,Fs.empty())}),this.recalculateAndSaveOverlays(e,a).next(c=>(c.forEach((u,h)=>o.set(u,h)),s.forEach((u,h)=>l.set(u,new UT(h,o.get(u)??null))),l))}recalculateAndSaveOverlays(e,s){const n=al();let r=new xt((o,l)=>o-l),a=Be();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,s).next(o=>{for(const l of o)l.keys().forEach(c=>{const u=s.get(c);if(u===null)return;let h=n.get(c)||Fs.empty();h=l.applyToLocalView(u,h),n.set(c,h);const m=(r.get(l.batchId)||Be()).add(c);r=r.insert(l.batchId,m)})}).next(()=>{const o=[],l=r.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),u=c.key,h=c.value,m=B_();h.forEach(f=>{if(!a.has(f)){const y=J_(s.get(f),n.get(f));y!==null&&m.set(f,y),a=a.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,m))}return ee.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,s){return this.remoteDocumentCache.getEntries(e,s).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,s,n,r){return function(o){return be.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(e,s.path):V_(s)?this.getDocumentsMatchingCollectionGroupQuery(e,s,n,r):this.getDocumentsMatchingCollectionQuery(e,s,n,r)}getNextDocuments(e,s,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,s,n,r).next(a=>{const o=r-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,s,n.largestBatchId,r-a.size):ee.resolve(Ni());let l=El,c=a;return o.next(u=>ee.forEach(u,(h,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),a.get(h)?ee.resolve():this.remoteDocumentCache.getEntry(e,h).next(f=>{c=c.insert(h,f)}))).next(()=>this.populateOverlays(e,u,a)).next(()=>this.computeViews(e,c,u,Be())).next(h=>({batchId:l,changes:U_(h)})))})}getDocumentsMatchingDocumentQuery(e,s){return this.getDocument(e,new be(s)).next(n=>{let r=zo();return n.isFoundDocument()&&(r=r.insert(n.key,n)),r})}getDocumentsMatchingCollectionGroupQuery(e,s,n,r){const a=s.collectionGroup;let o=zo();return this.indexManager.getCollectionParents(e,a).next(l=>ee.forEach(l,c=>{const u=function(m,f){return new oo(f,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(s,c.child(a));return this.getDocumentsMatchingCollectionQuery(e,u,n,r).next(h=>{h.forEach((m,f)=>{o=o.insert(m,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,s,n,r){let a;return this.documentOverlayCache.getOverlaysForCollection(e,s.path,n.largestBatchId).next(o=>(a=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,s,n,a,r))).next(o=>{a.forEach((c,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,is.newInvalidDocument(h)))});let l=zo();return o.forEach((c,u)=>{const h=a.get(c);h!==void 0&&ol(h.mutation,u,Fs.empty(),it.now()),Vu(s,u)&&(l=l.insert(c,u))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zT{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,s){return ee.resolve(this.Lr.get(s))}saveBundleMetadata(e,s){return this.Lr.set(s.id,function(r){return{id:r.id,version:r.version,createTime:On(r.createTime)}}(s)),ee.resolve()}getNamedQuery(e,s){return ee.resolve(this.kr.get(s))}saveNamedQuery(e,s){return this.kr.set(s.name,function(r){return{name:r.name,query:PT(r.bundledQuery),readTime:On(r.readTime)}}(s)),ee.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HT{constructor(){this.overlays=new xt(be.comparator),this.qr=new Map}getOverlay(e,s){return ee.resolve(this.overlays.get(s))}getOverlays(e,s){const n=Ni();return ee.forEach(s,r=>this.getOverlay(e,r).next(a=>{a!==null&&n.set(r,a)})).next(()=>n)}saveOverlays(e,s,n){return n.forEach((r,a)=>{this.St(e,s,a)}),ee.resolve()}removeOverlaysForBatchId(e,s,n){const r=this.qr.get(n);return r!==void 0&&(r.forEach(a=>this.overlays=this.overlays.remove(a)),this.qr.delete(n)),ee.resolve()}getOverlaysForCollection(e,s,n){const r=Ni(),a=s.length+1,o=new be(s.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,u=c.getKey();if(!s.isPrefixOf(u.path))break;u.path.length===a&&c.largestBatchId>n&&r.set(c.getKey(),c)}return ee.resolve(r)}getOverlaysForCollectionGroup(e,s,n,r){let a=new xt((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===s&&u.largestBatchId>n){let h=a.get(u.largestBatchId);h===null&&(h=Ni(),a=a.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const l=Ni(),c=a.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,h)=>l.set(u,h)),!(l.size()>=r)););return ee.resolve(l)}St(e,s,n){const r=this.overlays.get(n.key);if(r!==null){const o=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new lT(s,n));let a=this.qr.get(s);a===void 0&&(a=Be(),this.qr.set(s,a)),this.qr.set(s,a.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qT{constructor(){this.sessionToken=Yt.EMPTY_BYTE_STRING}getSessionToken(e){return ee.resolve(this.sessionToken)}setSessionToken(e,s){return this.sessionToken=s,ee.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{constructor(){this.Qr=new Vt(Ut.$r),this.Ur=new Vt(Ut.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,s){const n=new Ut(e,s);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,s){e.forEach(n=>this.addReference(n,s))}removeReference(e,s){this.Gr(new Ut(e,s))}zr(e,s){e.forEach(n=>this.removeReference(n,s))}jr(e){const s=new be(new rt([])),n=new Ut(s,e),r=new Ut(s,e+1),a=[];return this.Ur.forEachInRange([n,r],o=>{this.Gr(o),a.push(o.key)}),a}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const s=new be(new rt([])),n=new Ut(s,e),r=new Ut(s,e+1);let a=Be();return this.Ur.forEachInRange([n,r],o=>{a=a.add(o.key)}),a}containsKey(e){const s=new Ut(e,0),n=this.Qr.firstAfterOrEqual(s);return n!==null&&e.isEqual(n.key)}}class Ut{constructor(e,s){this.key=e,this.Yr=s}static $r(e,s){return be.comparator(e.key,s.key)||Ue(e.Yr,s.Yr)}static Kr(e,s){return Ue(e.Yr,s.Yr)||be.comparator(e.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WT{constructor(e,s){this.indexManager=e,this.referenceDelegate=s,this.mutationQueue=[],this.tr=1,this.Zr=new Vt(Ut.$r)}checkEmpty(e){return ee.resolve(this.mutationQueue.length===0)}addMutationBatch(e,s,n,r){const a=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new oT(a,s,n,r);this.mutationQueue.push(o);for(const l of r)this.Zr=this.Zr.add(new Ut(l.key,a)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return ee.resolve(o)}lookupMutationBatch(e,s){return ee.resolve(this.Xr(s))}getNextMutationBatchAfterBatchId(e,s){const n=s+1,r=this.ei(n),a=r<0?0:r;return ee.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return ee.resolve(this.mutationQueue.length===0?Fp:this.tr-1)}getAllMutationBatches(e){return ee.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,s){const n=new Ut(s,0),r=new Ut(s,Number.POSITIVE_INFINITY),a=[];return this.Zr.forEachInRange([n,r],o=>{const l=this.Xr(o.Yr);a.push(l)}),ee.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,s){let n=new Vt(Ue);return s.forEach(r=>{const a=new Ut(r,0),o=new Ut(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([a,o],l=>{n=n.add(l.Yr)})}),ee.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,s){const n=s.path,r=n.length+1;let a=n;be.isDocumentKey(a)||(a=a.child(""));const o=new Ut(new be(a),0);let l=new Vt(Ue);return this.Zr.forEachWhile(c=>{const u=c.key.path;return!!n.isPrefixOf(u)&&(u.length===r&&(l=l.add(c.Yr)),!0)},o),ee.resolve(this.ti(l))}ti(e){const s=[];return e.forEach(n=>{const r=this.Xr(n);r!==null&&s.push(r)}),s}removeMutationBatch(e,s){Je(this.ni(s.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return ee.forEach(s.mutations,r=>{const a=new Ut(r.key,s.batchId);return n=n.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,s){const n=new Ut(s,0),r=this.Zr.firstAfterOrEqual(n);return ee.resolve(s.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ee.resolve()}ni(e,s){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const s=this.ei(e);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KT{constructor(e){this.ri=e,this.docs=function(){return new xt(be.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,s){const n=s.key,r=this.docs.get(n),a=r?r.size:0,o=this.ri(s);return this.docs=this.docs.insert(n,{document:s.mutableCopy(),size:o}),this.size+=o-a,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const s=this.docs.get(e);s&&(this.docs=this.docs.remove(e),this.size-=s.size)}getEntry(e,s){const n=this.docs.get(s);return ee.resolve(n?n.document.mutableCopy():is.newInvalidDocument(s))}getEntries(e,s){let n=lr();return s.forEach(r=>{const a=this.docs.get(r);n=n.insert(r,a?a.document.mutableCopy():is.newInvalidDocument(r))}),ee.resolve(n)}getDocumentsMatchingQuery(e,s,n,r){let a=lr();const o=s.path,l=new be(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:u,value:{document:h}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||NE(_E(h),n)<=0||(r.has(h.key)||Vu(s,h))&&(a=a.insert(h.key,h.mutableCopy()))}return ee.resolve(a)}getAllFromCollectionGroup(e,s,n,r){Se(9500)}ii(e,s){return ee.forEach(this.docs,n=>s(n))}newChangeBuffer(e){return new GT(this)}getSize(e){return ee.resolve(this.size)}}class GT extends DT{constructor(e){super(),this.Nr=e}applyChanges(e){const s=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?s.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),ee.waitFor(s)}getFromCache(e,s){return this.Nr.getEntry(e,s)}getAllFromCache(e,s){return this.Nr.getEntries(e,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QT{constructor(e){this.persistence=e,this.si=new Yi(s=>Bp(s),zp),this.lastRemoteSnapshotVersion=Ae.min(),this.highestTargetId=0,this.oi=0,this._i=new Qp,this.targetCount=0,this.ai=Xa.ur()}forEachTarget(e,s){return this.si.forEach((n,r)=>s(r)),ee.resolve()}getLastRemoteSnapshotVersion(e){return ee.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ee.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ee.resolve(this.highestTargetId)}setTargetsMetadata(e,s,n){return n&&(this.lastRemoteSnapshotVersion=n),s>this.oi&&(this.oi=s),ee.resolve()}Pr(e){this.si.set(e.target,e);const s=e.targetId;s>this.highestTargetId&&(this.ai=new Xa(s),this.highestTargetId=s),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,s){return this.Pr(s),this.targetCount+=1,ee.resolve()}updateTargetData(e,s){return this.Pr(s),ee.resolve()}removeTargetData(e,s){return this.si.delete(s.target),this._i.jr(s.targetId),this.targetCount-=1,ee.resolve()}removeTargets(e,s,n){let r=0;const a=[];return this.si.forEach((o,l)=>{l.sequenceNumber<=s&&n.get(l.targetId)===null&&(this.si.delete(o),a.push(this.removeMatchingKeysForTargetId(e,l.targetId)),r++)}),ee.waitFor(a).next(()=>r)}getTargetCount(e){return ee.resolve(this.targetCount)}getTargetData(e,s){const n=this.si.get(s)||null;return ee.resolve(n)}addMatchingKeys(e,s,n){return this._i.Wr(s,n),ee.resolve()}removeMatchingKeys(e,s,n){this._i.zr(s,n);const r=this.persistence.referenceDelegate,a=[];return r&&s.forEach(o=>{a.push(r.markPotentiallyOrphaned(e,o))}),ee.waitFor(a)}removeMatchingKeysForTargetId(e,s){return this._i.jr(s),ee.resolve()}getMatchingKeysForTargetId(e,s){const n=this._i.Hr(s);return ee.resolve(n)}containsKey(e,s){return ee.resolve(this._i.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cN{constructor(e,s){this.ui={},this.overlays={},this.ci=new Pu(0),this.li=!1,this.li=!0,this.hi=new qT,this.referenceDelegate=e(this),this.Pi=new QT(this),this.indexManager=new RT,this.remoteDocumentCache=function(r){return new KT(r)}(n=>this.referenceDelegate.Ti(n)),this.serializer=new CT(s),this.Ii=new zT(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let s=this.overlays[e.toKey()];return s||(s=new HT,this.overlays[e.toKey()]=s),s}getMutationQueue(e,s){let n=this.ui[e.toKey()];return n||(n=new WT(s,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,s,n){ue("MemoryPersistence","Starting transaction:",e);const r=new JT(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(a=>this.referenceDelegate.di(r).next(()=>a)).toPromise().then(a=>(r.raiseOnCommittedEvent(),a))}Ai(e,s){return ee.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,s)))}}class JT extends IE{constructor(e){super(),this.currentSequenceNumber=e}}class Jp{constructor(e){this.persistence=e,this.Ri=new Qp,this.Vi=null}static mi(e){return new Jp(e)}get fi(){if(this.Vi)return this.Vi;throw Se(60996)}addReference(e,s,n){return this.Ri.addReference(n,s),this.fi.delete(n.toString()),ee.resolve()}removeReference(e,s,n){return this.Ri.removeReference(n,s),this.fi.add(n.toString()),ee.resolve()}markPotentiallyOrphaned(e,s){return this.fi.add(s.toString()),ee.resolve()}removeTarget(e,s){this.Ri.jr(s.targetId).forEach(r=>this.fi.add(r.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,s.targetId).next(r=>{r.forEach(a=>this.fi.add(a.toString()))}).next(()=>n.removeTargetData(e,s))}Ei(){this.Vi=new Set}di(e){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ee.forEach(this.fi,n=>{const r=be.fromPath(n);return this.gi(e,r).next(a=>{a||s.removeEntry(r,Ae.min())})}).next(()=>(this.Vi=null,s.apply(e)))}updateLimboDocument(e,s){return this.gi(e,s).next(n=>{n?this.fi.delete(s.toString()):this.fi.add(s.toString())})}Ti(e){return 0}gi(e,s){return ee.or([()=>ee.resolve(this.Ri.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(e,s),()=>this.persistence.Ai(e,s)])}}class Jd{constructor(e,s){this.persistence=e,this.pi=new Yi(n=>EE(n.path),(n,r)=>n.isEqual(r)),this.garbageCollector=FT(this,s)}static mi(e,s){return new Jd(e,s)}Ei(){}di(e){return ee.resolve()}forEachTarget(e,s){return this.persistence.getTargetCache().forEachTarget(e,s)}gr(e){const s=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>s.next(r=>n+r))}wr(e){let s=0;return this.pr(e,n=>{s++}).next(()=>s)}pr(e,s){return ee.forEach(this.pi,(n,r)=>this.br(e,n,r).next(a=>a?ee.resolve():s(r)))}removeTargets(e,s,n){return this.persistence.getTargetCache().removeTargets(e,s,n)}removeOrphanedDocuments(e,s){let n=0;const r=this.persistence.getRemoteDocumentCache(),a=r.newChangeBuffer();return r.ii(e,o=>this.br(e,o,s).next(l=>{l||(n++,a.removeEntry(o,Ae.min()))})).next(()=>a.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,s){return this.pi.set(s,e.currentSequenceNumber),ee.resolve()}removeTarget(e,s){const n=s.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,s,n){return this.pi.set(n,e.currentSequenceNumber),ee.resolve()}removeReference(e,s,n){return this.pi.set(n,e.currentSequenceNumber),ee.resolve()}updateLimboDocument(e,s){return this.pi.set(s,e.currentSequenceNumber),ee.resolve()}Ti(e){let s=e.key.toString().length;return e.isFoundDocument()&&(s+=od(e.data.value)),s}br(e,s,n){return ee.or([()=>this.persistence.Ai(e,s),()=>this.persistence.getTargetCache().containsKey(e,s),()=>{const r=this.pi.get(s);return ee.resolve(r!==void 0&&r>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yp{constructor(e,s,n,r){this.targetId=e,this.fromCache=s,this.Es=n,this.ds=r}static As(e,s){let n=Be(),r=Be();for(const a of s.docChanges)switch(a.type){case 0:n=n.add(a.doc.key);break;case 1:r=r.add(a.doc.key)}return new Yp(e,s.fromCache,n,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YT{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XT{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return qS()?8:SE(cs())>0?6:4}()}initialize(e,s){this.ps=e,this.indexManager=s,this.Rs=!0}getDocumentsMatchingQuery(e,s,n,r){const a={result:null};return this.ys(e,s).next(o=>{a.result=o}).next(()=>{if(!a.result)return this.ws(e,s,r,n).next(o=>{a.result=o})}).next(()=>{if(a.result)return;const o=new YT;return this.Ss(e,s,o).next(l=>{if(a.result=l,this.Vs)return this.bs(e,s,o,l.size)})}).next(()=>a.result)}bs(e,s,n,r){return n.documentReadCount<this.fs?(ha()<=De.DEBUG&&ue("QueryEngine","SDK will not create cache indexes for query:",ma(s),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ee.resolve()):(ha()<=De.DEBUG&&ue("QueryEngine","Query:",ma(s),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(ha()<=De.DEBUG&&ue("QueryEngine","The SDK decides to create cache indexes for query:",ma(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Mn(s))):ee.resolve())}ys(e,s){if(cy(s))return ee.resolve(null);let n=Mn(s);return this.indexManager.getIndexType(e,n).next(r=>r===0?null:(s.limit!==null&&r===1&&(s=Gd(s,null,"F"),n=Mn(s)),this.indexManager.getDocumentsMatchingTarget(e,n).next(a=>{const o=Be(...a);return this.ps.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,n).next(c=>{const u=this.Ds(s,l);return this.Cs(s,u,o,c.readTime)?this.ys(e,Gd(s,null,"F")):this.vs(e,u,s,c)}))})))}ws(e,s,n,r){return cy(s)||r.isEqual(Ae.min())?ee.resolve(null):this.ps.getDocuments(e,n).next(a=>{const o=this.Ds(s,a);return this.Cs(s,o,n,r)?ee.resolve(null):(ha()<=De.DEBUG&&ue("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ma(s)),this.vs(e,o,s,wE(r,El)).next(l=>l))})}Ds(e,s){let n=new Vt(F_(e));return s.forEach((r,a)=>{Vu(e,a)&&(n=n.add(a))}),n}Cs(e,s,n,r){if(e.limit===null)return!1;if(n.size!==s.size)return!0;const a=e.limitType==="F"?s.last():s.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(r)>0)}Ss(e,s,n){return ha()<=De.DEBUG&&ue("QueryEngine","Using full collection scan to execute query:",ma(s)),this.ps.getDocumentsMatchingQuery(e,s,Jr.min(),n)}vs(e,s,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(a=>(s.forEach(o=>{a=a.insert(o.key,o)}),a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xp="LocalStore",ZT=3e8;class eA{constructor(e,s,n,r){this.persistence=e,this.Fs=s,this.serializer=r,this.Ms=new xt(Ue),this.xs=new Yi(a=>Bp(a),zp),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new BT(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>e.collect(s,this.Ms))}}function tA(t,e,s,n){return new eA(t,e,s,n)}async function dN(t,e){const s=Re(t);return await s.persistence.runTransaction("Handle user change","readonly",n=>{let r;return s.mutationQueue.getAllMutationBatches(n).next(a=>(r=a,s.Bs(e),s.mutationQueue.getAllMutationBatches(n))).next(a=>{const o=[],l=[];let c=Be();for(const u of r){o.push(u.batchId);for(const h of u.mutations)c=c.add(h.key)}for(const u of a){l.push(u.batchId);for(const h of u.mutations)c=c.add(h.key)}return s.localDocuments.getDocuments(n,c).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:l}))})})}function sA(t,e){const s=Re(t);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const r=e.batch.keys(),a=s.Ns.newChangeBuffer({trackRemovals:!0});return function(l,c,u,h){const m=u.batch,f=m.keys();let y=ee.resolve();return f.forEach(_=>{y=y.next(()=>h.getEntry(c,_)).next(S=>{const R=u.docVersions.get(_);Je(R!==null,48541),S.version.compareTo(R)<0&&(m.applyToRemoteDocument(S,u),S.isValidDocument()&&(S.setReadTime(u.commitVersion),h.addEntry(S)))})}),y.next(()=>l.mutationQueue.removeMutationBatch(c,m))}(s,n,e,a).next(()=>a.apply(n)).next(()=>s.mutationQueue.performConsistencyCheck(n)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(n,r,e.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(l){let c=Be();for(let u=0;u<l.mutationResults.length;++u)l.mutationResults[u].transformResults.length>0&&(c=c.add(l.batch.mutations[u].key));return c}(e))).next(()=>s.localDocuments.getDocuments(n,r))})}function uN(t){const e=Re(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",s=>e.Pi.getLastRemoteSnapshotVersion(s))}function nA(t,e){const s=Re(t),n=e.snapshotVersion;let r=s.Ms;return s.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const o=s.Ns.newChangeBuffer({trackRemovals:!0});r=s.Ms;const l=[];e.targetChanges.forEach((h,m)=>{const f=r.get(m);if(!f)return;l.push(s.Pi.removeMatchingKeys(a,h.removedDocuments,m).next(()=>s.Pi.addMatchingKeys(a,h.addedDocuments,m)));let y=f.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(m)!==null?y=y.withResumeToken(Yt.EMPTY_BYTE_STRING,Ae.min()).withLastLimboFreeSnapshotVersion(Ae.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,n)),r=r.insert(m,y),function(S,R,k){return S.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=ZT?!0:k.addedDocuments.size+k.modifiedDocuments.size+k.removedDocuments.size>0}(f,y,h)&&l.push(s.Pi.updateTargetData(a,y))});let c=lr(),u=Be();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&l.push(s.persistence.referenceDelegate.updateLimboDocument(a,h))}),l.push(rA(a,o,e.documentUpdates).next(h=>{c=h.ks,u=h.qs})),!n.isEqual(Ae.min())){const h=s.Pi.getLastRemoteSnapshotVersion(a).next(m=>s.Pi.setTargetsMetadata(a,a.currentSequenceNumber,n));l.push(h)}return ee.waitFor(l).next(()=>o.apply(a)).next(()=>s.localDocuments.getLocalViewOfDocuments(a,c,u)).next(()=>c)}).then(a=>(s.Ms=r,a))}function rA(t,e,s){let n=Be(),r=Be();return s.forEach(a=>n=n.add(a)),e.getEntries(t,n).next(a=>{let o=lr();return s.forEach((l,c)=>{const u=a.get(l);c.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(l)),c.isNoDocument()&&c.version.isEqual(Ae.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):ue(Xp,"Ignoring outdated watch update for ",l,". Current version:",u.version," Watch version:",c.version)}),{ks:o,qs:r}})}function iA(t,e){const s=Re(t);return s.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=Fp),s.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function aA(t,e){const s=Re(t);return s.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return s.Pi.getTargetData(n,e).next(a=>a?(r=a,ee.resolve(r)):s.Pi.allocateTargetId(n).next(o=>(r=new Lr(e,o,"TargetPurposeListen",n.currentSequenceNumber),s.Pi.addTargetData(n,r).next(()=>r))))}).then(n=>{const r=s.Ms.get(n.targetId);return(r===null||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(s.Ms=s.Ms.insert(n.targetId,n),s.xs.set(e,n.targetId)),n})}async function _f(t,e,s){const n=Re(t),r=n.Ms.get(e),a=s?"readwrite":"readwrite-primary";try{s||await n.persistence.runTransaction("Release target",a,o=>n.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!ao(o))throw o;ue(Xp,`Failed to update sequence numbers for target ${e}: ${o}`)}n.Ms=n.Ms.remove(e),n.xs.delete(r.target)}function _y(t,e,s){const n=Re(t);let r=Ae.min(),a=Be();return n.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,h){const m=Re(c),f=m.xs.get(h);return f!==void 0?ee.resolve(m.Ms.get(f)):m.Pi.getTargetData(u,h)}(n,o,Mn(e)).next(l=>{if(l)return r=l.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(o,l.targetId).next(c=>{a=c})}).next(()=>n.Fs.getDocumentsMatchingQuery(o,e,s?r:Ae.min(),s?a:Be())).next(l=>(oA(n,KE(e),l),{documents:l,Qs:a})))}function oA(t,e,s){let n=t.Os.get(e)||Ae.min();s.forEach((r,a)=>{a.readTime.compareTo(n)>0&&(n=a.readTime)}),t.Os.set(e,n)}class Ny{constructor(){this.activeTargetIds=ZE()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class lA{constructor(){this.Mo=new Ny,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,s,n){}addLocalQueryTarget(e,s=!0){return s&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,s,n){this.xo[e]=s}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Ny,Promise.resolve()}handleUserChange(e,s,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cA{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jy="ConnectivityMonitor";class Iy{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){ue(jy,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){ue(jy,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fc=null;function Nf(){return Fc===null?Fc=function(){return 268435456+Math.round(2147483648*Math.random())}():Fc++,"0x"+Fc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gh="RestConnection",dA={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class uA{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const s=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=s+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===qd?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,s,n,r,a){const o=Nf(),l=this.zo(e,s.toUriEncodedString());ue(Gh,`Sending RPC '${e}' ${o}:`,l,n);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,r,a);const{host:u}=new URL(l),h=ii(u);return this.Jo(e,l,c,n,h).then(m=>(ue(Gh,`Received RPC '${e}' ${o}: `,m),m),m=>{throw Ga(Gh,`RPC '${e}' ${o} failed with error: `,m,"url: ",l,"request:",n),m})}Ho(e,s,n,r,a,o){return this.Go(e,s,n,r,a)}jo(e,s,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ro}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((r,a)=>e[a]=r),n&&n.headers.forEach((r,a)=>e[a]=r)}zo(e,s){const n=dA[e];return`${this.Uo}/v1/${s}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hA{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ss="WebChannelConnection";class mA extends uA{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,s,n,r,a){const o=Nf();return new Promise((l,c)=>{const u=new h_;u.setWithCredentials(!0),u.listenOnce(m_.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case ad.NO_ERROR:const m=u.getResponseJson();ue(ss,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(m)),l(m);break;case ad.TIMEOUT:ue(ss,`RPC '${e}' ${o} timed out`),c(new oe(X.DEADLINE_EXCEEDED,"Request time out"));break;case ad.HTTP_ERROR:const f=u.getStatus();if(ue(ss,`RPC '${e}' ${o} failed with status:`,f,"response text:",u.getResponseText()),f>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const _=y==null?void 0:y.error;if(_&&_.status&&_.message){const S=function(k){const x=k.toLowerCase().replace(/_/g,"-");return Object.values(X).indexOf(x)>=0?x:X.UNKNOWN}(_.status);c(new oe(S,_.message))}else c(new oe(X.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new oe(X.UNAVAILABLE,"Connection failed."));break;default:Se(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{ue(ss,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(r);ue(ss,`RPC '${e}' ${o} sending request:`,r),u.send(s,"POST",h,n,15)})}T_(e,s,n){const r=Nf(),a=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=g_(),l=p_(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,s,n),c.encodeInitMessageHeaders=!0;const h=a.join("");ue(ss,`Creating RPC '${e}' stream ${r}: ${h}`,c);const m=o.createWebChannel(h,c);this.I_(m);let f=!1,y=!1;const _=new hA({Yo:R=>{y?ue(ss,`Not sending because RPC '${e}' stream ${r} is closed:`,R):(f||(ue(ss,`Opening RPC '${e}' stream ${r} transport.`),m.open(),f=!0),ue(ss,`RPC '${e}' stream ${r} sending:`,R),m.send(R))},Zo:()=>m.close()}),S=(R,k,x)=>{R.listen(k,A=>{try{x(A)}catch(M){setTimeout(()=>{throw M},0)}})};return S(m,Bo.EventType.OPEN,()=>{y||(ue(ss,`RPC '${e}' stream ${r} transport opened.`),_.o_())}),S(m,Bo.EventType.CLOSE,()=>{y||(y=!0,ue(ss,`RPC '${e}' stream ${r} transport closed`),_.a_(),this.E_(m))}),S(m,Bo.EventType.ERROR,R=>{y||(y=!0,Ga(ss,`RPC '${e}' stream ${r} transport errored. Name:`,R.name,"Message:",R.message),_.a_(new oe(X.UNAVAILABLE,"The operation could not be completed")))}),S(m,Bo.EventType.MESSAGE,R=>{var k;if(!y){const x=R.data[0];Je(!!x,16349);const A=x,M=(A==null?void 0:A.error)||((k=A[0])==null?void 0:k.error);if(M){ue(ss,`RPC '${e}' stream ${r} received error:`,M);const D=M.status;let B=function(w){const E=Et[w];if(E!==void 0)return X_(E)}(D),v=M.message;B===void 0&&(B=X.INTERNAL,v="Unknown error status: "+D+" with message "+M.message),y=!0,_.a_(new oe(B,v)),m.close()}else ue(ss,`RPC '${e}' stream ${r} received:`,x),_.u_(x)}}),S(l,f_.STAT_EVENT,R=>{R.stat===uf.PROXY?ue(ss,`RPC '${e}' stream ${r} detected buffering proxy`):R.stat===uf.NOPROXY&&ue(ss,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{_.__()},0),_}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(s=>s===e)}}function Qh(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uu(t){return new xT(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{constructor(e,s,n=1e3,r=1.5,a=6e4){this.Mi=e,this.timerId=s,this.d_=n,this.A_=r,this.R_=a,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const s=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,s-n);r>0&&ue("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${s} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sy="PersistentStream";class mN{constructor(e,s,n,r,a,o,l,c){this.Mi=e,this.S_=n,this.b_=r,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new hN(e,s)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,s){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():s&&s.code===X.RESOURCE_EXHAUSTED?(or(s.toString()),or("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):s&&s.code===X.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(s)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),s=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,r])=>{this.D_===s&&this.G_(n,r)},n=>{e(()=>{const r=new oe(X.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(r)})})}G_(e,s){const n=this.W_(this.D_);this.stream=this.j_(e,s),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(r=>{n(()=>this.z_(r))}),this.stream.onMessage(r=>{n(()=>++this.F_==1?this.J_(r):this.onNext(r))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return ue(Sy,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return s=>{this.Mi.enqueueAndForget(()=>this.D_===e?s():(ue(Sy,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class fA extends mN{constructor(e,s,n,r,a,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,n,r,o),this.serializer=a}j_(e,s){return this.connection.T_("Listen",e,s)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const s=bT(this.serializer,e),n=function(a){if(!("targetChange"in a))return Ae.min();const o=a.targetChange;return o.targetIds&&o.targetIds.length?Ae.min():o.readTime?On(o.readTime):Ae.min()}(e);return this.listener.H_(s,n)}Y_(e){const s={};s.database=wf(this.serializer),s.addTarget=function(a,o){let l;const c=o.target;if(l=gf(c)?{documents:NT(a,c)}:{query:jT(a,c).ft},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=tN(a,o.resumeToken);const u=yf(a,o.expectedCount);u!==null&&(l.expectedCount=u)}else if(o.snapshotVersion.compareTo(Ae.min())>0){l.readTime=Qd(a,o.snapshotVersion.toTimestamp());const u=yf(a,o.expectedCount);u!==null&&(l.expectedCount=u)}return l}(this.serializer,e);const n=ST(this.serializer,e);n&&(s.labels=n),this.q_(s)}Z_(e){const s={};s.database=wf(this.serializer),s.removeTarget=e,this.q_(s)}}class pA extends mN{constructor(e,s,n,r,a,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,n,r,o),this.serializer=a}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,s){return this.connection.T_("Write",e,s)}J_(e){return Je(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Je(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Je(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const s=_T(e.writeResults,e.commitTime),n=On(e.commitTime);return this.listener.na(n,s)}ra(){const e={};e.database=wf(this.serializer),this.q_(e)}ea(e){const s={streamToken:this.lastStreamToken,writes:e.map(n=>wT(this.serializer,n))};this.q_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gA{}class xA extends gA{constructor(e,s,n,r){super(),this.authCredentials=e,this.appCheckCredentials=s,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new oe(X.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,s,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Go(e,vf(s,n),r,a,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===X.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new oe(X.UNKNOWN,a.toString())})}Ho(e,s,n,r,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Ho(e,vf(s,n),r,o,l,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===X.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new oe(X.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class yA{constructor(e,s){this.asyncQueue=e,this.onlineStateHandler=s,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const s=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(or(s),this.aa=!1):ue("OnlineStateTracker",s)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fi="RemoteStore";class vA{constructor(e,s,n,r,a){this.localStore=e,this.datastore=s,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=a,this.Aa.Oo(o=>{n.enqueueAndForget(async()=>{Xi(this)&&(ue(Fi,"Restarting streams for network reachability change."),await async function(c){const u=Re(c);u.Ea.add(4),await Yl(u),u.Ra.set("Unknown"),u.Ea.delete(4),await Bu(u)}(this))})}),this.Ra=new yA(n,r)}}async function Bu(t){if(Xi(t))for(const e of t.da)await e(!0)}async function Yl(t){for(const e of t.da)await e(!1)}function fN(t,e){const s=Re(t);s.Ia.has(e.targetId)||(s.Ia.set(e.targetId,e),sg(s)?tg(s):lo(s).O_()&&eg(s,e))}function Zp(t,e){const s=Re(t),n=lo(s);s.Ia.delete(e),n.O_()&&pN(s,e),s.Ia.size===0&&(n.O_()?n.L_():Xi(s)&&s.Ra.set("Unknown"))}function eg(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ae.min())>0){const s=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(s)}lo(t).Y_(e)}function pN(t,e){t.Va.Ue(e),lo(t).Z_(e)}function tg(t){t.Va=new mT({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),lo(t).start(),t.Ra.ua()}function sg(t){return Xi(t)&&!lo(t).x_()&&t.Ia.size>0}function Xi(t){return Re(t).Ea.size===0}function gN(t){t.Va=void 0}async function bA(t){t.Ra.set("Online")}async function wA(t){t.Ia.forEach((e,s)=>{eg(t,e)})}async function _A(t,e){gN(t),sg(t)?(t.Ra.ha(e),tg(t)):t.Ra.set("Unknown")}async function NA(t,e,s){if(t.Ra.set("Online"),e instanceof eN&&e.state===2&&e.cause)try{await async function(r,a){const o=a.cause;for(const l of a.targetIds)r.Ia.has(l)&&(await r.remoteSyncer.rejectListen(l,o),r.Ia.delete(l),r.Va.removeTarget(l))}(t,e)}catch(n){ue(Fi,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Yd(t,n)}else if(e instanceof dd?t.Va.Ze(e):e instanceof Z_?t.Va.st(e):t.Va.tt(e),!s.isEqual(Ae.min()))try{const n=await uN(t.localStore);s.compareTo(n)>=0&&await function(a,o){const l=a.Va.Tt(o);return l.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){const h=a.Ia.get(u);h&&a.Ia.set(u,h.withResumeToken(c.resumeToken,o))}}),l.targetMismatches.forEach((c,u)=>{const h=a.Ia.get(c);if(!h)return;a.Ia.set(c,h.withResumeToken(Yt.EMPTY_BYTE_STRING,h.snapshotVersion)),pN(a,c);const m=new Lr(h.target,c,u,h.sequenceNumber);eg(a,m)}),a.remoteSyncer.applyRemoteEvent(l)}(t,s)}catch(n){ue(Fi,"Failed to raise snapshot:",n),await Yd(t,n)}}async function Yd(t,e,s){if(!ao(e))throw e;t.Ea.add(1),await Yl(t),t.Ra.set("Offline"),s||(s=()=>uN(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{ue(Fi,"Retrying IndexedDB access"),await s(),t.Ea.delete(1),await Bu(t)})}function xN(t,e){return e().catch(s=>Yd(t,s,e))}async function zu(t){const e=Re(t),s=ei(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Fp;for(;jA(e);)try{const r=await iA(e.localStore,n);if(r===null){e.Ta.length===0&&s.L_();break}n=r.batchId,IA(e,r)}catch(r){await Yd(e,r)}yN(e)&&vN(e)}function jA(t){return Xi(t)&&t.Ta.length<10}function IA(t,e){t.Ta.push(e);const s=ei(t);s.O_()&&s.X_&&s.ea(e.mutations)}function yN(t){return Xi(t)&&!ei(t).x_()&&t.Ta.length>0}function vN(t){ei(t).start()}async function SA(t){ei(t).ra()}async function kA(t){const e=ei(t);for(const s of t.Ta)e.ea(s.mutations)}async function EA(t,e,s){const n=t.Ta.shift(),r=Wp.from(n,e,s);await xN(t,()=>t.remoteSyncer.applySuccessfulWrite(r)),await zu(t)}async function TA(t,e){e&&ei(t).X_&&await async function(n,r){if(function(o){return dT(o)&&o!==X.ABORTED}(r.code)){const a=n.Ta.shift();ei(n).B_(),await xN(n,()=>n.remoteSyncer.rejectFailedWrite(a.batchId,r)),await zu(n)}}(t,e),yN(t)&&vN(t)}async function ky(t,e){const s=Re(t);s.asyncQueue.verifyOperationInProgress(),ue(Fi,"RemoteStore received new credentials");const n=Xi(s);s.Ea.add(3),await Yl(s),n&&s.Ra.set("Unknown"),await s.remoteSyncer.handleCredentialChange(e),s.Ea.delete(3),await Bu(s)}async function AA(t,e){const s=Re(t);e?(s.Ea.delete(2),await Bu(s)):e||(s.Ea.add(2),await Yl(s),s.Ra.set("Unknown"))}function lo(t){return t.ma||(t.ma=function(s,n,r){const a=Re(s);return a.sa(),new fA(n,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,r)}(t.datastore,t.asyncQueue,{Xo:bA.bind(null,t),t_:wA.bind(null,t),r_:_A.bind(null,t),H_:NA.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),sg(t)?tg(t):t.Ra.set("Unknown")):(await t.ma.stop(),gN(t))})),t.ma}function ei(t){return t.fa||(t.fa=function(s,n,r){const a=Re(s);return a.sa(),new pA(n,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,r)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:SA.bind(null,t),r_:TA.bind(null,t),ta:kA.bind(null,t),na:EA.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await zu(t)):(await t.fa.stop(),t.Ta.length>0&&(ue(Fi,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng{constructor(e,s,n,r,a){this.asyncQueue=e,this.timerId=s,this.targetTimeMs=n,this.op=r,this.removalCallback=a,this.deferred=new er,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,s,n,r,a){const o=Date.now()+n,l=new ng(e,s,o,r,a);return l.start(n),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new oe(X.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function rg(t,e){if(or("AsyncQueue",`${e}: ${t}`),ao(t))return new oe(X.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{static emptySet(e){return new La(e.comparator)}constructor(e){this.comparator=e?(s,n)=>e(s,n)||be.comparator(s.key,n.key):(s,n)=>be.comparator(s.key,n.key),this.keyedMap=zo(),this.sortedSet=new xt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const s=this.keyedMap.get(e);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((s,n)=>(e(s),!1))}add(e){const s=this.delete(e.key);return s.copy(s.keyedMap.insert(e.key,e),s.sortedSet.insert(e,null))}delete(e){const s=this.get(e);return s?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(s)):this}isEqual(e){if(!(e instanceof La)||this.size!==e.size)return!1;const s=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;s.hasNext();){const r=s.getNext().key,a=n.getNext().key;if(!r.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach(s=>{e.push(s.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,s){const n=new La;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=s,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ey{constructor(){this.ga=new xt(be.comparator)}track(e){const s=e.doc.key,n=this.ga.get(s);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(s,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(s,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(s,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(s,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(s):e.type===1&&n.type===2?this.ga=this.ga.insert(s,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(s,{type:2,doc:e.doc}):Se(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(s,e)}ya(){const e=[];return this.ga.inorderTraversal((s,n)=>{e.push(n)}),e}}class Za{constructor(e,s,n,r,a,o,l,c,u){this.query=e,this.docs=s,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,s,n,r,a){const o=[];return s.forEach(l=>{o.push({type:0,doc:l})}),new Za(e,s,La.emptySet(s),o,n,r,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Lu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const s=this.docChanges,n=e.docChanges;if(s.length!==n.length)return!1;for(let r=0;r<s.length;r++)if(s[r].type!==n[r].type||!s[r].doc.isEqual(n[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CA{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class PA{constructor(){this.queries=Ty(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(s,n){const r=Re(s),a=r.queries;r.queries=Ty(),a.forEach((o,l)=>{for(const c of l.Sa)c.onError(n)})})(this,new oe(X.ABORTED,"Firestore shutting down"))}}function Ty(){return new Yi(t=>$_(t),Lu)}async function ig(t,e){const s=Re(t);let n=3;const r=e.query;let a=s.queries.get(r);a?!a.ba()&&e.Da()&&(n=2):(a=new CA,n=e.Da()?0:1);try{switch(n){case 0:a.wa=await s.onListen(r,!0);break;case 1:a.wa=await s.onListen(r,!1);break;case 2:await s.onFirstRemoteStoreListen(r)}}catch(o){const l=rg(o,`Initialization of query '${ma(e.query)}' failed`);return void e.onError(l)}s.queries.set(r,a),a.Sa.push(e),e.va(s.onlineState),a.wa&&e.Fa(a.wa)&&og(s)}async function ag(t,e){const s=Re(t),n=e.query;let r=3;const a=s.queries.get(n);if(a){const o=a.Sa.indexOf(e);o>=0&&(a.Sa.splice(o,1),a.Sa.length===0?r=e.Da()?0:1:!a.ba()&&e.Da()&&(r=2))}switch(r){case 0:return s.queries.delete(n),s.onUnlisten(n,!0);case 1:return s.queries.delete(n),s.onUnlisten(n,!1);case 2:return s.onLastRemoteStoreUnlisten(n);default:return}}function RA(t,e){const s=Re(t);let n=!1;for(const r of e){const a=r.query,o=s.queries.get(a);if(o){for(const l of o.Sa)l.Fa(r)&&(n=!0);o.wa=r}}n&&og(s)}function MA(t,e,s){const n=Re(t),r=n.queries.get(e);if(r)for(const a of r.Sa)a.onError(s);n.queries.delete(e)}function og(t){t.Ca.forEach(e=>{e.next()})}var jf,Ay;(Ay=jf||(jf={})).Ma="default",Ay.Cache="cache";class lg{constructor(e,s,n){this.query=e,this.xa=s,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const r of e.docChanges)r.type!==3&&n.push(r);e=new Za(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let s=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),s=!0):this.La(e,this.onlineState)&&(this.ka(e),s=!0),this.Na=e,s}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let s=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),s=!0),s}La(e,s){if(!e.fromCache||!this.Da())return!0;const n=s!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||s==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const s=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}ka(e){e=Za.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==jf.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bN{constructor(e){this.key=e}}class wN{constructor(e){this.key=e}}class OA{constructor(e,s){this.query=e,this.Ya=s,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Be(),this.mutatedKeys=Be(),this.eu=F_(e),this.tu=new La(this.eu)}get nu(){return this.Ya}ru(e,s){const n=s?s.iu:new Ey,r=s?s.tu:this.tu;let a=s?s.mutatedKeys:this.mutatedKeys,o=r,l=!1;const c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((h,m)=>{const f=r.get(h),y=Vu(this.query,m)?m:null,_=!!f&&this.mutatedKeys.has(f.key),S=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let R=!1;f&&y?f.data.isEqual(y.data)?_!==S&&(n.track({type:3,doc:y}),R=!0):this.su(f,y)||(n.track({type:2,doc:y}),R=!0,(c&&this.eu(y,c)>0||u&&this.eu(y,u)<0)&&(l=!0)):!f&&y?(n.track({type:0,doc:y}),R=!0):f&&!y&&(n.track({type:1,doc:f}),R=!0,(c||u)&&(l=!0)),R&&(y?(o=o.add(y),a=S?a.add(h):a.delete(h)):(o=o.delete(h),a=a.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),a=a.delete(h.key),n.track({type:1,doc:h})}return{tu:o,iu:n,Cs:l,mutatedKeys:a}}su(e,s){return e.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(e,s,n,r){const a=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,m)=>function(y,_){const S=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Se(20277,{Rt:R})}};return S(y)-S(_)}(h.type,m.type)||this.eu(h.doc,m.doc)),this.ou(n),r=r??!1;const l=s&&!r?this._u():[],c=this.Xa.size===0&&this.current&&!r?1:0,u=c!==this.Za;return this.Za=c,o.length!==0||u?{snapshot:new Za(this.query,e.tu,a,o,e.mutatedKeys,c===0,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ey,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(s=>this.Ya=this.Ya.add(s)),e.modifiedDocuments.forEach(s=>{}),e.removedDocuments.forEach(s=>this.Ya=this.Ya.delete(s)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Be(),this.tu.forEach(n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))});const s=[];return e.forEach(n=>{this.Xa.has(n)||s.push(new wN(n))}),this.Xa.forEach(n=>{e.has(n)||s.push(new bN(n))}),s}cu(e){this.Ya=e.Qs,this.Xa=Be();const s=this.ru(e.documents);return this.applyChanges(s,!0)}lu(){return Za.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const cg="SyncEngine";class LA{constructor(e,s,n){this.query=e,this.targetId=s,this.view=n}}class VA{constructor(e){this.key=e,this.hu=!1}}class $A{constructor(e,s,n,r,a,o){this.localStore=e,this.remoteStore=s,this.eventManager=n,this.sharedClientState=r,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Yi(l=>$_(l),Lu),this.Iu=new Map,this.Eu=new Set,this.du=new xt(be.comparator),this.Au=new Map,this.Ru=new Qp,this.Vu={},this.mu=new Map,this.fu=Xa.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function FA(t,e,s=!0){const n=kN(t);let r;const a=n.Tu.get(e);return a?(n.sharedClientState.addLocalQueryTarget(a.targetId),r=a.view.lu()):r=await _N(n,e,s,!0),r}async function DA(t,e){const s=kN(t);await _N(s,e,!0,!1)}async function _N(t,e,s,n){const r=await aA(t.localStore,Mn(e)),a=r.targetId,o=t.sharedClientState.addLocalQueryTarget(a,s);let l;return n&&(l=await UA(t,e,a,o==="current",r.resumeToken)),t.isPrimaryClient&&s&&fN(t.remoteStore,r),l}async function UA(t,e,s,n,r){t.pu=(m,f,y)=>async function(S,R,k,x){let A=R.view.ru(k);A.Cs&&(A=await _y(S.localStore,R.query,!1).then(({documents:v})=>R.view.ru(v,A)));const M=x&&x.targetChanges.get(R.targetId),D=x&&x.targetMismatches.get(R.targetId)!=null,B=R.view.applyChanges(A,S.isPrimaryClient,M,D);return Py(S,R.targetId,B.au),B.snapshot}(t,m,f,y);const a=await _y(t.localStore,e,!0),o=new OA(e,a.Qs),l=o.ru(a.documents),c=Jl.createSynthesizedTargetChangeForCurrentChange(s,n&&t.onlineState!=="Offline",r),u=o.applyChanges(l,t.isPrimaryClient,c);Py(t,s,u.au);const h=new LA(e,s,o);return t.Tu.set(e,h),t.Iu.has(s)?t.Iu.get(s).push(e):t.Iu.set(s,[e]),u.snapshot}async function BA(t,e,s){const n=Re(t),r=n.Tu.get(e),a=n.Iu.get(r.targetId);if(a.length>1)return n.Iu.set(r.targetId,a.filter(o=>!Lu(o,e))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await _f(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),s&&Zp(n.remoteStore,r.targetId),If(n,r.targetId)}).catch(io)):(If(n,r.targetId),await _f(n.localStore,r.targetId,!0))}async function zA(t,e){const s=Re(t),n=s.Tu.get(e),r=s.Iu.get(n.targetId);s.isPrimaryClient&&r.length===1&&(s.sharedClientState.removeLocalQueryTarget(n.targetId),Zp(s.remoteStore,n.targetId))}async function HA(t,e,s){const n=YA(t);try{const r=await function(o,l){const c=Re(o),u=it.now(),h=l.reduce((y,_)=>y.add(_.key),Be());let m,f;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let _=lr(),S=Be();return c.Ns.getEntries(y,h).next(R=>{_=R,_.forEach((k,x)=>{x.isValidDocument()||(S=S.add(k))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,_)).next(R=>{m=R;const k=[];for(const x of l){const A=iT(x,m.get(x.key).overlayedDocument);A!=null&&k.push(new oi(x.key,A,A_(A.value.mapValue),Zs.exists(!0)))}return c.mutationQueue.addMutationBatch(y,u,k,l)}).next(R=>{f=R;const k=R.applyToLocalDocumentSet(m,S);return c.documentOverlayCache.saveOverlays(y,R.batchId,k)})}).then(()=>({batchId:f.batchId,changes:U_(m)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(r.batchId),function(o,l,c){let u=o.Vu[o.currentUser.toKey()];u||(u=new xt(Ue)),u=u.insert(l,c),o.Vu[o.currentUser.toKey()]=u}(n,r.batchId,s),await Xl(n,r.changes),await zu(n.remoteStore)}catch(r){const a=rg(r,"Failed to persist write");s.reject(a)}}async function NN(t,e){const s=Re(t);try{const n=await nA(s.localStore,e);e.targetChanges.forEach((r,a)=>{const o=s.Au.get(a);o&&(Je(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?Je(o.hu,14607):r.removedDocuments.size>0&&(Je(o.hu,42227),o.hu=!1))}),await Xl(s,n,e)}catch(n){await io(n)}}function Cy(t,e,s){const n=Re(t);if(n.isPrimaryClient&&s===0||!n.isPrimaryClient&&s===1){const r=[];n.Tu.forEach((a,o)=>{const l=o.view.va(e);l.snapshot&&r.push(l.snapshot)}),function(o,l){const c=Re(o);c.onlineState=l;let u=!1;c.queries.forEach((h,m)=>{for(const f of m.Sa)f.va(l)&&(u=!0)}),u&&og(c)}(n.eventManager,e),r.length&&n.Pu.H_(r),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function qA(t,e,s){const n=Re(t);n.sharedClientState.updateQueryState(e,"rejected",s);const r=n.Au.get(e),a=r&&r.key;if(a){let o=new xt(be.comparator);o=o.insert(a,is.newNoDocument(a,Ae.min()));const l=Be().add(a),c=new Du(Ae.min(),new Map,new xt(Ue),o,l);await NN(n,c),n.du=n.du.remove(a),n.Au.delete(e),dg(n)}else await _f(n.localStore,e,!1).then(()=>If(n,e,s)).catch(io)}async function WA(t,e){const s=Re(t),n=e.batch.batchId;try{const r=await sA(s.localStore,e);IN(s,n,null),jN(s,n),s.sharedClientState.updateMutationState(n,"acknowledged"),await Xl(s,r)}catch(r){await io(r)}}async function KA(t,e,s){const n=Re(t);try{const r=await function(o,l){const c=Re(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return c.mutationQueue.lookupMutationBatch(u,l).next(m=>(Je(m!==null,37113),h=m.keys(),c.mutationQueue.removeMutationBatch(u,m))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,h,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>c.localDocuments.getDocuments(u,h))})}(n.localStore,e);IN(n,e,s),jN(n,e),n.sharedClientState.updateMutationState(e,"rejected",s),await Xl(n,r)}catch(r){await io(r)}}function jN(t,e){(t.mu.get(e)||[]).forEach(s=>{s.resolve()}),t.mu.delete(e)}function IN(t,e,s){const n=Re(t);let r=n.Vu[n.currentUser.toKey()];if(r){const a=r.get(e);a&&(s?a.reject(s):a.resolve(),r=r.remove(e)),n.Vu[n.currentUser.toKey()]=r}}function If(t,e,s=null){t.sharedClientState.removeLocalQueryTarget(e);for(const n of t.Iu.get(e))t.Tu.delete(n),s&&t.Pu.yu(n,s);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(n=>{t.Ru.containsKey(n)||SN(t,n)})}function SN(t,e){t.Eu.delete(e.path.canonicalString());const s=t.du.get(e);s!==null&&(Zp(t.remoteStore,s),t.du=t.du.remove(e),t.Au.delete(s),dg(t))}function Py(t,e,s){for(const n of s)n instanceof bN?(t.Ru.addReference(n.key,e),GA(t,n)):n instanceof wN?(ue(cg,"Document no longer in limbo: "+n.key),t.Ru.removeReference(n.key,e),t.Ru.containsKey(n.key)||SN(t,n.key)):Se(19791,{wu:n})}function GA(t,e){const s=e.key,n=s.path.canonicalString();t.du.get(s)||t.Eu.has(n)||(ue(cg,"New document in limbo: "+s),t.Eu.add(n),dg(t))}function dg(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const s=new be(rt.fromString(e)),n=t.fu.next();t.Au.set(n,new VA(s)),t.du=t.du.insert(s,n),fN(t.remoteStore,new Lr(Mn(Ou(s.path)),n,"TargetPurposeLimboResolution",Pu.ce))}}async function Xl(t,e,s){const n=Re(t),r=[],a=[],o=[];n.Tu.isEmpty()||(n.Tu.forEach((l,c)=>{o.push(n.pu(c,e,s).then(u=>{var h;if((u||s)&&n.isPrimaryClient){const m=u?!u.fromCache:(h=s==null?void 0:s.targetChanges.get(c.targetId))==null?void 0:h.current;n.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(u){r.push(u);const m=Yp.As(c.targetId,u);a.push(m)}}))}),await Promise.all(o),n.Pu.H_(r),await async function(c,u){const h=Re(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>ee.forEach(u,f=>ee.forEach(f.Es,y=>h.persistence.referenceDelegate.addReference(m,f.targetId,y)).next(()=>ee.forEach(f.ds,y=>h.persistence.referenceDelegate.removeReference(m,f.targetId,y)))))}catch(m){if(!ao(m))throw m;ue(Xp,"Failed to update sequence numbers: "+m)}for(const m of u){const f=m.targetId;if(!m.fromCache){const y=h.Ms.get(f),_=y.snapshotVersion,S=y.withLastLimboFreeSnapshotVersion(_);h.Ms=h.Ms.insert(f,S)}}}(n.localStore,a))}async function QA(t,e){const s=Re(t);if(!s.currentUser.isEqual(e)){ue(cg,"User change. New user:",e.toKey());const n=await dN(s.localStore,e);s.currentUser=e,function(a,o){a.mu.forEach(l=>{l.forEach(c=>{c.reject(new oe(X.CANCELLED,o))})}),a.mu.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Xl(s,n.Ls)}}function JA(t,e){const s=Re(t),n=s.Au.get(e);if(n&&n.hu)return Be().add(n.key);{let r=Be();const a=s.Iu.get(e);if(!a)return r;for(const o of a){const l=s.Tu.get(o);r=r.unionWith(l.view.nu)}return r}}function kN(t){const e=Re(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=NN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=JA.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=qA.bind(null,e),e.Pu.H_=RA.bind(null,e.eventManager),e.Pu.yu=MA.bind(null,e.eventManager),e}function YA(t){const e=Re(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=WA.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=KA.bind(null,e),e}class Xd{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Uu(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,s){return null}Mu(e,s){return null}vu(e){return tA(this.persistence,new XT,e.initialUser,this.serializer)}Cu(e){return new cN(Jp.mi,this.serializer)}Du(e){return new lA}async terminate(){var e,s;(e=this.gcScheduler)==null||e.stop(),(s=this.indexBackfillerScheduler)==null||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Xd.provider={build:()=>new Xd};class XA extends Xd{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,s){Je(this.persistence.referenceDelegate instanceof Jd,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new VT(n,e.asyncQueue,s)}Cu(e){const s=this.cacheSizeBytes!==void 0?ws.withCacheSize(this.cacheSizeBytes):ws.DEFAULT;return new cN(n=>Jd.mi(n,s),this.serializer)}}class Sf{async initialize(e,s){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Cy(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=QA.bind(null,this.syncEngine),await AA(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new PA}()}createDatastore(e){const s=Uu(e.databaseInfo.databaseId),n=function(a){return new mA(a)}(e.databaseInfo);return function(a,o,l,c){return new xA(a,o,l,c)}(e.authCredentials,e.appCheckCredentials,n,s)}createRemoteStore(e){return function(n,r,a,o,l){return new vA(n,r,a,o,l)}(this.localStore,this.datastore,e.asyncQueue,s=>Cy(this.syncEngine,s,0),function(){return Iy.v()?new Iy:new cA}())}createSyncEngine(e,s){return function(r,a,o,l,c,u,h){const m=new $A(r,a,o,l,c,u);return h&&(m.gu=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,s)}async terminate(){var e,s;await async function(r){const a=Re(r);ue(Fi,"RemoteStore shutting down."),a.Ea.add(5),await Yl(a),a.Aa.shutdown(),a.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(s=this.eventManager)==null||s.terminate()}}Sf.provider={build:()=>new Sf};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):or("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,s){setTimeout(()=>{this.muted||e(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ti="FirestoreClient";class ZA{constructor(e,s,n,r,a){this.authCredentials=e,this.appCheckCredentials=s,this.asyncQueue=n,this.databaseInfo=r,this.user=ns.UNAUTHENTICATED,this.clientId=$p.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(n,async o=>{ue(ti,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(n,o=>(ue(ti,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new er;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(s){const n=rg(s,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Jh(t,e){t.asyncQueue.verifyOperationInProgress(),ue(ti,"Initializing OfflineComponentProvider");const s=t.configuration;await e.initialize(s);let n=s.initialUser;t.setCredentialChangeListener(async r=>{n.isEqual(r)||(await dN(e.localStore,r),n=r)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Ry(t,e){t.asyncQueue.verifyOperationInProgress();const s=await eC(t);ue(ti,"Initializing OnlineComponentProvider"),await e.initialize(s,t.configuration),t.setCredentialChangeListener(n=>ky(e.remoteStore,n)),t.setAppCheckTokenChangeListener((n,r)=>ky(e.remoteStore,r)),t._onlineComponents=e}async function eC(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ue(ti,"Using user provided OfflineComponentProvider");try{await Jh(t,t._uninitializedComponentsProvider._offline)}catch(e){const s=e;if(!function(r){return r.name==="FirebaseError"?r.code===X.FAILED_PRECONDITION||r.code===X.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(s))throw s;Ga("Error using user provided cache. Falling back to memory cache: "+s),await Jh(t,new Xd)}}else ue(ti,"Using default OfflineComponentProvider"),await Jh(t,new XA(void 0));return t._offlineComponents}async function EN(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ue(ti,"Using user provided OnlineComponentProvider"),await Ry(t,t._uninitializedComponentsProvider._online)):(ue(ti,"Using default OnlineComponentProvider"),await Ry(t,new Sf))),t._onlineComponents}function tC(t){return EN(t).then(e=>e.syncEngine)}async function Zd(t){const e=await EN(t),s=e.eventManager;return s.onListen=FA.bind(null,e.syncEngine),s.onUnlisten=BA.bind(null,e.syncEngine),s.onFirstRemoteStoreListen=DA.bind(null,e.syncEngine),s.onLastRemoteStoreUnlisten=zA.bind(null,e.syncEngine),s}function sC(t,e,s={}){const n=new er;return t.asyncQueue.enqueueAndForget(async()=>function(a,o,l,c,u){const h=new ug({next:f=>{h.Nu(),o.enqueueAndForget(()=>ag(a,m));const y=f.docs.has(l);!y&&f.fromCache?u.reject(new oe(X.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&f.fromCache&&c&&c.source==="server"?u.reject(new oe(X.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(f)},error:f=>u.reject(f)}),m=new lg(Ou(l.path),h,{includeMetadataChanges:!0,qa:!0});return ig(a,m)}(await Zd(t),t.asyncQueue,e,s,n)),n.promise}function nC(t,e,s={}){const n=new er;return t.asyncQueue.enqueueAndForget(async()=>function(a,o,l,c,u){const h=new ug({next:f=>{h.Nu(),o.enqueueAndForget(()=>ag(a,m)),f.fromCache&&c.source==="server"?u.reject(new oe(X.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(f)},error:f=>u.reject(f)}),m=new lg(l,h,{includeMetadataChanges:!0,qa:!0});return ig(a,m)}(await Zd(t),t.asyncQueue,e,s,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TN(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const My=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AN="firestore.googleapis.com",Oy=!0;class Ly{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new oe(X.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=AN,this.ssl=Oy}else this.host=e.host,this.ssl=e.ssl??Oy;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=lN;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<OT)throw new oe(X.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}vE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=TN(e.experimentalLongPollingOptions??{}),function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new oe(X.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new oe(X.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new oe(X.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,r){return n.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Hu{constructor(e,s,n,r){this._authCredentials=e,this._appCheckCredentials=s,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ly({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new oe(X.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new oe(X.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ly(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new cE;switch(n.type){case"firstParty":return new mE(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new oe(X.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const n=My.get(s);n&&(ue("ComponentProvider","Removing Datastore"),My.delete(s),n.terminate())}(this),Promise.resolve()}}function rC(t,e,s,n={}){var u;t=As(t,Hu);const r=ii(e),a=t._getSettings(),o={...a,emulatorOptions:t._getEmulatorOptions()},l=`${e}:${s}`;r&&(Rp(`https://${l}`),Mp("Firestore",!0)),a.host!==AN&&a.host!==l&&Ga("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...a,host:l,ssl:r,emulatorOptions:n};if(!Vi(c,o)&&(t._setSettings(c),n.mockUserToken)){let h,m;if(typeof n.mockUserToken=="string")h=n.mockUserToken,m=ns.MOCK_USER;else{h=n_(n.mockUserToken,(u=t._app)==null?void 0:u.options.projectId);const f=n.mockUserToken.sub||n.mockUserToken.user_id;if(!f)throw new oe(X.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new ns(f)}t._authCredentials=new dE(new y_(h,m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr{constructor(e,s,n){this.converter=s,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new hr(this.firestore,e,this._query)}}class wt{constructor(e,s,n){this.converter=s,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Kr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new wt(this.firestore,e,this._key)}toJSON(){return{type:wt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,s,n){if(Gl(s,wt._jsonSchema))return new wt(e,n||null,new be(rt.fromString(s.referencePath)))}}wt._jsonSchemaVersion="firestore/documentReference/1.0",wt._jsonSchema={type:Ct("string",wt._jsonSchemaVersion),referencePath:Ct("string")};class Kr extends hr{constructor(e,s,n){super(e,s,Ou(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new wt(this.firestore,null,new be(e))}withConverter(e){return new Kr(this.firestore,e,this._path)}}function fe(t,e,...s){if(t=nt(t),v_("collection","path",e),t instanceof Hu){const n=rt.fromString(e,...s);return Q0(n),new Kr(t,null,n)}{if(!(t instanceof wt||t instanceof Kr))throw new oe(X.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(rt.fromString(e,...s));return Q0(n),new Kr(t.firestore,null,n)}}function st(t,e,...s){if(t=nt(t),arguments.length===1&&(e=$p.newId()),v_("doc","path",e),t instanceof Hu){const n=rt.fromString(e,...s);return G0(n),new wt(t,null,new be(n))}{if(!(t instanceof wt||t instanceof Kr))throw new oe(X.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(rt.fromString(e,...s));return G0(n),new wt(t.firestore,t instanceof Kr?t.converter:null,new be(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vy="AsyncQueue";class $y{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new hN(this,"async_queue_retry"),this._c=()=>{const n=Qh();n&&ue(Vy,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const s=Qh();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const s=Qh();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const s=new er;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ao(e))throw e;ue(Vy,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const s=this.ac.then(()=>(this.rc=!0,e().catch(n=>{throw this.nc=n,this.rc=!1,or("INTERNAL UNHANDLED ERROR: ",Fy(n)),n}).then(n=>(this.rc=!1,n))));return this.ac=s,s}enqueueAfterDelay(e,s,n){this.uc(),this.oc.indexOf(e)>-1&&(s=0);const r=ng.createAndSchedule(this,e,s,n,a=>this.hc(a));return this.tc.push(r),r}uc(){this.nc&&Se(47125,{Pc:Fy(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const s of this.tc)if(s.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((s,n)=>s.targetTimeMs-n.targetTimeMs);for(const s of this.tc)if(s.skipDelay(),e!=="all"&&s.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const s=this.tc.indexOf(e);this.tc.splice(s,1)}}function Fy(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dy(t){return function(s,n){if(typeof s!="object"||s===null)return!1;const r=s;for(const a of n)if(a in r&&typeof r[a]=="function")return!0;return!1}(t,["next","error","complete"])}class cr extends Hu{constructor(e,s,n,r){super(e,s,n,r),this.type="firestore",this._queue=new $y,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new $y(e),this._firestoreClient=void 0,await e}}}function iC(t,e){const s=typeof t=="object"?t:Au(),n=typeof t=="string"?t:qd,r=Qi(s,"firestore").getImmediate({identifier:n});if(!r._initialized){const a=e_("firestore");a&&rC(r,...a)}return r}function qu(t){if(t._terminated)throw new oe(X.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||aC(t),t._firestoreClient}function aC(t){var n,r,a;const e=t._freezeSettings(),s=function(l,c,u,h){return new CE(l,c,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,TN(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(t._databaseId,((n=t._app)==null?void 0:n.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(r=e.localCache)!=null&&r._offlineComponentProvider&&((a=e.localCache)!=null&&a._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new ZA(t._authCredentials,t._appCheckCredentials,t._queue,s,t._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Js(Yt.fromBase64String(e))}catch(s){throw new oe(X.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(e){return new Js(Yt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Js._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Gl(e,Js._jsonSchema))return Js.fromBase64String(e.bytes)}}Js._jsonSchemaVersion="firestore/bytes/1.0",Js._jsonSchema={type:Ct("string",Js._jsonSchemaVersion),bytes:Ct("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wu{constructor(...e){for(let s=0;s<e.length;++s)if(e[s].length===0)throw new oe(X.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Gt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(e,s){if(!isFinite(e)||e<-90||e>90)throw new oe(X.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(s)||s<-180||s>180)throw new oe(X.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=e,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ue(this._lat,e._lat)||Ue(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ln._jsonSchemaVersion}}static fromJSON(e){if(Gl(e,Ln._jsonSchema))return new Ln(e.latitude,e.longitude)}}Ln._jsonSchemaVersion="firestore/geoPoint/1.0",Ln._jsonSchema={type:Ct("string",Ln._jsonSchemaVersion),latitude:Ct("number"),longitude:Ct("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(e){this._values=(e||[]).map(s=>s)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,r){if(n.length!==r.length)return!1;for(let a=0;a<n.length;++a)if(n[a]!==r[a])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Vn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Gl(e,Vn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(s=>typeof s=="number"))return new Vn(e.vectorValues);throw new oe(X.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Vn._jsonSchemaVersion="firestore/vectorValue/1.0",Vn._jsonSchema={type:Ct("string",Vn._jsonSchemaVersion),vectorValues:Ct("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oC=/^__.*__$/;class lC{constructor(e,s,n){this.data=e,this.fieldMask=s,this.fieldTransforms=n}toMutation(e,s){return this.fieldMask!==null?new oi(e,this.data,this.fieldMask,s,this.fieldTransforms):new Ql(e,this.data,s,this.fieldTransforms)}}class CN{constructor(e,s,n){this.data=e,this.fieldMask=s,this.fieldTransforms=n}toMutation(e,s){return new oi(e,this.data,this.fieldMask,s,this.fieldTransforms)}}function PN(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Se(40011,{Ac:t})}}class hg{constructor(e,s,n,r,a,o){this.settings=e,this.databaseId=s,this.serializer=n,this.ignoreUndefinedProperties=r,a===void 0&&this.Rc(),this.fieldTransforms=a||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new hg({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var r;const s=(r=this.path)==null?void 0:r.child(e),n=this.Vc({path:s,fc:!1});return n.gc(e),n}yc(e){var r;const s=(r=this.path)==null?void 0:r.child(e),n=this.Vc({path:s,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return eu(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(s=>e.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>e.isPrefixOf(s.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(PN(this.Ac)&&oC.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class cC{constructor(e,s,n){this.databaseId=e,this.ignoreUndefinedProperties=s,this.serializer=n||Uu(e)}Cc(e,s,n,r=!1){return new hg({Ac:e,methodName:s,Dc:n,path:Gt.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ku(t){const e=t._freezeSettings(),s=Uu(t._databaseId);return new cC(t._databaseId,!!e.ignoreUndefinedProperties,s)}function RN(t,e,s,n,r,a={}){const o=t.Cc(a.merge||a.mergeFields?2:0,e,s,r);pg("Data must be an object, but it was:",o,n);const l=MN(n,o);let c,u;if(a.merge)c=new Fs(o.fieldMask),u=o.fieldTransforms;else if(a.mergeFields){const h=[];for(const m of a.mergeFields){const f=kf(e,m,s);if(!o.contains(f))throw new oe(X.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);LN(h,f)||h.push(f)}c=new Fs(h),u=o.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,u=o.fieldTransforms;return new lC(new Ns(l),c,u)}class Gu extends Zl{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Gu}}class mg extends Zl{_toFieldTransform(e){return new Q_(e.path,new Rl)}isEqual(e){return e instanceof mg}}class fg extends Zl{constructor(e,s){super(e),this.Fc=s}_toFieldTransform(e){const s=new Ll(e.serializer,H_(e.serializer,this.Fc));return new Q_(e.path,s)}isEqual(e){return e instanceof fg&&this.Fc===e.Fc}}function dC(t,e,s,n){const r=t.Cc(1,e,s);pg("Data must be an object, but it was:",r,n);const a=[],o=Ns.empty();ai(n,(c,u)=>{const h=gg(e,c,s);u=nt(u);const m=r.yc(h);if(u instanceof Gu)a.push(h);else{const f=ec(u,m);f!=null&&(a.push(h),o.set(h,f))}});const l=new Fs(a);return new CN(o,l,r.fieldTransforms)}function uC(t,e,s,n,r,a){const o=t.Cc(1,e,s),l=[kf(e,n,s)],c=[r];if(a.length%2!=0)throw new oe(X.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<a.length;f+=2)l.push(kf(e,a[f])),c.push(a[f+1]);const u=[],h=Ns.empty();for(let f=l.length-1;f>=0;--f)if(!LN(u,l[f])){const y=l[f];let _=c[f];_=nt(_);const S=o.yc(y);if(_ instanceof Gu)u.push(y);else{const R=ec(_,S);R!=null&&(u.push(y),h.set(y,R))}}const m=new Fs(u);return new CN(h,m,o.fieldTransforms)}function hC(t,e,s,n=!1){return ec(s,t.Cc(n?4:3,e))}function ec(t,e){if(ON(t=nt(t)))return pg("Unsupported field value:",e,t),MN(t,e);if(t instanceof Zl)return function(n,r){if(!PN(r.Ac))throw r.Sc(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${n._methodName}() is not currently supported inside arrays`);const a=n._toFieldTransform(r);a&&r.fieldTransforms.push(a)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(n,r){const a=[];let o=0;for(const l of n){let c=ec(l,r.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),a.push(c),o++}return{arrayValue:{values:a}}}(t,e)}return function(n,r){if((n=nt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return H_(r.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const a=it.fromDate(n);return{timestampValue:Qd(r.serializer,a)}}if(n instanceof it){const a=new it(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Qd(r.serializer,a)}}if(n instanceof Ln)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Js)return{bytesValue:tN(r.serializer,n._byteString)};if(n instanceof wt){const a=r.databaseId,o=n.firestore._databaseId;if(!o.isEqual(a))throw r.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:Gp(n.firestore._databaseId||r.databaseId,n._key.path)}}if(n instanceof Vn)return function(o,l){return{mapValue:{fields:{[E_]:{stringValue:T_},[Wd]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw l.Sc("VectorValues must only contain numeric values.");return Hp(l.serializer,u)})}}}}}}(n,r);throw r.Sc(`Unsupported field value: ${Cu(n)}`)}(t,e)}function MN(t,e){const s={};return __(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ai(t,(n,r)=>{const a=ec(r,e.mc(n));a!=null&&(s[n]=a)}),{mapValue:{fields:s}}}function ON(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof it||t instanceof Ln||t instanceof Js||t instanceof wt||t instanceof Zl||t instanceof Vn)}function pg(t,e,s){if(!ON(s)||!b_(s)){const n=Cu(s);throw n==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+n)}}function kf(t,e,s){if((e=nt(e))instanceof Wu)return e._internalPath;if(typeof e=="string")return gg(t,e);throw eu("Field path arguments must be of type string or ",t,!1,void 0,s)}const mC=new RegExp("[~\\*/\\[\\]]");function gg(t,e,s){if(e.search(mC)>=0)throw eu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,s);try{return new Wu(...e.split("."))._internalPath}catch{throw eu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,s)}}function eu(t,e,s,n,r){const a=n&&!n.isEmpty(),o=r!==void 0;let l=`Function ${e}() called with invalid data`;s&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(a||o)&&(c+=" (found",a&&(c+=` in field ${n}`),o&&(c+=` in document ${r}`),c+=")"),new oe(X.INVALID_ARGUMENT,l+t+c)}function LN(t,e){return t.some(s=>s.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VN{constructor(e,s,n,r,a){this._firestore=e,this._userDataWriter=s,this._key=n,this._document=r,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new wt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new fC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const s=this._document.data.field(Qu("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s)}}}class fC extends VN{data(){return super.data()}}function Qu(t,e){return typeof e=="string"?gg(t,e):e instanceof Wu?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $N(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new oe(X.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class xg{}class yg extends xg{}function _e(t,e,...s){let n=[];e instanceof xg&&n.push(e),n=n.concat(s),function(a){const o=a.filter(c=>c instanceof vg).length,l=a.filter(c=>c instanceof Ju).length;if(o>1||o>0&&l>0)throw new oe(X.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const r of n)t=r._apply(t);return t}class Ju extends yg{constructor(e,s,n){super(),this._field=e,this._op=s,this._value=n,this.type="where"}static _create(e,s,n){return new Ju(e,s,n)}_apply(e){const s=this._parse(e);return FN(e._query,s),new hr(e.firestore,e.converter,xf(e._query,s))}_parse(e){const s=Ku(e.firestore);return function(a,o,l,c,u,h,m){let f;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new oe(X.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){By(m,h);const _=[];for(const S of m)_.push(Uy(c,a,S));f={arrayValue:{values:_}}}else f=Uy(c,a,m)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||By(m,h),f=hC(l,o,m,h==="in"||h==="not-in");return At.create(u,h,f)}(e._query,"where",s,e.firestore._databaseId,this._field,this._op,this._value)}}function pe(t,e,s){const n=e,r=Qu("where",t);return Ju._create(r,n,s)}class vg extends xg{constructor(e,s){super(),this.type=e,this._queryConstraints=s}static _create(e,s){return new vg(e,s)}_parse(e){const s=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return s.length===1?s[0]:yn.create(s,this._getOperator())}_apply(e){const s=this._parse(e);return s.getFilters().length===0?e:(function(r,a){let o=r;const l=a.getFlattenedFilters();for(const c of l)FN(o,c),o=xf(o,c)}(e._query,s),new hr(e.firestore,e.converter,xf(e._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class bg extends yg{constructor(e,s){super(),this._field=e,this._direction=s,this.type="orderBy"}static _create(e,s){return new bg(e,s)}_apply(e){const s=function(r,a,o){if(r.startAt!==null)throw new oe(X.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new oe(X.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Pl(a,o)}(e._query,this._field,this._direction);return new hr(e.firestore,e.converter,function(r,a){const o=r.explicitOrderBy.concat([a]);return new oo(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,s))}}function Pt(t,e="asc"){const s=e,n=Qu("orderBy",t);return bg._create(n,s)}class wg extends yg{constructor(e,s,n){super(),this.type=e,this._limit=s,this._limitType=n}static _create(e,s,n){return new wg(e,s,n)}_apply(e){return new hr(e.firestore,e.converter,Gd(e._query,this._limit,this._limitType))}}function zs(t){return bE("limit",t),wg._create("limit",t,"F")}function Uy(t,e,s){if(typeof(s=nt(s))=="string"){if(s==="")throw new oe(X.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!V_(e)&&s.indexOf("/")!==-1)throw new oe(X.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const n=e.path.child(rt.fromString(s));if(!be.isDocumentKey(n))throw new oe(X.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ny(t,new be(n))}if(s instanceof wt)return ny(t,s._key);throw new oe(X.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Cu(s)}.`)}function By(t,e){if(!Array.isArray(t)||t.length===0)throw new oe(X.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function FN(t,e){const s=function(r,a){for(const o of r)for(const l of o.getFlattenedFilters())if(a.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(s!==null)throw s===e.op?new oe(X.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new oe(X.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${s.toString()}' filters.`)}class pC{convertValue(e,s="none"){switch(Zr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return It(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,s);case 5:return e.stringValue;case 6:return this.convertBytes(Xr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,s);case 11:return this.convertObject(e.mapValue,s);case 10:return this.convertVectorValue(e.mapValue);default:throw Se(62114,{value:e})}}convertObject(e,s){return this.convertObjectMap(e.fields,s)}convertObjectMap(e,s="none"){const n={};return ai(e,(r,a)=>{n[r]=this.convertValue(a,s)}),n}convertVectorValue(e){var n,r,a;const s=(a=(r=(n=e.fields)==null?void 0:n[Wd].arrayValue)==null?void 0:r.values)==null?void 0:a.map(o=>It(o.doubleValue));return new Vn(s)}convertGeoPoint(e){return new Ln(It(e.latitude),It(e.longitude))}convertArray(e,s){return(e.values||[]).map(n=>this.convertValue(n,s))}convertServerTimestamp(e,s){switch(s){case"previous":const n=Mu(e);return n==null?null:this.convertValue(n,s);case"estimate":return this.convertTimestamp(Tl(e));default:return null}}convertTimestamp(e){const s=Yr(e);return new it(s.seconds,s.nanos)}convertDocumentKey(e,s){const n=rt.fromString(e);Je(oN(n),9688,{name:e});const r=new Al(n.get(1),n.get(3)),a=new be(n.popFirst(5));return r.isEqual(s)||or(`Document ${a} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DN(t,e,s){let n;return n=t?s&&(s.merge||s.mergeFields)?t.toFirestore(e,s):t.toFirestore(e):e,n}class qo{constructor(e,s){this.hasPendingWrites=e,this.fromCache=s}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ei extends VN{constructor(e,s,n,r,a,o){super(e,s,n,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const s=new ud(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,s={}){if(this._document){const n=this._document.data.field(Qu("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,s.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new oe(X.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,s={};return s.type=Ei._jsonSchemaVersion,s.bundle="",s.bundleSource="DocumentSnapshot",s.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?s:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),s.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),s)}}Ei._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ei._jsonSchema={type:Ct("string",Ei._jsonSchemaVersion),bundleSource:Ct("string","DocumentSnapshot"),bundleName:Ct("string"),bundle:Ct("string")};class ud extends Ei{data(e={}){return super.data(e)}}class Ti{constructor(e,s,n,r){this._firestore=e,this._userDataWriter=s,this._snapshot=r,this.metadata=new qo(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(s=>e.push(s)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,s){this._snapshot.docs.forEach(n=>{e.call(s,new ud(this._firestore,this._userDataWriter,n.key,n,new qo(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const s=!!e.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new oe(X.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(r,a){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(l=>{const c=new ud(r._firestore,r._userDataWriter,l.doc.key,l.doc,new qo(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(l=>a||l.type!==3).map(l=>{const c=new ud(r._firestore,r._userDataWriter,l.doc.key,l.doc,new qo(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,h=-1;return l.type!==0&&(u=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),h=o.indexOf(l.doc.key)),{type:gC(l.type),doc:c,oldIndex:u,newIndex:h}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new oe(X.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Ti._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=$p.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const s=[],n=[],r=[];return this.docs.forEach(a=>{a._document!==null&&(s.push(a._document),n.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),r.push(a.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function gC(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Se(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ht(t){t=As(t,wt);const e=As(t.firestore,cr);return sC(qu(e),t._key).then(s=>BN(e,t,s))}Ti._jsonSchemaVersion="firestore/querySnapshot/1.0",Ti._jsonSchema={type:Ct("string",Ti._jsonSchemaVersion),bundleSource:Ct("string","QuerySnapshot"),bundleName:Ct("string"),bundle:Ct("string")};class _g extends pC{constructor(e){super(),this.firestore=e}convertBytes(e){return new Js(e)}convertReference(e){const s=this.convertDocumentKey(e,this.firestore._databaseId);return new wt(this.firestore,null,s)}}function Pe(t){t=As(t,hr);const e=As(t.firestore,cr),s=qu(e),n=new _g(e);return $N(t._query),nC(s,t._query).then(r=>new Ti(e,n,t,r))}function UN(t,e,s){t=As(t,wt);const n=As(t.firestore,cr),r=DN(t.converter,e,s);return Yu(n,[RN(Ku(n),"setDoc",t._key,r,t.converter!==null,s).toMutation(t._key,Zs.none())])}function Zi(t,e,s,...n){t=As(t,wt);const r=As(t.firestore,cr),a=Ku(r);let o;return o=typeof(e=nt(e))=="string"||e instanceof Wu?uC(a,"updateDoc",t._key,e,s,n):dC(a,"updateDoc",t._key,e),Yu(r,[o.toMutation(t._key,Zs.exists(!0))])}function xC(t){return Yu(As(t.firestore,cr),[new qp(t._key,Zs.none())])}function as(t,e){const s=As(t.firestore,cr),n=st(t),r=DN(t.converter,e);return Yu(s,[RN(Ku(t.firestore),"addDoc",n._key,r,t.converter!==null,{}).toMutation(n._key,Zs.exists(!1))]).then(()=>n)}function Vl(t,...e){var c,u,h;t=nt(t);let s={includeMetadataChanges:!1,source:"default"},n=0;typeof e[n]!="object"||Dy(e[n])||(s=e[n++]);const r={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Dy(e[n])){const m=e[n];e[n]=(c=m.next)==null?void 0:c.bind(m),e[n+1]=(u=m.error)==null?void 0:u.bind(m),e[n+2]=(h=m.complete)==null?void 0:h.bind(m)}let a,o,l;if(t instanceof wt)o=As(t.firestore,cr),l=Ou(t._key.path),a={next:m=>{e[n]&&e[n](BN(o,t,m))},error:e[n+1],complete:e[n+2]};else{const m=As(t,hr);o=As(m.firestore,cr),l=m._query;const f=new _g(o);a={next:y=>{e[n]&&e[n](new Ti(o,f,m,y))},error:e[n+1],complete:e[n+2]},$N(t._query)}return function(f,y,_,S){const R=new ug(S),k=new lg(y,R,_);return f.asyncQueue.enqueueAndForget(async()=>ig(await Zd(f),k)),()=>{R.Nu(),f.asyncQueue.enqueueAndForget(async()=>ag(await Zd(f),k))}}(qu(o),l,r,a)}function Yu(t,e){return function(n,r){const a=new er;return n.asyncQueue.enqueueAndForget(async()=>HA(await tC(n),r,a)),a.promise}(qu(t),e)}function BN(t,e,s){const n=s.docs.get(e._key),r=new _g(t);return new Ei(t,r,e._key,n,new qo(s.hasPendingWrites,s.fromCache),e.converter)}function qt(){return new mg("serverTimestamp")}function yC(t){return new fg("increment",t)}(function(e,s=!0){(function(r){ro=r})(Ji),xn(new sn("firestore",(n,{instanceIdentifier:r,options:a})=>{const o=n.getProvider("app").getImmediate(),l=new cr(new uE(n.getProvider("auth-internal")),new fE(o,n.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new oe(X.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Al(u.options.projectId,h)}(o,r),o);return a={useFetchStreams:s,...a},l._setSettings(a),l},"PUBLIC").setMultipleInstances(!0)),Ts(H0,q0,e),Ts(H0,q0,"esm2020")})();function zN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const vC=zN,HN=new Gi("auth","Firebase",zN());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tu=new Op("@firebase/auth");function bC(t,...e){tu.logLevel<=De.WARN&&tu.warn(`Auth (${Ji}): ${t}`,...e)}function hd(t,...e){tu.logLevel<=De.ERROR&&tu.error(`Auth (${Ji}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nn(t,...e){throw jg(t,...e)}function pn(t,...e){return jg(t,...e)}function Ng(t,e,s){const n={...vC(),[e]:s};return new Gi("auth","Firebase",n).create(e,{appName:t.name})}function $n(t){return Ng(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function qN(t,e,s){const n=s;if(!(e instanceof n))throw n.name!==e.constructor.name&&nn(t,"argument-error"),Ng(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function jg(t,...e){if(typeof t!="string"){const s=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=t.name),t._errorFactory.create(s,...n)}return HN.create(t,...e)}function Ie(t,e,...s){if(!t)throw jg(e,...s)}function Jn(t){const e="INTERNAL ASSERTION FAILED: "+t;throw hd(e),new Error(e)}function dr(t,e){t||Jn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ef(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function wC(){return zy()==="http:"||zy()==="https:"}function zy(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _C(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(wC()||BS()||"connection"in navigator)?navigator.onLine:!0}function NC(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,s){this.shortDelay=e,this.longDelay=s,dr(s>e,"Short delay should be less than long delay!"),this.isMobile=FS()||zS()}get(){return _C()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ig(t,e){dr(t.emulator,"Emulator should always be set here");const{url:s}=t.emulator;return e?`${s}${e.startsWith("/")?e.slice(1):e}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WN{static initialize(e,s,n){this.fetchImpl=e,s&&(this.headersImpl=s),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Jn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Jn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Jn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jC={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IC=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],SC=new tc(3e4,6e4);function mr(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Un(t,e,s,n,r={}){return KN(t,r,async()=>{let a={},o={};n&&(e==="GET"?o=n:a={body:JSON.stringify(n)});const l=Kl({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const u={method:e,headers:c,...a};return US()||(u.referrerPolicy="no-referrer"),t.emulatorConfig&&ii(t.emulatorConfig.host)&&(u.credentials="include"),WN.fetch()(await GN(t,t.config.apiHost,s,l),u)})}async function KN(t,e,s){t._canInitEmulator=!1;const n={...jC,...e};try{const r=new EC(t),a=await Promise.race([s(),r.promise]);r.clearNetworkTimeout();const o=await a.json();if("needConfirmation"in o)throw Dc(t,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{const l=a.ok?o.errorMessage:o.error.message,[c,u]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Dc(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Dc(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw Dc(t,"user-disabled",o);const h=n[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Ng(t,h,u);nn(t,h)}}catch(r){if(r instanceof vn)throw r;nn(t,"network-request-failed",{message:String(r)})}}async function sc(t,e,s,n,r={}){const a=await Un(t,e,s,n,r);return"mfaPendingCredential"in a&&nn(t,"multi-factor-auth-required",{_serverResponse:a}),a}async function GN(t,e,s,n){const r=`${e}${s}?${n}`,a=t,o=a.config.emulator?Ig(t.config,r):`${t.config.apiScheme}://${r}`;return IC.includes(s)&&(await a._persistenceManagerAvailable,a._getPersistenceType()==="COOKIE")?a._getPersistence()._getFinalTarget(o).toString():o}function kC(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class EC{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((s,n)=>{this.timer=setTimeout(()=>n(pn(this.auth,"network-request-failed")),SC.get())})}}function Dc(t,e,s){const n={appName:t.name};s.email&&(n.email=s.email),s.phoneNumber&&(n.phoneNumber=s.phoneNumber);const r=pn(t,e,n);return r.customData._tokenResponse=s,r}function Hy(t){return t!==void 0&&t.enterprise!==void 0}class TC{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===e)return kC(s.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function AC(t,e){return Un(t,"GET","/v2/recaptchaConfig",mr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CC(t,e){return Un(t,"POST","/v1/accounts:delete",e)}async function su(t,e){return Un(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ll(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function PC(t,e=!1){const s=nt(t),n=await s.getIdToken(e),r=Sg(n);Ie(r&&r.exp&&r.auth_time&&r.iat,s.auth,"internal-error");const a=typeof r.firebase=="object"?r.firebase:void 0,o=a==null?void 0:a.sign_in_provider;return{claims:r,token:n,authTime:ll(Yh(r.auth_time)),issuedAtTime:ll(Yh(r.iat)),expirationTime:ll(Yh(r.exp)),signInProvider:o||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function Yh(t){return Number(t)*1e3}function Sg(t){const[e,s,n]=t.split(".");if(e===void 0||s===void 0||n===void 0)return hd("JWT malformed, contained fewer than 3 sections"),null;try{const r=Xw(s);return r?JSON.parse(r):(hd("Failed to decode base64 JWT payload"),null)}catch(r){return hd("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function qy(t){const e=Sg(t);return Ie(e,"internal-error"),Ie(typeof e.exp<"u","internal-error"),Ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eo(t,e,s=!1){if(s)return e;try{return await e}catch(n){throw n instanceof vn&&RC(n)&&t.auth.currentUser===t&&await t.auth.signOut(),n}}function RC({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MC{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const s=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e,s){this.createdAt=e,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=ll(this.lastLoginAt),this.creationTime=ll(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nu(t){var m;const e=t.auth,s=await t.getIdToken(),n=await eo(t,su(e,{idToken:s}));Ie(n==null?void 0:n.users.length,e,"internal-error");const r=n.users[0];t._notifyReloadListener(r);const a=(m=r.providerUserInfo)!=null&&m.length?QN(r.providerUserInfo):[],o=LC(t.providerData,a),l=t.isAnonymous,c=!(t.email&&r.passwordHash)&&!(o!=null&&o.length),u=l?c:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new Tf(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(t,h)}async function OC(t){const e=nt(t);await nu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function LC(t,e){return[...t.filter(n=>!e.some(r=>r.providerId===n.providerId)),...e]}function QN(t){return t.map(({providerId:e,...s})=>({providerId:e,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VC(t,e){const s=await KN(t,{},async()=>{const n=Kl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:a}=t.config,o=await GN(t,r,"/v1/token",`key=${a}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:n};return t.emulatorConfig&&ii(t.emulatorConfig.host)&&(c.credentials="include"),WN.fetch()(o,c)});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function $C(t,e){return Un(t,"POST","/v2/accounts:revokeToken",mr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Va{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ie(e.idToken,"internal-error"),Ie(typeof e.idToken<"u","internal-error"),Ie(typeof e.refreshToken<"u","internal-error");const s="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):qy(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,s)}updateFromIdToken(e){Ie(e.length!==0,"internal-error");const s=qy(e);this.updateTokensAndExpiration(e,null,s)}async getToken(e,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Ie(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,s){const{accessToken:n,refreshToken:r,expiresIn:a}=await VC(e,s);this.updateTokensAndExpiration(n,r,Number(a))}updateTokensAndExpiration(e,s,n){this.refreshToken=s||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,s){const{refreshToken:n,accessToken:r,expirationTime:a}=s,o=new Va;return n&&(Ie(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),r&&(Ie(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),a&&(Ie(typeof a=="number","internal-error",{appName:e}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Va,this.toJSON())}_performRefresh(){return Jn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _r(t,e){Ie(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class hn{constructor({uid:e,auth:s,stsTokenManager:n,...r}){this.providerId="firebase",this.proactiveRefresh=new MC(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=s,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Tf(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const s=await eo(this,this.stsTokenManager.getToken(this.auth,e));return Ie(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(e){return PC(this,e)}reload(){return OC(this)}_assign(e){this!==e&&(Ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(s=>({...s})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const s=new hn({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return s.metadata._copy(this.metadata),s}_onReload(e){Ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,s=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),s&&await nu(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(hs(this.auth.app))return Promise.reject($n(this.auth));const e=await this.getIdToken();return await eo(this,CC(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,s){const n=s.displayName??void 0,r=s.email??void 0,a=s.phoneNumber??void 0,o=s.photoURL??void 0,l=s.tenantId??void 0,c=s._redirectEventId??void 0,u=s.createdAt??void 0,h=s.lastLoginAt??void 0,{uid:m,emailVerified:f,isAnonymous:y,providerData:_,stsTokenManager:S}=s;Ie(m&&S,e,"internal-error");const R=Va.fromJSON(this.name,S);Ie(typeof m=="string",e,"internal-error"),_r(n,e.name),_r(r,e.name),Ie(typeof f=="boolean",e,"internal-error"),Ie(typeof y=="boolean",e,"internal-error"),_r(a,e.name),_r(o,e.name),_r(l,e.name),_r(c,e.name),_r(u,e.name),_r(h,e.name);const k=new hn({uid:m,auth:e,email:r,emailVerified:f,displayName:n,isAnonymous:y,photoURL:o,phoneNumber:a,tenantId:l,stsTokenManager:R,createdAt:u,lastLoginAt:h});return _&&Array.isArray(_)&&(k.providerData=_.map(x=>({...x}))),c&&(k._redirectEventId=c),k}static async _fromIdTokenResponse(e,s,n=!1){const r=new Va;r.updateFromServerResponse(s);const a=new hn({uid:s.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await nu(a),a}static async _fromGetAccountInfoResponse(e,s,n){const r=s.users[0];Ie(r.localId!==void 0,"internal-error");const a=r.providerUserInfo!==void 0?QN(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(a!=null&&a.length),l=new Va;l.updateFromIdToken(n);const c=new hn({uid:r.localId,auth:e,stsTokenManager:l,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Tf(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(a!=null&&a.length)};return Object.assign(c,u),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wy=new Map;function Yn(t){dr(t instanceof Function,"Expected a class definition");let e=Wy.get(t);return e?(dr(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Wy.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JN{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,s){this.storage[e]=s}async _get(e){const s=this.storage[e];return s===void 0?null:s}async _remove(e){delete this.storage[e]}_addListener(e,s){}_removeListener(e,s){}}JN.type="NONE";const Ky=JN;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function md(t,e,s){return`firebase:${t}:${e}:${s}`}class $a{constructor(e,s,n){this.persistence=e,this.auth=s,this.userKey=n;const{config:r,name:a}=this.auth;this.fullUserKey=md(this.userKey,r.apiKey,a),this.fullPersistenceKey=md("persistence",r.apiKey,a),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const s=await su(this.auth,{idToken:e}).catch(()=>{});return s?hn._fromGetAccountInfoResponse(this.auth,s,e):null}return hn._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,s,n="authUser"){if(!s.length)return new $a(Yn(Ky),e,n);const r=(await Promise.all(s.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let a=r[0]||Yn(Ky);const o=md(n,e.config.apiKey,e.name);let l=null;for(const u of s)try{const h=await u._get(o);if(h){let m;if(typeof h=="string"){const f=await su(e,{idToken:h}).catch(()=>{});if(!f)break;m=await hn._fromGetAccountInfoResponse(e,f,h)}else m=hn._fromJSON(e,h);u!==a&&(l=m),a=u;break}}catch{}const c=r.filter(u=>u._shouldAllowMigration);return!a._shouldAllowMigration||!c.length?new $a(a,e,n):(a=c[0],l&&await a._set(o,l.toJSON()),await Promise.all(s.map(async u=>{if(u!==a)try{await u._remove(o)}catch{}})),new $a(a,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gy(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(e1(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(YN(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(s1(e))return"Blackberry";if(n1(e))return"Webos";if(XN(e))return"Safari";if((e.includes("chrome/")||ZN(e))&&!e.includes("edge/"))return"Chrome";if(t1(e))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(s);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function YN(t=cs()){return/firefox\//i.test(t)}function XN(t=cs()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ZN(t=cs()){return/crios\//i.test(t)}function e1(t=cs()){return/iemobile/i.test(t)}function t1(t=cs()){return/android/i.test(t)}function s1(t=cs()){return/blackberry/i.test(t)}function n1(t=cs()){return/webos/i.test(t)}function kg(t=cs()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function FC(t=cs()){var e;return kg(t)&&!!((e=window.navigator)!=null&&e.standalone)}function DC(){return HS()&&document.documentMode===10}function r1(t=cs()){return kg(t)||t1(t)||n1(t)||s1(t)||/windows phone/i.test(t)||e1(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i1(t,e=[]){let s;switch(t){case"Browser":s=Gy(cs());break;case"Worker":s=`${Gy(cs())}-${t}`;break;default:s=t}const n=e.length?e.join(","):"FirebaseCore-web";return`${s}/JsCore/${Ji}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UC{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,s){const n=a=>new Promise((o,l)=>{try{const c=e(a);o(c)}catch(c){l(c)}});n.onAbort=s,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const s=[];try{for(const n of this.queue)await n(e),n.onAbort&&s.push(n.onAbort)}catch(n){s.reverse();for(const r of s)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BC(t,e={}){return Un(t,"GET","/v2/passwordPolicy",mr(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zC=6;class HC{constructor(e){var n;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=s.minPasswordLength??zC,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((n=e.allowedNonAlphanumericCharacters)==null?void 0:n.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,s),this.validatePasswordCharacterOptions(e,s),s.isValid&&(s.isValid=s.meetsMinPasswordLength??!0),s.isValid&&(s.isValid=s.meetsMaxPasswordLength??!0),s.isValid&&(s.isValid=s.containsLowercaseLetter??!0),s.isValid&&(s.isValid=s.containsUppercaseLetter??!0),s.isValid&&(s.isValid=s.containsNumericCharacter??!0),s.isValid&&(s.isValid=s.containsNonAlphanumericCharacter??!0),s}validatePasswordLengthOptions(e,s){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(s.meetsMinPasswordLength=e.length>=n),r&&(s.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let n;for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(s,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,s,n,r,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{constructor(e,s,n,r){this.app=e,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Qy(this),this.idTokenSubscription=new Qy(this),this.beforeStateQueue=new UC(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=HN,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(e,s){return s&&(this._popupRedirectResolver=Yn(s)),this._initializationPromise=this.queue(async()=>{var n,r,a;if(!this._deleted&&(this.persistenceManager=await $a.create(this,e),(n=this._resolvePersistenceManagerAvailable)==null||n.call(this),!this._deleted)){if((r=this._popupRedirectResolver)!=null&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((a=this.currentUser)==null?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const s=await su(this,{idToken:e}),n=await hn._fromGetAccountInfoResponse(this,s,e);await this.directlySetCurrentUser(n)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var a;if(hs(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let n=s,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(a=this.redirectUser)==null?void 0:a._redirectEventId,l=n==null?void 0:n._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(n=c.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(o){n=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(e){try{await nu(e)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=NC()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(hs(this.app))return Promise.reject($n(this));const s=e?nt(e):null;return s&&Ie(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(e,s=!1){if(!this._deleted)return e&&Ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return hs(this.app)?Promise.reject($n(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return hs(this.app)?Promise.reject($n(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Yn(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await BC(this),s=new HC(e);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Gi("auth","Firebase",e())}onAuthStateChanged(e,s,n){return this.registerStateListener(this.authStateSubscription,e,s,n)}beforeAuthStateChanged(e,s){return this.beforeStateQueue.pushCallback(e,s)}onIdTokenChanged(e,s,n){return this.registerStateListener(this.idTokenSubscription,e,s,n)}authStateReady(){return new Promise((e,s)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},s)}})}async revokeAccessToken(e){if(this.currentUser){const s=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:s};this.tenantId!=null&&(n.tenantId=this.tenantId),await $C(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,s){const n=await this.getOrInitRedirectPersistenceManager(s);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const s=e&&Yn(e)||this._popupRedirectResolver;Ie(s,this,"argument-error"),this.redirectPersistenceManager=await $a.create(this,[Yn(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var s,n;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)==null?void 0:s._redirectEventId)===e?this._currentUser:((n=this.redirectUser)==null?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((s=this.currentUser)==null?void 0:s.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,s,n,r){if(this._deleted)return()=>{};const a=typeof s=="function"?s:s.next.bind(s);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ie(l,this,"internal-error"),l.then(()=>{o||a(this.currentUser)}),typeof s=="function"){const c=e.addObserver(s,n,r);return()=>{o=!0,c()}}else{const c=e.addObserver(s);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=i1(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var r;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const s=await((r=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:r.getHeartbeatsHeader());s&&(e["X-Firebase-Client"]=s);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){var s;if(hs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((s=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getToken());return e!=null&&e.error&&bC(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function bn(t){return nt(t)}class Qy{constructor(e){this.auth=e,this.observer=null,this.addObserver=YS(s=>this.observer=s)}get next(){return Ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function WC(t){Xu=t}function a1(t){return Xu.loadJS(t)}function KC(){return Xu.recaptchaEnterpriseScript}function GC(){return Xu.gapiScript}function QC(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class JC{constructor(){this.enterprise=new YC}ready(e){e()}execute(e,s){return Promise.resolve("token")}render(e,s){return""}}class YC{ready(e){e()}execute(e,s){return Promise.resolve("token")}render(e,s){return""}}const XC="recaptcha-enterprise",o1="NO_RECAPTCHA";class ZC{constructor(e){this.type=XC,this.auth=bn(e)}async verify(e="verify",s=!1){async function n(a){if(!s){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(o,l)=>{AC(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const u=new TC(c);return a.tenantId==null?a._agentRecaptchaConfig=u:a._tenantRecaptchaConfigs[a.tenantId]=u,o(u.siteKey)}}).catch(c=>{l(c)})})}function r(a,o,l){const c=window.grecaptcha;Hy(c)?c.enterprise.ready(()=>{c.enterprise.execute(a,{action:e}).then(u=>{o(u)}).catch(()=>{o(o1)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new JC().execute("siteKey",{action:"verify"}):new Promise((a,o)=>{n(this.auth).then(l=>{if(!s&&Hy(window.grecaptcha))r(l,a,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=KC();c.length!==0&&(c+=l),a1(c).then(()=>{r(l,a,o)}).catch(u=>{o(u)})}}).catch(l=>{o(l)})})}}async function Jy(t,e,s,n=!1,r=!1){const a=new ZC(t);let o;if(r)o=o1;else try{o=await a.verify(s)}catch{o=await a.verify(s,!0)}const l={...e};if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,u=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return n?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function ru(t,e,s,n,r){var a;if((a=t._getRecaptchaConfig())!=null&&a.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Jy(t,e,s,s==="getOobCode");return n(t,o)}else return n(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Jy(t,e,s,s==="getOobCode");return n(t,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eP(t,e){const s=Qi(t,"auth");if(s.isInitialized()){const r=s.getImmediate(),a=s.getOptions();if(Vi(a,e??{}))return r;nn(r,"already-initialized")}return s.initialize({options:e})}function tP(t,e){const s=(e==null?void 0:e.persistence)||[],n=(Array.isArray(s)?s:[s]).map(Yn);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function sP(t,e,s){const n=bn(t);Ie(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const r=!1,a=l1(e),{host:o,port:l}=nP(e),c=l===null?"":`:${l}`,u={url:`${a}//${o}${c}/`},h=Object.freeze({host:o,port:l,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!n._canInitEmulator){Ie(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),Ie(Vi(u,n.config.emulator)&&Vi(h,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=u,n.emulatorConfig=h,n.settings.appVerificationDisabledForTesting=!0,ii(o)?(Rp(`${a}//${o}${c}`),Mp("Auth",!0)):rP()}function l1(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function nP(t){const e=l1(t),s=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!s)return{host:"",port:null};const n=s[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(n);if(r){const a=r[1];return{host:a,port:Yy(n.substr(a.length+1))}}else{const[a,o]=n.split(":");return{host:a,port:Yy(o)}}}function Yy(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function rP(){function t(){const e=document.createElement("p"),s=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg{constructor(e,s){this.providerId=e,this.signInMethod=s}toJSON(){return Jn("not implemented")}_getIdTokenResponse(e){return Jn("not implemented")}_linkToIdToken(e,s){return Jn("not implemented")}_getReauthenticationResolver(e){return Jn("not implemented")}}async function iP(t,e){return Un(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aP(t,e){return sc(t,"POST","/v1/accounts:signInWithPassword",mr(t,e))}async function oP(t,e){return Un(t,"POST","/v1/accounts:sendOobCode",mr(t,e))}async function lP(t,e){return oP(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cP(t,e){return sc(t,"POST","/v1/accounts:signInWithEmailLink",mr(t,e))}async function dP(t,e){return sc(t,"POST","/v1/accounts:signInWithEmailLink",mr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l extends Eg{constructor(e,s,n,r=null){super("password",n),this._email=e,this._password=s,this._tenantId=r}static _fromEmailAndPassword(e,s){return new $l(e,s,"password")}static _fromEmailAndCode(e,s,n=null){return new $l(e,s,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ru(e,s,"signInWithPassword",aP);case"emailLink":return cP(e,{email:this._email,oobCode:this._password});default:nn(e,"internal-error")}}async _linkToIdToken(e,s){switch(this.signInMethod){case"password":const n={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ru(e,n,"signUpPassword",iP);case"emailLink":return dP(e,{idToken:s,email:this._email,oobCode:this._password});default:nn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fa(t,e){return sc(t,"POST","/v1/accounts:signInWithIdp",mr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uP="http://localhost";class Di extends Eg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const s=new Di(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(s.idToken=e.idToken),e.accessToken&&(s.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(s.nonce=e.nonce),e.pendingToken&&(s.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(s.accessToken=e.oauthToken,s.secret=e.oauthTokenSecret):nn("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:r,...a}=s;if(!n||!r)return null;const o=new Di(n,r);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}_getIdTokenResponse(e){const s=this.buildRequest();return Fa(e,s)}_linkToIdToken(e,s){const n=this.buildRequest();return n.idToken=s,Fa(e,n)}_getReauthenticationResolver(e){const s=this.buildRequest();return s.autoCreate=!1,Fa(e,s)}buildRequest(){const e={requestUri:uP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),e.postBody=Kl(s)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hP(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function mP(t){const e=Do(Uo(t)).link,s=e?Do(Uo(e)).deep_link_id:null,n=Do(Uo(t)).deep_link_id;return(n?Do(Uo(n)).link:null)||n||s||e||t}class Tg{constructor(e){const s=Do(Uo(e)),n=s.apiKey??null,r=s.oobCode??null,a=hP(s.mode??null);Ie(n&&r&&a,"argument-error"),this.apiKey=n,this.operation=a,this.code=r,this.continueUrl=s.continueUrl??null,this.languageCode=s.lang??null,this.tenantId=s.tenantId??null}static parseLink(e){const s=mP(e);try{return new Tg(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(){this.providerId=co.PROVIDER_ID}static credential(e,s){return $l._fromEmailAndPassword(e,s)}static credentialWithLink(e,s){const n=Tg.parseLink(s);return Ie(n,"argument-error"),$l._fromEmailAndCode(e,n.code,n.tenantId)}}co.PROVIDER_ID="password";co.EMAIL_PASSWORD_SIGN_IN_METHOD="password";co.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc extends Zu{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Er extends nc{constructor(){super("facebook.com")}static credential(e){return Di._fromParams({providerId:Er.PROVIDER_ID,signInMethod:Er.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Er.credentialFromTaggedObject(e)}static credentialFromError(e){return Er.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Er.credential(e.oauthAccessToken)}catch{return null}}}Er.FACEBOOK_SIGN_IN_METHOD="facebook.com";Er.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn extends nc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,s){return Di._fromParams({providerId:Kn.PROVIDER_ID,signInMethod:Kn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:s})}static credentialFromResult(e){return Kn.credentialFromTaggedObject(e)}static credentialFromError(e){return Kn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:s,oauthAccessToken:n}=e;if(!s&&!n)return null;try{return Kn.credential(s,n)}catch{return null}}}Kn.GOOGLE_SIGN_IN_METHOD="google.com";Kn.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr extends nc{constructor(){super("github.com")}static credential(e){return Di._fromParams({providerId:Tr.PROVIDER_ID,signInMethod:Tr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Tr.credentialFromTaggedObject(e)}static credentialFromError(e){return Tr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Tr.credential(e.oauthAccessToken)}catch{return null}}}Tr.GITHUB_SIGN_IN_METHOD="github.com";Tr.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar extends nc{constructor(){super("twitter.com")}static credential(e,s){return Di._fromParams({providerId:Ar.PROVIDER_ID,signInMethod:Ar.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:s})}static credentialFromResult(e){return Ar.credentialFromTaggedObject(e)}static credentialFromError(e){return Ar.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:s,oauthTokenSecret:n}=e;if(!s||!n)return null;try{return Ar.credential(s,n)}catch{return null}}}Ar.TWITTER_SIGN_IN_METHOD="twitter.com";Ar.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fP(t,e){return sc(t,"POST","/v1/accounts:signUp",mr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,s,n,r=!1){const a=await hn._fromIdTokenResponse(e,n,r),o=Xy(n);return new Ui({user:a,providerId:o,_tokenResponse:n,operationType:s})}static async _forOperation(e,s,n){await e._updateTokensIfNecessary(n,!0);const r=Xy(n);return new Ui({user:e,providerId:r,_tokenResponse:n,operationType:s})}}function Xy(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iu extends vn{constructor(e,s,n,r){super(s.code,s.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,iu.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:s.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,s,n,r){return new iu(e,s,n,r)}}function c1(t,e,s,n){return(e==="reauthenticate"?s._getReauthenticationResolver(t):s._getIdTokenResponse(t)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?iu._fromErrorAndOperation(t,a,e,n):a})}async function pP(t,e,s=!1){const n=await eo(t,e._linkToIdToken(t.auth,await t.getIdToken()),s);return Ui._forOperation(t,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gP(t,e,s=!1){const{auth:n}=t;if(hs(n.app))return Promise.reject($n(n));const r="reauthenticate";try{const a=await eo(t,c1(n,r,e,t),s);Ie(a.idToken,n,"internal-error");const o=Sg(a.idToken);Ie(o,n,"internal-error");const{sub:l}=o;return Ie(t.uid===l,n,"user-mismatch"),Ui._forOperation(t,r,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&nn(n,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d1(t,e,s=!1){if(hs(t.app))return Promise.reject($n(t));const n="signIn",r=await c1(t,n,e),a=await Ui._fromIdTokenResponse(t,n,r);return s||await t._updateCurrentUser(a.user),a}async function xP(t,e){return d1(bn(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u1(t){const e=bn(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function yP(t,e,s){const n=bn(t);await ru(n,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",lP)}async function vP(t,e,s){if(hs(t.app))return Promise.reject($n(t));const n=bn(t),o=await ru(n,{returnSecureToken:!0,email:e,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",fP).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&u1(t),c}),l=await Ui._fromIdTokenResponse(n,"signIn",o);return await n._updateCurrentUser(l.user),l}function bP(t,e,s){return hs(t.app)?Promise.reject($n(t)):xP(nt(t),co.credential(e,s)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&u1(t),n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wP(t,e){return Un(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _P(t,{displayName:e,photoURL:s}){if(e===void 0&&s===void 0)return;const n=nt(t),a={idToken:await n.getIdToken(),displayName:e,photoUrl:s,returnSecureToken:!0},o=await eo(n,wP(n.auth,a));n.displayName=o.displayName||null,n.photoURL=o.photoUrl||null;const l=n.providerData.find(({providerId:c})=>c==="password");l&&(l.displayName=n.displayName,l.photoURL=n.photoURL),await n._updateTokensIfNecessary(o)}function NP(t,e,s,n){return nt(t).onIdTokenChanged(e,s,n)}function jP(t,e,s){return nt(t).beforeAuthStateChanged(e,s)}function IP(t,e,s,n){return nt(t).onAuthStateChanged(e,s,n)}function SP(t){return nt(t).signOut()}const au="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h1{constructor(e,s){this.storageRetriever=e,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(au,"1"),this.storage.removeItem(au),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,s){return this.storage.setItem(e,JSON.stringify(s)),Promise.resolve()}_get(e){const s=this.storage.getItem(e);return Promise.resolve(s?JSON.parse(s):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kP=1e3,EP=10;class m1 extends h1{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,s)=>this.onStorageEvent(e,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=r1(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const s of Object.keys(this.listeners)){const n=this.storage.getItem(s),r=this.localCache[s];n!==r&&e(s,r,n)}}onStorageEvent(e,s=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const n=e.key;s?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(n);!s&&this.localCache[n]===o||this.notifyListeners(n,o)},a=this.storage.getItem(n);DC()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,EP):r()}notifyListeners(e,s){this.localCache[e]=s;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,s,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:s,newValue:n}),!0)})},kP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,s){await super._set(e,s),this.localCache[e]=JSON.stringify(s)}async _get(e){const s=await super._get(e);return this.localCache[e]=JSON.stringify(s),s}async _remove(e){await super._remove(e),delete this.localCache[e]}}m1.type="LOCAL";const TP=m1;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f1 extends h1{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,s){}_removeListener(e,s){}}f1.type="SESSION";const p1=f1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AP(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const s=this.receivers.find(r=>r.isListeningto(e));if(s)return s;const n=new eh(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const s=e,{eventId:n,eventType:r,data:a}=s.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;s.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const l=Array.from(o).map(async u=>u(s.origin,a)),c=await AP(l);s.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:c})}_subscribe(e,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(s)}_unsubscribe(e,s){this.handlersMap[e]&&s&&this.handlersMap[e].delete(s),(!s||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}eh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ag(t="",e=10){let s="";for(let n=0;n<e;n++)s+=Math.floor(Math.random()*10);return t+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,s,n=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let a,o;return new Promise((l,c)=>{const u=Ag("",20);r.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},n);o={messageChannel:r,onMessage(m){const f=m;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(h),a=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),l(f.data.response);break;default:clearTimeout(h),clearTimeout(a),c(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:s},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fn(){return window}function PP(t){Fn().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g1(){return typeof Fn().WorkerGlobalScope<"u"&&typeof Fn().importScripts=="function"}async function RP(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function MP(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function OP(){return g1()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x1="firebaseLocalStorageDb",LP=1,ou="firebaseLocalStorage",y1="fbase_key";class rc{constructor(e){this.request=e}toPromise(){return new Promise((e,s)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function th(t,e){return t.transaction([ou],e?"readwrite":"readonly").objectStore(ou)}function VP(){const t=indexedDB.deleteDatabase(x1);return new rc(t).toPromise()}function Af(){const t=indexedDB.open(x1,LP);return new Promise((e,s)=>{t.addEventListener("error",()=>{s(t.error)}),t.addEventListener("upgradeneeded",()=>{const n=t.result;try{n.createObjectStore(ou,{keyPath:y1})}catch(r){s(r)}}),t.addEventListener("success",async()=>{const n=t.result;n.objectStoreNames.contains(ou)?e(n):(n.close(),await VP(),e(await Af()))})})}async function Zy(t,e,s){const n=th(t,!0).put({[y1]:e,value:s});return new rc(n).toPromise()}async function $P(t,e){const s=th(t,!1).get(e),n=await new rc(s).toPromise();return n===void 0?null:n.value}function ev(t,e){const s=th(t,!0).delete(e);return new rc(s).toPromise()}const FP=800,DP=3;class v1{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Af(),this.db)}async _withRetries(e){let s=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(s++>DP)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return g1()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=eh._getInstance(OP()),this.receiver._subscribe("keyChanged",async(e,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(e,s)=>["keyChanged"])}async initializeSender(){var s,n;if(this.activeServiceWorker=await RP(),!this.activeServiceWorker)return;this.sender=new CP(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(s=e[0])!=null&&s.fulfilled&&(n=e[0])!=null&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||MP()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Af();return await Zy(e,au,"1"),await ev(e,au),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,s){return this._withPendingWrite(async()=>(await this._withRetries(n=>Zy(n,e,s)),this.localCache[e]=s,this.notifyServiceWorker(e)))}async _get(e){const s=await this._withRetries(n=>$P(n,e));return this.localCache[e]=s,s}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(s=>ev(s,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const a=th(r,!1).getAll();return new rc(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const s=[],n=new Set;if(e.length!==0)for(const{fbase_key:r,value:a}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(a)&&(this.notifyListeners(r,a),s.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),s.push(r));return s}notifyListeners(e,s){this.localCache[e]=s;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),FP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}v1.type="LOCAL";const UP=v1;new tc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cg(t,e){return e?Yn(e):(Ie(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg extends Eg{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Fa(e,this._buildIdpRequest())}_linkToIdToken(e,s){return Fa(e,this._buildIdpRequest(s))}_getReauthenticationResolver(e){return Fa(e,this._buildIdpRequest())}_buildIdpRequest(e){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(s.idToken=e),s}}function BP(t){return d1(t.auth,new Pg(t),t.bypassAuthState)}function zP(t){const{auth:e,user:s}=t;return Ie(s,e,"internal-error"),gP(s,new Pg(t),t.bypassAuthState)}async function HP(t){const{auth:e,user:s}=t;return Ie(s,e,"internal-error"),pP(s,new Pg(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b1{constructor(e,s,n,r,a=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(e,s)=>{this.pendingPromise={resolve:e,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:s,sessionId:n,postBody:r,tenantId:a,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:s,sessionId:n,tenantId:a||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return BP;case"linkViaPopup":case"linkViaRedirect":return HP;case"reauthViaPopup":case"reauthViaRedirect":return zP;default:nn(this.auth,"internal-error")}}resolve(e){dr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){dr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qP=new tc(2e3,1e4);async function WP(t,e,s){if(hs(t.app))return Promise.reject(pn(t,"operation-not-supported-in-this-environment"));const n=bn(t);qN(t,e,Zu);const r=Cg(n,s);return new ji(n,"signInViaPopup",e,r).executeNotNull()}class ji extends b1{constructor(e,s,n,r,a){super(e,s,r,a),this.provider=n,this.authWindow=null,this.pollId=null,ji.currentPopupAction&&ji.currentPopupAction.cancel(),ji.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ie(e,this.auth,"internal-error"),e}async onExecution(){dr(this.filter.length===1,"Popup operations only handle one event");const e=Ag();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(pn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(pn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ji.currentPopupAction=null}pollUserCancellation(){const e=()=>{var s,n;if((n=(s=this.authWindow)==null?void 0:s.window)!=null&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(pn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,qP.get())};e()}}ji.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KP="pendingRedirect",fd=new Map;class GP extends b1{constructor(e,s,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,n),this.eventId=null}async execute(){let e=fd.get(this.auth._key());if(!e){try{const n=await QP(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(s){e=()=>Promise.reject(s)}fd.set(this.auth._key(),e)}return this.bypassAuthState||fd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const s=await this.auth._redirectUserForId(e.eventId);if(s)return this.user=s,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function QP(t,e){const s=_1(e),n=w1(t);if(!await n._isAvailable())return!1;const r=await n._get(s)==="true";return await n._remove(s),r}async function JP(t,e){return w1(t)._set(_1(e),"true")}function YP(t,e){fd.set(t._key(),e)}function w1(t){return Yn(t._redirectPersistence)}function _1(t){return md(KP,t.config.apiKey,t.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XP(t,e,s){return ZP(t,e,s)}async function ZP(t,e,s){if(hs(t.app))return Promise.reject($n(t));const n=bn(t);qN(t,e,Zu),await n._initializationPromise;const r=Cg(n,s);return await JP(r,n),r._openRedirect(n,e,"signInViaRedirect")}async function e4(t,e){return await bn(t)._initializationPromise,N1(t,e,!1)}async function N1(t,e,s=!1){if(hs(t.app))return Promise.reject($n(t));const n=bn(t),r=Cg(n,e),o=await new GP(n,r,s).execute();return o&&!s&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t4=10*60*1e3;class s4{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let s=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(s=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!n4(e)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=e,s=!0)),s}sendToConsumer(e,s){var n;if(e.error&&!j1(e)){const r=((n=e.error.code)==null?void 0:n.split("auth/")[1])||"internal-error";s.onError(pn(this.auth,r))}else s.onAuthEvent(e)}isEventForConsumer(e,s){const n=s.eventId===null||!!e.eventId&&e.eventId===s.eventId;return s.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=t4&&this.cachedEventUids.clear(),this.cachedEventUids.has(tv(e))}saveEventToCache(e){this.cachedEventUids.add(tv(e)),this.lastProcessedEventTime=Date.now()}}function tv(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function j1({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function n4(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return j1(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r4(t,e={}){return Un(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i4=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,a4=/^https?/;async function o4(t){if(t.config.emulator)return;const{authorizedDomains:e}=await r4(t);for(const s of e)try{if(l4(s))return}catch{}nn(t,"unauthorized-domain")}function l4(t){const e=Ef(),{protocol:s,hostname:n}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&n===""?s==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):s==="chrome-extension:"&&o.hostname===n}if(!a4.test(s))return!1;if(i4.test(t))return n===t;const r=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c4=new tc(3e4,6e4);function sv(){const t=Fn().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let s=0;s<t.CP.length;s++)t.CP[s]=null}}function d4(t){return new Promise((e,s)=>{var r,a,o;function n(){sv(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{sv(),s(pn(t,"network-request-failed"))},timeout:c4.get()})}if((a=(r=Fn().gapi)==null?void 0:r.iframes)!=null&&a.Iframe)e(gapi.iframes.getContext());else if((o=Fn().gapi)!=null&&o.load)n();else{const l=QC("iframefcb");return Fn()[l]=()=>{gapi.load?n():s(pn(t,"network-request-failed"))},a1(`${GC()}?onload=${l}`).catch(c=>s(c))}}).catch(e=>{throw pd=null,e})}let pd=null;function u4(t){return pd=pd||d4(t),pd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h4=new tc(5e3,15e3),m4="__/auth/iframe",f4="emulator/auth/iframe",p4={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},g4=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function x4(t){const e=t.config;Ie(e.authDomain,t,"auth-domain-config-required");const s=e.emulator?Ig(e,f4):`https://${t.config.authDomain}/${m4}`,n={apiKey:e.apiKey,appName:t.name,v:Ji},r=g4.get(t.config.apiHost);r&&(n.eid=r);const a=t._getFrameworks();return a.length&&(n.fw=a.join(",")),`${s}?${Kl(n).slice(1)}`}async function y4(t){const e=await u4(t),s=Fn().gapi;return Ie(s,t,"internal-error"),e.open({where:document.body,url:x4(t),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:p4,dontclear:!0},n=>new Promise(async(r,a)=>{await n.restyle({setHideOnLeave:!1});const o=pn(t,"network-request-failed"),l=Fn().setTimeout(()=>{a(o)},h4.get());function c(){Fn().clearTimeout(l),r(n)}n.ping(c).then(c,()=>{a(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v4={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},b4=500,w4=600,_4="_blank",N4="http://localhost";class nv{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function j4(t,e,s,n=b4,r=w4){const a=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let l="";const c={...v4,width:n.toString(),height:r.toString(),top:a,left:o},u=cs().toLowerCase();s&&(l=ZN(u)?_4:s),YN(u)&&(e=e||N4,c.scrollbars="yes");const h=Object.entries(c).reduce((f,[y,_])=>`${f}${y}=${_},`,"");if(FC(u)&&l!=="_self")return I4(e||"",l),new nv(null);const m=window.open(e||"",l,h);Ie(m,t,"popup-blocked");try{m.focus()}catch{}return new nv(m)}function I4(t,e){const s=document.createElement("a");s.href=t,s.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S4="__/auth/handler",k4="emulator/auth/handler",E4=encodeURIComponent("fac");async function rv(t,e,s,n,r,a){Ie(t.config.authDomain,t,"auth-domain-config-required"),Ie(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:s,redirectUrl:n,v:Ji,eventId:r};if(e instanceof Zu){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",JS(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,m]of Object.entries({}))o[h]=m}if(e instanceof nc){const h=e.getScopes().filter(m=>m!=="");h.length>0&&(o.scopes=h.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const h of Object.keys(l))l[h]===void 0&&delete l[h];const c=await t._getAppCheckToken(),u=c?`#${E4}=${encodeURIComponent(c)}`:"";return`${T4(t)}?${Kl(l).slice(1)}${u}`}function T4({config:t}){return t.emulator?Ig(t,k4):`https://${t.authDomain}/${S4}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xh="webStorageSupport";class A4{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=p1,this._completeRedirectFn=N1,this._overrideRedirectResult=YP}async _openPopup(e,s,n,r){var o;dr((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const a=await rv(e,s,n,Ef(),r);return j4(e,a,Ag())}async _openRedirect(e,s,n,r){await this._originValidation(e);const a=await rv(e,s,n,Ef(),r);return PP(a),new Promise(()=>{})}_initialize(e){const s=e._key();if(this.eventManagers[s]){const{manager:r,promise:a}=this.eventManagers[s];return r?Promise.resolve(r):(dr(a,"If manager is not set, promise should be"),a)}const n=this.initAndGetManager(e);return this.eventManagers[s]={promise:n},n.catch(()=>{delete this.eventManagers[s]}),n}async initAndGetManager(e){const s=await y4(e),n=new s4(e);return s.register("authEvent",r=>(Ie(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:n.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=s,n}_isIframeWebStorageSupported(e,s){this.iframes[e._key()].send(Xh,{type:Xh},r=>{var o;const a=(o=r==null?void 0:r[0])==null?void 0:o[Xh];a!==void 0&&s(!!a),nn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const s=e._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=o4(e)),this.originValidationPromises[s]}get _shouldInitProactively(){return r1()||XN()||kg()}}const C4=A4;var iv="@firebase/auth",av="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P4{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const s=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,s),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const s=this.internalListeners.get(e);s&&(this.internalListeners.delete(e),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R4(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function M4(t){xn(new sn("auth",(e,{options:s})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=n.options;Ie(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:i1(t)},u=new qC(n,r,a,c);return tP(u,s),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,s,n)=>{e.getProvider("auth-internal").initialize()})),xn(new sn("auth-internal",e=>{const s=bn(e.getProvider("auth").getImmediate());return(n=>new P4(n))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ts(iv,av,R4(t)),Ts(iv,av,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O4=5*60,L4=s_("authIdTokenMaxAge")||O4;let ov=null;const V4=t=>async e=>{const s=e&&await e.getIdTokenResult(),n=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(n&&n>L4)return;const r=s==null?void 0:s.token;ov!==r&&(ov=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function $4(t=Au()){const e=Qi(t,"auth");if(e.isInitialized())return e.getImmediate();const s=eP(t,{popupRedirectResolver:C4,persistence:[UP,TP,p1]}),n=s_("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const a=new URL(n,location.origin);if(location.origin===a.origin){const o=V4(a.toString());jP(s,o,()=>o(s.currentUser)),NP(s,l=>o(l))}}const r=Zw("auth");return r&&sP(s,`http://${r}`),s}function F4(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}WC({loadJS(t){return new Promise((e,s)=>{const n=document.createElement("script");n.setAttribute("src",t),n.onload=e,n.onerror=r=>{const a=pn("internal-error");a.customData=r,s(a)},n.type="text/javascript",n.charset="UTF-8",F4().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});M4("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I1="firebasestorage.googleapis.com",S1="storageBucket",D4=2*60*1e3,U4=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nt extends vn{constructor(e,s,n=0){super(Zh(e),`Firebase Storage: ${s} (${Zh(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Nt.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Zh(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var _t;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(_t||(_t={}));function Zh(t){return"storage/"+t}function Rg(){const t="An unknown error occurred, please check the error payload for server response.";return new Nt(_t.UNKNOWN,t)}function B4(t){return new Nt(_t.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function z4(t){return new Nt(_t.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function H4(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Nt(_t.UNAUTHENTICATED,t)}function q4(){return new Nt(_t.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function W4(t){return new Nt(_t.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function K4(){return new Nt(_t.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function G4(){return new Nt(_t.CANCELED,"User canceled the upload/download.")}function Q4(t){return new Nt(_t.INVALID_URL,"Invalid URL '"+t+"'.")}function J4(t){return new Nt(_t.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Y4(){return new Nt(_t.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+S1+"' property when initializing the app?")}function X4(){return new Nt(_t.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Z4(){return new Nt(_t.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function eR(t){return new Nt(_t.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Cf(t){return new Nt(_t.INVALID_ARGUMENT,t)}function k1(){return new Nt(_t.APP_DELETED,"The Firebase app was deleted.")}function tR(t){return new Nt(_t.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function cl(t,e){return new Nt(_t.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Oo(t){throw new Nt(_t.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds{constructor(e,s){this.bucket=e,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,s){let n;try{n=Ds.makeFromUrl(e,s)}catch{return new Ds(e,"")}if(n.path==="")return n;throw J4(e)}static makeFromUrl(e,s){let n=null;const r="([A-Za-z0-9.\\-_]+)";function a(M){M.path.charAt(M.path.length-1)==="/"&&(M.path_=M.path_.slice(0,-1))}const o="(/(.*))?$",l=new RegExp("^gs://"+r+o,"i"),c={bucket:1,path:3};function u(M){M.path_=decodeURIComponent(M.path)}const h="v[A-Za-z0-9_]+",m=s.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",y=new RegExp(`^https?://${m}/${h}/b/${r}/o${f}`,"i"),_={bucket:1,path:3},S=s===I1?"(?:storage.googleapis.com|storage.cloud.google.com)":s,R="([^?#]*)",k=new RegExp(`^https?://${S}/${r}/${R}`,"i"),A=[{regex:l,indices:c,postModify:a},{regex:y,indices:_,postModify:u},{regex:k,indices:{bucket:1,path:2},postModify:u}];for(let M=0;M<A.length;M++){const D=A[M],B=D.regex.exec(e);if(B){const v=B[D.indices.bucket];let N=B[D.indices.path];N||(N=""),n=new Ds(v,N),D.postModify(n);break}}if(n==null)throw Q4(e);return n}}class sR{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nR(t,e,s){let n=1,r=null,a=null,o=!1,l=0;function c(){return l===2}let u=!1;function h(...R){u||(u=!0,e.apply(null,R))}function m(R){r=setTimeout(()=>{r=null,t(y,c())},R)}function f(){a&&clearTimeout(a)}function y(R,...k){if(u){f();return}if(R){f(),h.call(null,R,...k);return}if(c()||o){f(),h.call(null,R,...k);return}n<64&&(n*=2);let A;l===1?(l=2,A=0):A=(n+Math.random())*1e3,m(A)}let _=!1;function S(R){_||(_=!0,f(),!u&&(r!==null?(R||(l=2),clearTimeout(r),m(0)):R||(l=1)))}return m(0),a=setTimeout(()=>{o=!0,S(!0)},s),S}function rR(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iR(t){return t!==void 0}function aR(t){return typeof t=="object"&&!Array.isArray(t)}function Mg(t){return typeof t=="string"||t instanceof String}function lv(t){return Og()&&t instanceof Blob}function Og(){return typeof Blob<"u"}function cv(t,e,s,n){if(n<e)throw Cf(`Invalid value for '${t}'. Expected ${e} or greater.`);if(n>s)throw Cf(`Invalid value for '${t}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lg(t,e,s){let n=e;return s==null&&(n=`https://${e}`),`${s}://${n}/v0${t}`}function E1(t){const e=encodeURIComponent;let s="?";for(const n in t)if(t.hasOwnProperty(n)){const r=e(n)+"="+e(t[n]);s=s+r+"&"}return s=s.slice(0,-1),s}var Ai;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Ai||(Ai={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oR(t,e){const s=t>=500&&t<600,r=[408,429].indexOf(t)!==-1,a=e.indexOf(t)!==-1;return s||r||a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lR{constructor(e,s,n,r,a,o,l,c,u,h,m,f=!0,y=!1){this.url_=e,this.method_=s,this.headers_=n,this.body_=r,this.successCodes_=a,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=c,this.timeout_=u,this.progressCallback_=h,this.connectionFactory_=m,this.retry=f,this.isUsingEmulator=y,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((_,S)=>{this.resolve_=_,this.reject_=S,this.start_()})}start_(){const e=(n,r)=>{if(r){n(!1,new Uc(!1,null,!0));return}const a=this.connectionFactory_();this.pendingConnection_=a;const o=l=>{const c=l.loaded,u=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,u)};this.progressCallback_!==null&&a.addUploadProgressListener(o),a.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&a.removeUploadProgressListener(o),this.pendingConnection_=null;const l=a.getErrorCode()===Ai.NO_ERROR,c=a.getStatus();if(!l||oR(c,this.additionalRetryCodes_)&&this.retry){const h=a.getErrorCode()===Ai.ABORT;n(!1,new Uc(!1,null,h));return}const u=this.successCodes_.indexOf(c)!==-1;n(!0,new Uc(u,a))})},s=(n,r)=>{const a=this.resolve_,o=this.reject_,l=r.connection;if(r.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());iR(c)?a(c):a()}catch(c){o(c)}else if(l!==null){const c=Rg();c.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,c)):o(c)}else if(r.canceled){const c=this.appDelete_?k1():G4();o(c)}else{const c=K4();o(c)}};this.canceled_?s(!1,new Uc(!1,null,!0)):this.backoffId_=nR(e,s,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&rR(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Uc{constructor(e,s,n){this.wasSuccessCode=e,this.connection=s,this.canceled=!!n}}function cR(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function dR(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function uR(t,e){e&&(t["X-Firebase-GMPID"]=e)}function hR(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function mR(t,e,s,n,r,a,o=!0,l=!1){const c=E1(t.urlParams),u=t.url+c,h=Object.assign({},t.headers);return uR(h,e),cR(h,s),dR(h,a),hR(h,n),new lR(u,t.method,h,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,r,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fR(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function pR(...t){const e=fR();if(e!==void 0){const s=new e;for(let n=0;n<t.length;n++)s.append(t[n]);return s.getBlob()}else{if(Og())return new Blob(t);throw new Nt(_t.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function gR(t,e,s){return t.webkitSlice?t.webkitSlice(e,s):t.mozSlice?t.mozSlice(e,s):t.slice?t.slice(e,s):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xR(t){if(typeof atob>"u")throw eR("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cn={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class em{constructor(e,s){this.data=e,this.contentType=s||null}}function yR(t,e){switch(t){case Cn.RAW:return new em(T1(e));case Cn.BASE64:case Cn.BASE64URL:return new em(A1(t,e));case Cn.DATA_URL:return new em(bR(e),wR(e))}throw Rg()}function T1(t){const e=[];for(let s=0;s<t.length;s++){let n=t.charCodeAt(s);if(n<=127)e.push(n);else if(n<=2047)e.push(192|n>>6,128|n&63);else if((n&64512)===55296)if(!(s<t.length-1&&(t.charCodeAt(s+1)&64512)===56320))e.push(239,191,189);else{const a=n,o=t.charCodeAt(++s);n=65536|(a&1023)<<10|o&1023,e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|n&63)}else(n&64512)===56320?e.push(239,191,189):e.push(224|n>>12,128|n>>6&63,128|n&63)}return new Uint8Array(e)}function vR(t){let e;try{e=decodeURIComponent(t)}catch{throw cl(Cn.DATA_URL,"Malformed data URL.")}return T1(e)}function A1(t,e){switch(t){case Cn.BASE64:{const r=e.indexOf("-")!==-1,a=e.indexOf("_")!==-1;if(r||a)throw cl(t,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case Cn.BASE64URL:{const r=e.indexOf("+")!==-1,a=e.indexOf("/")!==-1;if(r||a)throw cl(t,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let s;try{s=xR(e)}catch(r){throw r.message.includes("polyfill")?r:cl(t,"Invalid character found")}const n=new Uint8Array(s.length);for(let r=0;r<s.length;r++)n[r]=s.charCodeAt(r);return n}class C1{constructor(e){this.base64=!1,this.contentType=null;const s=e.match(/^data:([^,]+)?,/);if(s===null)throw cl(Cn.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=s[1]||null;n!=null&&(this.base64=_R(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}function bR(t){const e=new C1(t);return e.base64?A1(Cn.BASE64,e.rest):vR(e.rest)}function wR(t){return new C1(t).contentType}function _R(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(e,s){let n=0,r="";lv(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(s?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(s?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,s){if(lv(this.data_)){const n=this.data_,r=gR(n,e,s);return r===null?null:new Cr(r)}else{const n=new Uint8Array(this.data_.buffer,e,s-e);return new Cr(n,!0)}}static getBlob(...e){if(Og()){const s=e.map(n=>n instanceof Cr?n.data_:n);return new Cr(pR.apply(null,s))}else{const s=e.map(o=>Mg(o)?yR(Cn.RAW,o).data:o.data_);let n=0;s.forEach(o=>{n+=o.byteLength});const r=new Uint8Array(n);let a=0;return s.forEach(o=>{for(let l=0;l<o.length;l++)r[a++]=o[l]}),new Cr(r,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P1(t){let e;try{e=JSON.parse(t)}catch{return null}return aR(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NR(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function jR(t,e){const s=e.split("/").filter(n=>n.length>0).join("/");return t.length===0?s:t+"/"+s}function R1(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IR(t,e){return e}class ds{constructor(e,s,n,r){this.server=e,this.local=s||e,this.writable=!!n,this.xform=r||IR}}let Bc=null;function SR(t){return!Mg(t)||t.length<2?t:R1(t)}function M1(){if(Bc)return Bc;const t=[];t.push(new ds("bucket")),t.push(new ds("generation")),t.push(new ds("metageneration")),t.push(new ds("name","fullPath",!0));function e(a,o){return SR(o)}const s=new ds("name");s.xform=e,t.push(s);function n(a,o){return o!==void 0?Number(o):o}const r=new ds("size");return r.xform=n,t.push(r),t.push(new ds("timeCreated")),t.push(new ds("updated")),t.push(new ds("md5Hash",null,!0)),t.push(new ds("cacheControl",null,!0)),t.push(new ds("contentDisposition",null,!0)),t.push(new ds("contentEncoding",null,!0)),t.push(new ds("contentLanguage",null,!0)),t.push(new ds("contentType",null,!0)),t.push(new ds("metadata","customMetadata",!0)),Bc=t,Bc}function kR(t,e){function s(){const n=t.bucket,r=t.fullPath,a=new Ds(n,r);return e._makeStorageReference(a)}Object.defineProperty(t,"ref",{get:s})}function ER(t,e,s){const n={};n.type="file";const r=s.length;for(let a=0;a<r;a++){const o=s[a];n[o.local]=o.xform(n,e[o.server])}return kR(n,t),n}function O1(t,e,s){const n=P1(e);return n===null?null:ER(t,n,s)}function TR(t,e,s,n){const r=P1(e);if(r===null||!Mg(r.downloadTokens))return null;const a=r.downloadTokens;if(a.length===0)return null;const o=encodeURIComponent;return a.split(",").map(u=>{const h=t.bucket,m=t.fullPath,f="/b/"+o(h)+"/o/"+o(m),y=Lg(f,s,n),_=E1({alt:"media",token:u});return y+_})[0]}function AR(t,e){const s={},n=e.length;for(let r=0;r<n;r++){const a=e[r];a.writable&&(s[a.server]=t[a.local])}return JSON.stringify(s)}class L1{constructor(e,s,n,r){this.url=e,this.method=s,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V1(t){if(!t)throw Rg()}function CR(t,e){function s(n,r){const a=O1(t,r,e);return V1(a!==null),a}return s}function PR(t,e){function s(n,r){const a=O1(t,r,e);return V1(a!==null),TR(a,r,t.host,t._protocol)}return s}function $1(t){function e(s,n){let r;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?r=q4():r=H4():s.getStatus()===402?r=z4(t.bucket):s.getStatus()===403?r=W4(t.path):r=n,r.status=s.getStatus(),r.serverResponse=n.serverResponse,r}return e}function RR(t){const e=$1(t);function s(n,r){let a=e(n,r);return n.getStatus()===404&&(a=B4(t.path)),a.serverResponse=r.serverResponse,a}return s}function MR(t,e,s){const n=e.fullServerUrl(),r=Lg(n,t.host,t._protocol),a="GET",o=t.maxOperationRetryTime,l=new L1(r,a,PR(t,s),o);return l.errorHandler=RR(e),l}function OR(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function LR(t,e,s){const n=Object.assign({},s);return n.fullPath=t.path,n.size=e.size(),n.contentType||(n.contentType=OR(null,e)),n}function VR(t,e,s,n,r){const a=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function l(){let A="";for(let M=0;M<2;M++)A=A+Math.random().toString().slice(2);return A}const c=l();o["Content-Type"]="multipart/related; boundary="+c;const u=LR(e,n,r),h=AR(u,s),m="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+c+`\r
Content-Type: `+u.contentType+`\r
\r
`,f=`\r
--`+c+"--",y=Cr.getBlob(m,n,f);if(y===null)throw X4();const _={name:u.fullPath},S=Lg(a,t.host,t._protocol),R="POST",k=t.maxUploadRetryTime,x=new L1(S,R,CR(t,s),k);return x.urlParams=_,x.headers=o,x.body=y.uploadData(),x.errorHandler=$1(e),x}class $R{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Ai.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Ai.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Ai.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,s,n,r,a){if(this.sent_)throw Oo("cannot .send() more than once");if(ii(e)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(s,e,!0),a!==void 0)for(const o in a)a.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,a[o].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Oo("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Oo("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Oo("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Oo("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class FR extends $R{initXhr(){this.xhr_.responseType="text"}}function F1(){return new FR}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{constructor(e,s){this._service=e,s instanceof Ds?this._location=s:this._location=Ds.makeFromUrl(s,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,s){return new Bi(e,s)}get root(){const e=new Ds(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return R1(this._location.path)}get storage(){return this._service}get parent(){const e=NR(this._location.path);if(e===null)return null;const s=new Ds(this._location.bucket,e);return new Bi(this._service,s)}_throwIfRoot(e){if(this._location.path==="")throw tR(e)}}function DR(t,e,s){t._throwIfRoot("uploadBytes");const n=VR(t.storage,t._location,M1(),new Cr(e,!0),s);return t.storage.makeRequestWithTokens(n,F1).then(r=>({metadata:r,ref:t}))}function UR(t){t._throwIfRoot("getDownloadURL");const e=MR(t.storage,t._location,M1());return t.storage.makeRequestWithTokens(e,F1).then(s=>{if(s===null)throw Z4();return s})}function BR(t,e){const s=jR(t._location.path,e),n=new Ds(t._location.bucket,s);return new Bi(t.storage,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zR(t){return/^[A-Za-z]+:\/\//.test(t)}function HR(t,e){return new Bi(t,e)}function D1(t,e){if(t instanceof Vg){const s=t;if(s._bucket==null)throw Y4();const n=new Bi(s,s._bucket);return e!=null?D1(n,e):n}else return e!==void 0?BR(t,e):t}function qR(t,e){if(e&&zR(e)){if(t instanceof Vg)return HR(t,e);throw Cf("To use ref(service, url), the first argument must be a Storage instance.")}else return D1(t,e)}function dv(t,e){const s=e==null?void 0:e[S1];return s==null?null:Ds.makeFromBucketSpec(s,t)}function WR(t,e,s,n={}){t.host=`${e}:${s}`;const r=ii(e);r&&(Rp(`https://${t.host}/b`),Mp("Storage",!0)),t._isUsingEmulator=!0,t._protocol=r?"https":"http";const{mockUserToken:a}=n;a&&(t._overrideAuthToken=typeof a=="string"?a:n_(a,t.app.options.projectId))}class Vg{constructor(e,s,n,r,a,o=!1){this.app=e,this._authProvider=s,this._appCheckProvider=n,this._url=r,this._firebaseVersion=a,this._isUsingEmulator=o,this._bucket=null,this._host=I1,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=D4,this._maxUploadRetryTime=U4,this._requests=new Set,r!=null?this._bucket=Ds.makeFromBucketSpec(r,this._host):this._bucket=dv(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ds.makeFromBucketSpec(this._url,e):this._bucket=dv(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){cv("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){cv("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const s=await e.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(hs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Bi(this,e)}_makeRequest(e,s,n,r,a=!0){if(this._deleted)return new sR(k1());{const o=mR(e,this._appId,n,r,s,this._firebaseVersion,a,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,s){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,s,n,r).getPromise()}}const uv="@firebase/storage",hv="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U1="storage";function KR(t,e,s){return t=nt(t),DR(t,e,s)}function GR(t){return t=nt(t),UR(t)}function QR(t,e){return t=nt(t),qR(t,e)}function JR(t=Au(),e){t=nt(t);const n=Qi(t,U1).getImmediate({identifier:e}),r=e_("storage");return r&&YR(n,...r),n}function YR(t,e,s,n={}){WR(t,e,s,n)}function XR(t,{instanceIdentifier:e}){const s=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),r=t.getProvider("app-check-internal");return new Vg(s,n,r,e,Ji)}function ZR(){xn(new sn(U1,XR,"PUBLIC").setMultipleInstances(!0)),Ts(uv,hv,""),Ts(uv,hv,"esm2020")}ZR();const B1="@firebase/installations",$g="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z1=1e4,H1=`w:${$g}`,q1="FIS_v2",e5="https://firebaseinstallations.googleapis.com/v1",t5=60*60*1e3,s5="installations",n5="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r5={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},zi=new Gi(s5,n5,r5);function W1(t){return t instanceof vn&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K1({projectId:t}){return`${e5}/projects/${t}/installations`}function G1(t){return{token:t.token,requestStatus:2,expiresIn:a5(t.expiresIn),creationTime:Date.now()}}async function Q1(t,e){const n=(await e.json()).error;return zi.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function J1({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function i5(t,{refreshToken:e}){const s=J1(t);return s.append("Authorization",o5(e)),s}async function Y1(t){const e=await t();return e.status>=500&&e.status<600?t():e}function a5(t){return Number(t.replace("s","000"))}function o5(t){return`${q1} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l5({appConfig:t,heartbeatServiceProvider:e},{fid:s}){const n=K1(t),r=J1(t),a=e.getImmediate({optional:!0});if(a){const u=await a.getHeartbeatsHeader();u&&r.append("x-firebase-client",u)}const o={fid:s,authVersion:q1,appId:t.appId,sdkVersion:H1},l={method:"POST",headers:r,body:JSON.stringify(o)},c=await Y1(()=>fetch(n,l));if(c.ok){const u=await c.json();return{fid:u.fid||s,registrationStatus:2,refreshToken:u.refreshToken,authToken:G1(u.authToken)}}else throw await Q1("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X1(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c5(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d5=/^[cdef][\w-]{21}$/,Pf="";function u5(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const s=h5(t);return d5.test(s)?s:Pf}catch{return Pf}}function h5(t){return c5(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sh(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z1=new Map;function ej(t,e){const s=sh(t);tj(s,e),m5(s,e)}function tj(t,e){const s=Z1.get(t);if(s)for(const n of s)n(e)}function m5(t,e){const s=f5();s&&s.postMessage({key:t,fid:e}),p5()}let Ii=null;function f5(){return!Ii&&"BroadcastChannel"in self&&(Ii=new BroadcastChannel("[Firebase] FID Change"),Ii.onmessage=t=>{tj(t.data.key,t.data.fid)}),Ii}function p5(){Z1.size===0&&Ii&&(Ii.close(),Ii=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g5="firebase-installations-database",x5=1,Hi="firebase-installations-store";let tm=null;function Fg(){return tm||(tm=Tu(g5,x5,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Hi)}}})),tm}async function lu(t,e){const s=sh(t),r=(await Fg()).transaction(Hi,"readwrite"),a=r.objectStore(Hi),o=await a.get(s);return await a.put(e,s),await r.done,(!o||o.fid!==e.fid)&&ej(t,e.fid),e}async function sj(t){const e=sh(t),n=(await Fg()).transaction(Hi,"readwrite");await n.objectStore(Hi).delete(e),await n.done}async function nh(t,e){const s=sh(t),r=(await Fg()).transaction(Hi,"readwrite"),a=r.objectStore(Hi),o=await a.get(s),l=e(o);return l===void 0?await a.delete(s):await a.put(l,s),await r.done,l&&(!o||o.fid!==l.fid)&&ej(t,l.fid),l}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dg(t){let e;const s=await nh(t.appConfig,n=>{const r=y5(n),a=v5(t,r);return e=a.registrationPromise,a.installationEntry});return s.fid===Pf?{installationEntry:await e}:{installationEntry:s,registrationPromise:e}}function y5(t){const e=t||{fid:u5(),registrationStatus:0};return nj(e)}function v5(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const r=Promise.reject(zi.create("app-offline"));return{installationEntry:e,registrationPromise:r}}const s={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},n=b5(t,s);return{installationEntry:s,registrationPromise:n}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:w5(t)}:{installationEntry:e}}async function b5(t,e){try{const s=await l5(t,e);return lu(t.appConfig,s)}catch(s){throw W1(s)&&s.customData.serverCode===409?await sj(t.appConfig):await lu(t.appConfig,{fid:e.fid,registrationStatus:0}),s}}async function w5(t){let e=await mv(t.appConfig);for(;e.registrationStatus===1;)await X1(100),e=await mv(t.appConfig);if(e.registrationStatus===0){const{installationEntry:s,registrationPromise:n}=await Dg(t);return n||s}return e}function mv(t){return nh(t,e=>{if(!e)throw zi.create("installation-not-found");return nj(e)})}function nj(t){return _5(t)?{fid:t.fid,registrationStatus:0}:t}function _5(t){return t.registrationStatus===1&&t.registrationTime+z1<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N5({appConfig:t,heartbeatServiceProvider:e},s){const n=j5(t,s),r=i5(t,s),a=e.getImmediate({optional:!0});if(a){const u=await a.getHeartbeatsHeader();u&&r.append("x-firebase-client",u)}const o={installation:{sdkVersion:H1,appId:t.appId}},l={method:"POST",headers:r,body:JSON.stringify(o)},c=await Y1(()=>fetch(n,l));if(c.ok){const u=await c.json();return G1(u)}else throw await Q1("Generate Auth Token",c)}function j5(t,{fid:e}){return`${K1(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ug(t,e=!1){let s;const n=await nh(t.appConfig,a=>{if(!rj(a))throw zi.create("not-registered");const o=a.authToken;if(!e&&k5(o))return a;if(o.requestStatus===1)return s=I5(t,e),a;{if(!navigator.onLine)throw zi.create("app-offline");const l=T5(a);return s=S5(t,l),l}});return s?await s:n.authToken}async function I5(t,e){let s=await fv(t.appConfig);for(;s.authToken.requestStatus===1;)await X1(100),s=await fv(t.appConfig);const n=s.authToken;return n.requestStatus===0?Ug(t,e):n}function fv(t){return nh(t,e=>{if(!rj(e))throw zi.create("not-registered");const s=e.authToken;return A5(s)?{...e,authToken:{requestStatus:0}}:e})}async function S5(t,e){try{const s=await N5(t,e),n={...e,authToken:s};return await lu(t.appConfig,n),s}catch(s){if(W1(s)&&(s.customData.serverCode===401||s.customData.serverCode===404))await sj(t.appConfig);else{const n={...e,authToken:{requestStatus:0}};await lu(t.appConfig,n)}throw s}}function rj(t){return t!==void 0&&t.registrationStatus===2}function k5(t){return t.requestStatus===2&&!E5(t)}function E5(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+t5}function T5(t){const e={requestStatus:1,requestTime:Date.now()};return{...t,authToken:e}}function A5(t){return t.requestStatus===1&&t.requestTime+z1<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C5(t){const e=t,{installationEntry:s,registrationPromise:n}=await Dg(e);return n?n.catch(console.error):Ug(e).catch(console.error),s.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P5(t,e=!1){const s=t;return await R5(s),(await Ug(s,e)).token}async function R5(t){const{registrationPromise:e}=await Dg(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M5(t){if(!t||!t.options)throw sm("App Configuration");if(!t.name)throw sm("App Name");const e=["projectId","apiKey","appId"];for(const s of e)if(!t.options[s])throw sm(s);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function sm(t){return zi.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ij="installations",O5="installations-internal",L5=t=>{const e=t.getProvider("app").getImmediate(),s=M5(e),n=Qi(e,"heartbeat");return{app:e,appConfig:s,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},V5=t=>{const e=t.getProvider("app").getImmediate(),s=Qi(e,ij).getImmediate();return{getId:()=>C5(s),getToken:r=>P5(s,r)}};function $5(){xn(new sn(ij,L5,"PUBLIC")),xn(new sn(O5,V5,"PRIVATE"))}$5();Ts(B1,$g);Ts(B1,$g,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F5="/firebase-messaging-sw.js",D5="/firebase-cloud-messaging-push-scope",aj="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",U5="https://fcmregistrations.googleapis.com/v1",oj="google.c.a.c_id",B5="google.c.a.c_l",z5="google.c.a.ts",H5="google.c.a.e",pv=1e4;var gv;(function(t){t[t.DATA_MESSAGE=1]="DATA_MESSAGE",t[t.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(gv||(gv={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var Fl;(function(t){t.PUSH_RECEIVED="push-received",t.NOTIFICATION_CLICKED="notification-clicked"})(Fl||(Fl={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qn(t){const e=new Uint8Array(t);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function q5(t){const e="=".repeat((4-t.length%4)%4),s=(t+e).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(s),r=new Uint8Array(n.length);for(let a=0;a<n.length;++a)r[a]=n.charCodeAt(a);return r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nm="fcm_token_details_db",W5=5,xv="fcm_token_object_Store";async function K5(t){if("databases"in indexedDB&&!(await indexedDB.databases()).map(a=>a.name).includes(nm))return null;let e=null;return(await Tu(nm,W5,{upgrade:async(n,r,a,o)=>{if(r<2||!n.objectStoreNames.contains(xv))return;const l=o.objectStore(xv),c=await l.index("fcmSenderId").get(t);if(await l.clear(),!!c){if(r===2){const u=c;if(!u.auth||!u.p256dh||!u.endpoint)return;e={token:u.fcmToken,createTime:u.createTime??Date.now(),subscriptionOptions:{auth:u.auth,p256dh:u.p256dh,endpoint:u.endpoint,swScope:u.swScope,vapidKey:typeof u.vapidKey=="string"?u.vapidKey:qn(u.vapidKey)}}}else if(r===3){const u=c;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:qn(u.auth),p256dh:qn(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:qn(u.vapidKey)}}}else if(r===4){const u=c;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:qn(u.auth),p256dh:qn(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:qn(u.vapidKey)}}}}}})).close(),await zh(nm),await zh("fcm_vapid_details_db"),await zh("undefined"),G5(e)?e:null}function G5(t){if(!t||!t.subscriptionOptions)return!1;const{subscriptionOptions:e}=t;return typeof t.createTime=="number"&&t.createTime>0&&typeof t.token=="string"&&t.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q5="firebase-messaging-database",J5=1,Dl="firebase-messaging-store";let rm=null;function lj(){return rm||(rm=Tu(Q5,J5,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Dl)}}})),rm}async function Y5(t){const e=cj(t),n=await(await lj()).transaction(Dl).objectStore(Dl).get(e);if(n)return n;{const r=await K5(t.appConfig.senderId);if(r)return await Bg(t,r),r}}async function Bg(t,e){const s=cj(t),r=(await lj()).transaction(Dl,"readwrite");return await r.objectStore(Dl).put(e,s),await r.done,e}function cj({appConfig:t}){return t.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X5={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},os=new Gi("messaging","Messaging",X5);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Z5(t,e){const s=await Hg(t),n=dj(e),r={method:"POST",headers:s,body:JSON.stringify(n)};let a;try{a=await(await fetch(zg(t.appConfig),r)).json()}catch(o){throw os.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(a.error){const o=a.error.message;throw os.create("token-subscribe-failed",{errorInfo:o})}if(!a.token)throw os.create("token-subscribe-no-token");return a.token}async function e3(t,e){const s=await Hg(t),n=dj(e.subscriptionOptions),r={method:"PATCH",headers:s,body:JSON.stringify(n)};let a;try{a=await(await fetch(`${zg(t.appConfig)}/${e.token}`,r)).json()}catch(o){throw os.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(a.error){const o=a.error.message;throw os.create("token-update-failed",{errorInfo:o})}if(!a.token)throw os.create("token-update-no-token");return a.token}async function t3(t,e){const n={method:"DELETE",headers:await Hg(t)};try{const a=await(await fetch(`${zg(t.appConfig)}/${e}`,n)).json();if(a.error){const o=a.error.message;throw os.create("token-unsubscribe-failed",{errorInfo:o})}}catch(r){throw os.create("token-unsubscribe-failed",{errorInfo:r==null?void 0:r.toString()})}}function zg({projectId:t}){return`${U5}/projects/${t}/registrations`}async function Hg({appConfig:t,installations:e}){const s=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey,"x-goog-firebase-installations-auth":`FIS ${s}`})}function dj({p256dh:t,auth:e,endpoint:s,vapidKey:n}){const r={web:{endpoint:s,auth:e,p256dh:t}};return n!==aj&&(r.web.applicationPubKey=n),r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s3=7*24*60*60*1e3;async function n3(t){const e=await i3(t.swRegistration,t.vapidKey),s={vapidKey:t.vapidKey,swScope:t.swRegistration.scope,endpoint:e.endpoint,auth:qn(e.getKey("auth")),p256dh:qn(e.getKey("p256dh"))},n=await Y5(t.firebaseDependencies);if(n){if(a3(n.subscriptionOptions,s))return Date.now()>=n.createTime+s3?r3(t,{token:n.token,createTime:Date.now(),subscriptionOptions:s}):n.token;try{await t3(t.firebaseDependencies,n.token)}catch(r){console.warn(r)}return yv(t.firebaseDependencies,s)}else return yv(t.firebaseDependencies,s)}async function r3(t,e){try{const s=await e3(t.firebaseDependencies,e),n={...e,token:s,createTime:Date.now()};return await Bg(t.firebaseDependencies,n),s}catch(s){throw s}}async function yv(t,e){const n={token:await Z5(t,e),createTime:Date.now(),subscriptionOptions:e};return await Bg(t,n),n.token}async function i3(t,e){const s=await t.pushManager.getSubscription();return s||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:q5(e)})}function a3(t,e){const s=e.vapidKey===t.vapidKey,n=e.endpoint===t.endpoint,r=e.auth===t.auth,a=e.p256dh===t.p256dh;return s&&n&&r&&a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vv(t){const e={from:t.from,collapseKey:t.collapse_key,messageId:t.fcmMessageId};return o3(e,t),l3(e,t),c3(e,t),e}function o3(t,e){if(!e.notification)return;t.notification={};const s=e.notification.title;s&&(t.notification.title=s);const n=e.notification.body;n&&(t.notification.body=n);const r=e.notification.image;r&&(t.notification.image=r);const a=e.notification.icon;a&&(t.notification.icon=a)}function l3(t,e){e.data&&(t.data=e.data)}function c3(t,e){var r,a,o,l;if(!e.fcmOptions&&!((r=e.notification)!=null&&r.click_action))return;t.fcmOptions={};const s=((a=e.fcmOptions)==null?void 0:a.link)??((o=e.notification)==null?void 0:o.click_action);s&&(t.fcmOptions.link=s);const n=(l=e.fcmOptions)==null?void 0:l.analytics_label;n&&(t.fcmOptions.analyticsLabel=n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d3(t){return typeof t=="object"&&!!t&&oj in t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u3(t){if(!t||!t.options)throw im("App Configuration Object");if(!t.name)throw im("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:s}=t;for(const n of e)if(!s[n])throw im(n);return{appName:t.name,projectId:s.projectId,apiKey:s.apiKey,appId:s.appId,senderId:s.messagingSenderId}}function im(t){return os.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h3{constructor(e,s,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=u3(e);this.firebaseDependencies={app:e,appConfig:r,installations:s,analyticsProvider:n}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m3(t){try{t.swRegistration=await navigator.serviceWorker.register(F5,{scope:D5}),t.swRegistration.update().catch(()=>{}),await f3(t.swRegistration)}catch(e){throw os.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}async function f3(t){return new Promise((e,s)=>{const n=setTimeout(()=>s(new Error(`Service worker not registered after ${pv} ms`)),pv),r=t.installing||t.waiting;t.active?(clearTimeout(n),e()):r?r.onstatechange=a=>{var o;((o=a.target)==null?void 0:o.state)==="activated"&&(r.onstatechange=null,clearTimeout(n),e())}:(clearTimeout(n),s(new Error("No incoming service worker found.")))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p3(t,e){if(!e&&!t.swRegistration&&await m3(t),!(!e&&t.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw os.create("invalid-sw-registration");t.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g3(t,e){e?t.vapidKey=e:t.vapidKey||(t.vapidKey=aj)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uj(t,e){if(!navigator)throw os.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw os.create("permission-blocked");return await g3(t,e==null?void 0:e.vapidKey),await p3(t,e==null?void 0:e.serviceWorkerRegistration),n3(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x3(t,e,s){const n=y3(e);(await t.firebaseDependencies.analyticsProvider.get()).logEvent(n,{message_id:s[oj],message_name:s[B5],message_time:s[z5],message_device_time:Math.floor(Date.now()/1e3)})}function y3(t){switch(t){case Fl.NOTIFICATION_CLICKED:return"notification_open";case Fl.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v3(t,e){const s=e.data;if(!s.isFirebaseMessaging)return;t.onMessageHandler&&s.messageType===Fl.PUSH_RECEIVED&&(typeof t.onMessageHandler=="function"?t.onMessageHandler(vv(s)):t.onMessageHandler.next(vv(s)));const n=s.data;d3(n)&&n[H5]==="1"&&await x3(t,s.messageType,n)}const bv="@firebase/messaging",wv="0.12.23";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b3=t=>{const e=new h3(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),t.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",s=>v3(e,s)),e},w3=t=>{const e=t.getProvider("messaging").getImmediate();return{getToken:n=>uj(e,n)}};function _3(){xn(new sn("messaging",b3,"PUBLIC")),xn(new sn("messaging-internal",w3,"PRIVATE")),Ts(bv,wv),Ts(bv,wv,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hj(){try{await i_()}catch{return!1}return typeof window<"u"&&r_()&&WS()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N3(t,e){if(!navigator)throw os.create("only-available-in-window");return t.onMessageHandler=e,()=>{t.onMessageHandler=null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j3(t=Au()){return hj().then(e=>{if(!e)throw os.create("unsupported-browser")},e=>{throw os.create("indexed-db-unsupported")}),Qi(nt(t),"messaging").getImmediate()}async function I3(t,e){return t=nt(t),uj(t,e)}function S3(t,e){return t=nt(t),N3(t,e)}_3();const k3={apiKey:"AIzaSyAMubJk9qXmaz_V3uHiCGs0hRe6FSu9ji4",authDomain:"ai-factory-c6d58.firebaseapp.com",projectId:"ai-factory-c6d58",storageBucket:"ai-factory-c6d58.firebasestorage.app",messagingSenderId:"213197152130",appId:"1:213197152130:web:7c19f9c3c88bea7cc1399b",measurementId:"G-4D82WS9H7K"},rh=l_(k3),se=iC(rh),kn=$4(rh),E3=JR(rh);let Ul=null;typeof window<"u"&&hj().then(t=>{t&&(Ul=j3(rh))});const et={USERS:"users",PETS:"pets",DIAGNOSES:"diagnoses",BOOKINGS:"bookings",CLINIC_RESULTS:"clinicResults",DAILY_LOGS:"dailyLogs",RECORDS:"records",PRE_QUESTIONNAIRES:"preQuestionnaires",MEDICAL_RECORDS:"medicalRecords"},_v={guardian:"guardian@test.com",clinic:"clinic@happyvet.com"};function gd(t){return t?t===_v.guardian||t===_v.clinic:!1}function T3(t,e){return gd(e)?t.filter(s=>{var l,c,u,h,m,f;const n=((l=s.user)==null?void 0:l.email)||((c=s.owner)==null?void 0:c.email)||s.userEmail||((u=s.user)==null?void 0:u.userEmail)||((h=s.owner)==null?void 0:h.userEmail),r=((m=s.clinic)==null?void 0:m.email)||s.clinicEmail||((f=s.clinic)==null?void 0:f.userEmail)||s.hospitalEmail,a=s.clinicName||s.hospitalName,o=a&&(a.includes("")||a.includes("happyvet")||a.includes("Happy Vet"));return gd(n)||gd(r)||o}):t}const Vs={async saveUser(t,e){var s;try{return await UN(st(se,et.USERS,t),{...e,updatedAt:qt()},{merge:!0}),{success:!0}}catch(n){return n.code==="permission-denied"||(s=n.message)!=null&&s.includes("Missing or insufficient permissions")?(console.warn("     (Firestore    ):",n.message),{success:!0,warning:"    ( )"}):(console.error("  :",n),{success:!1,error:n})}},async getUser(t){var e;try{const s=await Ht(st(se,et.USERS,t));return s.exists()?{success:!0,data:{id:s.id,...s.data()}}:{success:!1,data:null}}catch(s){return s.code==="permission-denied"||(e=s.message)!=null&&e.includes("Missing or insufficient permissions")?(console.warn("     (Firestore    ):",s.message),{success:!1,data:null,warning:"    ( )"}):(console.error("  :",s),{success:!1,error:s})}},async findUserByEmail(t){try{const e=_e(fe(se,et.USERS),pe("email","==",t)),s=await Pe(e);if(!s.empty){const n=s.docs[0];return{success:!0,data:{id:n.id,...n.data()}}}return{success:!1,data:null}}catch(e){return console.error("  :",e),{success:!1,error:e}}}},Wo={async addPet(t,e){try{return{success:!0,id:(await as(fe(se,et.PETS),{...e,userId:t,createdAt:qt(),updatedAt:qt()})).id}}catch(s){return console.error("  :",s),{success:!1,error:s}}},async getPetsByUser(t){try{const e=_e(fe(se,et.PETS),pe("userId","==",t),Pt("createdAt","desc"));return{success:!0,data:(await Pe(e)).docs.map(r=>({id:r.id,...r.data()}))}}catch(e){return console.error("   :",e),{success:!1,error:e,data:[]}}},async updatePet(t,e){try{return await Zi(st(se,et.PETS,t),{...e,updatedAt:qt()}),{success:!0}}catch(s){return console.error("  :",s),{success:!1,error:s}}},async deletePet(t){try{return await xC(st(se,et.PETS,t)),{success:!0}}catch(e){return console.error("  :",e),{success:!1,error:e}}}};function Rf(t){if(t==null)return null;if(Array.isArray(t))return t.map(e=>Rf(e)).filter(e=>e!==void 0);if(typeof t=="object"){const e={};for(const[s,n]of Object.entries(t))n!==void 0&&(e[s]=Rf(n));return e}return t}const Da={async saveDiagnosis(t){try{if(!t.petId)throw new Error("petId  .");if(!t.ownerId&&!t.userId)throw new Error("ownerId  userId  .");const e={...t,clinicId:t.clinicId??null,ownerId:t.ownerId||t.userId,petId:t.petId,createdAt:qt()},s=Rf(e);return{success:!0,id:(await as(fe(se,et.DIAGNOSES),s)).id}}catch(e){return console.error("  :",e),{success:!1,error:e}}},async getDiagnosesByPet(t){try{const e=_e(fe(se,et.DIAGNOSES),pe("petId","==",t),Pt("createdAt","desc"));return{success:!0,data:(await Pe(e)).docs.map(r=>({id:r.id,...r.data()}))}}catch(e){return console.error("   :",e),{success:!1,error:e,data:[]}}},async getDiagnosesByUser(t){try{const e=_e(fe(se,et.DIAGNOSES),pe("userId","==",t),Pt("createdAt","desc"));return{success:!0,data:(await Pe(e)).docs.map(r=>({id:r.id,...r.data()}))}}catch(e){return console.error("   :",e),{success:!1,error:e,data:[]}}},async getDiagnosesByClinicAndPatient(t,e,s){try{const n=_e(fe(se,et.DIAGNOSES),pe("clinicId","==",t),pe("ownerId","==",e),pe("petId","==",s),Pt("createdAt","desc"));return{success:!0,data:(await Pe(n)).docs.map(o=>({id:o.id,...o.data()}))}}catch(n){return console.error("    :",n),{success:!1,error:n,data:[]}}},async getLatestDiagnosis(t){try{const e=_e(fe(se,et.DIAGNOSES),pe("petId","==",t),Pt("createdAt","desc"),zs(1)),s=await Pe(e);if(!s.empty){const n=s.docs[0];return{success:!0,data:{id:n.id,...n.data()}}}return{success:!0,data:null}}catch(e){return console.error("   :",e),{success:!1,error:e}}}},qi={async createBooking(t){try{const e={...t,status:t.status||"pending",createdAt:qt(),updatedAt:qt(),createdAtISO:new Date().toISOString(),updatedAtISO:new Date().toISOString()};console.log("[ ] Firestore  :",{clinicId:e.clinicId,clinicName:e.clinicName,date:e.date,time:e.time});const s=await as(fe(se,et.BOOKINGS),e);return console.log("[ ]  Firestore  :",s.id),{success:!0,id:s.id}}catch(e){return console.error("[ ]  Firestore  :",e),console.error("[ ]  :",{message:e.message,code:e.code,bookingData:{clinicId:t.clinicId,clinicName:t.clinicName,date:t.date}}),{success:!1,error:e.message||e}}},async updateBookingStatus(t,e){try{const s=fe(se,et.BOOKINGS);let n=st(se,et.BOOKINGS,t);if(!(await Ht(n)).exists()){console.warn("[  ]  ID    , bookingId   :",t);const a=_e(s,pe("bookingId","==",t)),o=await Pe(a);if(o.empty)throw new Error(` ID  bookingId    : ${t}`);n=o.docs[0].ref}return await Zi(n,{status:e,updatedAt:qt()}),console.log("[  ] :",t,"",e),{success:!0}}catch(s){return console.error("   :",s),{success:!1,error:s}}},async getBookingsByUser(t,e=null){var s;try{let n=_e(fe(se,et.BOOKINGS),pe("userId","==",t)),r;try{n=_e(fe(se,et.BOOKINGS),pe("userId","==",t),Pt("createdAt","desc")),r=await Pe(n)}catch(c){console.warn(" :  ,   :",c.message),n=_e(fe(se,et.BOOKINGS),pe("userId","==",t)),r=await Pe(n)}let a=r.docs.map(c=>({id:c.id,...c.data()}));(s=r.query._query.orderBy)!=null&&s.length||a.sort((c,u)=>{var f,y,_,S;const h=((y=(f=c.createdAt)==null?void 0:f.toDate)==null?void 0:y.call(f))||new Date(c.createdAtISO||c.createdAt||0);return(((S=(_=u.createdAt)==null?void 0:_.toDate)==null?void 0:S.call(_))||new Date(u.createdAtISO||u.createdAt||0))-h});const o=e==null?void 0:e.email;let l=a;return gd(o),l=a,{success:!0,data:l}}catch(n){return console.error("   :",n),{success:!1,error:n,data:[]}}},async getBookingsByClinic(t){try{const e=_e(fe(se,et.BOOKINGS),pe("clinicId","==",t),Pt("date","asc"));return{success:!0,data:(await Pe(e)).docs.map(r=>({id:r.id,...r.data()}))}}catch(e){return console.error("   :",e),{success:!1,error:e,data:[]}}},async getTodayBookings(t){const e=new Date().toISOString().split("T")[0];try{const s=_e(fe(se,et.BOOKINGS),pe("clinicId","==",t),pe("date","==",e));return{success:!0,data:(await Pe(s)).docs.map(a=>({id:a.id,...a.data()}))}}catch(s){return console.error("   :",s),{success:!1,error:s,data:[]}}},subscribeToBookings(t,e){const s=_e(fe(se,et.BOOKINGS),pe("clinicId","==",t),Pt("date","asc"));return Vl(s,n=>{const r=n.docs.map(a=>({id:a.id,...a.data()}));e(r)})}},tr={async saveResult(t){try{if(console.log(" [saveResult]  :",{clinicId:t.clinicId,userId:t.userId,ownerId:t.ownerId,petId:t.petId,petIdType:typeof t.petId,bookingId:t.bookingId,visitDate:t.visitDate}),!t.clinicId)throw new Error("clinicId  .");!t.userId&&!t.ownerId&&console.warn(" userId  ownerId .   ."),t.petId||console.warn(" petId .   .");const e={...t,clinicId:t.clinicId,userId:t.userId||t.ownerId,ownerId:t.ownerId||t.userId,petId:t.petId,createdAt:qt()};console.log(" [saveResult] Firestore   payload:",{clinicId:e.clinicId,userId:e.userId,ownerId:e.ownerId,petId:e.petId,petIdType:typeof e.petId,bookingId:e.bookingId,mainDiagnosis:e.mainDiagnosis,visitDate:e.visitDate});const s=await as(fe(se,et.CLINIC_RESULTS),e);console.log("[saveResult]     , docId:",s.id);try{const{sendNotificationToGuardian:n}=await Ud(async()=>{const{sendNotificationToGuardian:a}=await Promise.resolve().then(()=>kv);return{sendNotificationToGuardian:a}},void 0),r=await n(t.userId,"  ","    .    .",{clinicId:t.clinicId,petId:t.petId,bookingId:t.bookingId});r!=null&&r.success?console.log("[saveResult]    "):console.warn("[saveResult]     :",r==null?void 0:r.error)}catch(n){console.warn("[saveResult]     ():",n)}return{success:!0,id:s.id}}catch(e){return console.error("   :",e),{success:!1,error:e}}},async getResultByBooking(t){try{const e=_e(fe(se,et.CLINIC_RESULTS),pe("bookingId","==",t)),s=await Pe(e);if(!s.empty){const n=s.docs[0];return{success:!0,data:{id:n.id,...n.data()}}}return{success:!0,data:null}}catch(e){return console.error("   :",e),{success:!1,error:e}}},async getResultsByPet(t,e=null){try{console.log(" [getResultsByPet] :",{petId:t,petIdType:typeof t});let s=[];try{let a;try{const o=_e(fe(se,et.CLINIC_RESULTS),pe("petId","==",t),Pt("createdAt","desc"));a=await Pe(o)}catch(o){console.warn("  :  ,   :",o.message);const l=_e(fe(se,et.CLINIC_RESULTS),pe("petId","==",t));a=await Pe(l)}s=a.docs.map(o=>({id:o.id,...o.data()}))}catch(a){console.warn("petId    :",a)}if(s.length===0&&(e!=null&&e.uid)){console.log(" petId   , userId fallback  ...");try{let a;try{const l=_e(fe(se,et.CLINIC_RESULTS),pe("userId","==",e.uid),Pt("createdAt","desc"));a=await Pe(l)}catch{const c=_e(fe(se,et.CLINIC_RESULTS),pe("userId","==",e.uid));a=await Pe(c)}s=a.docs.map(l=>({id:l.id,...l.data()})).filter(l=>l.petId===t||!l.petId&&l.userId===e.uid),console.log(`    userId   petId : ${s.length}`)}catch(a){console.warn("userId    :",a)}}s.length>0&&s.sort((a,o)=>{var u,h,m,f;const l=((h=(u=a.createdAt)==null?void 0:u.toDate)==null?void 0:h.call(u))||new Date(a.createdAtISO||a.createdAt||a.visitDate||0);return(((f=(m=o.createdAt)==null?void 0:m.toDate)==null?void 0:f.call(m))||new Date(o.createdAtISO||o.createdAt||o.visitDate||0))-l});const n=e==null?void 0:e.email,r=T3(s,n);return console.log(" [getResultsByPet]  :",{count:r.length,shared:r.filter(a=>a.sharedToGuardian===!0).length}),{success:!0,data:r}}catch(s){return console.error(" [getResultsByPet]     :",s),{success:!1,error:s,data:[]}}},async shareResult(t){try{const e=st(se,et.CLINIC_RESULTS,t),s=await Ht(e);if(!s.exists())return{success:!1,error:new Error("   .")};const n=s.data();if(!n.userId)return{success:!1,error:new Error("    .")};const{sendNotificationToGuardian:r}=await Ud(async()=>{const{sendNotificationToGuardian:o}=await Promise.resolve().then(()=>kv);return{sendNotificationToGuardian:o}},void 0),a=n.clinicName||n.hospitalName||"";return await r(n.userId,`${a}   `,`${n.petName||""}   .`,{type:"treatment_completed",resultId:t,bookingId:n.bookingId,petName:n.petName,clinicName:a,url:"/records"}),await Zi(e,{sharedToGuardian:!0,sharedAt:qt()}),{success:!0}}catch(e){return console.error("   :",e),{success:!1,error:e}}}},A3={async getAllTemplates(){try{const t=await Pe(fe(se,"commentTemplates")),e=[];return t.forEach(s=>{e.push({id:s.id,...s.data()})}),{success:!0,data:e}}catch(t){return console.error("  :",t),{success:!1,error:t,data:[]}}},async getTemplatesByCategory(t){try{const e=_e(fe(se,"commentTemplates"),pe("category","==",t)),s=await Pe(e),n=[];return s.forEach(r=>{n.push({id:r.id,...r.data()})}),{success:!0,data:n}}catch(e){return console.error("   :",e),{success:!1,error:e,data:[]}}},async getRandomTemplate(t=!1,e=!1){try{let s;t||e?s=[1,2]:s=[4,5,7];const n=s[Math.floor(Math.random()*s.length)],r=await this.getTemplatesByCategory(n);if(r.success&&r.data.length>0){const a=Math.floor(Math.random()*r.data.length);return{success:!0,data:r.data[a]}}return{success:!1,data:null}}catch(s){return console.error("   :",s),{success:!1,error:s,data:null}}}},C3={dog:"",cat:"",rabbit:"",hamster:"",bird:"",hedgehog:"",reptile:"",etc:"",other:""},P3="petMedical_diagnoses",mj="petMedical_pets",fj="petMedical_bookings",R3="petMedical_clinicResults",pj=t=>`petMedical_pets_${t}`,M3=t=>`petMedical_diagnoses_${t}`,gj=t=>`petMedical_bookings_${t}`,O3=t=>{if(!t)return[];try{const e=localStorage.getItem(pj(t));return e?JSON.parse(e):[]}catch{return[]}},Nv=(t,e)=>{if(t)try{localStorage.setItem(pj(t),JSON.stringify(e))}catch(s){console.error("Failed to save pets:",s)}},L3=t=>{if(!t)return[];try{const e=localStorage.getItem(M3(t));return e?JSON.parse(e):[]}catch{return[]}},zc=t=>{if(!t)return[];try{const e=localStorage.getItem(gj(t));return e?JSON.parse(e):[]}catch{return[]}},Hc=(t,e)=>{if(t)try{localStorage.setItem(gj(t),JSON.stringify(e))}catch(s){console.error("Failed to save bookings:",s)}},V3=()=>{try{const t=localStorage.getItem(P3);return t?JSON.parse(t):[]}catch{return[]}},$3=()=>{try{const t=localStorage.getItem(mj);return t?JSON.parse(t):[]}catch{return[]}},jv=t=>{try{localStorage.setItem(mj,JSON.stringify(t))}catch(e){console.error("Failed to save pets:",e)}},F3=()=>{try{const t=localStorage.getItem(fj);return t?JSON.parse(t):[]}catch{return[]}},D3=t=>{try{localStorage.setItem(fj,JSON.stringify(t))}catch(e){console.error("Failed to save bookings:",e)}},qc=()=>{try{const t=localStorage.getItem(R3);return t?JSON.parse(t):[]}catch{return[]}};function Iv({onBack:t,onSelectPet:e,onViewDiagnosis:s,onAddPet:n,onClinicMode:r,onHome:a,userId:o,onPetsUpdate:l,currentUser:c,selectedPet:u}){const h=()=>{const F=localStorage.getItem("mypage_initialTab");return F&&["pets","bookings","records"].includes(F)?(localStorage.removeItem("mypage_initialTab"),F):"pets"},[m,f]=O.useState(h);O.useEffect(()=>{const F=Q=>{Q.detail&&["pets","bookings","records"].includes(Q.detail)&&f(Q.detail)};return window.addEventListener("mypage-set-tab",F),()=>window.removeEventListener("mypage-set-tab",F)},[]);const[y,_]=O.useState([]),[S,R]=O.useState([]),[k,x]=O.useState([]),[A,M]=O.useState([]),[D,B]=O.useState(null),[v,N]=O.useState(null);O.useEffect(()=>{window.scrollTo(0,0)},[]),O.useEffect(()=>{if(o){_(O3(o)),R(L3(o));let F=null;try{const Q=_e(fe(se,"bookings"),pe("userId","==",o),Pt("createdAt","desc"));F=Vl(Q,async K=>{console.log("[]  :",K.docs.length,"");const I=K.docs.map(b=>({id:b.id,...b.data()})),W=(c==null?void 0:c.email)==="guardian@test.com"||(c==null?void 0:c.email)==="clinic@happyvet.com"?I.filter(b=>{const V=b.clinicName||b.hospitalName;return V&&(V.includes("")||V.includes("happyvet")||V.includes("Happy Vet"))}):I;M(W),Hc(o,W)},K=>{console.warn("   :",K),(async()=>{try{const L=await qi.getBookingsByUser(o,c);L.success&&L.data.length>0?(M(L.data),Hc(o,L.data)):M(zc(o))}catch(L){console.warn("Firestore   , localStorage :",L),M(zc(o))}})()})}catch(Q){console.warn("    :",Q),(async()=>{try{const I=await qi.getBookingsByUser(o,c);I.success&&I.data.length>0?(M(I.data),Hc(o,I.data)):M(zc(o))}catch(I){console.warn("Firestore   , localStorage :",I),M(zc(o))}})()}return()=>{F&&F()}}else _($3()),R(V3()),M(F3())},[o]),O.useEffect(()=>{if(!(c!=null&&c.uid))return;const F=y.map(L=>L.id).filter(Boolean),Q=y.map(L=>L.name||L.petName).filter(Boolean),K=(c==null?void 0:c.email)==="guardian@test.com"||(c==null?void 0:c.email)==="clinic@happyvet.com";let I=null;try{let L;try{K?L=_e(fe(se,"clinicResults"),pe("userId","==",c.uid)):L=_e(fe(se,"clinicResults"),pe("userId","==",c.uid),pe("sharedToGuardian","==",!0))}catch(W){console.warn("  :",W),L=_e(fe(se,"clinicResults"),pe("userId","==",c.uid))}I=Vl(L,W=>{console.log("[]   :",W.docs.length,""),console.log("[]   - petIds:",F,"petNames:",Q);const b=W.docs.map(q=>({id:q.id,...q.data()})),V=F.length>0||Q.length>0?b.filter(q=>q.petId&&F.includes(q.petId)?(console.log(`[] petId : ${q.petId}`),!0):q.petName&&Q.includes(q.petName)?(console.log(`[] petName : ${q.petName}`),!0):!1):b,J=K?V:V.filter(q=>q.sharedToGuardian===!0),z=Array.from(new Map(J.map(q=>[q.id,q])).values());z.sort((q,ae)=>{var ye,ht,Qe,an;const je=((ht=(ye=q.createdAt)==null?void 0:ye.toDate)==null?void 0:ht.call(ye))||new Date(q.visitDate||q.sharedAt||0);return(((an=(Qe=ae.createdAt)==null?void 0:Qe.toDate)==null?void 0:an.call(Qe))||new Date(ae.visitDate||ae.sharedAt||0))-je}),console.log(`    : ${z.length} (: ${b.length})`),x(z)},W=>{console.warn("    :",W),(async()=>{try{const V=[];if(F.length>0)for(const J of F){const z=await tr.getResultsByPet(J,c);if(z.success&&z.data.length>0){const q=K?z.data:z.data.filter(ae=>ae.sharedToGuardian===!0);V.push(...q)}}else{const J=_e(fe(se,"clinicResults"),pe("userId","==",c.uid)),q=(await Pe(J)).docs.map(je=>({id:je.id,...je.data()})),ae=K?q:q.filter(je=>je.sharedToGuardian===!0);V.push(...ae)}if(V.length>0){const J=Array.from(new Map(V.map(z=>[z.id,z])).values());J.sort((z,q)=>{var Ve,ye,ht,Qe;const ae=((ye=(Ve=z.createdAt)==null?void 0:Ve.toDate)==null?void 0:ye.call(Ve))||new Date(z.visitDate||0);return(((Qe=(ht=q.createdAt)==null?void 0:ht.toDate)==null?void 0:Qe.call(ht))||new Date(q.visitDate||0))-ae}),x(J)}else x(qc())}catch(V){console.warn("Firestore    :",V),x(qc())}})()})}catch(L){console.warn("     :",L),(async()=>{try{const b=[];if(F.length>0)for(const V of F){const J=await tr.getResultsByPet(V,c);if(J.success&&J.data.length>0){const z=K?J.data:J.data.filter(q=>q.sharedToGuardian===!0);b.push(...z)}}else{const V=_e(fe(se,"clinicResults"),pe("userId","==",c.uid)),z=(await Pe(V)).docs.map(ae=>({id:ae.id,...ae.data()})),q=K?z:z.filter(ae=>ae.sharedToGuardian===!0);b.push(...q)}if(b.length>0){const V=Array.from(new Map(b.map(J=>[J.id,J])).values());V.sort((J,z)=>{var je,Ve,ye,ht;const q=((Ve=(je=J.createdAt)==null?void 0:je.toDate)==null?void 0:Ve.call(je))||new Date(J.visitDate||0);return(((ht=(ye=z.createdAt)==null?void 0:ye.toDate)==null?void 0:ht.call(ye))||new Date(z.visitDate||0))-q}),x(V)}else x(qc())}catch(b){console.warn("Firestore    :",b),x(qc())}})()}return()=>{I&&I()}},[y,c==null?void 0:c.uid,c==null?void 0:c.email]);const w=F=>{B(F.id),N({...F})},E=()=>{if(!v)return;const F=y.map(Q=>Q.id===D?{...v}:Q);_(F),o?Nv(o,F):jv(F),l&&l(F),B(null),N(null)},C=()=>{B(null),N(null)},P=F=>{if(window.confirm(" ?")){const Q=y.filter(K=>K.id!==F);_(Q),o?Nv(o,Q):jv(Q),l&&l(Q)}},j=(F,Q)=>{N(K=>({...K,[F]:Q}))},re=F=>{switch(F){case"confirmed":return{label:" ",color:"bg-green-100 text-green-700",icon:"check_circle"};case"cancelled":return{label:" ",color:"bg-red-100 text-red-700",icon:"cancel"};case"completed":return{label:" ",color:"bg-slate-100 text-slate-700",icon:"task_alt"};default:return{label:" ",color:"bg-amber-100 text-amber-700",icon:"schedule"}}},Z=F=>{if(window.confirm(" ?")){const Q=A.map(K=>K.id===F?{...K,status:"cancelled"}:K);M(Q),o?Hc(o,Q):D3(Q)}},le=F=>new Date(F).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"short"}),ce=F=>{var L,W,b;const Q=F.petSpecies||((L=F.petProfile)==null?void 0:L.species),K=F.petBreed||((W=F.petProfile)==null?void 0:W.breed),I=F.petName||((b=F.petProfile)==null?void 0:b.name)||" ";return Q?`${C3[Q]||""}/${K||" "}[${I}]`:I};return i.jsxs("div",{className:"min-h-screen bg-background-light",children:[i.jsxs("div",{className:"flex items-center bg-background-light/80 p-3 sm:p-4 pb-2 justify-between sticky top-0 z-10 backdrop-blur-sm",children:[i.jsx("div",{className:"flex size-10 sm:size-12 shrink-0 items-center text-slate-800",children:i.jsx("button",{onClick:t,className:"p-1.5 sm:p-2 -ml-1 sm:-ml-2 text-slate-600 hover:bg-slate-100 rounded-full",children:i.jsx("span",{className:"material-symbols-outlined text-2xl sm:text-3xl",children:"arrow_back_ios_new"})})}),i.jsx("h2",{className:"text-slate-800 text-base sm:text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center font-display",children:""}),i.jsx("div",{className:"flex shrink-0 items-center justify-end gap-1",children:a&&i.jsx("button",{onClick:a,className:"p-1.5 sm:p-2 text-slate-600 hover:bg-slate-100 rounded-full",title:"",children:i.jsx("span",{className:"material-symbols-outlined text-xl sm:text-2xl",children:"home"})})})]}),i.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 pt-2 pb-2 bg-background-light border-b border-slate-200 overflow-x-auto",children:[i.jsx("button",{onClick:()=>f("pets"),className:`flex-1 py-2.5 sm:py-3 px-2 sm:px-3 rounded-lg font-medium text-xs sm:text-sm transition-colors whitespace-nowrap ${m==="pets"?"bg-primary text-white":"bg-surface-light text-slate-600"}`,children:" "}),i.jsxs("button",{onClick:()=>f("bookings"),className:`flex-1 py-2.5 sm:py-3 px-2 sm:px-3 rounded-lg font-medium text-xs sm:text-sm transition-colors whitespace-nowrap relative ${m==="bookings"?"bg-primary text-white":"bg-surface-light text-slate-600"}`,children:[" ",A.filter(F=>F.status==="pending").length>0&&i.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 sm:w-5 sm:h-5 bg-red-500 text-white text-[10px] sm:text-xs rounded-full flex items-center justify-center",children:A.filter(F=>F.status==="pending").length})]}),i.jsx("button",{onClick:()=>f("records"),className:`flex-1 py-2.5 sm:py-3 px-2 sm:px-3 rounded-lg font-medium text-xs sm:text-sm transition-colors whitespace-nowrap ${m==="records"?"bg-primary text-white":"bg-surface-light text-slate-600"}`,children:" "})]}),m==="pets"&&i.jsx("div",{className:"px-3 sm:px-4 pt-3 sm:pt-4 pb-40",children:y.length===0?i.jsxs("div",{className:"text-center py-16 sm:py-20",children:[i.jsx("div",{className:"text-5xl sm:text-6xl mb-3 sm:mb-4",children:""}),i.jsx("p",{className:"text-slate-500 mb-3 sm:mb-4 text-sm sm:text-base",children:"  "}),i.jsx("button",{onClick:()=>n&&n(),className:"bg-primary text-white px-5 sm:px-6 py-2.5 sm:py-3 rounded-lg font-bold hover:bg-primary/90 transition-colors text-sm sm:text-base",children:" "})]}):i.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[y.map(F=>i.jsx("div",{className:"bg-surface-light rounded-lg p-3 sm:p-4 shadow-soft",children:D===F.id?i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:" "}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-20 h-20 rounded-full bg-primary/20 flex items-center justify-center overflow-hidden",children:i.jsx("img",{src:(v==null?void 0:v.profileImage)||rf((v==null?void 0:v.species)||"dog"),alt:"",className:"w-full h-full object-cover"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("input",{type:"file",accept:"image/*",id:`profileImage-${F.id}`,className:"hidden",onChange:Q=>{const K=Q.target.files[0];if(K){if(K.size>5*1024*1024){alert("  5MB  .");return}const I=new FileReader;I.onload=L=>{j("profileImage",L.target.result)},I.readAsDataURL(K)}}}),i.jsxs("label",{htmlFor:`profileImage-${F.id}`,className:"inline-block px-4 py-2 bg-primary/10 text-primary rounded-lg font-medium cursor-pointer hover:bg-primary/20 transition-colors",children:[i.jsx("span",{className:"material-symbols-outlined text-sm align-middle mr-1",children:"photo_camera"})," "]}),(v==null?void 0:v.profileImage)&&i.jsx("button",{onClick:()=>j("profileImage",null),className:"ml-2 px-3 py-2 text-red-500 text-sm hover:bg-red-50 rounded-lg transition-colors",children:""})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:""}),i.jsx("input",{type:"text",value:(v==null?void 0:v.petName)||"",onChange:Q=>j("petName",Q.target.value),className:"w-full p-2 rounded-lg border border-slate-300 bg-white text-slate-900 focus:ring-primary focus:border-primary"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:""}),i.jsx("input",{type:"text",value:(v==null?void 0:v.breed)||"",onChange:Q=>j("breed",Q.target.value),className:"w-full p-2 rounded-lg border border-slate-300 bg-white text-slate-900 focus:ring-primary focus:border-primary"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:""}),i.jsx("input",{type:"date",value:(v==null?void 0:v.birthDate)||"",onChange:Q=>j("birthDate",Q.target.value),className:"w-full p-2 rounded-lg border border-slate-300 bg-white text-slate-900 focus:ring-primary focus:border-primary"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:E,className:"flex-1 bg-primary text-white py-2 rounded-lg font-medium hover:bg-primary/90 transition-colors",children:""}),i.jsx("button",{onClick:C,className:"flex-1 bg-slate-200 text-slate-700 py-2 rounded-lg font-medium hover:bg-slate-300 transition-colors",children:""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 mb-2 sm:mb-3",children:[i.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-full bg-primary/20 overflow-hidden flex-shrink-0",children:i.jsx("img",{src:Is(F,!1),alt:F.petName,className:"w-full h-full object-cover",style:{objectPosition:"center",display:"block"}})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"text-slate-900 font-bold text-base sm:text-lg mb-0.5 sm:mb-1 font-display truncate",children:F.petName}),i.jsxs("p",{className:"text-slate-500 text-xs sm:text-sm truncate",children:[F.breed||" ","  ",F.birthDate?(()=>{const Q=new Date(F.birthDate);return`${new Date().getFullYear()-Q.getFullYear()}`})():" "]}),F.sido&&i.jsxs("p",{className:"text-slate-400 text-[10px] sm:text-xs mt-0.5 sm:mt-1 truncate",children:[F.sido," ",F.sigungu]})]})]}),i.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[i.jsx("button",{onClick:()=>e&&e(F),className:"flex-1 bg-primary text-white py-1.5 sm:py-2 rounded-lg font-medium hover:bg-primary/90 transition-colors text-xs sm:text-sm",children:""}),i.jsx("button",{onClick:()=>w(F),className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-slate-200 text-slate-700 rounded-lg font-medium hover:bg-slate-300 transition-colors",children:i.jsx("span",{className:"material-symbols-outlined text-xs sm:text-sm",children:"edit"})}),i.jsx("button",{onClick:()=>P(F.id),className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-red-100 text-red-600 rounded-lg font-medium hover:bg-red-200 transition-colors",children:i.jsx("span",{className:"material-symbols-outlined text-xs sm:text-sm",children:"delete"})})]})]})},F.id)),i.jsxs("button",{onClick:()=>n&&n(),className:"w-full bg-primary/10 text-primary py-4 rounded-lg font-bold hover:bg-primary/20 transition-colors flex items-center justify-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined",children:"add"})," "]})]})}),m==="bookings"&&(()=>{const Q=[...u?A.filter(K=>{var W,b;if(K.petId&&K.petId===u.id)return!0;const I=K.petName||((W=K.pet)==null?void 0:W.name)||((b=K.pet)==null?void 0:b.petName),L=u.name||u.petName;return!!(I&&L&&I===L)}):A].sort((K,I)=>{var b,V,J,z;const L=K.date||K.bookingDate||((V=(b=K.createdAt)==null?void 0:b.toDate)==null?void 0:V.call(b))||new Date(K.createdAt||0),W=I.date||I.bookingDate||((z=(J=I.createdAt)==null?void 0:J.toDate)==null?void 0:z.call(J))||new Date(I.createdAt||0);return new Date(W)-new Date(L)});return i.jsx("div",{className:"px-3 sm:px-4 pt-3 sm:pt-4 pb-40",children:Q.length===0?i.jsxs("div",{className:"text-center py-16 sm:py-20",children:[i.jsx("div",{className:"text-5xl sm:text-6xl mb-3 sm:mb-4",children:""}),i.jsx("p",{className:"text-slate-500 mb-1.5 sm:mb-2 text-sm sm:text-base",children:"  "}),i.jsx("p",{className:"text-slate-400 text-xs sm:text-sm",children:"      "})]}):i.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-3 gap-1.5 sm:gap-2 mb-3 sm:mb-4",children:[i.jsxs("div",{className:"bg-amber-50 rounded-lg p-2 sm:p-3 text-center",children:[i.jsx("p",{className:"text-xl sm:text-2xl font-bold text-amber-600",children:Q.filter(K=>K.status==="pending").length}),i.jsx("p",{className:"text-[10px] sm:text-xs text-amber-700",children:""})]}),i.jsxs("div",{className:"bg-green-50 rounded-lg p-2 sm:p-3 text-center",children:[i.jsx("p",{className:"text-xl sm:text-2xl font-bold text-green-600",children:Q.filter(K=>K.status==="confirmed").length}),i.jsx("p",{className:"text-[10px] sm:text-xs text-green-700",children:""})]}),i.jsxs("div",{className:"bg-slate-50 rounded-lg p-2 sm:p-3 text-center",children:[i.jsx("p",{className:"text-xl sm:text-2xl font-bold text-slate-600",children:Q.filter(K=>K.status==="completed").length}),i.jsx("p",{className:"text-[10px] sm:text-xs text-slate-700",children:""})]})]}),Q.map(K=>{var L,W,b,V;const I=re(K.status);return i.jsxs("div",{className:"bg-surface-light rounded-lg p-4 shadow-soft",children:[i.jsxs("div",{className:"flex justify-between items-start mb-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-primary",children:"local_hospital"}),i.jsx("h3",{className:"text-slate-900 font-bold font-display",children:((L=K.hospital)==null?void 0:L.name)||""})]}),i.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${I.color}`,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:I.icon}),I.label]})]}),i.jsxs("div",{className:"space-y-2 mb-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[i.jsx("span",{className:"material-symbols-outlined text-sm text-slate-400",children:"calendar_today"}),i.jsx("span",{children:le(K.date)}),i.jsx("span",{className:"text-slate-400",children:"|"}),i.jsx("span",{className:"material-symbols-outlined text-sm text-slate-400",children:"schedule"}),i.jsx("span",{children:K.time})]}),i.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[i.jsx("span",{className:"material-symbols-outlined text-sm text-slate-400",children:"pets"}),i.jsx("span",{children:ce(K)})]}),((W=K.hospital)==null?void 0:W.address)&&i.jsxs("div",{className:"flex items-start gap-2 text-sm text-slate-500",children:[i.jsx("span",{className:"material-symbols-outlined text-sm text-slate-400",children:"location_on"}),i.jsx("span",{children:K.hospital.address})]})]}),K.message&&i.jsxs("div",{className:"bg-slate-50 rounded-lg p-2 mb-3 text-sm text-slate-600",children:[" ",K.message]}),K.status==="pending"&&i.jsxs("div",{className:"flex gap-2",children:[((b=K.hospital)==null?void 0:b.phone)&&i.jsx("a",{href:`tel:${K.hospital.phone}`,className:"flex-1 py-2 text-center border border-slate-200 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors",children:" "}),i.jsx("button",{onClick:()=>Z(K.id),className:"flex-1 py-2 text-center bg-red-50 text-red-600 rounded-lg text-sm font-medium hover:bg-red-100 transition-colors",children:" "})]}),K.status==="confirmed"&&((V=K.hospital)==null?void 0:V.phone)&&i.jsx("a",{href:`tel:${K.hospital.phone}`,className:"block w-full py-2 text-center bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors",children:"  "})]},K.id)})]})})})(),m==="records"&&(()=>{const F=u?S.filter(b=>{var z,q;if(b.petId&&b.petId===u.id)return!0;const V=b.petName||((z=b.pet)==null?void 0:z.name)||((q=b.pet)==null?void 0:q.petName),J=u.name||u.petName;return!!(V&&J&&V===J)}):S,Q=u?k.filter(b=>{var z,q;if(b.petId&&b.petId===u.id)return!0;const V=b.petName||((z=b.pet)==null?void 0:z.name)||((q=b.pet)==null?void 0:q.petName),J=u.name||u.petName;return!!(V&&J&&V===J)}):k,K=F.map(b=>({...b,source:"ai"})),L=((c==null?void 0:c.email)==="guardian@test.com"||(c==null?void 0:c.email)==="clinic@happyvet.com"?Q:Q.filter(b=>b.sharedToGuardian===!0)).map(b=>{var V,J,z,q;return{id:b.id,date:b.visitDate||b.createdAt,created_at:b.visitDate||b.createdAt,hospitalName:b.clinicName||b.hospitalName,diagnosis:b.mainDiagnosis||b.finalDiagnosis||b.diagnosis,petName:b.petName,petId:b.petId,riskLevel:b.triageScore<=2?"low":b.triageScore<=3?"medium":"high",treatment:((V=b.soap)==null?void 0:V.plan)||b.treatment,assessment:(J=b.soap)==null?void 0:J.assessment,subjective:(z=b.soap)==null?void 0:z.subjective,objective:(q=b.soap)==null?void 0:q.objective,triageScore:b.triageScore,medications:b.medications,totalCost:b.totalCost,doctorNote:b.doctorNote,source:"clinic",soap:b.soap,mainDiagnosis:b.mainDiagnosis||b.finalDiagnosis||b.diagnosis,summary:b.summary||b.description||b.memo||"",description:b.description||b.summary||b.memo||""}}),W=[...K,...L].sort((b,V)=>new Date(V.date||V.created_at)-new Date(b.date||b.created_at));return i.jsxs("div",{className:"px-4 pt-4 pb-40",children:[i.jsxs("div",{className:"flex items-center gap-4 mb-4 text-xs",children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"w-3 h-3 rounded-full bg-sky-200 border border-sky-300"}),i.jsx("span",{className:"text-slate-600",children:"AI "})]}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"w-3 h-3 rounded-full bg-red-200 border border-red-300"}),i.jsx("span",{className:"text-slate-600",children:" "})]})]}),W.length===0?i.jsxs("div",{className:"text-center py-20",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("p",{className:"text-slate-500 mb-2",children:"   "}),i.jsx("p",{className:"text-slate-400 text-sm",children:"AI    "})]}):i.jsx("div",{className:"space-y-4",children:W.map(b=>{var J,z,q;const V=y.find(ae=>ae.id===b.petId);if(b.source==="ai"){const ae=b.diagnosis||((z=(J=b.suspectedConditions)==null?void 0:J[0])==null?void 0:z.name)||"  ",je=b.description||b.detailDescription||"",Ve=b.actions||b.recommendedActions||[];return i.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden shadow-sm border border-slate-200 cursor-pointer hover:shadow-md transition-all active:scale-[0.98]",onClick:()=>{s&&(localStorage.setItem("mypage_initialTab","records"),s({...b,pet:V}))},children:[i.jsx("div",{className:"bg-gradient-to-br from-sky-300 via-sky-400 to-sky-500 p-5 text-white",children:i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-white",children:"info"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm opacity-90",children:" "}),i.jsx("h3",{className:"text-xl font-bold mt-1",children:ae}),i.jsx("p",{className:"text-xs opacity-80 mt-1",children:"AI     "})]})]})}),i.jsxs("div",{className:"p-4 space-y-4",children:[je&&i.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#38bdf8",strokeWidth:"2",children:[i.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),i.jsx("path",{d:"M14 2v6h6M16 13H8M16 17H8M10 9H8"})]}),i.jsx("h4",{className:"font-bold text-slate-800",children:" "})]}),i.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border-l-4 border-sky-400",children:i.jsx("p",{className:"text-sm text-slate-700 leading-relaxed whitespace-pre-line",children:je})})]}),Ve.length>0&&i.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-sky-100 flex items-center justify-center",children:i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#0ea5e9",strokeWidth:"2",children:[i.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),i.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]})}),i.jsx("h4",{className:"font-bold text-slate-800",children:" "})]}),i.jsx("div",{className:"space-y-2",children:Ve.map((ye,ht)=>{const Qe=typeof ye=="string"?ye:(ye==null?void 0:ye.title)||(ye==null?void 0:ye.description)||(ye==null?void 0:ye.text)||JSON.stringify(ye);return i.jsxs("div",{className:"flex items-start gap-3 bg-sky-50 rounded-lg p-3",children:[i.jsx("div",{className:"w-6 h-6 rounded-full bg-sky-500 text-white flex items-center justify-center text-xs font-bold flex-shrink-0",children:ht+1}),i.jsx("p",{className:"text-sm text-slate-700 flex-1",children:Qe})]},ht)})})]}),i.jsx("div",{className:"bg-amber-50 rounded-xl p-4 border border-amber-200",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-400 flex items-center justify-center flex-shrink-0",children:i.jsx("span",{className:"material-symbols-outlined text-white text-sm",children:"info"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h5",{className:"font-bold text-slate-800 mb-1",children:" "}),i.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:"  AI  .          ."})]})]})})]})]},b.id)}if(b.source==="clinic"){const ae=b.mainDiagnosis||b.diagnosis||" ",je=b.summary||b.description||b.doctorNote||"",Ve=((q=b.soap)==null?void 0:q.plan)||b.treatment||"",ye=b.soap||{};return i.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden shadow-sm border border-slate-200 cursor-pointer hover:shadow-md transition-all active:scale-[0.98]",onClick:()=>{s&&(localStorage.setItem("mypage_initialTab","records"),s({...b,pet:V}))},children:[i.jsx("div",{className:"bg-gradient-to-br from-red-200 via-red-300 to-red-400 p-5 text-white",children:i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-white",children:"local_hospital"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm opacity-90",children:" "}),i.jsx("h3",{className:"text-xl font-bold mt-1",children:ae}),i.jsx("p",{className:"text-xs opacity-80 mt-1",children:"  "}),b.hospitalName&&i.jsx("p",{className:"text-xs opacity-70 mt-1",children:b.hospitalName})]})]})}),i.jsxs("div",{className:"p-4 space-y-4",children:[ye.subjective&&i.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#dc2626",strokeWidth:"2",children:[i.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),i.jsx("path",{d:"M14 2v6h6M16 13H8M16 17H8M10 9H8"})]}),i.jsx("h4",{className:"font-bold text-slate-800",children:"Subjective ( )"})]}),i.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border-l-4 border-red-400",children:i.jsx("p",{className:"text-sm text-slate-700 leading-relaxed whitespace-pre-line",children:ye.subjective})})]}),ye.objective&&i.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#dc2626",strokeWidth:"2",children:[i.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),i.jsx("path",{d:"M14 2v6h6M16 13H8M16 17H8M10 9H8"})]}),i.jsx("h4",{className:"font-bold text-slate-800",children:"Objective ( )"})]}),i.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border-l-4 border-red-400",children:i.jsx("p",{className:"text-sm text-slate-700 leading-relaxed whitespace-pre-line",children:ye.objective})})]}),ye.assessment&&i.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#dc2626",strokeWidth:"2",children:[i.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),i.jsx("path",{d:"M14 2v6h6M16 13H8M16 17H8M10 9H8"})]}),i.jsx("h4",{className:"font-bold text-slate-800",children:"Assessment ()"})]}),i.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border-l-4 border-red-400",children:i.jsx("p",{className:"text-sm text-slate-700 leading-relaxed whitespace-pre-line",children:ye.assessment})})]}),je&&i.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#dc2626",strokeWidth:"2",children:[i.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),i.jsx("path",{d:"M14 2v6h6M16 13H8M16 17H8M10 9H8"})]}),i.jsx("h4",{className:"font-bold text-slate-800",children:" "})]}),i.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border-l-4 border-red-400",children:i.jsx("p",{className:"text-sm text-slate-700 leading-relaxed whitespace-pre-line",children:je})})]}),Ve&&i.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#dc2626",strokeWidth:"2",children:[i.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),i.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]})}),i.jsx("h4",{className:"font-bold text-slate-800",children:" "})]}),i.jsx("div",{className:"bg-red-50 rounded-lg p-4 border-l-4 border-red-400",children:i.jsx("p",{className:"text-sm text-slate-700 leading-relaxed whitespace-pre-line",children:Ve})})]}),i.jsx("div",{className:"bg-amber-50 rounded-xl p-4 border border-amber-200",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-400 flex items-center justify-center flex-shrink-0",children:i.jsx("span",{className:"material-symbols-outlined text-white text-sm",children:"info"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h5",{className:"font-bold text-slate-800 mb-1",children:" "}),i.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:"      ."})]})]})})]})]},b.id)}return null})})]})})()]})}function U3({variant:t="default"}){return i.jsxs("div",{className:`floating-background ${t}`,children:[i.jsx("div",{className:"bg-shape shape-1"}),i.jsx("div",{className:"bg-shape shape-2"}),i.jsx("div",{className:"bg-shape shape-3"}),i.jsx("div",{className:"bg-shape shape-4"}),i.jsx("div",{className:"bg-shape shape-5"}),i.jsxs("div",{className:"paw-particles",children:[i.jsx("span",{className:"paw-particle",children:""}),i.jsx("span",{className:"paw-particle",children:""}),i.jsx("span",{className:"paw-particle",children:""}),i.jsx("span",{className:"paw-particle",children:""}),i.jsx("span",{className:"paw-particle",children:""})]})]})}const B3="petMedical_dailyLogs",z3=t=>{try{return JSON.parse(localStorage.getItem(B3)||"{}")[t]||[]}catch{return[]}};function H3(t,e){const s=`carelog_${t}`,n=JSON.parse(localStorage.getItem(s)||"{}");n[e.date]=e,localStorage.setItem(s,JSON.stringify(n))}function q3(t){const e=`carelog_${t}`;return JSON.parse(localStorage.getItem(e)||"{}")}function xj(t,e=7){const s=q3(t);return Object.keys(s).sort().slice(-e).map(a=>s[a]).filter(a=>a&&a.date)}const fs={GEMINI:"gemini",OPENAI:"openai",ANTHROPIC:"anthropic"},rn=t=>{switch(t){case fs.GEMINI:return null;case fs.OPENAI:return null;case fs.ANTHROPIC:return null;default:return null}},ea=`
   AI   "PetMedical.AI"   .
     .

-   , ()  .
-  ,        .
-      "" ,    .
-   ,    .
-    JSON  .     .
`,Cs=t=>({dog:"",cat:"",rabbit:"",hamster:"",bird:"",hedgehog:"",reptile:"",etc:" ",other:" "})[t]||t||"",W3=async(t,e)=>{const s=rn(fs.GEMINI);if(!s)throw new Error("Gemini API   .  > API   .");const n=e.slice(-7);if(n.length<3)return{patterns:[],predictions:[],health_flags:{energy_level:.8,ear_issue:!1,digestion_issue:!1,skin_issue:!1},recommendations:["   ."]};const r=`     .

 :
- : ${t.petName}
- : ${Cs(t.species)}
- : ${t.breed||""}

 7  :
${JSON.stringify(n,null,2)}

 JSON    :
{
  "patterns": [
    "  1",
    "  2"
  ],
  "predictions": [
    "   1",
    "   2"
  ],
  "health_flags": {
    "energy_level": 0.0-1.0,
    "ear_issue": true/false,
    "digestion_issue": true/false,
    "skin_issue": true/false
  },
  "recommendations": [
    "  1",
    "  2"
  ]
}

 .`;try{const a=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:r}]}]})});if(!a.ok)throw new Error(`Gemini API : ${a.status}`);const c=(await a.json()).candidates[0].content.parts[0].text.match(/\{[\s\S]*\}/);if(c)return JSON.parse(c[0]);throw new Error("JSON  ")}catch(a){console.error("  :",a);const o=n.reduce((m,f)=>m+(f.food_count||0),0)/n.length,l=n.reduce((m,f)=>m+(f.activity_level||5),0)/n.length,c=[],u=[],h={energy_level:Math.min(1,l/10),ear_issue:!1,digestion_issue:o<2,skin_issue:!1};return o<2&&(c.push("    ."),u.push("    .")),l<5&&(c.push("  ."),u.push("  .")),{patterns:c,predictions:u,health_flags:h,recommendations:["   ."]}}},K3=async(t,e,s,n)=>{var c;const r=rn(fs.ANTHROPIC);if(!r)throw new Error("Claude API   .  > API   .");const a="claude-sonnet-4-20250514",o=`${ea}

 "Triage Engine".

[]
- Medical Agent       .
- 0~5  triage_score . (0=  , 5=  )
- health_flags     ,     .
-   ( )      .

[  - JSON ONLY]
  JSON  .    .

{
  "triage_score": 0,
  "triage_level": "green | yellow | orange | red",
  "emergency_summary_kor": "    ",
  "recommended_action_window": "  |   | 24~48  |    |  ",
  "health_flags": {
    "earIssue": false,
    "digestionIssue": false,
    "skinIssue": false,
    "fever": false,
    "energyLevel": 0.8
  }
}

 :
- triage_score:
  - 0~1:      ,   
  - 2: ,      ,    
  - 3:    24~48      
  - 4:  ,    
  - 5: ,    

- triage_level:
  - green: 0~1  " .  ."
  - yellow: 2  " .     ."
  - orange: 3~4  "24    ."
  - red: 5  "   ."

- recommended_action_window  :
  - " ": green ,    
  - "  ": yellow ,    
  - "24~48 ": orange ,   
  - " ": orange 
  - " ": red , 

- health_flags:
  - Medical Agent possible_diseases body_part, risk_level   
  - energyLevel: 0~1   (0= , 1=   )

:  ( ,  ,   ,   ) triage_score 0~2    .      .`,l=` :
- : ${t.petName}
- : ${Cs(t.species)}
- : ${t.age||""}

: ${(e==null?void 0:e.symptomText)||"  "}
${e!=null&&e.guardianResponsesSummary?`
     (  -    ) 
${e.guardianResponsesSummary}

:        triage_score  :
-    " " +1
-  "  "  "  " +1
-  "  " +1
-   "", ""  +2
`:""}

 :
${JSON.stringify(s,null,2)}

CS Agent :
${JSON.stringify(n,null,2)}

  JSON .`;try{const u=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":r,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:a,max_tokens:1024,system:o,messages:[{role:"user",content:l}]})});if(!u.ok){const y=await u.json().catch(()=>({}));throw new Error(`Claude API : ${u.status} - ${((c=y.error)==null?void 0:c.message)||"   "}`)}const m=(await u.json()).content[0].text;let f;try{const y=m.match(/\{[\s\S]*\}/);f=JSON.parse(y?y[0]:m)}catch(y){throw console.error("JSON  :",y),new Error("  ")}return f}catch(u){console.error("Triage Engine :",u);const h=(s==null?void 0:s.risk_level)||(s==null?void 0:s.riskLevel)||"moderate";let m=2,f="yellow",y="24~48 ";h==="emergency"||h==="Emergency"?(m=5,f="red",y=" "):h==="high"||h==="High"?(m=4,f="orange",y=" "):h==="low"||h==="Low"?(m=1,f="green",y=" "):(m=3,f="orange",y="24~48 ");const _=(s==null?void 0:s.possible_diseases)||[],S={earIssue:_.some(R=>R.body_part===""),digestionIssue:_.some(R=>R.body_part===""),skinIssue:_.some(R=>R.body_part===""),fever:!1,energyLevel:m<=2?.8:m<=3?.6:.4};return{triage_score:m,triage_level:f,emergency_summary_kor:`${y}   .`,recommended_action_window:y,health_flags:S}}},Mf=async(t,e,s,n="")=>{var o,l,c,u,h;if(e.hospitalPacket){const m=e.hospitalPacket,f=m.requested_actions_for_hospital||[],y=n?n.trim():"";return{packet_text:`
=== ${m.packet_title} ===

[ ]
: ${m.pet_profile_brief.name}
/: ${Cs(m.pet_profile_brief.species)} / ${m.pet_profile_brief.breed}
${m.pet_profile_brief.age_info?`: ${m.pet_profile_brief.age_info}`:""}
${m.pet_profile_brief.sex_neutered?`: ${m.pet_profile_brief.sex_neutered}`:""}

[ ]
${m.for_vet_summary}

[ ]
${m.visit_reason}

[ ]
${m.symptom_timeline}

[AI  ]
${m.ai_differential_diagnosis.map((S,R)=>`${R+1}. ${S.name_kor} (: ${Math.round(S.probability*100)}%)
   ${S.note_for_vet||""}`).join(`

`)}

[ ]
Triage Score: ${m.triage_and_risk.triage_score}/5
: ${m.triage_and_risk.triage_level}
: ${m.triage_and_risk.risk_level}
: ${m.triage_and_risk.urgency_comment}

[AI  /]
${f.length>0?f.map(S=>`- ${S}`).join(`
`):"-    "}

[ ]
${y||"- "}
    `.trim(),packet_json:{...m,owner_request_note:y}}}const r=rn(fs.GEMINI);if(!r)throw new Error("Gemini API   .  > API   .");n&&n.trim();const a=`       .

           .

 :
- : ${t.petName}
- : ${Cs(t.species)}
- : ${t.breed||""}
- : ${t.age||""}
${t.weight?`- : ${t.weight}kg`:""}

:
${(s==null?void 0:s.symptomText)||"  "}
${((o=s==null?void 0:s.images)==null?void 0:o.length)>0?`
 ${s.images.length} `:""}

AI  :
${JSON.stringify(e,null,2)}

     :

=== AI    ===

[ ]
: ${t.petName}
/: ${Cs(t.species)} / ${t.breed||""}
/: ${t.age||""} / ${t.weight||""}kg

[ ]
${(s==null?void 0:s.symptomText)||"  "}

[AI   Top 3]
1. ${e.diagnosis||"  "} (: ${e.probability||60}%)
2. [  ]
3. [  ]

[ ]
${e.riskLevel||"Moderate"} - ${e.emergency||"medium"}

[  ]
- [ 1]
- [ 2]

[/]
${((l=s==null?void 0:s.images)==null?void 0:l.length)>0?`  ${s.images.length} `:""}

[  ]
${((c=e.conversationHistory)==null?void 0:c.length)>0?e.conversationHistory.join(`
`):""}

[  ]
${((u=e.actions)==null?void 0:u.map(m=>`- ${m}`).join(`
`))||"-   "}

   .`;try{const m=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":r,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-5-sonnet-20241022",max_tokens:2e3,messages:[{role:"user",content:a}]})});if(!m.ok)throw new Error(`Anthropic API : ${m.status}`);return{packet_text:(await m.json()).content[0].text,packet_json:{pet_name:t.petName,species:t.species,breed:t.breed,diagnosis:e.diagnosis,risk_level:e.riskLevel,symptoms:s==null?void 0:s.symptomText,images_count:((h=s==null?void 0:s.images)==null?void 0:h.length)||0,created_at:new Date().toISOString()}}}catch(m){return console.error("   :",m),{packet_text:`=== AI    ===

: ${t.petName}
: ${(s==null?void 0:s.symptomText)||"  "}
: ${e.diagnosis||"  "}
: ${e.riskLevel||"Moderate"}`,packet_json:{pet_name:t.petName,diagnosis:e.diagnosis,risk_level:e.riskLevel}}}},G3="6a6433ff3ccbbc31a0448cae49055e4d";let Wc=!1,Kc=null;function ih(){return Wc?Promise.resolve(window.kakao):Kc||(Kc=new Promise((t,e)=>{if(window.kakao&&window.kakao.maps){Wc=!0,t(window.kakao);return}const s=setInterval(()=>{window.kakao&&window.kakao.maps&&(clearInterval(s),Wc=!0,t(window.kakao))},100);setTimeout(()=>{clearInterval(s),Wc||e(new Error("Kakao Maps SDK  "))},1e4)}),Kc)}function Sv(){return new Promise(t=>{if(!navigator.geolocation){t({lat:37.4979,lng:127.0276,isReal:!1,error:"     ."});return}navigator.geolocation.getCurrentPosition(e=>{console.log("   :",e.coords.latitude,e.coords.longitude),t({lat:e.coords.latitude,lng:e.coords.longitude,isReal:!0})},e=>{let s="   .";switch(e.code){case e.PERMISSION_DENIED:s="  .     .";break;case e.POSITION_UNAVAILABLE:s="    .";break;case e.TIMEOUT:s="   .";break}console.warn("  :",s),t({lat:37.4979,lng:127.0276,isReal:!1,error:s})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})})}async function am(t,e,s=5e3){console.log("[KakaoMap]   :",{lat:t,lng:e,radius:s});try{const n=await ih();return console.log("[KakaoMap] SDK  "),new Promise((r,a)=>{const o=new n.maps.services.Places,l=function(u,h){if(console.log("[KakaoMap]  :",{status:h,resultCount:u==null?void 0:u.length}),h===n.maps.services.Status.OK){const m=u.map(f=>({id:f.id,name:f.place_name,address:f.address_name,roadAddress:f.road_address_name,phone:f.phone,distance:parseInt(f.distance),lat:parseFloat(f.y),lng:parseFloat(f.x),category:f.category_name,url:f.place_url,is24Hours:f.place_name.includes("24")||f.place_name.includes("")})).sort((f,y)=>f.distance-y.distance);console.log("[KakaoMap]  :",m.length,"  "),r(m)}else h===n.maps.services.Status.ZERO_RESULT?(console.log("[KakaoMap]   "),r([])):(console.error("[KakaoMap]  :",h),a(new Error("   : "+h)))},c={location:new n.maps.LatLng(t,e),radius:s,sort:n.maps.services.SortBy.DISTANCE};console.log("[KakaoMap] keywordSearch "),o.keywordSearch("",l,c)})}catch(n){return console.error("[KakaoMap]   :",n),console.log("[KakaoMap] Mock  "),Q3(t,e)}}function Q3(t,e){return[{name:"24 SNC ",address:"   823-33",roadAddress:"   152",phone:"02-555-7582",baseLat:37.5012,baseLng:127.0396,is24Hours:!0},{name:"",address:"   118-17",roadAddress:"   317",phone:"02-511-7522",baseLat:37.5245,baseLng:127.0472,is24Hours:!1},{name:"",address:"   1303-22",roadAddress:"   254",phone:"02-525-6645",baseLat:37.4916,baseLng:127.0076,is24Hours:!0},{name:" ",address:"   184-21",roadAddress:"   135",phone:"02-421-7588",baseLat:37.5133,baseLng:127.1001,is24Hours:!1},{name:"VIP",address:"   827-2",roadAddress:"   385",phone:"02-2691-7500",baseLat:37.5509,baseLng:126.8495,is24Hours:!0},{name:"",address:"   546-4",roadAddress:"   478",phone:"02-447-7975",baseLat:37.5432,baseLng:127.0857,is24Hours:!1}].map((n,r)=>{const a=Math.round(Math.sqrt(Math.pow((n.baseLat-t)*111e3,2)+Math.pow((n.baseLng-e)*88e3,2)));return{id:`real_${r}`,name:n.name,address:n.address,roadAddress:n.roadAddress,phone:n.phone,distance:a,lat:n.baseLat,lng:n.baseLng,category:" > ",url:`https://map.kakao.com/link/search/${encodeURIComponent(n.name)}`,is24Hours:n.is24Hours,rating:(4+Math.random()*.9).toFixed(1),reviewCount:Math.floor(80+Math.random()*300),homepage:null,businessHours:n.is24Hours?"24 ":"09:00 - 21:00"}}).sort((n,r)=>n.distance-r.distance)}async function J3(t){console.log("[KakaoMap]   :",t);try{const e=`${t} `,n=`https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(e)}&category_group_code=HP8&size=15`;console.log("[KakaoMap] REST API :",n);const r=await fetch(n,{method:"GET",headers:{Authorization:`KakaoAK ${G3}`}});if(!r.ok){const o=await r.text();throw console.error("[KakaoMap] REST API :",r.status,o),r.status===0||r.status===403?new Error("CORS :     ."):new Error(` API  : ${r.status}`)}const a=await r.json();if(console.log("[KakaoMap] REST API :",a),a.documents&&a.documents.length>0){const o=a.documents.map(l=>({id:l.id,name:l.place_name,address:l.address_name,roadAddress:l.road_address_name,phone:l.phone,lat:parseFloat(l.y),lng:parseFloat(l.x),category:l.category_name,url:l.place_url,distance:l.distance?parseInt(l.distance):null,is24Hours:l.place_name.includes("24")||l.place_name.includes("")}));return console.log("[KakaoMap]   :",o.length,"  "),o}else return console.log("[KakaoMap]   "),[]}catch(e){throw console.error("[KakaoMap]   :",e),e.message.includes("CORS")?new Error("      .    ."):e}}async function Y3(t,e,s){const n=await ih(),r=document.getElementById(t);if(!r)throw new Error("    .");const a={center:new n.maps.LatLng(e,s),level:5};return new n.maps.Map(r,a)}async function X3(t,e,s,n,r=!1){const a=await ih(),o=r?"https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png":"https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker.png",l=new a.maps.Size(24,35),c={offset:new a.maps.Point(12,35)},u=new a.maps.MarkerImage(o,l,c),h=new a.maps.LatLng(e,s),m=new a.maps.Marker({position:h,image:u,title:n});m.setMap(t);const f=new a.maps.InfoWindow({content:`<div style="padding:5px;font-size:12px;">${n}</div>`});return a.maps.event.addListener(m,"click",function(){f.open(t,m)}),m}function Z3(t,e,s,n){const a=h=>h*Math.PI/180,o=a(s-t),l=a(n-e),c=Math.sin(o/2)**2+Math.cos(a(t))*Math.cos(a(s))*Math.sin(l/2)**2;return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}async function om(t,e,s=5){try{console.log("[Firestore]    :",{userLat:t,userLng:e,radiusKm:s});const n=s/111,r=_e(fe(se,"animal_hospitals"),pe("location.lat",">=",t-n),pe("location.lat","<=",t+n),zs(500)),a=await Pe(r);console.log("[Firestore]  :",a.size,"");const o=[];return a.forEach(l=>{const c=l.data();if(!c.location||c.location.lat==null||c.location.lng==null)return;const u=Z3(t,e,c.location.lat,c.location.lng);if(u<=s){const h=c.name||c.||" ";o.push({id:l.id,name:h,phone:c.phone||c.||null,address:c.address_jibun||c.||null,roadAddress:c.address_road||c.||null,lat:c.location.lat,lng:c.location.lng,distance:Math.round(u*1e3),distanceKm:Number(u.toFixed(2)),category:"",url:`https://map.kakao.com/link/search/${encodeURIComponent(h)}`,businessStatus:c.||"",is24Hours:h.includes("24")||h.includes("24")||h.includes("")})}}),o.sort((l,c)=>(l.distance||0)-(c.distance||0)),console.log("[Firestore]   :",o.length,""),o}catch(n){throw console.error("[Firestore]   :",n),n}}async function e6(t,e=50){try{console.log("[Firestore]  :",t);const s=_e(fe(se,"animal_hospitals"),zs(2e3)),n=await Pe(s);console.log("[Firestore]  :",n.size,"");const r=[],a=t.toLowerCase().trim();return n.forEach(o=>{var m,f;const l=o.data(),c=(l.address_jibun||l.||"").toLowerCase(),u=(l.address_road||l.||"").toLowerCase(),h=(l.name||l.||"").toLowerCase();if(c.includes(a)||u.includes(a)||h.includes(a)){const y=l.name||l.||" ";r.push({id:o.id,name:y,phone:l.phone||l.||null,address:l.address_jibun||l.||null,roadAddress:l.address_road||l.||null,lat:((m=l.location)==null?void 0:m.lat)||null,lng:((f=l.location)==null?void 0:f.lng)||null,distance:null,category:"",url:`https://map.kakao.com/link/search/${encodeURIComponent(y)}`,businessStatus:l.||"",is24Hours:y.includes("24")||y.includes("24")||y.includes("")})}}),console.log("[Firestore]   :",r.length,""),r.slice(0,e)}catch(s){throw console.error("[Firestore]   :",s),s}}const t6="BKEaMLnqCvGpIMgn0Qi8eWq3WgzyHtu-pVVcHkBOJLSLYK3WcZ7lZJI8p7Gja0lHM5MPEL8f9CVJEFcJW02SAXM";async function Of(t){var e,s,n;if(!Ul)return console.warn("Firebase Messaging  ."),null;try{if(!("serviceWorker"in navigator))return console.warn("Service Worker   ."),null;if(await Notification.requestPermission()!=="granted")return console.warn("   ."),null;const a=await I3(Ul,{vapidKey:t6});if(a){try{await Zi(st(se,"users",t),{fcmToken:a,fcmTokenUpdatedAt:new Date().toISOString()}),console.log("    :",a)}catch(o){o.code==="permission-denied"||(e=o.message)!=null&&e.includes("Missing or insufficient permissions")?console.warn("       (Firestore    ):",o.message):console.warn("    :",o)}return a}return null}catch(r){return r.code==="messaging/failed-service-worker-registration"||(s=r.message)!=null&&s.includes("ServiceWorker")||(n=r.message)!=null&&n.includes("404")?(console.warn("     (Service Worker ).   ."),null):(console.error("    :",r),null)}}async function yj(t,e,s,n={}){try{const r=_e(fe(se,"clinicStaff"),pe("clinicId","==",t),pe("isActive","==",!0)),a=await Pe(r),o=[],l=[];for(const u of a.docs){const h=u.data();l.push(h.userId);const m=await Ht(st(se,"users",h.userId));if(m.exists()){const f=m.data();f.fcmToken&&o.push(f.fcmToken)}}const c={type:"clinic_notification",clinicId:t,title:e,body:s,data:n,tokens:o,staffUserIds:l,createdAt:new Date().toISOString(),sent:!1,read:!1};return await as(fe(se,"notificationQueue"),c),o.length===0?(console.log("   (   -   )"),{success:!0,tokensCount:0,message:"  (  )"}):(console.log(`   : ${o.length}  `),{success:!0,tokensCount:o.length})}catch(r){return console.error("     :",r),{success:!1,error:r.message}}}async function s6(t,e,s,n={}){try{const r=await Ht(st(se,"users",t));if(!r.exists())return{success:!1,message:"   ."};const o=r.data().fcmToken;if(!o)return console.warn("    ."),{success:!1,message:"   ."};const l={type:"guardian_notification",userId:t,title:e,body:s,data:n,token:o,createdAt:new Date().toISOString(),sent:!1};return await as(fe(se,"notificationQueue"),l),console.log("    "),{success:!0}}catch(r){return console.error("    :",r),{success:!1,error:r.message}}}function vj(t){return Ul?S3(Ul,e=>{console.log("  :",e),t&&t(e)}):null}const kv=Object.freeze(Object.defineProperty({__proto__:null,requestPushPermission:Of,sendNotificationToClinicStaff:yj,sendNotificationToGuardian:s6,setupForegroundMessageHandler:vj},Symbol.toStringTag,{value:"Module"})),n6=async()=>{try{const t=fe(se,"clinics");try{const n=_e(t,pe("name","=="," "),zs(1)),r=await Pe(n);if(!r.empty){const a=r.docs[0];return console.log("[]  clinicId:",a.id,a.data().name),a.id}}catch(n){console.warn("[fetchHappyVetClinicId] exact match :",n)}try{const n=_e(t,pe("name","==",""),zs(1)),r=await Pe(n);if(!r.empty){const a=r.docs[0];return console.log("[]   clinicId:",a.id,a.data().name),a.id}}catch(n){console.warn("[fetchHappyVetClinicId] alt match :",n)}const e=await Pe(t);let s=null;for(const n of e.docs){const r=n.data().name||"";if(r.includes(" "))return console.log("[]   -   :",n.id,r),n.id}for(const n of e.docs){const r=(n.data().name||"").toLowerCase();if(r.includes("")||r.includes("happy"))return console.log("[]   - /happy :",n.id,n.data().name),n.id}if(e.docs.length>0){const n=e.docs[0];return console.log("[] fallback  :",n.id,n.data().name),n.id}}catch(t){console.error("[fetchHappyVetClinicId] :",t)}return"happyvet_test_clinic"},bj=t=>({id:t,name:" []  ",address:"   123",roadAddress:"   123",phone:"02-1234-5678",distance:0,lat:37.5012,lng:127.0396,category:"",is24Hours:!0,rating:"5.0",reviewCount:999,businessHours:"24  ()",isTestHospital:!0});let vs=bj("happyvet_test_clinic");const Ev=t=>{if(!t)return"";const e=new Date(t);return`${new Date().getFullYear()-e.getFullYear()}`},r6=async t=>{if(!t)return null;const e=new Date().toISOString().split("T")[0],s=`${t}_${e}`;try{const n=st(se,"dailyLogs",s),r=await Ht(n);if(!r.exists())return null;const a=r.data(),o=a==null?void 0:a.weight;return typeof o=="number"?o:null}catch(n){return console.warn("[] dailyLogs   :",n),null}},Lf=t=>{if(Array.isArray(t))return t.map(e=>Lf(e));if(t&&typeof t=="object"){const e={};return Object.entries(t).forEach(([s,n])=>{n===void 0?e[s]=null:e[s]=Lf(n)}),e}return t};function Tv({petData:t,diagnosis:e,symptomData:s,onBack:n,onSelectHospital:r,onHome:a,currentUser:o,onGoToMyBookings:l}){var di,ui,wn,fr;const[c,u]=O.useState(null),[h,m]=O.useState(!0),[f,y]=O.useState(null),[_,S]=O.useState([]),[R,k]=O.useState(!0),[x,A]=O.useState(null),[M,D]=O.useState(!1),[B,v]=O.useState(null),[N,w]=O.useState({}),[E,C]=O.useState({}),[P,j]=O.useState("firestore"),[re,Z]=O.useState("nearby"),[le,ce]=O.useState(!1),F=O.useRef(null),Q=O.useRef(null),[K,I]=O.useState(!1),[L,W]=O.useState(null),[b,V]=O.useState(""),[J,z]=O.useState(""),[q,ae]=O.useState(""),[je,Ve]=O.useState(!1),[ye,ht]=O.useState(vs),Qe=Y=>{const he=Y.find(ke=>ke.isTestHospital===!0),de=Y.filter(ke=>ke.isTestHospital!==!0);return he?[he,...de]:Y};O.useEffect(()=>{let Y=!0;return(async()=>{window.scrollTo(0,0);try{try{const de=await n6();if(Y&&de){const ke=bj(de);ht(ke),vs=ke,console.log("[]   ID :",de)}}catch(de){console.error("[] clinicId  :",de)}if(e&&t&&!c)try{const de=await Mf(t,e,s);Y&&u(de)}catch(de){console.error("  :",de)}Y&&m(!1);try{const de=await Sv();Y&&(A(de),D(de.isReal),de.error&&v(de.error));try{console.log("[HospitalBooking]    ");const ke=await am(de.lat,de.lng);if(Y&&ke.length>0){console.log("[HospitalBooking]   :",ke.length,"");const dt=Qe([ye||vs,...ke]);S(dt),j("kakao"),k(!1);return}}catch(ke){console.warn("[HospitalBooking]   , Firestore fallback:",ke)}try{console.log("[HospitalBooking] Firestore()   ");const ke=await om(de.lat,de.lng,5);if(Y&&ke.length>0){console.log("[HospitalBooking] Firestore  :",ke.length,"");const dt=Qe([ye||vs,...ke]);S(dt),j("firestore"),k(!1);return}}catch(ke){console.warn("[HospitalBooking] Firestore  :",ke)}if(Y){const ke=Qe([ye||vs]);S(ke),j("kakao"),k(!1)}}catch(de){if(console.error("/  :",de),Y){A({lat:37.4979,lng:127.0276});try{const we=await am(37.4979,127.0276);if(we.length>0){const $t=Qe([ye||vs,...we]);S($t),j("kakao"),k(!1);return}}catch(we){console.warn("[HospitalBooking]  fallback :",we)}try{const we=await om(37.4979,127.0276,5);if(we.length>0){const $t=Qe([ye||vs,...we]);S($t),j("firestore"),k(!1);return}}catch(we){console.warn("[HospitalBooking] Firestore fallback :",we)}const Rt=Qe([ye||vs,...[{id:"h1",name:"24 SNC ",address:"   823-33",roadAddress:"   152",phone:"02-555-7582",distance:850,lat:37.5012,lng:127.0396,category:"",is24Hours:!0,rating:"4.7",reviewCount:248,businessHours:"24 "},{id:"h2",name:"",address:"   1303-22",roadAddress:"   254",phone:"02-525-6645",distance:1200,lat:37.4916,lng:127.0076,category:"",is24Hours:!0,rating:"4.8",reviewCount:312,businessHours:"24 "}]]);S(Rt),k(!1)}}}catch(de){console.error(" :",de),Y&&(m(!1),k(!1))}})(),()=>{Y=!1}},[t,e,s]),O.useEffect(()=>{if(!x||!Q.current||_.length===0)return;(async()=>{try{const he="kakao-map-container";let de=document.getElementById(he);if(Q.current.innerHTML==="")de=document.createElement("div"),de.id=he,de.style.width="100%",de.style.height="300px",de.style.borderRadius="12px",Q.current.appendChild(de);else return;const ke=await Y3(he,x.lat,x.lng);F.current=ke;const dt=await ih(),$e=new dt.maps.LatLng(x.lat,x.lng);new dt.maps.Circle({center:$e,radius:50,strokeWeight:2,strokeColor:"#4C6FFF",strokeOpacity:.7,fillColor:"#4C6FFF",fillOpacity:.2}).setMap(ke);for(const we of _)await X3(ke,we.lat,we.lng,we.name,we.is24Hours);if(_.length>0){const we=_[0],$t=new dt.maps.LatLng(we.lat,we.lng);ke.panTo($t)}}catch(he){console.error("  :",he)}})()},[x,_]);const an=Y=>{W(Y),I(!0);const he=new Date().toISOString().split("T")[0];if(V(he),z(""),e){const de=e.symptom||(s==null?void 0:s.symptomText)||"",ke=e.diagnosis||"",dt=e.triage_level||"",$e=e.hospitalVisitTime||"";let Rt="";de&&(Rt+=`[] ${de}
`),ke&&(Rt+=`[AI ] ${ke}
`),dt&&(Rt+=`[] ${dt==="red"?"":dt==="orange"?" ":dt==="yellow"?"":""}
`),$e&&(Rt+=`[ ] ${$e}
`),ae(Rt.trim())}else ae("")},[jt,ie]=O.useState(!1);O.useEffect(()=>{K&&e&&ae(Y=>{const he=Y.replace(/\n* AI   \.?/g,"").trim();return jt?he+`

 AI   .`:he})},[jt,K,e]);const Te=async()=>{if(!b||!J){alert("  .");return}const Y=t==null?void 0:t.id,he=await r6(Y),de=typeof he=="number"?he:typeof(t==null?void 0:t.weight)=="number"?t.weight:t!=null&&t.weight&&Number(t.weight)||null,ke={id:(t==null?void 0:t.id)||null,name:(t==null?void 0:t.petName)||(t==null?void 0:t.name)||null,species:(t==null?void 0:t.species)||null,breed:(t==null?void 0:t.breed)||null,birthDate:(t==null?void 0:t.birthDate)||null,age:t!=null&&t.birthDate?Ev(t.birthDate):typeof(t==null?void 0:t.age)=="number"?t.age:null,sex:(t==null?void 0:t.sex)||null,neutered:typeof(t==null?void 0:t.neutered)=="boolean"?t.neutered:null,weight:de,allergies:Array.isArray(t==null?void 0:t.allergies)?t.allergies:[],chronicConditions:Array.isArray(t==null?void 0:t.chronicConditions)?t.chronicConditions:[]},dt=jt&&e?{id:e.id,createdAt:e.created_at||e.createdAt,symptom:e.symptom||(s==null?void 0:s.symptomText),symptomTimeline:e.symptomTimeline,diagnosis:e.diagnosis,possibleDiseases:e.possible_diseases||[],probability:e.probability,triageScore:e.triage_score,triageLevel:e.triage_level,riskLevel:e.riskLevel||e.emergency,hospitalVisitTime:e.hospitalVisitTime,actions:e.actions||[],ownerSheet:e.ownerSheet,careGuide:e.careGuide,carePlan:e.carePlan,healthFlags:e.healthFlags}:null,$e={id:"booking_"+Date.now(),petId:t==null?void 0:t.id,petName:t==null?void 0:t.petName,petSpecies:(t==null?void 0:t.species)||null,petBreed:(t==null?void 0:t.breed)||null,petProfile:ke,hospital:{id:L.id,name:L.name,address:L.roadAddress||L.address,phone:L.phone},date:b,time:J,message:q,status:"pending",createdAt:new Date().toISOString(),diagnosisId:jt&&e?e.id:null,aiDiagnosis:dt};try{const we=o==null?void 0:o.uid,$t=we?`petMedical_bookings_${we}`:"petMedical_bookings",Rs=JSON.parse(localStorage.getItem($t)||"[]");Rs.push($e),localStorage.setItem($t,JSON.stringify(Rs)),console.log("  localStorage  :",$t,$e.id)}catch(we){console.error(" localStorage  :",we)}try{let we=L.id,$t=L.id;try{const Nn=_e(fe(se,"clinics"),pe("name","==",L.name),zs(1)),Ks=await Pe(Nn);Ks.empty?console.warn("[] clinics    , animal_hospitals ID :",L.id):(we=Ks.docs[0].id,console.log("[] clinics ID :",we,":",L.name))}catch(Nn){console.warn("[] clinics  :",Nn)}const Rs={...$e,userId:(o==null?void 0:o.uid)||(t==null?void 0:t.userId)||null,clinicId:we,clinicName:L.name,animalHospitalId:$t,hospitalId:$t},_n=Lf(Rs),Bn=await qi.createBooking(_n);if(Bn.success){if(console.log("  Firestore  :",Bn.id,"clinicId:",we),console.log("  :",{clinicId:we,clinicName:L.name,date:b,time:J,petName:t==null?void 0:t.petName}),we)try{await yj(we,"  ",`${(t==null?void 0:t.petName)||""}  . (${b} ${J})`,{type:"booking_created",bookingId:Bn.id,clinicId:we,petName:t==null?void 0:t.petName,date:b,time:J,url:"/clinic-dashboard"}),console.log("      ")}catch(Nn){console.warn("    ( ):",Nn)}}else console.error("  Firestore  :",Bn.error),alert("  .  .")}catch(we){console.error("  Firestore  :",we),alert("    : "+we.message)}const Rt={...L,bookingDate:b,bookingTime:J,bookingMessage:q};y(Rt),r&&r(Rt),Ve(!0)},Ee=()=>{const Y=[],he=new Date,de=he.getHours(),ke=he.getMinutes(),dt=b===new Date().toISOString().split("T")[0];for(let $e=9;$e<=18;$e++)dt?($e>de&&Y.push(`${$e.toString().padStart(2,"0")}:00`),$e<18&&($e>de||$e===de&&ke<30)&&Y.push(`${$e.toString().padStart(2,"0")}:30`)):(Y.push(`${$e.toString().padStart(2,"0")}:00`),$e<18&&Y.push(`${$e.toString().padStart(2,"0")}:30`));return Y},Ce=async()=>{k(!0),v(null);try{const Y=await Sv();A(Y),D(Y.isReal),Y.error&&v(Y.error);const he=await am(Y.lat,Y.lng),de=Qe([ye||vs,...he]);S(de)}catch(Y){console.error("  :",Y)}finally{k(!1)}},ze=Y=>!Y&&Y!==0?"":Y<1e3?`${Y}m`:`${(Y/1e3).toFixed(1)}km`,ct=async Y=>{if(!(N[Y.id]||E[Y.id])){C(he=>({...he,[Y.id]:!0}));try{const he=rn(fs.GEMINI);if(he){const de=`         .

: ${Y.name}
: ${Y.address}
24 : ${Y.is24Hours?"":""}
: ${Y.distance?(Y.distance/1e3).toFixed(1)+"km":" "}

 :
- " ", "  ", " "      .
-      .
- 24 , ,     .
-     2-3  .
-    .`,ke=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${he}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:de}]}]})});if(ke.ok){const $e=(await ke.json()).candidates[0].content.parts[0].text;w(Rt=>({...Rt,[Y.id]:$e}))}else throw new Error("API  ")}else{let de="";Y.is24Hours?de=" 24  !      .":de=`${Y.name}()   ${Y.distance?(Y.distance/1e3).toFixed(1)+"km":""}   .`,w(ke=>({...ke,[Y.id]:de}))}}catch(he){console.error("   :",he);let de=Y.is24Hours?" 24    .":`${Y.name}()   .`;w(ke=>({...ke,[Y.id]:de}))}finally{C(he=>{const de={...he};return delete de[Y.id],de})}}},[Ne,Oe]=O.useState(""),Ze=async()=>{var Y;if(!Ne.trim()){if(x){ce(!0);try{const he=await om(x.lat,x.lng,5),de=Qe([ye||vs,...he]);S(de),Z("nearby")}catch(he){console.error("   :",he)}ce(!1)}return}ce(!0);try{console.log("[HospitalBooking] / :",Ne);try{const he=await J3(Ne);if(he&&he.length>0){console.log("[HospitalBooking]   :",he.length,"");const de=Qe([ye||vs,...he]);S(de),Z("region"),j("kakao"),ce(!1);return}}catch(he){console.warn("[HospitalBooking]   , Firestore fallback:",he)}try{const he=await e6(Ne,50);console.log("[HospitalBooking] Firestore  :",he.length,"");const de=Qe([ye||vs,...he]);S(de),Z("region"),j("firestore")}catch(he){console.error("[HospitalBooking] Firestore  :",he),(Y=he.message)!=null&&Y.includes("permissions")||he.code==="permission-denied"?alert("   .   , Firebase   ."):alert("   : "+he.message);const de=Qe([ye||vs]);S(de)}}catch(he){console.error(" :",he),alert("   : "+he.message);const de=Qe([ye||vs]);S(de)}ce(!1)},Ws=Y=>{Y.key==="Enter"&&Ze()};if(!t)return i.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:" "}),i.jsx("button",{onClick:n,className:"mt-4 bg-sky-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-sky-600 transition-colors",children:""})]})});const xs=_.find(Y=>Y.isTestHospital===!0),li=_.filter(Y=>Y.isTestHospital!==!0).filter(Y=>!Ne||Y.name.toLowerCase().includes(Ne.toLowerCase())||Y.address&&Y.address.toLowerCase().includes(Ne.toLowerCase())),ci=xs?[xs,...li]:li;return i.jsxs("div",{className:"min-h-screen bg-slate-50",children:[i.jsxs("div",{className:"bg-white px-4 py-4 border-b border-slate-100",children:[i.jsx("div",{className:"flex items-center gap-3 mb-2",children:i.jsx("button",{onClick:n,className:"text-slate-600",children:i.jsx("span",{className:"text-sm",children:" "})})}),i.jsx("h1",{className:"text-xl font-bold text-slate-900",children:" "})]}),i.jsxs("div",{className:"px-4 pt-4 pb-24 space-y-4",children:[!M&&x&&i.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-3",children:i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-amber-500 text-lg",children:""}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-amber-800",children:" ( )  "}),i.jsx("p",{className:"text-xs text-amber-600 mt-1",children:B||"       ."}),i.jsx("button",{onClick:Ce,className:"mt-2 px-3 py-1.5 bg-amber-500 text-white text-xs font-medium rounded-lg hover:bg-amber-600 transition-colors",children:"    "})]})]})}),M&&x&&i.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-3",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-green-500 text-lg",children:""}),i.jsx("p",{className:"text-sm font-medium text-green-800",children:"     "}),i.jsx("button",{onClick:Ce,className:"ml-auto px-2 py-1 text-xs text-green-600 hover:bg-green-100 rounded",children:" "})]})}),e&&i.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-accent/10 rounded-2xl shadow-soft border border-primary/20 overflow-hidden",children:[i.jsx("div",{className:"bg-gradient-to-r from-primary to-primary/80 px-4 py-3",children:i.jsxs("h3",{className:"font-bold text-white flex items-center gap-2 font-display",children:[i.jsx("span",{className:"material-symbols-outlined",children:"smart_toy"}),"AI  "]})}),h?i.jsxs("div",{className:"p-8 text-center text-gray-500",children:[i.jsx("div",{className:"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-2"}),"  ..."]}):i.jsxs("div",{className:"p-4 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-14 h-14 rounded-full bg-white shadow overflow-hidden",children:i.jsx("img",{src:Is(t,!1),alt:(t==null?void 0:t.petName)||"",className:"w-full h-full object-cover",style:{objectPosition:"center",display:"block"}})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-900",children:(t==null?void 0:t.petName)||""}),i.jsxs("p",{className:"text-sm text-slate-500",children:[t==null?void 0:t.breed,"  ",t!=null&&t.birthDate?Ev(t.birthDate):""]})]})]}),(e.diagnosis||((ui=(di=e.suspectedConditions)==null?void 0:di[0])==null?void 0:ui.name))&&i.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:[i.jsxs("p",{className:"text-xs text-amber-700 mb-1 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"diagnosis"}),"AI "]}),i.jsx("p",{className:"text-amber-900 font-bold",children:e.diagnosis||((fr=(wn=e.suspectedConditions)==null?void 0:wn[0])==null?void 0:fr.name)||"  "})]}),e.symptom&&i.jsxs("div",{className:"bg-white/60 rounded-lg p-3",children:[i.jsxs("p",{className:"text-xs text-slate-500 mb-1 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"symptoms"})," "]}),i.jsx("p",{className:"text-slate-800 font-medium",children:e.symptom})]}),e.possible_diseases&&e.possible_diseases.length>0&&i.jsxs("div",{className:"bg-white/60 rounded-lg p-3",children:[i.jsxs("p",{className:"text-xs text-slate-500 mb-2 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"psychology"}),"AI  "]}),i.jsx("div",{className:"space-y-2",children:e.possible_diseases.slice(0,2).map((Y,he)=>i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"text-slate-800 text-sm",children:Y.name||Y}),i.jsxs("span",{className:`text-sm font-bold ${he===0?"text-primary":"text-slate-500"}`,children:[Y.probability||Y.probability_percent||"N/A","%"]})]},he))})]}),i.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-200",children:[i.jsx("span",{className:"text-xs text-slate-500",children:"    "}),i.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-600 font-medium",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"check_circle"}),"  "]})]})]})]}),!e&&i.jsx("div",{className:"bg-gradient-to-br from-accent/20 to-accent/10 border border-accent/30 rounded-2xl p-4",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-accent/30 flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-accent",children:"lightbulb"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-800 mb-1",children:"  "}),i.jsx("p",{className:"text-sm text-slate-600",children:"AI         .          ."})]})]})}),(e==null?void 0:e.triage_score)!==void 0&&i.jsxs("div",{className:"bg-surface-light p-4 rounded-lg shadow-soft border border-slate-200",children:[i.jsxs("div",{className:"flex justify-between items-center mb-3",children:[i.jsxs("h3",{className:"font-bold text-slate-900 font-display flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-primary",children:"warning"})," "]}),i.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${e.triage_score>=4?"bg-red-100 text-red-600":e.triage_score>=3?"bg-orange-100 text-orange-600":"bg-green-100 text-green-600"}`,children:e.triage_level||"Normal"})]}),i.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden mb-2",children:i.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ${e.triage_score>=4?"bg-red-500":e.triage_score>=3?"bg-orange-500":e.triage_score>=2?"bg-yellow-500":"bg-green-500"}`,style:{width:`${e.triage_score/5*100}%`}})}),i.jsxs("p",{className:"text-xs text-gray-500 text-right",children:[e.hospitalVisitTime||"24 "," "]})]}),i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h3",{className:"font-bold text-slate-900",children:re==="nearby"?"   ":` "${Ne}"  `}),re==="region"&&i.jsx("button",{onClick:()=>{Oe(""),Ze()},className:"text-sm text-sky-500 font-medium",children:" "})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[i.jsxs("span",{children:[" ",P==="firestore"?" ()":""]}),i.jsx("span",{children:""}),i.jsxs("span",{children:[_.length," "]})]}),i.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[i.jsxs("div",{className:"relative flex-1 min-w-0",children:[i.jsx("input",{type:"text",placeholder:"  (: , )",value:Ne,onChange:Y=>Oe(Y.target.value),onKeyDown:Ws,className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 pl-8 sm:pl-10 bg-white border border-slate-200 rounded-xl text-xs sm:text-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500"}),i.jsx("span",{className:"absolute left-2.5 sm:left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm",children:""})]}),i.jsx("button",{onClick:Ze,disabled:le,className:"px-3 sm:px-4 py-2.5 sm:py-3 bg-sky-500 text-white text-xs sm:text-sm font-bold rounded-xl hover:bg-sky-600 transition-colors disabled:opacity-50 whitespace-nowrap flex-shrink-0",children:le?"":""})]}),i.jsxs("div",{className:"space-y-4",children:[le&&i.jsxs("div",{className:"text-center py-8 text-gray-500 bg-white rounded-2xl border border-slate-100",children:[i.jsx("div",{className:"w-6 h-6 border-2 border-sky-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),"  ..."]}),!le&&ci.length===0&&!R?i.jsx("div",{className:"text-center py-8 text-gray-500 bg-white rounded-2xl border border-slate-100",children:re==="region"?`"${Ne}"     .`:"    ."}):!le&&ci.map(Y=>i.jsxs("div",{className:"bg-white p-3 sm:p-4 rounded-2xl shadow-sm border border-slate-100",children:[i.jsxs("div",{className:"mb-2",children:[i.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[i.jsx("h4",{className:"font-bold text-sky-600 text-sm sm:text-base leading-tight",children:Y.name}),i.jsx("a",{href:Y.url||`https://map.kakao.com/link/search/${encodeURIComponent(Y.name)}`,target:"_blank",rel:"noopener noreferrer",className:"px-1 py-0.5 bg-[#FFEB00] text-[#3C1E1E] text-[9px] sm:text-[10px] font-medium rounded hover:bg-[#F5E100] transition-colors flex-shrink-0",children:""}),Y.is24Hours&&i.jsx("span",{className:"px-1 py-0.5 bg-red-500 text-white text-[9px] sm:text-[10px] font-medium rounded flex-shrink-0",children:"24"})]}),i.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mt-1 flex-wrap",children:[i.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 leading-tight",children:Y.roadAddress||Y.address}),Y.distance&&i.jsx("span",{className:"text-xs sm:text-sm font-bold text-red-500 flex-shrink-0",children:ze(Y.distance)})]})]}),i.jsx("div",{className:"mb-4",children:E[Y.id]?i.jsxs("div",{className:"text-xs text-slate-400 flex items-center gap-1",children:[i.jsx("div",{className:"w-3 h-3 border-2 border-slate-300 border-t-transparent rounded-full animate-spin"}),"   ..."]}):N[Y.id]?i.jsxs("div",{className:"bg-gradient-to-r from-sky-50 to-blue-50 rounded-xl p-3 border border-sky-200 shadow-sm",children:[i.jsxs("div",{className:"flex items-center gap-1.5 text-sky-700 font-bold text-sm mb-2",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("span",{children:"AI  "})]}),i.jsx("p",{className:"text-slate-700 text-sm leading-relaxed",children:N[Y.id]})]}):i.jsxs("button",{onClick:()=>ct(Y),className:"text-[10px] sm:text-xs text-sky-600 hover:text-sky-700 font-medium flex items-center gap-0.5 bg-sky-50 px-1.5 py-1 rounded hover:bg-sky-100 transition-colors",children:[i.jsx("span",{className:"text-[10px]",children:""}),i.jsx("span",{children:"AI  "})]})}),i.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[i.jsx("button",{onClick:()=>an(Y),className:"flex-1 py-2 sm:py-2.5 text-center bg-sky-500 text-white rounded-xl text-xs sm:text-sm font-bold hover:bg-sky-600 transition-colors flex items-center justify-center min-w-0",children:""}),i.jsxs("a",{href:x?`https://map.kakao.com/link/from/,${x.lat},${x.lng}/to/${encodeURIComponent(Y.name)},${Y.lat},${Y.lng}`:`https://map.kakao.com/link/to/${encodeURIComponent(Y.name)},${Y.lat},${Y.lng}`,target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-2 sm:py-2.5 text-center bg-[#FEE500] rounded-xl text-[10px] sm:text-xs font-bold text-[#3C1E1E] hover:bg-[#F5DC00] transition-colors flex items-center justify-center gap-0.5 sm:gap-1 min-w-0",children:[i.jsx("span",{children:""}),i.jsx("span",{className:"truncate",children:""})]}),i.jsxs("a",{href:"https://service.kakaomobility.com/launch/kakaot",target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-2 sm:py-2.5 text-center bg-[#1E1B4B] rounded-xl text-[10px] sm:text-xs font-bold hover:bg-[#2d2a5a] transition-colors flex items-center justify-center gap-0.5 min-w-0",children:[i.jsx("span",{className:"text-[#FACC15] truncate",children:"Kakao T"}),i.jsx("span",{className:"text-white truncate hidden xs:inline",children:""})]})]})]},Y.id))]})]}),K&&L&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999] animate-fade-in",onClick:Y=>{Y.target===Y.currentTarget&&I(!1)},children:i.jsx("div",{className:"bg-white rounded-3xl w-full max-w-md mx-4 p-4 pb-6 max-h-[90vh] overflow-y-auto",style:{overscrollBehavior:"contain"},children:je?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full mx-auto mb-4 flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-green-600 text-5xl",children:"check_circle"})}),i.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-2",children:"  !"}),i.jsx("p",{className:"text-slate-500 mb-6",children:"    ."}),i.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 text-left mb-6",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx("span",{className:"material-symbols-outlined text-primary",children:"local_hospital"}),i.jsx("span",{className:"font-bold text-slate-900",children:L.name})]}),i.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600",children:[i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"calendar_today"}),b]}),i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"schedule"}),J]})]})]}),i.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-6",children:i.jsxs("p",{className:"text-sm text-amber-800 flex items-start gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-amber-600 text-sm mt-0.5",children:"info"}),"     ."]})}),i.jsx("button",{onClick:()=>{I(!1),Ve(!1),l&&l()},className:"w-full py-3 bg-primary text-white font-bold rounded-lg hover:bg-primary/90 transition-colors",children:"  "})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsx("h3",{className:"text-xl font-bold text-slate-900",children:""}),i.jsx("button",{onClick:()=>I(!1),className:"p-2 text-slate-400 hover:text-slate-600 rounded-full hover:bg-slate-100",children:i.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),i.jsxs("div",{className:"bg-slate-50 rounded-lg p-2.5 mb-3",children:[i.jsx("p",{className:"font-bold text-slate-900 text-sm",children:L.name}),i.jsx("p",{className:"text-xs text-slate-500",children:L.roadAddress||L.address})]}),i.jsxs("div",{className:"flex gap-2 mb-3",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:" "}),i.jsx("input",{type:"date",value:b,onChange:Y=>V(Y.target.value),min:new Date().toISOString().split("T")[0],className:"w-full p-2 text-sm border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"})]}),i.jsxs("div",{className:"flex-1",children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:" "}),i.jsxs("select",{value:J,onChange:Y=>z(Y.target.value),className:"w-full p-2 text-sm border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary",children:[i.jsx("option",{value:"",children:" "}),Ee().map(Y=>i.jsx("option",{value:Y,children:Y},Y))]})]})]}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"   ()"}),i.jsx("textarea",{value:q,onChange:Y=>ae(Y.target.value),placeholder:"  ",rows:"2",className:"w-full p-2 text-sm border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary resize-none"})]}),e&&i.jsx("div",{className:"mb-3",children:i.jsxs("div",{className:`rounded-lg p-3 border-2 cursor-pointer transition-all ${jt?"border-primary bg-primary/10":"border-slate-200 bg-slate-50"}`,onClick:()=>ie(!jt),children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:`w-5 h-5 rounded flex items-center justify-center ${jt?"bg-primary":"bg-white border border-slate-300"}`,children:jt&&i.jsx("span",{className:"material-symbols-outlined text-white text-sm",children:"check"})}),i.jsx("span",{className:"font-bold text-slate-800 text-sm",children:"AI   "}),i.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ml-auto ${jt?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}`,children:jt?" ":""})]}),!jt&&i.jsx("p",{className:"text-xs text-slate-500 mt-1.5 ml-7",children:"        "})]})}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>I(!1),className:"flex-1 py-3 bg-slate-200 text-slate-700 font-bold rounded-lg hover:bg-slate-300 transition-colors",children:""}),i.jsx("button",{onClick:Te,className:"flex-1 py-3 bg-primary text-white font-bold rounded-lg hover:bg-primary/90 transition-colors shadow-lg shadow-primary/30",children:" "})]})]})})})]})}function i6({petData:t,diagnosis:e,hospital:s,hospitalPacket:n,onBack:r,onEdit:a,onSend:o,onSave:l}){var R,k;const[c,u]=O.useState(""),[h,m]=O.useState(!0),f=()=>Is(t,!1),y=()=>{if(!n)return null;const x=c.trim();let A=n.packet_text||"";return A.includes("[ ]")?A=A.replace(/\[ \]\n[\s\S]*$/,`[ ]
${x||"- "}`):A+=`

[ ]
${x||"- "}`,{...n,packet_text:A,packet_json:{...n.packet_json,owner_request_note:x},requestNote:x}};if(!t||!e||!s)return null;const _=x=>x>=4?"text-red-600 bg-red-100":x>=3?"text-orange-600 bg-orange-100":x>=2?"text-yellow-600 bg-yellow-100":"text-green-600 bg-green-100",S=x=>x>=4?"":x>=3?"":x>=2?"":"";return i.jsxs("div",{className:"page-container",children:[i.jsxs("div",{className:"page-header",children:[i.jsx("div",{className:"flex size-12 shrink-0 items-center text-slate-800",children:i.jsx("button",{onClick:r,className:"p-2 -ml-2 text-slate-600 hover:bg-slate-100 rounded-full",children:i.jsx("span",{className:"material-symbols-outlined text-3xl",children:"arrow_back_ios_new"})})}),i.jsx("h2",{className:"text-slate-800 text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center font-display",children:" "}),i.jsx("div",{className:"flex size-12 shrink-0 items-center justify-end",children:i.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-400",children:"more_horiz"})})]}),i.jsxs("div",{className:"px-4 pt-6 pb-40",children:[i.jsxs("div",{className:"flex items-center gap-3 px-1 pt-2 pb-6",children:[i.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-100 overflow-hidden border-2 border-sky-200",children:i.jsx("img",{src:f(),alt:t.petName||"",className:"w-full h-full object-cover",style:{objectPosition:"center",display:"block"}})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h1",{className:"text-slate-900 text-2xl font-bold leading-tight tracking-tight font-display whitespace-nowrap",children:"!"}),i.jsx("p",{className:"text-slate-500 text-sm font-normal leading-normal whitespace-nowrap",children:"    "})]})]}),i.jsxs("div",{className:"mb-6 rounded-lg bg-surface-light p-4 shadow-soft",children:[i.jsx("h3",{className:"text-slate-900 text-lg font-bold leading-tight tracking-[-0.015em] pb-4 font-display",children:"  "}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"flex items-center justify-center rounded-lg bg-primary/20 shrink-0 size-12 text-primary",children:i.jsx("span",{className:"material-symbols-outlined text-3xl",children:"local_hospital"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-slate-800 text-base font-medium leading-normal",children:s.name}),i.jsx("p",{className:"text-slate-500 text-sm font-normal leading-normal",children:s.distance?`${(s.distance/1e3).toFixed(1)}km`:""})]})]}),s.phone&&i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"flex items-center justify-center shrink-0 size-12",children:i.jsx("span",{className:"material-symbols-outlined text-slate-400 text-3xl",children:"call"})}),i.jsx("p",{className:"text-slate-800 text-base font-normal leading-normal flex-1",children:s.phone})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"flex items-center justify-center shrink-0 size-12",children:i.jsx("span",{className:"material-symbols-outlined text-slate-400 text-3xl",children:"location_on"})}),i.jsx("p",{className:"text-slate-800 text-base font-normal leading-normal flex-1",children:s.roadAddress||s.address})]})]})]}),i.jsxs("div",{className:"mb-6 rounded-lg bg-surface-light p-4 shadow-soft",children:[i.jsxs("h3",{className:"flex items-center gap-2 text-slate-900 text-lg font-bold leading-tight tracking-[-0.015em] pb-4 font-display",children:[i.jsx("span",{className:"material-symbols-outlined text-secondary",children:"pets"}),i.jsx("span",{children:" "})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-4",children:[i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-sm text-slate-500",children:""}),i.jsx("span",{className:"text-slate-800 font-medium",children:t.petName})]}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-sm text-slate-500",children:""}),i.jsx("span",{className:"text-slate-800 font-medium",children:t.breed||""})]}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-sm text-slate-500",children:""}),i.jsx("span",{className:"text-slate-800 font-medium",children:t.birthDate?(()=>{const x=new Date(t.birthDate);return`${new Date().getFullYear()-x.getFullYear()}`})():""})]}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-sm text-slate-500",children:""}),i.jsx("span",{className:"text-slate-800 font-medium",children:t.sex==="M"?"":t.sex==="F"?"":""})]}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-sm text-slate-500",children:""}),i.jsx("span",{className:"text-slate-800 font-medium",children:t.neutered?"":""})]})]})]}),e.possible_diseases&&e.possible_diseases.length>0&&i.jsxs("div",{className:"mb-6 rounded-xl bg-gradient-to-r from-violet-500 to-purple-600 p-4 text-white",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("span",{className:"material-symbols-outlined",children:"diagnosis"}),i.jsx("span",{className:"font-bold",children:"AI "})]}),i.jsx("p",{className:"text-2xl font-bold",children:((R=e.possible_diseases[0])==null?void 0:R.name)||e.possible_diseases[0]}),((k=e.possible_diseases[0])==null?void 0:k.probability)&&i.jsxs("p",{className:"text-white/80 text-sm mt-1",children:["AI  : ",e.possible_diseases[0].probability,"%"]})]}),e.symptom&&i.jsxs("div",{className:"mb-6 rounded-lg bg-surface-light p-4 shadow-soft",children:[i.jsxs("h3",{className:"flex items-center gap-2 text-slate-900 text-lg font-bold leading-tight tracking-[-0.015em] pb-4 font-display",children:[i.jsx("span",{className:"material-symbols-outlined text-secondary",children:"history"}),i.jsx("span",{children:"  &  "})]}),i.jsx("p",{className:"text-slate-800 font-medium pb-3",children:e.symptom}),e.symptomTimeline&&e.symptomTimeline.length>0?i.jsx("ul",{className:"space-y-2 pl-1",children:e.symptomTimeline.map((x,A)=>i.jsxs("li",{className:"flex items-start gap-3 text-slate-600",children:[i.jsx("span",{className:"material-symbols-outlined text-base mt-1 text-primary",children:"check_circle"}),i.jsx("p",{children:x})]},A))}):i.jsx("p",{className:"text-slate-600 text-sm",children:"   ."})]}),e.possible_diseases&&e.possible_diseases.length>0&&i.jsxs("div",{className:"mb-6 rounded-lg bg-surface-light p-4 shadow-soft",children:[i.jsxs("h3",{className:"flex items-center gap-2 text-slate-900 text-lg font-bold leading-tight tracking-[-0.015em] pb-4 font-display",children:[i.jsx("span",{className:"material-symbols-outlined text-secondary",children:"smart_toy"}),i.jsx("span",{children:"AI  "})]}),i.jsx("div",{className:"space-y-3",children:e.possible_diseases.map((x,A)=>i.jsxs("div",{className:`rounded-lg border border-slate-200 p-3 ${A===0?"bg-slate-50/50":""}`,children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("p",{className:"text-base font-semibold text-slate-900",children:x.name||x}),i.jsxs("p",{className:`text-lg font-bold ${A===0?"text-primary":A===1?"text-primary/70":"text-primary/50"}`,children:[x.probability||x.probability_percent||"N/A","%"]})]}),x.related_area&&i.jsxs("p",{className:"text-sm text-slate-500",children:[" : ",x.related_area]})]},A))})]}),e.triage_score!==void 0&&i.jsx("div",{className:`mb-6 rounded-lg p-4 border ${_(e.triage_score)}`,children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"material-symbols-outlined text-3xl",children:"warning"}),i.jsxs("div",{children:[i.jsxs("h3",{className:`text-lg font-bold leading-tight ${_(e.triage_score).split(" ")[0]}`,children:[": ",S(e.triage_score)]}),i.jsx("p",{className:"text-slate-700 mt-1",children:e.triage_note||"  ."}),i.jsxs("p",{className:"text-slate-800 mt-3 font-semibold",children:[" : ",e.hospitalVisitTime||"24 ","  "]})]})]})}),i.jsxs("div",{className:"mb-6 rounded-lg bg-surface-light p-4 shadow-soft",children:[i.jsxs("h3",{className:"flex items-center gap-2 text-slate-900 text-lg font-bold leading-tight tracking-[-0.015em] pb-4 font-display",children:[i.jsx("span",{className:"material-symbols-outlined text-secondary",children:"edit_note"}),i.jsx("span",{children:"   ()"})]}),i.jsx("textarea",{className:"w-full rounded-lg border-slate-300 bg-slate-100 text-slate-900 focus:ring-primary focus:border-primary p-3 text-base",rows:"3",placeholder:"     ",value:c,onChange:x=>u(x.target.value)}),i.jsx("p",{className:"text-xs text-slate-400 mt-2",children:" AI   ."})]}),i.jsx("div",{className:"mb-6 rounded-xl border-2 border-sky-200 bg-sky-50 p-4",children:i.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:h,onChange:x=>m(x.target.checked),className:"w-5 h-5 mt-1 text-sky-500 rounded border-sky-300 focus:ring-sky-400"}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("span",{className:"text-sky-600 text-lg",children:""}),i.jsx("span",{className:"font-bold text-slate-900",children:"AI   "}),i.jsx("span",{className:"px-2 py-0.5 bg-sky-500 text-white text-xs font-bold rounded-full",children:""})]}),i.jsx("p",{className:"text-sm text-slate-600 mb-3",children:"      "}),i.jsxs("div",{className:"space-y-2 pl-1",children:[i.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[i.jsx("span",{className:"text-green-500",children:""}),i.jsx("span",{children:"  "})]}),i.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[i.jsx("span",{className:"text-green-500",children:""}),i.jsx("span",{children:"  "})]}),i.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[i.jsx("span",{className:"text-green-500",children:""}),i.jsx("span",{children:"AI  (Top 3  )"})]}),i.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[i.jsx("span",{className:"text-green-500",children:""}),i.jsx("span",{children:"    "})]})]})]})]})})]}),i.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-sm p-4 border-t border-slate-200",children:i.jsxs("div",{className:"flex flex-col space-y-3",children:[i.jsx("button",{onClick:a,className:"w-full bg-slate-200 text-slate-700 font-bold py-4 px-6 rounded-lg text-base hover:bg-slate-300 transition-colors",children:" "}),i.jsx("button",{onClick:()=>o&&o(y()),className:"w-full bg-primary text-white font-bold py-4 px-6 rounded-lg text-base hover:bg-primary/90 transition-colors shadow-lg shadow-primary/30",children:" "}),i.jsx("button",{onClick:()=>l&&l(y()),className:"w-full text-slate-500 font-medium py-2 px-6 rounded-lg text-sm hover:text-slate-700 transition-colors",children:" "})]})})]})}const a6={dog:"",cat:"",rabbit:"",hamster:"",bird:"",hedgehog:"",reptile:"",etc:"",other:""};function o6({petData:t,hospital:e,bookingTime:s,bookingDate:n,onBack:r,onGetDirections:a,onHome:o}){var f;const[l,c]=O.useState(""),[u,h]=O.useState("");O.useEffect(()=>{const y=Math.floor(1e3+Math.random()*9e3).toString();c(y);let _="",S="";if(n)try{const R=new Date(n);if(isNaN(R.getTime()))_=n;else{const k=R.getFullYear(),x=String(R.getMonth()+1).padStart(2,"0"),A=String(R.getDate()).padStart(2,"0"),D=["","","","","","",""][R.getDay()];_=`${k}. ${x}. ${A}. (${D})`}}catch{_=n}if(s&&s.includes(":")){const R=s.split(":"),k=parseInt(R[0],10),x=parseInt(R[1],10);if(!isNaN(k)&&!isNaN(x)){const A=k>=12?"":"";let M=k%12;M===0&&(M=12),S=`${A} ${M} ${x.toString().padStart(2,"0")}`}else S=s}else s?S=s:S=" ";h(_&&S?`${_} ${S}`:_||S||" ")},[n,s]);const m=()=>{if(!t)return"  ";const y=a6[t.species]||"",_=t.breed||" ",S=t.petName||t.name||" ";return`${y}/${_}[${S}]`};return!t||!e?null:i.jsxs("div",{className:"page-container",children:[i.jsxs("div",{className:"page-header",children:[i.jsx("div",{className:"flex size-12 shrink-0 items-center text-slate-800",children:i.jsx("button",{onClick:r,className:"p-2 -ml-2 text-slate-600 hover:bg-slate-100 rounded-full",children:i.jsx("span",{className:"material-symbols-outlined text-3xl",children:"arrow_back_ios_new"})})}),i.jsx("h2",{className:"text-slate-800 text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center font-display",children:" "}),i.jsx("div",{className:"flex size-12 shrink-0 items-center justify-end"})]}),i.jsxs("div",{className:"px-4 pt-6 pb-40",children:[i.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[i.jsx("div",{className:"w-24 h-24 rounded-full bg-accent/20 flex items-center justify-center mb-4",children:i.jsx("span",{className:"material-symbols-outlined text-accent text-6xl",children:"pets"})}),i.jsx("h1",{className:"text-slate-900 text-2xl font-bold mb-2 font-display",children:"   !"}),i.jsx("p",{className:"text-slate-600 text-base text-center max-w-sm",children:"  ,      ."})]}),i.jsx("div",{className:"mb-4 rounded-lg bg-surface-light p-4 shadow-soft",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"flex items-center justify-center rounded-lg bg-primary/20 shrink-0 size-12 text-primary",children:i.jsx("span",{className:"material-symbols-outlined text-3xl",children:"local_hospital"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"text-slate-900 font-bold text-base mb-1 font-display",children:e.name}),i.jsx("p",{className:"text-slate-600 text-sm",children:e.roadAddress||e.address}),e.phone&&i.jsx("p",{className:"text-slate-500 text-sm mt-1",children:e.phone})]})]})}),i.jsx("div",{className:"mb-6 rounded-lg bg-surface-light p-4 shadow-soft",children:i.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[i.jsx("div",{className:"flex items-center justify-center rounded-lg bg-primary/20 shrink-0 size-12 text-primary",children:i.jsx("span",{className:"material-symbols-outlined text-3xl",children:"schedule"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"text-slate-900 font-bold text-base mb-2 font-display",children:" "}),i.jsxs("p",{className:"text-slate-600 text-sm",children:[" : ",u]}),i.jsxs("p",{className:"text-slate-600 text-sm mt-1",children:[": ",m()]})]})]})}),i.jsx("div",{className:"mb-6 rounded-lg bg-primary/10 p-6",children:i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx("div",{className:"w-48 h-48 bg-white rounded-lg flex items-center justify-center mb-4 shadow-md",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-6xl mb-2",children:""}),i.jsx("p",{className:"text-xs text-slate-500",children:"QR Code"})]})}),i.jsx("p",{className:"text-slate-700 text-sm text-center mb-4",children:"      ."}),i.jsx("div",{className:"bg-white rounded-lg px-6 py-4 shadow-md",children:i.jsx("p",{className:"text-slate-900 text-3xl font-bold tracking-wider font-mono",children:((f=l.match(/.{1,4}/g))==null?void 0:f.join(" "))||l})})]})})]}),i.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-sm p-4 border-t border-slate-200 space-y-2",children:[i.jsxs("button",{onClick:a,className:"w-full bg-primary text-white font-bold py-4 px-6 rounded-lg text-base hover:bg-primary/90 transition-colors shadow-lg shadow-primary/30 flex items-center justify-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined",children:"directions"}),i.jsx("span",{children:""})]}),i.jsxs("a",{href:"https://service.kakaomobility.com/launch/kakaot",target:"_blank",rel:"noopener noreferrer",className:"w-full bg-[#1E1B4B] text-white font-bold py-4 px-6 rounded-lg text-base hover:bg-[#2d2a5a] transition-colors flex items-center justify-center gap-2",children:[i.jsx("span",{className:"text-[#FACC15] font-black text-xl",children:"T"}),i.jsx("span",{children:"Kakao T  "})]}),i.jsx("button",{onClick:o||r,className:"w-full text-slate-600 font-medium py-3 px-6 rounded-lg text-sm hover:text-slate-800 hover:bg-slate-100 transition-colors",children:" "})]})]})}const l6="petMedical_diagnoses",c6="petMedical_clinicResults",Av="petMedical_medicationFeedback",d6=[{id:"visit_1",date:"2024-11-15",hospitalName:"",hospitalAddress:"   123-45",diagnosis:"  -   ",type:"visit",triage_score:2,possible_diseases:[{name:" ",probability:65},{name:" ",probability:25}]},{id:"visit_2",date:"2024-10-20",hospitalName:"24 ",hospitalAddress:"   456-78",diagnosis:"  -  ",type:"visit",triage_score:3,possible_diseases:[{name:" ",probability:70},{name:"",probability:20}]},{id:"visit_3",date:"2024-09-05",hospitalName:"",hospitalAddress:"   123-45",diagnosis:" -  ",type:"visit",triage_score:1}],u6=[{id:"med_1",date:"2024-11-28",medications:[" ()",""],pharmacyName:"",daysSupply:"7",status:"effective"},{id:"med_2",date:"2024-11-20",medications:[" ()",""],pharmacyName:"24 ",daysSupply:"5",status:"effective"},{id:"med_3",date:"2024-11-15",medications:[" (/)",""],pharmacyName:"",daysSupply:"3",status:"side_effect"},{id:"med_4",date:"2024-11-10",medications:[" ()",""],pharmacyName:"24 ",daysSupply:"10",status:"effective"},{id:"med_5",date:"2024-11-05",medications:["",""],pharmacyName:"",daysSupply:"14",status:"none"},{id:"med_6",date:"2024-10-28",medications:[" ()",""],pharmacyName:"24 ",daysSupply:"7",status:"none"},{id:"med_7",date:"2024-10-15",medications:[" "],pharmacyName:"",daysSupply:"1",status:"none"}],h6=[{id:"checkup_1",date:"2024-09-05",hospitalName:"",type:"",results:[{item:"",status:"normal",note:"   "},{item:"",status:"normal",note:" "},{item:"",status:"normal",note:"  "},{item:"",status:"normal",note:"  "}],overallStatus:""},{id:"checkup_2",date:"2024-03-15",hospitalName:"24 ",type:"",results:[{item:"",status:"normal",note:""},{item:"",status:"caution",note:"  (5.8kg  6.2kg)"},{item:"",status:"normal",note:"  "}],overallStatus:""}],m6=[{id:"care_1",date:"2024-11-29",meals:3,water:4,walks:2,treats:2,grooming:1,weight:6.2,notes:"     !"},{id:"care_2",date:"2024-11-28",meals:2,water:3,walks:1,treats:3,grooming:0,weight:null,notes:""},{id:"care_3",date:"2024-11-27",meals:3,water:5,walks:2,treats:1,grooming:1,weight:6.1,notes:" "},{id:"care_4",date:"2024-11-26",meals:2,water:4,walks:2,treats:2,grooming:0,weight:null,notes:""}],f6=[{id:"vac_1",date:"2024-08-20",name:" (DHPPL)",hospitalName:"",nextDue:"2025-08-20",status:"completed"},{id:"vac_2",date:"2024-11-01",name:" ",hospitalName:"",nextDue:"2024-12-01",status:"completed"},{id:"vac_3",date:"2024-07-15",name:" ",hospitalName:"",nextDue:"2025-07-15",status:"completed"},{id:"vac_4",date:"2024-06-10",name:" ",hospitalName:"24 ",nextDue:"2025-06-10",status:"completed"}],Ye={date:"2024-09-05",hospitalName:"",hospitalAddress:"   123-45",hospitalPhone:"02-1234-5678",veterinarian:" ",type:"",overallStatus:"",overallComment:"   .      ,    .    .",physicalExam:{weight:6.2,bodyConditionScore:5,temperature:38.5,heartRate:120},cbc:{items:[{name:"WBC ()",value:12.5,unit:"10/L",range:"5.5-16.9",status:"normal"},{name:"RBC ()",value:7.2,unit:"10/L",range:"5.5-8.5",status:"normal"},{name:"HGB ()",value:16.8,unit:"g/dL",range:"12-18",status:"normal"},{name:"HCT ()",value:48,unit:"%",range:"37-55",status:"normal"},{name:"PLT ()",value:285,unit:"10/L",range:"175-500",status:"normal"},{name:"MCV ()",value:67,unit:"fL",range:"60-77",status:"normal"},{name:"MCH ()",value:23.3,unit:"pg",range:"19.5-24.5",status:"normal"},{name:"MCHC ()",value:35,unit:"g/dL",range:"32-36",status:"normal"}],comment:"      . , ,     ."},biochemistry:{items:[{name:"BUN ()",value:18,unit:"mg/dL",range:"7-27",status:"normal"},{name:"CREA ()",value:1.2,unit:"mg/dL",range:"0.5-1.8",status:"normal"},{name:"ALT ()",value:42,unit:"U/L",range:"10-125",status:"normal"},{name:"ALP ()",value:85,unit:"U/L",range:"23-212",status:"normal"},{name:"TP ()",value:6.8,unit:"g/dL",range:"5.2-8.2",status:"normal"},{name:"ALB ()",value:3.4,unit:"g/dL",range:"2.3-4.0",status:"normal"},{name:"GLU ()",value:98,unit:"mg/dL",range:"74-143",status:"normal"},{name:"CHOL ()",value:220,unit:"mg/dL",range:"110-320",status:"normal"},{name:"TBIL ()",value:.2,unit:"mg/dL",range:"0.0-0.9",status:"normal"},{name:"Ca ()",value:10.2,unit:"mg/dL",range:"7.9-12.0",status:"normal"},{name:"PHOS ()",value:4.5,unit:"mg/dL",range:"2.5-6.8",status:"normal"}],comment:" ,  ,       ."},urinalysis:{items:[{name:" (SG)",value:"1.035",range:"1.015-1.045",status:"normal"},{name:"pH",value:"6.5",range:"5.5-7.0",status:"normal"},{name:"",value:"",range:"",status:"normal"},{name:"",value:"",range:"",status:"normal"},{name:"",value:"",range:"",status:"normal"},{name:"",value:"",range:"",status:"normal"},{name:"",value:"",range:"",status:"normal"},{name:"",value:"",range:"",status:"normal"}],comment:"    ,      ."},cardiacUltrasound:{findings:[{item:" ",result:"",status:"normal"},{item:" ",result:"",status:"normal"},{item:"  ",result:"",status:"normal"},{item:"",result:"",status:"normal"},{item:" ",result:" ",status:"normal"},{item:"",result:"",status:"normal"}],laToAoRatio:1.2,fractionalShortening:38,comment:" ,   .    ."},abdominalUltrasound:{organs:[{name:"",result:",  ",status:"normal"},{name:"",result:",  ",status:"normal"},{name:"",result:",  ",status:"normal"},{name:" ()",result:",  ",status:"normal"},{name:" ()",result:",  ",status:"normal"},{name:"",result:",  ",status:"normal"},{name:"",result:" ",status:"normal"},{name:"",result:"",status:"normal"}],comment:"    . , ,     ."},recommendations:["   .    1  .","        .","    .","       ."],nextCheckupDate:"2025-09-05"};function p6({petData:t,onBack:e,onViewDiagnosis:s,onOCR:n,onHome:r,onHospitalBooking:a}){var le,ce,F,Q,K,I,L,W;const o=()=>{const b=localStorage.getItem("records_initialTab");return b&&["visits","medication","checkup","vaccination"].includes(b)?(localStorage.removeItem("records_initialTab"),b):"visits"},[l,c]=O.useState(o);O.useEffect(()=>{const b=V=>{V.detail&&["visits","medication","checkup","vaccination"].includes(V.detail)&&c(V.detail)};return window.addEventListener("records-set-tab",b),()=>window.removeEventListener("records-set-tab",b)},[]);const[u,h]=O.useState([]),[m,f]=O.useState([]),[y,_]=O.useState({}),[S,R]=O.useState(!0),[k,x]=O.useState(!1);O.useEffect(()=>{(async()=>{if(!(t!=null&&t.id))return;try{const J=await Da.getDiagnosesByPet(t.id);if(J.success&&J.data.length>0){h(J.data);return}}catch(J){console.warn("Firestore    :",J)}const V=localStorage.getItem(l6);if(V){const z=JSON.parse(V).filter(q=>q.petId===(t==null?void 0:t.id));h(z)}})()},[t]),O.useEffect(()=>{(async()=>{if(!(t!=null&&t.id))return;try{const J=await tr.getResultsByPet(t.id);if(J.success&&J.data.length>0){f(J.data);return}}catch(J){console.warn("Firestore    :",J)}const V=localStorage.getItem(c6);if(V){const z=JSON.parse(V).filter(q=>q.petId===(t==null?void 0:t.id));f(z)}})()},[t]),O.useEffect(()=>{const b=localStorage.getItem(Av);b&&_(JSON.parse(b))},[]);const A=(b,V)=>{const J={...y,[b]:{status:V,updatedAt:new Date().toISOString(),petId:t==null?void 0:t.id}};_(J),localStorage.setItem(Av,JSON.stringify(J))},M=b=>b?new Date(b).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"}):"",D=[{id:"visits",label:"",icon:"local_hospital"},{id:"medication",label:"",icon:"medication"},{id:"checkup",label:"",icon:"assignment"},{id:"vaccination",label:"",icon:"vaccines"},{id:"care",label:"",icon:"favorite"}],B=(()=>{const b=m.map(z=>({id:z.id,date:z.visitDate||z.createdAt,hospitalName:z.hospitalName,hospitalAddress:z.hospitalAddress||"",diagnosis:z.finalDiagnosis||z.diagnosis,type:"visit",triage_score:z.triageScore,treatment:z.treatment,medications:z.medications,totalCost:z.totalCost,nextVisitDate:z.nextVisitDate,doctorNote:z.doctorNote,source:"clinic"})),V=u.filter(z=>z.type==="visit"||!z.type).map(z=>({...z,source:"ai"})),J=[...b,...V].sort((z,q)=>new Date(q.date||q.created_at)-new Date(z.date||z.created_at));return S?[...J,...d6]:J})(),v=(()=>{const b=m.filter(z=>z.medications&&z.medications.length>0).flatMap(z=>z.medications.map((q,ae)=>{var je;return{id:`${z.id}_med_${ae}`,resultId:z.id,date:z.visitDate||z.createdAt,name:q.name,dosage:q.dosage,days:q.days,instructions:q.instructions,hospitalName:z.hospitalName,petId:z.petId,source:"clinic",feedbackStatus:((je=y[`${z.id}_med_${ae}`])==null?void 0:je.status)||"none"}})),V=u.filter(z=>z.medications||z.prescription).map(z=>{var q;return{id:z.id,date:z.created_at||z.date,medications:z.medications||z.prescription||[],hospitalName:"AI ",source:"ai",feedbackStatus:((q=y[z.id])==null?void 0:q.status)||"none"}}),J=[...b,...V].sort((z,q)=>new Date(q.date)-new Date(z.date));return S?[...J,...u6]:J})(),N=S?h6:[],w=S?f6:[],E=S?m6:[],C=v.filter(b=>b.feedbackStatus==="effective").length,P=v.filter(b=>b.feedbackStatus==="side_effect").length,j=v.filter(b=>b.feedbackStatus==="none"||!b.feedbackStatus).length,re=b=>{switch(b){case"normal":return"text-green-600 bg-green-50";case"caution":return"text-yellow-600 bg-yellow-50";case"warning":return"text-red-600 bg-red-50";default:return"text-slate-600 bg-slate-50"}},Z=b=>{switch(b){case"normal":return"check_circle";case"caution":return"warning";case"warning":return"error";default:return"help"}};return i.jsxs("div",{className:"min-h-screen bg-slate-50",children:[i.jsxs("div",{className:"bg-white px-4 py-4 border-b border-slate-100",children:[i.jsx("div",{className:"flex items-center gap-3 mb-2",children:i.jsx("button",{onClick:e,className:"text-slate-600",children:i.jsx("span",{className:"text-sm",children:" "})})}),i.jsx("h1",{className:"text-xl font-bold text-slate-900",children:" "})]}),i.jsxs("div",{className:"px-4 pt-4 pb-24 space-y-4",children:[i.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-slate-100",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h3",{className:"font-bold text-slate-800",children:" "}),i.jsx("span",{className:"text-xs text-slate-400",children:new Date().toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\. /g,"-").replace(".","")})]}),i.jsxs("div",{className:"grid grid-cols-5 gap-3",children:[i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"w-11 h-11 rounded-xl bg-slate-50 flex flex-col items-center justify-center",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("span",{className:"text-[10px] text-slate-600",children:"2"})]}),i.jsx("span",{className:"text-xs text-slate-500 mt-1",children:""})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"w-11 h-11 rounded-xl bg-slate-50 flex flex-col items-center justify-center",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("span",{className:"text-[10px] text-slate-600",children:"3"})]}),i.jsx("span",{className:"text-xs text-slate-500 mt-1",children:""})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"w-11 h-11 rounded-xl bg-slate-50 flex flex-col items-center justify-center",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("span",{className:"text-[10px] text-slate-600",children:"2"})]}),i.jsx("span",{className:"text-xs text-slate-500 mt-1",children:""})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"w-11 h-11 rounded-xl bg-slate-50 flex flex-col items-center justify-center",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("span",{className:"text-[10px] text-slate-600",children:"1"})]}),i.jsx("span",{className:"text-xs text-slate-500 mt-1",children:""})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"w-11 h-11 rounded-xl bg-slate-50 flex flex-col items-center justify-center",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("span",{className:"text-[10px] text-slate-600",children:"2"})]}),i.jsx("span",{className:"text-xs text-slate-500 mt-1",children:""})]})]})]}),B.length>0&&i.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-slate-100",children:[i.jsxs("div",{className:"flex justify-between items-center mb-3",children:[i.jsx("h3",{className:"font-bold text-slate-800",children:"  "}),i.jsx("span",{className:"text-xs text-slate-400",children:M(((le=B[0])==null?void 0:le.date)||((ce=B[0])==null?void 0:ce.created_at))})]}),i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${((F=B[0])==null?void 0:F.source)==="clinic"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:((Q=B[0])==null?void 0:Q.source)==="clinic"?" ":"AI "}),i.jsx("span",{className:"text-sm text-slate-700",children:((K=B[0])==null?void 0:K.hospitalName)||"AI "})]}),i.jsx("p",{className:"text-sm text-slate-600",children:((I=B[0])==null?void 0:I.diagnosis)||"  "}),((W=(L=B[0])==null?void 0:L.medications)==null?void 0:W.length)>0&&i.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["  ",B[0].medications.length,""]})]}),i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden",children:[i.jsx("div",{className:"flex border-b border-slate-100 overflow-x-auto",children:D.map(b=>i.jsxs("button",{onClick:()=>c(b.id),className:`flex-1 min-w-[80px] py-3 px-2 text-center transition-colors ${l===b.id?"bg-primary/5 text-primary border-b-2 border-primary":"text-slate-500 hover:bg-slate-50"}`,children:[i.jsx("span",{className:"material-symbols-outlined text-lg block mb-0.5",children:b.icon}),i.jsx("span",{className:"text-xs font-medium",children:b.label})]},b.id))}),i.jsxs("div",{className:"p-4",children:[l==="visits"&&i.jsx("div",{className:"space-y-4",children:B.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"text-5xl mb-4",children:""}),i.jsx("p",{className:"text-slate-500",children:"  ."}),i.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"AI      "})]}):B.map(b=>{var V;return i.jsxs("div",{onClick:()=>s&&s(b),className:"bg-slate-50 rounded-xl p-4 cursor-pointer hover:bg-slate-100 transition-all",children:[i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${b.source==="clinic"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:b.source==="clinic"?"":"AI"}),i.jsx("p",{className:"text-slate-500 text-xs",children:M(b.date||b.created_at)})]}),i.jsx("h3",{className:"text-slate-900 font-bold text-base mb-1",children:b.hospitalName||"AI "})]}),i.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"chevron_right"})]}),b.diagnosis&&i.jsx("p",{className:"text-slate-700 text-sm mb-2",children:b.diagnosis}),b.source==="clinic"&&i.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[b.treatment&&i.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-50 text-green-700 rounded text-xs",children:[i.jsx("span",{className:"material-symbols-outlined text-xs",children:"healing"}),b.treatment]}),((V=b.medications)==null?void 0:V.length)>0&&i.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-orange-50 text-orange-700 rounded text-xs",children:[i.jsx("span",{className:"material-symbols-outlined text-xs",children:"medication"})," ",b.medications.length,""]}),b.totalCost>0&&i.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs",children:[" ",b.totalCost.toLocaleString(),""]}),b.nextVisitDate&&i.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-primary/10 text-primary rounded text-xs",children:[i.jsx("span",{className:"material-symbols-outlined text-xs",children:"event"}),": ",M(b.nextVisitDate)]})]})]},b.id)})}),l==="medication"&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-4",children:[i.jsx("h4",{className:"text-sm font-bold text-slate-700 mb-3",children:"  "}),i.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[i.jsxs("div",{className:"bg-white rounded-lg p-3 text-center shadow-sm",children:[i.jsx("span",{className:"material-symbols-outlined text-green-500 text-2xl",children:"check_circle"}),i.jsx("p",{className:"text-xl font-bold text-green-600 mt-1",children:C}),i.jsx("p",{className:"text-xs text-slate-500",children:"  "})]}),i.jsxs("div",{className:"bg-white rounded-lg p-3 text-center shadow-sm",children:[i.jsx("span",{className:"material-symbols-outlined text-red-500 text-2xl",children:"warning"}),i.jsx("p",{className:"text-xl font-bold text-red-600 mt-1",children:P}),i.jsx("p",{className:"text-xs text-slate-500",children:""})]}),i.jsxs("div",{className:"bg-white rounded-lg p-3 text-center shadow-sm",children:[i.jsx("span",{className:"material-symbols-outlined text-slate-400 text-2xl",children:"pending"}),i.jsx("p",{className:"text-xl font-bold text-slate-600 mt-1",children:j}),i.jsx("p",{className:"text-xs text-slate-500",children:" "})]})]}),i.jsx("p",{className:"text-xs text-slate-500 mt-3 text-center",children:"           "})]}),v.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"text-5xl mb-4",children:""}),i.jsx("p",{className:"text-slate-500",children:"  ."}),i.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"    "})]}):v.map(b=>i.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[b.source==="clinic"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex justify-between items-start mb-3",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full text-xs font-medium",children:" "}),i.jsx("span",{className:"text-xs text-slate-500",children:M(b.date)})]}),i.jsx("h4",{className:"text-slate-900 font-bold text-base",children:b.name}),i.jsx("p",{className:"text-slate-500 text-sm",children:b.hospitalName})]}),b.feedbackStatus==="effective"&&i.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-xs",children:"check"})," "]}),b.feedbackStatus==="side_effect"&&i.jsxs("span",{className:"px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-xs",children:"warning"}),""]})]}),i.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[b.dosage&&i.jsxs("span",{className:"px-2 py-1 bg-white text-slate-600 rounded text-xs",children:[" ",b.dosage]}),b.days&&i.jsxs("span",{className:"px-2 py-1 bg-white text-slate-600 rounded text-xs",children:[" ",b.days,""]}),b.instructions&&i.jsxs("span",{className:"px-2 py-1 bg-white text-slate-600 rounded text-xs",children:[" ",b.instructions]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("button",{onClick:V=>{V.stopPropagation(),A(b.id,"effective")},className:`flex-1 flex items-center justify-center gap-1 px-3 py-2.5 rounded-lg text-sm font-medium transition-all ${b.feedbackStatus==="effective"?"bg-green-500 text-white shadow-md":"bg-green-50 text-green-700 hover:bg-green-100"}`,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"thumb_up"})," "]}),i.jsxs("button",{onClick:V=>{V.stopPropagation(),A(b.id,"side_effect")},className:`flex-1 flex items-center justify-center gap-1 px-3 py-2.5 rounded-lg text-sm font-medium transition-all ${b.feedbackStatus==="side_effect"?"bg-red-500 text-white shadow-md":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"thumb_down"})," "]})]})]}),b.source==="ai"&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"flex justify-between items-start mb-3",children:i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-700 rounded-full text-xs font-medium",children:"AI "}),i.jsx("span",{className:"text-xs text-slate-500",children:M(b.date)})]}),i.jsx("p",{className:"text-slate-900 font-bold text-base mb-1",children:Array.isArray(b.medications)&&b.medications.length>0?b.medications.length>1?`${typeof b.medications[0]=="string"?b.medications[0]:b.medications[0].name}  ${b.medications.length-1}`:typeof b.medications[0]=="string"?b.medications[0]:b.medications[0].name:" "})]})}),Array.isArray(b.medications)&&b.medications.length>0&&i.jsx("div",{className:"flex flex-wrap gap-1",children:b.medications.map((V,J)=>i.jsxs("span",{className:"px-2 py-1 bg-white text-slate-600 rounded text-xs",children:[" ",typeof V=="string"?V:V.name]},J))})]})]},b.id))]}),l==="checkup"&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"bg-primary/10 rounded-lg p-3 mb-4 flex items-start gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-primary text-sm",children:"info"}),i.jsx("p",{className:"text-slate-700 text-sm flex-1",children:"  10   ."}),i.jsx("span",{className:"material-symbols-outlined text-slate-400 text-sm",children:"arrow_forward_ios"})]}),N.length===0?i.jsxs("div",{className:"text-center py-20",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("p",{className:"text-slate-500",children:"  ."})]}):N.map(b=>i.jsxs("div",{className:"bg-surface-light rounded-lg p-4 shadow-soft",children:[i.jsxs("div",{className:"flex justify-between items-start mb-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-slate-500 text-sm mb-1",children:M(b.date)}),i.jsx("h3",{className:"text-slate-900 font-bold text-base mb-1 font-display",children:b.type}),i.jsxs("p",{className:"text-slate-500 text-sm flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"location_on"}),b.hospitalName]})]}),i.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${b.overallStatus===""?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:b.overallStatus})]}),i.jsx("div",{className:"space-y-2 mt-4",children:b.results.map((V,J)=>i.jsxs("div",{className:`flex items-center justify-between p-2 rounded-lg ${re(V.status)}`,children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:Z(V.status)}),i.jsx("span",{className:"text-sm font-medium",children:V.item})]}),i.jsx("span",{className:"text-xs",children:V.note})]},J))}),i.jsxs("button",{onClick:()=>x(!0),className:"w-full mt-4 py-2 text-primary text-sm font-medium flex items-center justify-center gap-1 hover:bg-primary/5 rounded-lg transition-colors",children:["  ",i.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_forward_ios"})]})]},b.id))]}),k&&i.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end justify-center",children:i.jsxs("div",{className:"bg-white w-full max-w-lg h-[95vh] rounded-t-3xl overflow-hidden flex flex-col animate-slide-up",children:[i.jsxs("div",{className:"bg-gradient-to-r from-primary to-sky-500 text-white p-6 relative",children:[i.jsx("button",{onClick:()=>x(!1),className:"absolute top-4 right-4 w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-white",children:"close"})}),i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-3xl",children:"assignment"})}),i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl font-bold",children:Ye.type}),i.jsx("p",{className:"text-white/80 text-sm",children:M(Ye.date)})]})]}),i.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/90",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"location_on"}),i.jsx("span",{children:Ye.hospitalName}),i.jsx("span",{className:"text-white/50",children:"|"}),i.jsx("span",{children:Ye.veterinarian})]})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-8 space-y-4",children:[i.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-4 border border-green-200",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-green-600",children:"verified"})," "]}),i.jsx("span",{className:"px-3 py-1 bg-green-500 text-white rounded-full text-sm font-bold",children:Ye.overallStatus})]}),i.jsx("p",{className:"text-slate-600 text-sm leading-relaxed",children:Ye.overallComment})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100",children:[i.jsxs("h3",{className:"font-bold text-slate-800 mb-4 flex items-center gap-2",children:[i.jsx("span",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-blue-600 text-lg",children:"monitor_weight"})})," "]}),i.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[i.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 text-center",children:[i.jsx("p",{className:"text-xs text-slate-500 mb-1",children:""}),i.jsxs("p",{className:"text-lg font-bold text-slate-800",children:[Ye.physicalExam.weight,"kg"]}),i.jsx("span",{className:"text-xs text-green-600",children:""})]}),i.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 text-center",children:[i.jsx("p",{className:"text-xs text-slate-500 mb-1",children:""}),i.jsxs("p",{className:"text-lg font-bold text-slate-800",children:[Ye.physicalExam.temperature,"C"]}),i.jsx("span",{className:"text-xs text-green-600",children:""})]}),i.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 text-center",children:[i.jsx("p",{className:"text-xs text-slate-500 mb-1",children:""}),i.jsx("p",{className:"text-lg font-bold text-slate-800",children:Ye.physicalExam.heartRate}),i.jsx("span",{className:"text-xs text-green-600",children:"/"})]})]}),i.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded-xl",children:i.jsxs("p",{className:"text-xs text-slate-600",children:[i.jsx("span",{className:"font-medium",children:"BCS ():"})," ",Ye.physicalExam.bodyConditionScore,"/9 -  ."]})})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[i.jsx("span",{className:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-red-600 text-lg",children:"water_drop"})})," (CBC)"]}),i.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:""})]}),i.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:Ye.cbc.items.map((b,V)=>i.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-50 last:border-0",children:[i.jsx("span",{className:"text-sm text-slate-600",children:b.name}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("span",{className:"text-sm font-medium text-slate-800",children:[b.value," ",b.unit]}),i.jsxs("span",{className:"text-xs text-slate-400",children:["(",b.range,")"]}),i.jsx("span",{className:`w-2 h-2 rounded-full ${b.status==="normal"?"bg-green-500":b.status==="caution"?"bg-yellow-500":"bg-red-500"}`})]})]},V))}),i.jsx("p",{className:"mt-3 text-xs text-slate-500 bg-slate-50 p-2 rounded-lg",children:Ye.cbc.comment})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[i.jsx("span",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-purple-600 text-lg",children:"science"})})," "]}),i.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:""})]}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ye.biochemistry.items.slice(0,6).map((b,V)=>i.jsxs("div",{className:"bg-slate-50 rounded-lg p-2",children:[i.jsx("p",{className:"text-xs text-slate-500 truncate",children:b.name}),i.jsxs("p",{className:"text-sm font-medium text-slate-800",children:[b.value," ",i.jsx("span",{className:"text-xs text-slate-400",children:b.unit})]})]},V))}),i.jsxs("details",{className:"mt-3",children:[i.jsxs("summary",{className:"text-xs text-primary cursor-pointer hover:underline",children:["   (",Ye.biochemistry.items.length,")"]}),i.jsx("div",{className:"mt-2 space-y-1",children:Ye.biochemistry.items.map((b,V)=>i.jsxs("div",{className:"flex justify-between text-xs py-1 border-b border-slate-100",children:[i.jsx("span",{className:"text-slate-600",children:b.name}),i.jsxs("span",{className:"text-slate-800",children:[b.value," ",b.unit," (",b.range,")"]})]},V))})]}),i.jsx("p",{className:"mt-3 text-xs text-slate-500 bg-slate-50 p-2 rounded-lg",children:Ye.biochemistry.comment})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[i.jsx("span",{className:"w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-yellow-600 text-lg",children:"labs"})}),""]}),i.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:""})]}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ye.urinalysis.items.map((b,V)=>i.jsxs("div",{className:"flex justify-between items-center bg-slate-50 rounded-lg p-2",children:[i.jsx("span",{className:"text-xs text-slate-600",children:b.name}),i.jsx("span",{className:"text-xs font-medium text-slate-800",children:b.value})]},V))}),i.jsx("p",{className:"mt-3 text-xs text-slate-500 bg-slate-50 p-2 rounded-lg",children:Ye.urinalysis.comment})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[i.jsx("span",{className:"w-8 h-8 bg-pink-100 rounded-lg flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-pink-600 text-lg",children:"cardiology"})})," "]}),i.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:""})]}),i.jsx("div",{className:"space-y-2",children:Ye.cardiacUltrasound.findings.map((b,V)=>i.jsxs("div",{className:"flex justify-between items-center py-1",children:[i.jsx("span",{className:"text-sm text-slate-600",children:b.item}),i.jsx("span",{className:`text-sm font-medium ${b.status==="normal"?"text-green-600":"text-yellow-600"}`,children:b.result})]},V))}),i.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[i.jsxs("div",{className:"bg-pink-50 rounded-lg p-2 text-center",children:[i.jsx("p",{className:"text-xs text-slate-500",children:"LA/Ao "}),i.jsx("p",{className:"text-sm font-bold text-slate-800",children:Ye.cardiacUltrasound.laToAoRatio}),i.jsx("p",{className:"text-xs text-green-600",children:" (<1.6)"})]}),i.jsxs("div",{className:"bg-pink-50 rounded-lg p-2 text-center",children:[i.jsx("p",{className:"text-xs text-slate-500",children:"FS (%)"}),i.jsxs("p",{className:"text-sm font-bold text-slate-800",children:[Ye.cardiacUltrasound.fractionalShortening,"%"]}),i.jsx("p",{className:"text-xs text-green-600",children:" (25-50%)"})]})]}),i.jsx("p",{className:"mt-3 text-xs text-slate-500 bg-slate-50 p-2 rounded-lg",children:Ye.cardiacUltrasound.comment})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[i.jsx("span",{className:"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-orange-600 text-lg",children:"radiology"})})," "]}),i.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:""})]}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ye.abdominalUltrasound.organs.map((b,V)=>i.jsxs("div",{className:"bg-slate-50 rounded-lg p-2",children:[i.jsx("p",{className:"text-xs font-medium text-slate-700",children:b.name}),i.jsx("p",{className:"text-xs text-slate-500",children:b.result})]},V))}),i.jsx("p",{className:"mt-3 text-xs text-slate-500 bg-slate-50 p-2 rounded-lg",children:Ye.abdominalUltrasound.comment})]}),i.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-4 border border-blue-200",children:[i.jsxs("h3",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-blue-600",children:"lightbulb"})," "]}),i.jsx("ul",{className:"space-y-2",children:Ye.recommendations.map((b,V)=>i.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-600",children:[i.jsx("span",{className:"material-symbols-outlined text-blue-500 text-sm mt-0.5",children:"check_circle"}),b]},V))})]}),i.jsxs("div",{className:"bg-primary/10 rounded-2xl p-4 flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-slate-600",children:"  "}),i.jsx("p",{className:"text-lg font-bold text-primary",children:M(Ye.nextCheckupDate)})]}),i.jsx("button",{onClick:()=>{x(!1),a&&a()},className:"px-4 py-2 bg-primary text-white rounded-xl text-sm font-medium hover:bg-primary/90 transition-colors",children:" "})]}),i.jsxs("div",{className:"text-center text-xs text-slate-400 pb-4",children:[i.jsx("p",{children:Ye.hospitalName}),i.jsx("p",{children:Ye.hospitalAddress}),i.jsxs("p",{children:["Tel. ",Ye.hospitalPhone]})]})]})]})}),l==="vaccination"&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-slate-900 font-bold text-base mb-3 font-display",children:"  "}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("div",{className:"bg-surface-light rounded-lg p-4 shadow-soft",children:i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"text-slate-900 font-bold text-sm mb-1",children:" (DHPPL)"}),i.jsx("p",{className:"text-slate-500 text-xs",children:"1 1  ."})]}),i.jsx("button",{onClick:()=>a&&a(),className:"px-3 py-1.5 bg-primary text-white rounded-lg text-xs font-medium hover:bg-primary/90 transition-colors",children:" "})]})}),i.jsx("div",{className:"bg-surface-light rounded-lg p-4 shadow-soft",children:i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"text-slate-900 font-bold text-sm mb-1",children:" "}),i.jsx("p",{className:"text-slate-500 text-xs",children:"1 1  ."})]}),i.jsx("button",{onClick:()=>a&&a(),className:"px-3 py-1.5 bg-primary text-white rounded-lg text-xs font-medium hover:bg-primary/90 transition-colors",children:" "})]})}),i.jsx("div",{className:"bg-surface-light rounded-lg p-4 shadow-soft",children:i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"text-slate-900 font-bold text-sm mb-1",children:" "}),i.jsx("p",{className:"text-slate-500 text-xs",children:"1 1  ( )"})]}),i.jsx("button",{onClick:()=>a&&a(),className:"px-3 py-1.5 bg-primary text-white rounded-lg text-xs font-medium hover:bg-primary/90 transition-colors",children:" "})]})})]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-slate-900 font-bold text-base mb-3 font-display",children:"  "}),w.length===0?i.jsxs("div",{className:"text-center py-20",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("p",{className:"text-slate-500",children:"  ."})]}):i.jsx("div",{className:"space-y-3",children:w.map(b=>i.jsx("div",{className:"bg-surface-light rounded-lg p-4 shadow-soft",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{className:"flex gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-green-600",children:"vaccines"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-slate-900 font-bold text-sm mb-1",children:b.name}),i.jsxs("p",{className:"text-slate-500 text-xs",children:[M(b.date),"  ",b.hospitalName]}),i.jsxs("p",{className:"text-primary text-xs mt-1 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-xs",children:"event"})," : ",M(b.nextDue)]})]})]}),i.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium",children:""})]})},b.id))})]})]}),l==="care"&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"bg-surface-light rounded-lg p-4 shadow-soft mb-4",children:[i.jsx("h3",{className:"text-slate-900 font-bold text-base mb-3 font-display",children:"   "}),i.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl mb-1",children:""}),i.jsx("p",{className:"text-xs text-slate-500",children:""}),i.jsxs("p",{className:"text-sm font-bold text-slate-800",children:[E.reduce((b,V)=>b+(V.meals||0),0),""]})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl mb-1",children:""}),i.jsx("p",{className:"text-xs text-slate-500",children:""}),i.jsxs("p",{className:"text-sm font-bold text-slate-800",children:[E.reduce((b,V)=>b+(V.water||0),0),""]})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl mb-1",children:""}),i.jsx("p",{className:"text-xs text-slate-500",children:""}),i.jsxs("p",{className:"text-sm font-bold text-slate-800",children:[E.reduce((b,V)=>b+(V.walks||0),0),""]})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl mb-1",children:""}),i.jsx("p",{className:"text-xs text-slate-500",children:""}),i.jsxs("p",{className:"text-sm font-bold text-slate-800",children:[E.reduce((b,V)=>b+(V.treats||0),0),""]})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl mb-1",children:""}),i.jsx("p",{className:"text-xs text-slate-500",children:""}),i.jsxs("p",{className:"text-sm font-bold text-slate-800",children:[E.reduce((b,V)=>b+(V.grooming||0),0),""]})]})]})]}),i.jsx("h3",{className:"text-slate-900 font-bold text-base mb-3 font-display",children:" "}),E.length===0?i.jsxs("div",{className:"text-center py-20",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("p",{className:"text-slate-500",children:"  ."}),i.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"   !"})]}):i.jsx("div",{className:"space-y-3",children:E.map(b=>i.jsxs("div",{className:"bg-surface-light rounded-lg p-4 shadow-soft",children:[i.jsxs("div",{className:"flex justify-between items-start mb-3",children:[i.jsx("p",{className:"text-slate-500 text-sm font-medium",children:M(b.date)}),b.weight&&i.jsxs("span",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-xs font-medium",children:[b.weight,"kg"]})]}),i.jsxs("div",{className:"flex gap-4 text-sm",children:[b.meals>0&&i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("span",{className:"text-slate-700",children:b.meals})]}),b.water>0&&i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("span",{className:"text-slate-700",children:b.water})]}),b.walks>0&&i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("span",{className:"text-slate-700",children:b.walks})]}),b.treats>0&&i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("span",{className:"text-slate-700",children:b.treats})]}),b.grooming>0&&i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("span",{className:"text-slate-700",children:b.grooming})]})]}),b.notes&&i.jsxs("p",{className:"text-slate-600 text-sm mt-3 p-2 bg-slate-50 rounded-lg",children:[" ",b.notes]})]},b.id))})]})]})]})]})]})}function g6(t){const e={earIssue:!1,digestionIssue:!1,skinIssue:!1,energyLevel:.8,fever:!1},n=`
    ${t.summary||""}
    ${t.description||""}
    ${t.diagnosis||""}
    ${(t.possibleDiseases||[]).map(a=>a.name||a).join(" ")}
    ${(t.differentialDiagnosis||[]).join(" ")}
    ${t.reasoning||""}
  `.toLowerCase();(n.includes("")||n.includes("")||n.includes("ear")||n.includes("otitis"))&&(e.earIssue=!0),(n.includes("")||n.includes("")||n.includes("")||n.includes("")||n.includes("diarrhea")||n.includes("vomit")||n.includes("digestion"))&&(e.digestionIssue=!0),(n.includes("")||n.includes("")||n.includes("")||n.includes("skin")||n.includes("rash")||n.includes("itch"))&&(e.skinIssue=!0),(n.includes("")||n.includes("")||n.includes("")||n.includes("fever")||n.includes("temperature"))&&(e.fever=!0);const r=t.riskLevel||t.emergency||"low";return r==="high"||r==="High"||r==="Emergency"?e.energyLevel=.2:r==="medium"||r==="Moderate"?e.energyLevel=.5:e.energyLevel=.8,t.triage_score!==void 0&&(e.energyLevel=Math.max(.1,1-t.triage_score/5)),e}function Vf(t){return t?{earIssue:t.ear_issue||t.earIssue||!1,digestionIssue:t.digestion_issue||t.digestionIssue||!1,skinIssue:t.skin_issue||t.skinIssue||!1,energyLevel:t.energy_level!==void 0?t.energy_level:t.energyLevel!==void 0?t.energyLevel:.8,fever:t.fever||!1}:{}}async function x6(t,e=7){const s=xj(t.id,e);if(!s.length)return null;const n=rn(fs.GEMINI);if(!n)return console.warn("Gemini API  .  > API   ."),{earIssue:!1,digestionIssue:s.some(o=>o.poopCount>=3),skinIssue:!1,energyLevel:.7,fever:!1};const r=`     AI.
 ${e}   ,       JSON .

 :
{
  "health_flags": {
    "earIssue": boolean,
    "digestionIssue": boolean,
    "skinIssue": boolean,
    "energyLevel": number,  // 0~1
    "fever": boolean
  },
  "patterns": [
    "   1",
    "   2"
  ],
  "predictions": [
    " 3  1",
    " 3  2"
  ],
  "risk_changes": {
    "description": "  ",
    "trend": "up" | "down" | "stable"
  }
}

 JSON .    .`,a=` :
- : ${t.petName||t.name}
- : ${t.species==="dog"?"":t.species==="cat"?"":t.species}
- : ${t.breed||""}

 ${s.length}  :
${s.map(o=>`- ${o.date}:  ${o.mealCount||0},  ${o.waterCount||0},  ${o.walkCount||0},  ${o.poopCount||0},  ${o.weight||"?"}kg, : ${o.note||""}`).join(`
`)}

  :
1.    (: " 3  20% ", "  ")
2.  3  (: "  ", "  ")
3. health_flags 

JSON .`;try{const o=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:r},{text:a}]}]})});if(!o.ok)throw new Error(`Gemini API : ${o.status}`);const u=(await o.json()).candidates[0].content.parts[0].text.match(/\{[\s\S]*\}/);if(u){const h=JSON.parse(u[0]);return h.health_flags?{...h.health_flags,patterns:h.patterns||[],predictions:h.predictions||[],risk_changes:h.risk_changes||null}:h}throw new Error("JSON  ")}catch(o){console.error("  :",o);const l=s.reduce((h,m)=>h+(m.mealCount||0),0)/s.length,c=s.reduce((h,m)=>h+(m.walkCount||0),0)/s.length;return{earIssue:!1,digestionIssue:s.reduce((h,m)=>h+(m.poopCount||0),0)/s.length>3||s.some(h=>(h.note||"").toLowerCase().includes("")||(h.note||"").toLowerCase().includes("")),skinIssue:s.some(h=>(h.note||"").toLowerCase().includes("")||(h.note||"").toLowerCase().includes("")),energyLevel:Math.min(1,Math.max(0,c/3*.5+l/2*.5)),fever:s.some(h=>(h.note||"").toLowerCase().includes("")||(h.note||"").toLowerCase().includes(""))}}}function y6({currentTab:t,onTabChange:e,onModeSwitch:s,showModeSwitch:n,hideInDiagnosis:r=!1}){const a=[{id:"care",label:"",icon:"home"},{id:"diagnosis",label:"AI",icon:"medical_services"},{id:"hospital",label:"",icon:"local_hospital"},{id:"records",label:"",icon:"receipt_long"},{id:"mypage",label:"",icon:"person"}];return r?null:i.jsx("div",{className:"fixed bottom-0 left-0 right-0 md:left-1/2 md:-translate-x-1/2 md:w-[430px] md:bottom-2 md:rounded-b-[2.5rem] bg-white/95 backdrop-blur-sm border-t border-slate-200 z-50 overflow-hidden",children:i.jsxs("div",{className:"flex items-center h-16 px-0.5",children:[a.map(o=>i.jsxs("button",{className:`flex flex-col items-center justify-center flex-1 h-full transition-colors ${t===o.id?"text-sky-500":"text-slate-400"}`,onClick:()=>e(o.id),children:[i.jsx("span",{className:`material-symbols-outlined text-[18px] mb-0.5 ${t===o.id?"font-bold":""}`,children:o.icon}),i.jsx("span",{className:`text-[9px] font-medium ${t===o.id?"text-sky-500":"text-slate-400"}`,children:o.label})]},o.id)),n&&s&&i.jsxs("button",{className:"flex flex-col items-center justify-center flex-1 h-full transition-colors text-emerald-500 hover:text-emerald-600",onClick:s,title:"   ",children:[i.jsx("span",{className:"material-symbols-outlined text-[18px] mb-0.5",children:"swap_horiz"}),i.jsx("span",{className:"text-[9px] font-medium text-emerald-500",children:""})]})]})})}const v6=async(t,e,s,n)=>{const r=rn(fs.GEMINI);if(!r)throw new Error("Gemini API   .  > API   .");const a="gemini-2.0-flash",o=`${ea}

 "Care Agent ( )".

[]
- Medical / Triage / Ops  ,        .
-    ' '    .
-  /   .
-  ,    .

[]
- pet_profile:  
- medical_result: Medical Agent JSON
- triage_result: Triage Engine JSON
- ops_medical_log: Ops Agent medical_log

 :
- : ${t.petName}
- : ${Cs(t.species)}
- : ${t.breed||""}

Medical Agent :
${JSON.stringify(s,null,2)}

Triage Engine :
${JSON.stringify(n,null,2)}

Ops Agent  :
${JSON.stringify((e==null?void 0:e.medical_log)||{},null,2)}

[  - JSON ONLY]

{
  "immediate_home_care": [
    "        1",
    "     2",
    "   (:   ,   )"
  ],
  "things_to_avoid": [
    "  // 1",
    "   2"
  ],
  "monitoring_guide": [
    "     1",
    "       "
  ],
  "long_term_prevention": [
    " 1~3       ",
    "//  "
  ],
  "follow_up_guide": {
    "need_follow_up": true,
    "timing": "24~48  | 3  | 1  |   ",
    "condition_for_hospital": "     ",
    "home_care_duration": "   (: 2~3 )"
  },
  "care_tone_message": "   /  ( 1~2)",
  "hospital_needed": false
}

:
- triage_score 0~2 (green/yellow) :       . hospital_needed false.
- triage_score 3 :   , 24~48      . hospital_needed  true.
- triage_result red  emergency : immediate_home_care   '  '  . hospital_needed true.
-         .
- follow_up_guide /    .
-   "   "   .
-   JSON .`;try{const l=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${a}:generateContent?key=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:o}]}]})});if(!l.ok)throw new Error(`Gemini API : ${l.status}`);const h=(await l.json()).candidates[0].content.parts[0].text.match(/\{[\s\S]*\}/);if(h){const m=JSON.parse(h[0]),f=m.follow_up_guide?`
[/ ]
 : ${m.follow_up_guide.timing||"  "}
  : ${m.follow_up_guide.home_care_duration||"2~3 "}
    : ${m.follow_up_guide.condition_for_hospital||"     "}
`:"",y=m.hospital_needed?`
   .`:`
     .`,_=`
${m.care_tone_message}
${y}

[  ]
${m.immediate_home_care.map(S=>` ${S}`).join(`
`)}

[  ]
${m.things_to_avoid.map(S=>` ${S}`).join(`
`)}

[ ]
${m.monitoring_guide.map(S=>` ${S}`).join(`
`)}
${f}
[ ]
${m.long_term_prevention.map(S=>` ${S}`).join(`
`)}
      `.trim();return{json:m,message:`${t.petName}    !

${m.care_tone_message}`,fullGuide:_}}throw new Error("JSON  ")}catch(l){console.error("Care Agent :",l);const c=(n==null?void 0:n.triage_level)==="red"||(n==null?void 0:n.triage_score)>=4,u=(n==null?void 0:n.triage_score)<=2,h={immediate_home_care:c?["   .   ."]:u?["  ","   ","      ","   "]:["  ","  ","  "],things_to_avoid:[" ","  ","  "],monitoring_guide:["  ","    ","  "],long_term_prevention:["  ","  "],follow_up_guide:{need_follow_up:!u,timing:c?"":u?"  ":"24~48 ",condition_for_hospital:"   (, ,  )  ",home_care_duration:u?"2~3 ":"24 "},care_tone_message:u?`${t.petName}   .    !`:`${t.petName}   .`,hospital_needed:c},m=u?`     .

[ ]
${h.immediate_home_care.map(f=>` ${f}`).join(`
`)}

[ ]
 ${h.follow_up_guide.timing} .`:"  ";return{json:h,message:u?`${t.petName}   !

  .

 :
   
   

   .`:`${t.petName}   !

 :
   
   `,fullGuide:m}}},b6={dog:"",cat:"",rabbit:"",hamster:"",bird:"",hedgehog:"",reptile:"",etc:"",other:""};function qg({petData:t,diagnosisResult:e,symptomData:s,userData:n,onClose:r,onGoToHospital:a,onGoToTreatment:o,onShowDetail:l}){var C,P,j,re;const[c,u]=O.useState(!1),[h,m]=O.useState(!1),[f,y]=O.useState(!1),_=O.useRef(null),R=(()=>{if(!t)return{name:"",age:"",weight:"",breed:"",species:"dog",speciesLabel:"",genderLabel:""};const Z=t.petName||t.name||"";let le="";if(t.age)le=typeof t.age=="number"?`${t.age}`:t.age;else if(t.birthDate){const b=new Date(t.birthDate),V=new Date,J=V.getFullYear()-b.getFullYear(),z=V.getMonth()-b.getMonth();J>0?le=`${J}`:z>0?le=`${z}`:le="1 "}const ce=t.weight?`${t.weight}kg`:"",F=t.breed||"",Q=t.species||"dog",K=b6[Q]||"",I=t.sex||t.gender,L=I==="M"?"":I==="F"?"":"",W=Is(t,!1);return{name:Z,age:le,weight:ce,breed:F,species:Q,speciesLabel:K,gender:I,genderLabel:L,profileImage:W}})(),k=new Date().toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),x=`PMD.${Date.now().toString(36).toUpperCase().slice(-6)}`,M=(Z=>{switch(Z){case"high":return{text:"",color:"#ef4444",bgColor:"#fef2f2",desc:"   "};case"medium":return{text:"",color:"#f59e0b",bgColor:"#fffbeb",desc:"  "};default:return{text:"",color:"#22c55e",bgColor:"#f0fdf4",desc:"   "}}})(e==null?void 0:e.emergency),D=((C=e==null?void 0:e.diagnosis)==null?void 0:C.includes(""))||(e==null?void 0:e.isAcute)||(e==null?void 0:e.type)==="acute",B=Math.round(((e==null?void 0:e.probability)||(e==null?void 0:e.confidence)||.7)*100),v=async()=>{u(!0);try{const Z=N(),le=new Blob([Z],{type:"text/plain;charset=utf-8"}),ce=URL.createObjectURL(le),F=document.createElement("a");F.href=ce,F.download=`_${R.name}_${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(F),F.click(),document.body.removeChild(F),URL.revokeObjectURL(ce),alert(" .")}catch(Z){console.error(" :",Z),alert("   .")}finally{u(!1)}},N=()=>{var Z,le;return`

       PetMedical.AI 


: ${k}
 : No. ${x}


               

: ${R.name}
: ${R.speciesLabel}
: ${R.age}
: ${R.breed}
: ${R.weight}
: ${R.genderLabel}


               

: ${(s==null?void 0:s.department)||""}
: ${((Z=s==null?void 0:s.selectedSymptoms)==null?void 0:Z.join(", "))||(s==null?void 0:s.description)||" "}
 : ${(s==null?void 0:s.userDescription)||(s==null?void 0:s.description)||""}


               

: ${(e==null?void 0:e.diagnosis)||" "}
: ${B}%
: ${M.text} - ${M.desc}
${e!=null&&e.triage_score?`: ${e.triage_score}/5`:""}


               

${(e==null?void 0:e.description)||"  "}


               

${((le=e==null?void 0:e.actions)==null?void 0:le.map((ce,F)=>`${F+1}. ${ce}`).join(`
`))||""}


      AI  .
        
    .

`},w=()=>{m(!0),setTimeout(()=>{m(!1),a&&a()},1e3)},E=()=>{l?l():y(!0)};return n!=null&&n.name||n!=null&&n.displayName||t!=null&&t.ownerName,(n==null?void 0:n.provider)==="kakao"||(n==null?void 0:n.provider)==="google"||n==null||n.provider,f?i.jsx("div",{className:"dr-overlay",children:i.jsxs("div",{className:"dr-container",ref:_,children:[i.jsxs("div",{className:"dr-header",children:[i.jsxs("div",{className:"dr-header-left",children:[i.jsx("button",{className:"dr-back-btn",onClick:()=>y(!1),children:i.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:i.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),i.jsx("div",{className:"dr-header-text",children:i.jsx("h1",{children:"  "})})]}),i.jsx("button",{className:"dr-close-btn",onClick:r,children:i.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:i.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),i.jsxs("div",{className:"dr-content",children:[(e==null?void 0:e.description)&&i.jsxs("div",{className:"dr-section",children:[i.jsxs("h3",{className:"dr-section-title",children:[i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#38bdf8",strokeWidth:"2",children:[i.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),i.jsx("path",{d:"M14 2v6h6M16 13H8M16 17H8M10 9H8"})]})," "]}),i.jsx("div",{className:"dr-description-box",children:e.description})]}),((P=e==null?void 0:e.actions)==null?void 0:P.length)>0&&i.jsxs("div",{className:"dr-section",children:[i.jsxs("h3",{className:"dr-section-title",children:[i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#38bdf8",strokeWidth:"2",children:[i.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),i.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]})," "]}),i.jsx("div",{className:"dr-actions-list",children:e.actions.map((Z,le)=>i.jsxs("div",{className:"dr-action-item",children:[i.jsx("div",{className:"dr-action-num",children:le+1}),i.jsx("p",{className:"dr-action-text",children:Z})]},le))})]}),((j=e==null?void 0:e.medicationGuidance)==null?void 0:j.hasMedicationGuidance)&&i.jsxs("div",{className:"dr-section dr-medication-section",children:[i.jsxs("h3",{className:"dr-section-title",children:[i.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#ca8a04",strokeWidth:"2",children:i.jsx("path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0016.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 002 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"})})," "]}),i.jsx("p",{className:"dr-medication-summary",children:e.medicationGuidance.message}),(re=e.medicationGuidance.medications)==null?void 0:re.map((Z,le)=>{var ce;return i.jsxs("div",{className:"dr-medication-category",children:[i.jsxs("div",{className:"dr-medication-category-title",children:[Z.category," "]}),(ce=Z.medications)==null?void 0:ce.slice(0,2).map((F,Q)=>i.jsxs("div",{className:"dr-medication-item",children:[i.jsx("div",{className:"dr-medication-type",children:F.type}),i.jsxs("div",{className:"dr-medication-details",children:[i.jsxs("span",{children:[": ",F.usage]}),i.jsxs("span",{children:[": ",F.duration]})]})]},Q))]},le)}),i.jsx("p",{className:"dr-medication-disclaimer",children:e.medicationGuidance.disclaimer})]}),((e==null?void 0:e.hospitalVisit)||(e==null?void 0:e.emergency)==="high"||(e==null?void 0:e.emergency)==="medium")&&i.jsxs("div",{className:"dr-hospital-alert",children:[i.jsx("div",{className:"dr-hospital-icon",children:i.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",children:[i.jsx("circle",{cx:"12",cy:"12",r:"10"}),i.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),i.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}),i.jsxs("div",{className:"dr-hospital-content",children:[i.jsx("strong",{children:" "}),i.jsxs("p",{children:[(e==null?void 0:e.hospitalVisitTime)||" ","   ."]})]})]})]})]})}):i.jsx("div",{className:"dr-overlay",children:i.jsxs("div",{className:"dr-container",ref:_,children:[i.jsxs("div",{className:"dr-header",children:[i.jsxs("div",{className:"dr-header-left",children:[i.jsx("div",{className:"dr-logo-icon",children:i.jsx("img",{src:"/ai-factory/icon/login/logo.png",alt:"PetMedical.AI",style:{width:"32px",height:"32px",objectFit:"contain"}})}),i.jsxs("div",{className:"dr-header-text",children:[i.jsx("h1",{children:"PetMedical.AI "}),i.jsx("p",{children:"AI     "})]})]}),i.jsx("button",{className:"dr-close-btn",onClick:r,children:i.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:i.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),i.jsxs("div",{className:"dr-content",children:[i.jsxs("div",{className:"dr-meta-card",children:[i.jsxs("div",{className:"dr-meta-item",children:[i.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),i.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),i.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),i.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),i.jsx("span",{children:k})]}),i.jsxs("span",{className:"dr-pmd-number",children:["No. ",x]})]}),i.jsxs("div",{className:"dr-pet-card",children:[i.jsx("div",{className:"dr-pet-avatar-square",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:R.profileImage?i.jsx("img",{src:R.profileImage,alt:R.name,style:{objectFit:"cover",objectPosition:"center"}}):i.jsx("div",{className:"dr-pet-icon-placeholder",children:i.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"#f59e0b",children:i.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})})})}),i.jsxs("div",{className:"dr-pet-details",children:[i.jsx("h2",{children:" "}),i.jsxs("div",{className:"dr-pet-grid",children:[i.jsxs("div",{className:"dr-pet-item",children:[i.jsx("span",{className:"dr-pet-label",children:""}),i.jsx("span",{className:"dr-pet-value",children:R.name})]}),i.jsxs("div",{className:"dr-pet-item",children:[i.jsx("span",{className:"dr-pet-label",children:""}),i.jsx("span",{className:"dr-pet-value",children:R.speciesLabel})]}),i.jsxs("div",{className:"dr-pet-item",children:[i.jsx("span",{className:"dr-pet-label",children:""}),i.jsx("span",{className:"dr-pet-value",children:R.age})]}),i.jsxs("div",{className:"dr-pet-item",children:[i.jsx("span",{className:"dr-pet-label",children:""}),i.jsx("span",{className:"dr-pet-value",children:R.breed})]}),i.jsxs("div",{className:"dr-pet-item",children:[i.jsx("span",{className:"dr-pet-label",children:""}),i.jsx("span",{className:"dr-pet-value",children:R.weight})]}),i.jsxs("div",{className:"dr-pet-item",children:[i.jsx("span",{className:"dr-pet-label",children:""}),i.jsx("span",{className:"dr-pet-value",children:R.genderLabel})]})]})]})]}),i.jsxs("div",{className:"dr-diagnosis-card",children:[i.jsxs("div",{className:"dr-diagnosis-header",children:[i.jsxs("div",{className:"dr-diagnosis-title-row",children:[i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#ef4444",strokeWidth:"2",children:[i.jsx("circle",{cx:"12",cy:"12",r:"10"}),i.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),i.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),i.jsx("h3",{children:" "})]}),i.jsxs("div",{className:"dr-emergency-badges",children:[D&&i.jsx("span",{className:"dr-badge dr-badge-acute",children:""}),i.jsx("span",{className:"dr-badge",style:{backgroundColor:M.color},children:M.text})]})]}),i.jsxs("div",{className:"dr-diagnosis-content",children:[i.jsxs("div",{className:"dr-diagnosis-inner-card",children:[i.jsx("h4",{className:"dr-diagnosis-name",children:(e==null?void 0:e.diagnosis)||"  "}),i.jsxs("div",{className:"dr-confidence",children:[i.jsx("span",{className:"dr-confidence-label",children:""}),i.jsx("div",{className:"dr-confidence-bar",children:i.jsx("div",{className:"dr-confidence-fill",style:{width:`${B}%`}})}),i.jsxs("span",{className:"dr-confidence-value",children:[B,"%"]})]})]}),(e==null?void 0:e.triage_score)!==void 0&&i.jsxs("div",{className:"dr-severity",children:[i.jsx("span",{className:"dr-severity-label",children:" "}),i.jsx("div",{className:"dr-severity-dots",children:[1,2,3,4,5].map(Z=>i.jsx("div",{className:`dr-severity-dot ${Z<=e.triage_score?"active":""}`,style:{backgroundColor:Z<=e.triage_score?e.triage_score>=4?"#ef4444":e.triage_score>=3?"#f59e0b":"#22c55e":"#e5e7eb"}},Z))}),i.jsxs("span",{className:"dr-severity-value",children:[e.triage_score,"/5"]})]}),i.jsxs("button",{className:"dr-detail-btn",onClick:E,children:["   ",i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:i.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})]})]})]}),i.jsxs("div",{className:"dr-footer-notice",children:[i.jsx("span",{className:"dr-notice-icon",children:""}),"  AI   .",i.jsx("br",{}),"     ."]})]}),i.jsxs("div",{className:"dr-actions",children:[i.jsxs("button",{className:"dr-btn dr-btn-primary",onClick:v,disabled:c,children:[i.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),i.jsx("polyline",{points:"7 10 12 15 17 10"}),i.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),c?" ...":" "]}),i.jsxs("button",{className:"dr-btn dr-btn-secondary",onClick:w,disabled:h,children:[i.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("circle",{cx:"12",cy:"12",r:"10"}),i.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),i.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),h?" ...":" "]}),i.jsxs("button",{className:"dr-btn dr-btn-treatment",onClick:o,children:[i.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})," "]})]})]})})}const Cv=new Kn,w6=()=>{const t=navigator.userAgent||navigator.vendor||window.opera;return/KAKAOTALK|FBAN|FBAV|Instagram|Line|NAVER|Daum/i.test(t)||t.indexOf("wv")>-1||/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(t)},Pr={async register(t,e,s,n="guardian"){try{const a=(await vP(kn,t,e)).user;return await _P(a,{displayName:s}),await Vs.saveUser(a.uid,{email:a.email,displayName:s,userMode:n,createdAt:new Date().toISOString()}),{success:!0,user:{uid:a.uid,email:a.email,displayName:s,userMode:n,roles:[],defaultClinicId:null}}}catch(r){console.error(" :",r);let a=" .";return r.code==="auth/email-already-in-use"?a="   .":r.code==="auth/weak-password"?a=" 6  .":r.code==="auth/invalid-email"&&(a="   ."),{success:!1,error:a}}},async login(t,e){try{const n=(await bP(kn,t,e)).user,a=(await Vs.getUser(n.uid)).data||{};return{success:!0,user:{uid:n.uid,email:n.email,displayName:n.displayName||a.displayName,userMode:a.userMode||"guardian",roles:a.roles||[],defaultClinicId:a.defaultClinicId||null}}}catch(s){console.error(" :",s.code,s.message);let n=" .";return s.code==="auth/user-not-found"?n="  .   .":s.code==="auth/wrong-password"?n="  .":s.code==="auth/invalid-credential"?n=`    .
    .`:s.code==="auth/invalid-email"?n="   .":s.code==="auth/user-disabled"?n=" .  .":s.code==="auth/too-many-requests"&&(n="   .    ."),{success:!1,error:n}}},async loginWithGoogle(t="guardian"){var e,s,n;try{if(w6()){const r=window.location.href;return/android/i.test(navigator.userAgent)?window.location.href=`intent://${r.replace(/^https?:\/\//,"")}#Intent;scheme=https;package=com.android.chrome;end`:/iPhone|iPad|iPod/i.test(navigator.userAgent)&&(window.location.href=r),{success:!1,error:`     .

 (Safari, Chrome) .

  (  )  "  "`,isEmbeddedBrowser:!0}}try{console.log("   ");const r=window.onerror;window.onerror=(a,o,l,c,u)=>a!=null&&a.includes("Cross-Origin-Opener-Policy")||a!=null&&a.includes("window.closed")?(console.warn("[Google Login] COOP  :",a),!0):r?r(a,o,l,c,u):!1;try{const a=await WP(kn,Cv);window.onerror=r;const o=a.user;let l={};try{const c=await Vs.getUser(o.uid);l=c.data||{},c.data||await Vs.saveUser(o.uid,{email:o.email,displayName:o.displayName,photoURL:o.photoURL,userMode:t,createdAt:new Date().toISOString()})}catch(c){console.warn("Firestore  ():",c)}return{success:!0,user:{uid:o.uid,email:o.email,displayName:o.displayName,photoURL:o.photoURL,userMode:l.userMode||t,roles:l.roles||[],defaultClinicId:l.defaultClinicId||null}}}catch(a){throw window.onerror=r,a}}catch(r){return console.error("  :",r),r.code==="auth/popup-blocked"||r.code==="auth/popup-closed-by-user"||(e=r.message)!=null&&e.includes("Cross-Origin-Opener-Policy")||(s=r.message)!=null&&s.includes("window.close")||(n=r.message)!=null&&n.includes("window.closed")?(console.log("[Google Login]  ,   "),sessionStorage.setItem("pendingUserMode",t),await XP(kn,Cv),{success:!1,redirecting:!0}):{success:!1,error:"  : "+r.message}}}catch(r){return console.error("  :",r),{success:!1,error:"  : "+r.message}}},async handleRedirectResult(){try{const t=await e4(kn);if(t){const e=t.user,s=sessionStorage.getItem("pendingUserMode")||"guardian";sessionStorage.removeItem("pendingUserMode");let n={};try{const r=await Vs.getUser(e.uid);n=r.data||{},r.data||await Vs.saveUser(e.uid,{email:e.email,displayName:e.displayName,photoURL:e.photoURL,userMode:s,createdAt:new Date().toISOString()})}catch(r){console.warn("Firestore   (  ):",r)}return{success:!0,user:{uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,userMode:n.userMode||s,roles:n.roles||[],defaultClinicId:n.defaultClinicId||null}}}return{success:!1,noResult:!0}}catch(t){return console.error("   :",t),{success:!1,error:"     ."}}},async sendPasswordReset(t){try{return await yP(kn,t),{success:!0}}catch(e){console.error("  :",e);let s="    .";return e.code==="auth/user-not-found"?s="  .":e.code==="auth/invalid-email"&&(s="   ."),{success:!1,error:s}}},async logout(){try{return await SP(kn),{success:!0}}catch(t){return console.error(" :",t),{success:!1,error:" ."}}},async updateUserMode(t,e){try{return await Vs.saveUser(t,{userMode:e}),{success:!0}}catch(s){return console.error("  :",s),{success:!1,error:s}}},getCurrentUser(){return kn.currentUser},onAuthStateChange(t){return IP(kn,async e=>{if(e){const n=(await Vs.getUser(e.uid)).data||{};t({uid:e.uid,email:e.email,displayName:e.displayName||n.displayName,photoURL:e.photoURL,userMode:n.userMode||"guardian",roles:n.roles||[],defaultClinicId:n.defaultClinicId||null})}else t(null)})}},wj="6a6433ff3ccbbc31a0448cae49055e4d",_6="jNNfgEPny8kfcQ6NLBtGmegCRa558c4m",_j=window.location.origin+window.location.pathname,N6=(t="guardian")=>new Promise(async(e,s)=>{try{sessionStorage.removeItem("pendingKakaoLogin"),sessionStorage.removeItem("pendingUserMode"),sessionStorage.setItem("pendingUserMode",t),sessionStorage.setItem("pendingKakaoLogin","true");const n=`https://kauth.kakao.com/oauth/authorize?client_id=${wj}&redirect_uri=${encodeURIComponent(_j)}&response_type=code`;console.log("  :",n),window.location.href=n,e({success:!1,redirecting:!0})}catch(n){console.error("   :",n),s({success:!1,error:"    ."})}}),j6=()=>new Promise(async(t,e)=>{var s,n,r,a,o;try{if(!sessionStorage.getItem("pendingKakaoLogin")){t({success:!1,noPending:!0});return}const c=new URLSearchParams(window.location.search),u=c.get("code"),h=c.get("error"),m=c.get("error_description");if(h){sessionStorage.removeItem("pendingKakaoLogin"),sessionStorage.removeItem("pendingUserMode"),window.history.replaceState({},document.title,window.location.pathname),e({success:!1,error:m||"  ."});return}if(u){window.history.replaceState({},document.title,window.location.pathname);try{const f=await fetch("https://kauth.kakao.com/oauth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},body:new URLSearchParams({grant_type:"authorization_code",client_id:wj,client_secret:_6,redirect_uri:_j,code:u})});if(!f.ok){const A=await f.json();throw new Error(A.error_description||"  ")}const _=(await f.json()).access_token,S=await fetch("https://kapi.kakao.com/v2/user/me",{headers:{Authorization:`Bearer ${_}`,"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}});if(!S.ok)throw new Error("   ");const R=await S.json(),k=sessionStorage.getItem("pendingUserMode")||"guardian";sessionStorage.removeItem("pendingKakaoLogin"),sessionStorage.removeItem("pendingUserMode");const x={uid:`kakao_${R.id}`,email:((s=R.kakao_account)==null?void 0:s.email)||`kakao_${R.id}@kakao.com`,displayName:((r=(n=R.kakao_account)==null?void 0:n.profile)==null?void 0:r.nickname)||" ",photoURL:((o=(a=R.kakao_account)==null?void 0:a.profile)==null?void 0:o.profile_image_url)||null,provider:"kakao",kakaoId:R.id,userMode:k};t({success:!0,user:x})}catch(f){sessionStorage.removeItem("pendingKakaoLogin"),sessionStorage.removeItem("pendingUserMode"),console.error("   :",f),e({success:!1,error:f.message||"   ."})}return}sessionStorage.removeItem("pendingKakaoLogin"),t({success:!1,noCode:!0})}catch(l){sessionStorage.removeItem("pendingKakaoLogin"),sessionStorage.removeItem("pendingUserMode"),console.error("    :",l),e({success:!1,error:"Kakao   ."})}}),Nj=(t=new Date)=>{const e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${s}-${n}`},Pv={guardian:"guardian@test.com",clinic:"clinic@happyvet.com"};function lm(t){return t?t===Pv.guardian||t===Pv.clinic:!1}function I6(t,e){return lm(e)?t.filter(s=>{var a,o,l;const n=((a=s.user)==null?void 0:a.email)||((o=s.owner)==null?void 0:o.email)||s.userEmail,r=((l=s.clinic)==null?void 0:l.email)||s.clinicEmail;return lm(n)||lm(r)}):t}async function Ci(t){try{const e=_e(fe(se,"clinicStaff"),pe("userId","==",t),pe("isActive","==",!0)),s=await Pe(e);if(s.empty)return[];const n=[];for(const r of s.docs){const a=r.data(),o=st(se,"clinics",a.clinicId),l=await Ht(o);l.exists()&&n.push({id:l.id,...l.data(),staffRole:a.role,staffId:r.id})}return n}catch(e){throw console.error("   :",e),e}}async function S6(t){try{const e=_e(fe(se,"clinicStaff"),pe("clinicId","==",t),pe("isActive","==",!0)),s=await Pe(e),n=[];for(const r of s.docs){const a=r.data(),o=await Ht(st(se,"users",a.userId));o.exists()&&n.push({id:r.id,...a,user:o.data()})}return n}catch(e){throw console.error("   :",e),e}}async function jj(t,e=null){try{const n=Nj(new Date),r=await Ht(st(se,"clinics",t)),a=r.exists()?r.data():null,o=a==null?void 0:a.name,l=_e(fe(se,"bookings"),pe("clinicId","==",t),pe("date","==",n),Pt("time","asc"));let c=null;o&&(c=_e(fe(se,"bookings"),pe("clinicName","==",o),pe("date","==",n)));let u=null;a!=null&&a.animalHospitalId&&(u=_e(fe(se,"bookings"),pe("animalHospitalId","==",a.animalHospitalId),pe("date","==",n)));const h=[Pe(l)];c&&h.push(Pe(c)),u&&h.push(Pe(u));const m=await Promise.all(h),f=new Map;for(const R of m)for(const k of R.docs)f.has(k.id)||f.set(k.id,k);const y=[];for(const R of f.values()){const k=R.data();let x=null;k.petId&&(x=await Ht(st(se,"pets",k.petId)));let A=null;k.userId&&(A=await Ht(st(se,"users",k.userId))),y.push({id:R.id,...k,pet:x!=null&&x.exists()?x.data():k.pet||k.petProfile||null,owner:A!=null&&A.exists()?A.data():k.owner||null})}y.sort((R,k)=>{const x=R.time||"00:00",A=k.time||"00:00";return x.localeCompare(A)});const _=(a==null?void 0:a.email)||(e==null?void 0:e.email);return I6(y,_)}catch(s){throw console.error("   :",s),s}}async function Ij(t,e,s){try{const n=`${e}-${String(s).padStart(2,"0")}-01`,r=s===12?`${e+1}-01-01`:`${e}-${String(s+1).padStart(2,"0")}-01`;console.log(" [getMonthlyBookings] :",{clinicId:t,year:e,month:s,startDate:n,endDate:r});const a=_e(fe(se,"bookings"),pe("clinicId","==",t),pe("date",">=",n),pe("date","<",r),Pt("date","asc"),Pt("time","asc")),o=await Pe(a);console.log(" [getMonthlyBookings]  :",{count:o.size,clinicId:t,dateRange:`${n} ~ ${r}`});const l=await Promise.all(o.docs.map(async c=>{const u=c.data();let h=null;if(u.petId)try{h=await Ht(st(se,"pets",u.petId))}catch(f){console.warn("   :",u.petId,f)}let m=null;if(u.userId)try{m=await Ht(st(se,"users",u.userId))}catch(f){console.warn("   :",u.userId,f)}return{id:c.id,...u,pet:h!=null&&h.exists()?h.data():u.pet||u.petProfile||null,owner:m!=null&&m.exists()?m.data():u.owner||null}}));return l.sort((c,u)=>{const h=(c.date||"").localeCompare(u.date||"");return h!==0?h:(c.time||"00:00").localeCompare(u.time||"00:00")}),l}catch(n){throw console.error(" [getMonthlyBookings]    :",n),n}}async function Sj(t,e={}){try{let s=_e(fe(se,"clinicPatients"),pe("clinicId","==",t));return e.orderBy?s=_e(s,Pt(e.orderBy,"desc")):s=_e(s,Pt("lastVisitDate","desc")),e.limit&&(s=_e(s,zs(e.limit))),(await Pe(s)).docs.map(r=>({id:r.id,...r.data()}))}catch(s){throw console.error("   :",s),s}}async function kj(t,e={}){try{console.log(" [getClinicResults] :",{clinicId:t,options:e});let s=_e(fe(se,"clinicResults"),pe("clinicId","==",t),Pt("visitDate","desc"));e.limit&&(s=_e(s,zs(e.limit)));const n=await Pe(s);console.log(" [getClinicResults]  :",{count:n.size});const r=[];for(const a of n.docs){const o=a.data();let l=null;if(o.petId)try{const c=await Ht(st(se,"pets",o.petId));l=c.exists()?c.data():null}catch(c){console.warn(" [getClinicResults]    :",c.message)}r.push({id:a.id,...o,pet:l})}return r}catch(s){throw console.error(" [getClinicResults]    :",s),s}}async function k6(t,e){try{const s=st(se,"clinics",t);return await Zi(s,{...e,updatedAt:qt()}),{success:!0}}catch(s){return console.error("   :",s),{success:!1,error:s}}}async function Ej(t){const e=Nj(),s=e.substring(0,7);console.log(" [getClinicStats] :",{clinicId:t,today:e,thisMonth:s});let n=0,r=0,a=0,o=0;try{const c=_e(fe(se,"bookings"),pe("clinicId","==",t),pe("date","==",e));n=(await Pe(c)).size,console.log(" [getClinicStats]  :",n)}catch(c){console.warn(" [getClinicStats]     ():",c.message)}try{const c=_e(fe(se,"clinicResults"),pe("clinicId","==",t),pe("visitDate",">=",`${s}-01`));r=(await Pe(c)).size,console.log(" [getClinicStats]   :",r)}catch(c){console.warn(" [getClinicStats]      ():",c.message)}try{const c=_e(fe(se,"clinicPatients"),pe("clinicId","==",t));a=(await Pe(c)).size,console.log(" [getClinicStats]  :",a)}catch(c){console.warn(" [getClinicStats]     ():",c.message)}try{const c=_e(fe(se,"vaccinations"),pe("clinicId","==",t),pe("status","==","scheduled"),pe("scheduledDate",">=",e));o=(await Pe(c)).size,console.log(" [getClinicStats]  :",o)}catch(c){console.warn(" [getClinicStats]    ():",c.message)}const l={todayBookings:n,monthlyVisits:r,totalPatients:a,upcomingVaccinations:o};return console.log(" [getClinicStats]  :",l),l}async function Tj(t){try{return{success:!0,clinicId:(await as(fe(se,"clinics"),{name:t.name,address:t.address||null,phone:t.phone||null,licenseNumber:t.licenseNumber||null,verified:!1,isActive:!0,createdAt:qt(),updatedAt:qt()})).id}}catch(e){return console.error("  :",e),{success:!1,error:e}}}async function Wg(t,e,s="director"){try{return{success:!0,staffId:(await as(fe(se,"clinicStaff"),{clinicId:t,userId:e,role:s,isActive:!0,joinedAt:qt(),updatedAt:qt()})).id}}catch(n){return console.error("  :",n),{success:!1,error:n}}}async function Kg(t,e){try{const s=await Tj(e);if(!s.success)throw new Error("  ");const n=s.clinicId,r=await Wg(n,t,"director");if(!r.success)throw new Error("  ");return await Zi(st(se,"users",t),{roles:[{clinicId:n,role:"director"}],defaultClinicId:n,updatedAt:qt()}),{success:!0,clinicId:n,staffId:r.staffId}}catch(s){return console.error("  :",s),{success:!1,error:s}}}async function Aj(t,e){try{const s=await Ci(t);if(s.length>0)return console.log(" clinicStaff  :",s.length),{success:!0,alreadyMigrated:!0,clinics:s};const n=e.clinicInfo||{name:e.displayName?`${e.displayName} `:" ",address:null,phone:null,licenseNumber:null};console.log("    :",t,n);const r=await Kg(t,n);return r.success&&console.log(" :",r.clinicId),r}catch(s){return console.error("    :",s),{success:!1,error:s}}}const Rv=Object.freeze(Object.defineProperty({__proto__:null,addClinicStaff:Wg,createClinic:Tj,getClinicPatients:Sj,getClinicResults:kj,getClinicStaff:S6,getClinicStats:Ej,getMonthlyBookings:Ij,getTodayBookings:jj,getUserClinics:Ci,migrateExistingClinicUser:Aj,setupClinicForNewUser:Kg,updateClinicInfo:k6},Symbol.toStringTag,{value:"Module"})),E6=Pr.logout;function T6({onLogin:t,onGoToRegister:e,onSkipLogin:s}){const[n,r]=O.useState({email:"",password:""}),[a,o]=O.useState("guardian"),[l,c]=O.useState(""),[u,h]=O.useState(!1),[m,f]=O.useState(!1),[y,_]=O.useState(!1),[S,R]=O.useState(""),[k,x]=O.useState(!1);O.useEffect(()=>{(async()=>{const N=sessionStorage.getItem("pendingUserMode"),w=sessionStorage.getItem("pendingKakaoLogin");if(!(!N&&!w)){h(!0);try{if(N){const E=N,C=await Pr.handleRedirectResult();if(C.success){sessionStorage.removeItem("pendingUserMode"),t({...C.user,userMode:E}),h(!1);return}}if(w)try{const E=await j6();if(E.success){try{await Vs.saveUser(E.user.uid,{email:E.user.email,displayName:E.user.displayName,photoURL:E.user.photoURL,provider:"kakao",userMode:E.user.userMode,createdAt:new Date().toISOString()})}catch(C){console.warn("Firestore   (  ):",C)}t(E.user)}}catch(E){E.error&&c(E.error),console.error("    :",E)}}catch(E){console.error("   :",E)}h(!1)}})()},[t]);const A=async v=>{v.preventDefault(),c(""),h(!0);const N=await Pr.login(n.email,n.password);N.success?(await Pr.updateUserMode(N.user.uid,a),t({...N.user,userMode:a})):c(N.error),h(!1)},M=async v=>{if(v.preventDefault(),!S){c(" .");return}c(""),h(!0);const N=await Pr.sendPasswordReset(S);N.success?x(!0):c(N.error),h(!1)},D=async()=>{c(""),h(!0);const v=await Pr.loginWithGoogle(a);if(v.success)t({...v.user,userMode:a});else{if(v.redirecting)return;v.isEmbeddedBrowser,c(v.error)}h(!1)},B=async()=>{c(""),h(!0);try{const v=await N6(a);if(v.success){try{await Vs.saveUser(v.user.uid,{email:v.user.email,displayName:v.user.displayName,photoURL:v.user.photoURL,provider:"kakao",userMode:a,createdAt:new Date().toISOString()})}catch(N){console.warn("Firestore   (  ):",N)}t({...v.user,userMode:a})}else{if(v.redirecting)return;c(v.error||"  .")}}catch(v){console.error("  :",v),c(v.error||"  .")}h(!1)};return i.jsxs("div",{className:"min-h-screen bg-slate-100 flex flex-col items-center justify-center p-6 pt-12",children:[i.jsx("div",{className:"w-full max-w-sm mb-8",children:i.jsxs("div",{className:"flex flex-col items-center text-center",children:[i.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[i.jsx("img",{src:"/ai-factory/icon/login/logo_red.png",alt:"PetMedical.AI",className:"w-16 h-16 sm:w-20 sm:h-20 object-contain"}),i.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-900 font-display",children:"PetMedical.AI"})]}),i.jsx("p",{className:"text-slate-500 text-base sm:text-lg",children:"AI   "})]})}),i.jsx("div",{className:"w-full max-w-sm mb-6",children:i.jsxs("div",{className:"flex gap-3",children:[i.jsxs("button",{type:"button",onClick:()=>o("guardian"),className:`flex-1 py-5 px-4 rounded-2xl bg-white shadow-sm transition-all flex flex-col items-center border-2 ${a==="guardian"?"border-sky-400 bg-sky-50/50":"border-transparent hover:shadow-md"}`,children:[i.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 flex items-center justify-center mb-2",children:i.jsx("img",{src:"/ai-factory/icon/login/main_friend.png",alt:"",className:"w-full h-full object-contain"})}),i.jsx("span",{className:"font-bold text-slate-800 text-base",children:""}),i.jsx("span",{className:"text-xs text-slate-500 mt-1",children:"  "})]}),i.jsxs("button",{type:"button",onClick:()=>o("clinic"),className:`flex-1 py-5 px-4 rounded-2xl bg-white shadow-sm transition-all flex flex-col items-center border-2 ${a==="clinic"?"border-sky-400 bg-sky-50/50":"border-transparent hover:shadow-md"}`,children:[i.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 flex items-center justify-center mb-2",children:i.jsx("img",{src:"/ai-factory/icon/login/main_hospital.png",alt:"",className:"w-full h-full object-contain"})}),i.jsx("span",{className:"font-bold text-slate-800 text-base",children:""}),i.jsx("span",{className:"text-xs text-slate-500 mt-1",children:"   "})]})]})}),i.jsxs("div",{className:"w-full max-w-sm",children:[m?y?i.jsx("div",{className:"space-y-4",children:k?i.jsxs("div",{className:"text-center py-6",children:[i.jsx("div",{className:"text-5xl mb-4",children:""}),i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:" "}),i.jsxs("p",{className:"text-sm text-slate-600 mb-4",children:[S,"    ."]}),i.jsx("button",{onClick:()=>{_(!1),x(!1),R("")},className:"w-full py-3 bg-gradient-to-r from-sky-500 to-sky-600 text-white font-bold rounded-xl hover:from-sky-600 hover:to-sky-700 transition-all",children:" "})]}):i.jsxs("form",{onSubmit:M,className:"space-y-3",children:[i.jsxs("div",{className:"text-center mb-4",children:[i.jsx("div",{className:"text-4xl mb-2",children:""}),i.jsx("h3",{className:"font-bold text-slate-800",children:" "}),i.jsx("p",{className:"text-sm text-slate-500",children:"    "})]}),i.jsx("input",{type:"email",placeholder:" ",value:S,onChange:v=>R(v.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-sky-500 bg-white",required:!0}),i.jsx("button",{type:"submit",disabled:u,className:"w-full py-4 bg-gradient-to-r from-sky-500 to-sky-600 text-white font-bold rounded-xl hover:from-sky-600 hover:to-sky-700 transition-all disabled:opacity-50",children:u?" ...":"  "}),i.jsx("button",{type:"button",onClick:()=>{_(!1),c("")},className:"w-full py-2 text-slate-500 text-sm hover:text-slate-700",children:" "})]})}):i.jsxs("form",{onSubmit:A,className:"space-y-3",children:[i.jsxs("div",{className:"text-center mb-4",children:[i.jsx("h3",{className:"text-lg font-bold text-slate-800",children:" "}),i.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"  "})]}),i.jsx("div",{children:i.jsx("input",{type:"email",placeholder:"",value:n.email,onChange:v=>r({...n,email:v.target.value}),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-sky-500 bg-white",required:!0})}),i.jsx("div",{children:i.jsx("input",{type:"password",placeholder:"",value:n.password,onChange:v=>r({...n,password:v.target.value}),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-sky-500 bg-white",required:!0})}),i.jsx("button",{type:"submit",disabled:u,className:"w-full py-4 bg-gradient-to-r from-sky-500 to-sky-600 text-white font-bold rounded-xl hover:from-sky-600 hover:to-sky-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg shadow-sky-500/30",children:u?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"})," ..."]}):""}),i.jsxs("div",{className:"flex justify-between items-center pt-2",children:[i.jsx("button",{type:"button",onClick:()=>{f(!1),c("")},className:"text-slate-500 text-sm hover:text-slate-700",children:"   "}),i.jsx("button",{type:"button",onClick:()=>{_(!0),c("")},className:"text-sky-600 text-sm hover:underline font-medium",children:" "})]}),i.jsxs("div",{className:"text-center pt-2 border-t border-slate-200 mt-4",children:[i.jsx("span",{className:"text-slate-500 text-sm",children:" ? "}),i.jsx("button",{type:"button",onClick:e,className:"text-sky-600 font-bold text-sm hover:underline",children:""})]})]}):i.jsx("button",{onClick:()=>f(!0),disabled:u,className:"w-full py-4 bg-gradient-to-r from-sky-500 to-sky-600 text-white text-base font-bold rounded-full hover:from-sky-600 hover:to-sky-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg",children:u?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),i.jsx("span",{children:" ..."})]}):" "}),l&&i.jsxs("div",{className:"mt-4 bg-red-50 text-red-600 text-sm p-3 rounded-lg flex items-start gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-sm mt-0.5",children:"error"}),i.jsx("span",{className:"whitespace-pre-line",children:l})]}),!m&&i.jsxs("div",{className:"mt-6",children:[i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-0 flex items-center",children:i.jsx("div",{className:"w-full border-t border-slate-300"})}),i.jsx("div",{className:"relative flex justify-center text-sm",children:i.jsx("span",{className:"px-4 bg-slate-100 text-slate-500",children:""})})]}),i.jsxs("div",{className:"mt-4 flex gap-3",children:[i.jsxs("button",{onClick:B,disabled:u,className:"flex-1 flex items-center justify-center gap-2 py-3 rounded-full bg-[#FEE500] hover:bg-[#FDD835] transition-colors disabled:opacity-50 font-medium",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("span",{className:"text-slate-900 font-bold text-base",children:""})]}),i.jsxs("button",{onClick:D,disabled:u,className:"flex-1 flex items-center justify-center gap-2 py-3 border border-slate-300 rounded-full bg-white hover:bg-slate-50 transition-colors disabled:opacity-50",children:[i.jsx("span",{className:"text-lg font-bold text-blue-500",children:"G"}),i.jsx("span",{className:"font-bold text-slate-700 text-base",children:""})]})]})]}),!m&&!y&&i.jsxs("div",{className:"mt-8 text-center",children:[i.jsx("span",{className:"text-slate-500 text-sm",children:" ? "}),i.jsx("button",{onClick:e,className:"text-sky-600 font-bold text-sm hover:underline",children:""})]}),s&&i.jsx("div",{className:"mt-4",children:i.jsxs("button",{onClick:()=>s(a),className:"w-full py-3 bg-white text-sky-600 font-medium rounded-full hover:bg-slate-50 transition-all flex items-center justify-center gap-2 border border-slate-200",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"rocket_launch"}),"   "]})})]})]})}function A6({onRegister:t,onGoToLogin:e}){const[s,n]=O.useState(1),[r,a]=O.useState({userMode:"",name:"",email:"",password:"",passwordConfirm:"",phone:"",gender:"",birthYear:"",clinicName:"",clinicAddress:"",clinicPhone:"",licenseNumber:"",agreeTerms:!1,agreePrivacy:!1,agreeMarketing:!1}),[o,l]=O.useState(""),[c,u]=O.useState(!1),[h,m]=O.useState(null),f=()=>!r.name||r.name.length<2?(l(" 2  ."),!1):!r.email||!r.email.includes("@")?(l("  ."),!1):!r.password||r.password.length<6?(l(" 6  ."),!1):r.password!==r.passwordConfirm?(l("  ."),!1):r.userMode==="clinic"&&(!r.clinicName||r.clinicName.length<2)?(l(" ."),!1):!0,y=()=>{if(l(""),s===1){if(!r.userMode){l(" .");return}n(2)}else s===2&&f()&&n(3)},_=async()=>{if(!r.agreeTerms||!r.agreePrivacy){l("  .");return}u(!0),l("");const S=await Pr.register(r.email,r.password,r.name,r.userMode);if(S.success){try{const R={phone:r.phone||null,gender:r.gender||null,ageGroup:r.birthYear||null,agreeMarketing:r.agreeMarketing};if(r.userMode==="clinic"){const k={name:r.clinicName,address:r.clinicAddress||null,phone:r.clinicPhone||null,licenseNumber:r.licenseNumber||null},x=await Kg(S.user.uid,k);x.success?(R.defaultClinicId=x.clinicId,R.roles=[{clinicId:x.clinicId,role:"director"}]):console.warn("  :",x.error)}await Vs.saveUser(S.user.uid,R)}catch(R){console.warn("Firestore    :",R)}m({...S.user,userMode:r.userMode}),n(4)}else l(S.error);u(!1)};return i.jsxs("div",{className:"min-h-screen bg-slate-100 flex flex-col items-center justify-center p-4 sm:p-6 pt-8 sm:pt-12",children:[i.jsx("div",{className:"w-full max-w-sm mb-4 sm:mb-6",children:i.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[i.jsx("img",{src:"/ai-factory/icon/login/logo.png",alt:"PetMedical.AI",className:"w-12 h-12 sm:w-14 sm:h-14 object-contain"}),i.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-slate-900 font-display",children:""})]})}),i.jsxs("div",{className:"w-full max-w-sm mb-4 sm:mb-6",children:[i.jsx("div",{className:"flex items-center justify-center gap-1 sm:gap-2",children:[1,2,3,4].map(S=>i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:`w-6 h-6 sm:w-8 sm:h-8 rounded-full flex items-center justify-center text-xs sm:text-sm font-bold ${S<=s?"bg-primary text-white":"bg-slate-200 text-slate-400"}`,children:S===4&&s===4?"":S}),S<4&&i.jsx("div",{className:`w-5 sm:w-8 h-0.5 sm:h-1 ${S<s?"bg-primary":"bg-slate-200"}`})]},S))}),i.jsxs("div",{className:"flex justify-between text-[10px] sm:text-xs text-slate-400 mt-1.5 sm:mt-2 px-1",children:[i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{children:""})]})]}),i.jsxs("div",{className:"w-full max-w-sm bg-white rounded-2xl shadow-xl p-4 sm:p-6",children:[s===1&&i.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[i.jsxs("div",{className:"text-center mb-3 sm:mb-4",children:[i.jsx("h3",{className:"text-base sm:text-lg font-bold text-slate-900",children:"  ?"}),i.jsx("p",{className:"text-xs sm:text-sm text-slate-500 mt-1",children:"    "})]}),i.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[i.jsxs("button",{type:"button",onClick:()=>a({...r,userMode:"guardian"}),className:`w-full p-3 sm:p-5 rounded-xl border-2 transition-all flex items-center gap-3 sm:gap-4 text-left ${r.userMode==="guardian"?"border-sky-500 bg-sky-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[i.jsx("div",{className:`w-10 h-10 sm:w-14 sm:h-14 rounded-xl flex items-center justify-center flex-shrink-0 ${r.userMode==="guardian"?"bg-sky-100":"bg-slate-100"}`,children:i.jsx("img",{src:"/ai-factory/icon/login/main_friend.png",alt:"",className:"w-7 h-7 sm:w-10 sm:h-10 object-contain"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[i.jsx("span",{className:"font-bold text-slate-900 text-sm sm:text-base",children:""}),r.userMode==="guardian"&&i.jsx("span",{className:"text-sky-500 text-xs sm:text-sm font-bold",children:" "})]}),i.jsx("p",{className:"text-xs sm:text-sm text-slate-500 mt-0.5 sm:mt-1 leading-tight",children:"  , AI      ."}),i.jsxs("div",{className:"flex gap-1.5 sm:gap-2 mt-1.5 sm:mt-2 flex-wrap",children:[i.jsx("span",{className:"text-[10px] sm:text-xs bg-slate-100 text-slate-600 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded",children:"AI "}),i.jsx("span",{className:"text-[10px] sm:text-xs bg-slate-100 text-slate-600 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded",children:""}),i.jsx("span",{className:"text-[10px] sm:text-xs bg-slate-100 text-slate-600 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded",children:""})]})]})]}),i.jsxs("button",{type:"button",onClick:()=>a({...r,userMode:"clinic"}),className:`w-full p-3 sm:p-5 rounded-xl border-2 transition-all flex items-center gap-3 sm:gap-4 text-left ${r.userMode==="clinic"?"border-sky-500 bg-sky-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[i.jsx("div",{className:`w-10 h-10 sm:w-14 sm:h-14 rounded-xl flex items-center justify-center flex-shrink-0 ${r.userMode==="clinic"?"bg-sky-100":"bg-slate-100"}`,children:i.jsx("img",{src:"/ai-factory/icon/login/main_hospital.png",alt:"",className:"w-7 h-7 sm:w-10 sm:h-10 object-contain"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[i.jsx("span",{className:"font-bold text-slate-900 text-sm sm:text-base",children:" (/)"}),r.userMode==="clinic"&&i.jsx("span",{className:"text-sky-500 text-xs sm:text-sm font-bold",children:" "})]}),i.jsx("p",{className:"text-xs sm:text-sm text-slate-500 mt-0.5 sm:mt-1 leading-tight",children:"       ."}),i.jsxs("div",{className:"flex gap-1.5 sm:gap-2 mt-1.5 sm:mt-2 flex-wrap",children:[i.jsx("span",{className:"text-[10px] sm:text-xs bg-slate-100 text-slate-600 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded",children:""}),i.jsx("span",{className:"text-[10px] sm:text-xs bg-slate-100 text-slate-600 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded",children:""}),i.jsx("span",{className:"text-[10px] sm:text-xs bg-slate-100 text-slate-600 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded",children:""})]})]})]})]}),o&&i.jsxs("div",{className:"bg-red-50 text-red-600 text-sm p-3 rounded-lg flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"error"}),o]}),i.jsx("button",{onClick:y,disabled:!r.userMode,className:"w-full py-3 bg-primary text-white font-bold rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:""})]}),s===2&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("img",{src:`/ai-factory/icon/login/${r.userMode==="guardian"?"main_friend":"main_hospital"}.png`,alt:r.userMode==="guardian"?"":"",className:"w-8 h-8 object-contain"}),i.jsxs("span",{className:"text-sm font-medium text-slate-500",children:[r.userMode==="guardian"?"":""," "]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:" *"}),i.jsx("input",{type:"text",required:!0,placeholder:"",value:r.name,onChange:S=>a({...r,name:S.target.value}),className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:" *"}),i.jsx("input",{type:"email",required:!0,placeholder:"example@email.com",value:r.email,onChange:S=>a({...r,email:S.target.value}),className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:" *"}),i.jsx("input",{type:"password",required:!0,placeholder:"6 ",value:r.password,onChange:S=>a({...r,password:S.target.value}),className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"  *"}),i.jsx("input",{type:"password",required:!0,placeholder:" ",value:r.passwordConfirm,onChange:S=>a({...r,passwordConfirm:S.target.value}),className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:" "}),i.jsx("input",{type:"tel",placeholder:"010-1234-5678",value:r.phone,onChange:S=>a({...r,phone:S.target.value}),className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"})]}),r.userMode==="clinic"&&i.jsxs("div",{className:"pt-4 border-t border-slate-200 space-y-4",children:[i.jsxs("p",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[i.jsx("span",{children:""}),"  "]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:" *"}),i.jsx("input",{type:"text",required:!0,placeholder:" ",value:r.clinicName,onChange:S=>a({...r,clinicName:S.target.value}),className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:" "}),i.jsx("input",{type:"text",placeholder:"   123",value:r.clinicAddress,onChange:S=>a({...r,clinicAddress:S.target.value}),className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:" "}),i.jsx("input",{type:"tel",placeholder:"02-1234-5678",value:r.clinicPhone,onChange:S=>a({...r,clinicPhone:S.target.value}),className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:""}),i.jsx("input",{type:"text",placeholder:"123-45-67890",value:r.licenseNumber,onChange:S=>a({...r,licenseNumber:S.target.value}),className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"})]})]}),r.userMode==="guardian"&&i.jsxs("div",{className:"pt-2 border-t border-slate-200",children:[i.jsx("p",{className:"text-xs text-slate-400 mb-3",children:" "}),i.jsxs("div",{className:"flex gap-3",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:""}),i.jsxs("select",{value:r.gender,onChange:S=>a({...r,gender:S.target.value}),className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary bg-white",children:[i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"male",children:""}),i.jsx("option",{value:"female",children:""})]})]}),i.jsxs("div",{className:"flex-1",children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:""}),i.jsxs("select",{value:r.birthYear,onChange:S=>a({...r,birthYear:S.target.value}),className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary bg-white",children:[i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"10",children:"10"}),i.jsx("option",{value:"20",children:"20"}),i.jsx("option",{value:"30",children:"30"}),i.jsx("option",{value:"40",children:"40"}),i.jsx("option",{value:"50",children:"50"}),i.jsx("option",{value:"60",children:"60"}),i.jsx("option",{value:"70 ",children:"70 "})]})]})]})]}),o&&i.jsxs("div",{className:"bg-red-50 text-red-600 text-sm p-3 rounded-lg flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"error"}),o]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>n(1),className:"flex-1 py-3 bg-slate-200 text-slate-700 font-bold rounded-lg hover:bg-slate-300 transition-colors",children:""}),i.jsx("button",{onClick:y,className:"flex-1 py-3 bg-primary text-white font-bold rounded-lg hover:bg-primary/90 transition-colors",children:""})]})]}),s===3&&i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"text-lg font-bold text-slate-900",children:" "}),i.jsx("div",{className:"p-4 bg-slate-50 rounded-lg",children:i.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:r.agreeTerms&&r.agreePrivacy&&r.agreeMarketing,onChange:S=>a({...r,agreeTerms:S.target.checked,agreePrivacy:S.target.checked,agreeMarketing:S.target.checked}),className:"w-5 h-5 text-primary rounded focus:ring-primary"}),i.jsx("span",{className:"font-bold text-slate-900",children:" "})]})}),i.jsxs("div",{className:"space-y-3 pl-2",children:[i.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("input",{type:"checkbox",checked:r.agreeTerms,onChange:S=>a({...r,agreeTerms:S.target.checked}),className:"w-5 h-5 text-primary rounded focus:ring-primary"}),i.jsx("span",{className:"text-slate-700",children:"[]  "})]}),i.jsx("span",{className:"material-symbols-outlined text-slate-400 text-sm",children:"chevron_right"})]}),i.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("input",{type:"checkbox",checked:r.agreePrivacy,onChange:S=>a({...r,agreePrivacy:S.target.checked}),className:"w-5 h-5 text-primary rounded focus:ring-primary"}),i.jsx("span",{className:"text-slate-700",children:"[]   "})]}),i.jsx("span",{className:"material-symbols-outlined text-slate-400 text-sm",children:"chevron_right"})]}),i.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("input",{type:"checkbox",checked:r.agreeMarketing,onChange:S=>a({...r,agreeMarketing:S.target.checked}),className:"w-5 h-5 text-primary rounded focus:ring-primary"}),i.jsx("span",{className:"text-slate-700",children:"[]    "})]}),i.jsx("span",{className:"material-symbols-outlined text-slate-400 text-sm",children:"chevron_right"})]})]}),o&&i.jsxs("div",{className:"bg-red-50 text-red-600 text-sm p-3 rounded-lg flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"error"}),o]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>n(2),className:"flex-1 py-3 bg-slate-200 text-slate-700 font-bold rounded-lg hover:bg-slate-300 transition-colors",children:""}),i.jsx("button",{onClick:_,disabled:c,className:"flex-1 py-3 bg-primary text-white font-bold rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:c?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"})," ..."]}):""})]})]}),s===4&&i.jsxs("div",{className:"text-center py-6",children:[i.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full mx-auto mb-4 flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-green-600 text-4xl",children:"check_circle"})}),i.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:" !"}),i.jsxs("p",{className:"text-slate-500 mb-2",children:[", ",r.name,"!"]}),i.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-full mb-6",children:[i.jsx("span",{className:"text-lg",children:r.userMode==="guardian"?"":""}),i.jsxs("span",{className:"text-sm font-medium text-slate-700",children:[r.userMode==="guardian"?"":""," "]})]}),i.jsx("p",{className:"text-slate-500 text-sm mb-6",children:r.userMode==="guardian"?"    .":"        ."}),i.jsx("button",{onClick:()=>t(h),className:"w-full py-3 bg-primary text-white font-bold rounded-lg hover:bg-primary/90 transition-colors",children:""})]}),s<4&&i.jsxs("div",{className:"mt-6 text-center",children:[i.jsx("p",{className:"text-slate-500 text-sm",children:"  ?"}),i.jsx("button",{onClick:e,className:"text-primary font-medium hover:underline mt-1",children:""})]})]})]})}const C6=t=>new Promise((e,s)=>{const n=new FileReader;n.onload=()=>{const r=n.result.split(",")[1];e(r)},n.onerror=s,n.readAsDataURL(t)});async function P6(t,e="auto",s="image/jpeg"){const n=rn(fs.GEMINI);if(!n)return console.warn("Gemini API  .  > API   ."),M6(e);const r=R6(e);try{const a=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{inline_data:{mime_type:s,data:t}},{text:r}]}],generationConfig:{temperature:.1,maxOutputTokens:4096}})});if(!a.ok)throw new Error(`Gemini API : ${a.status}`);const l=(await a.json()).candidates[0].content.parts[0].text,c=l.match(/\{[\s\S]*\}/);return c?{success:!0,data:JSON.parse(c[0]),rawText:l}:{success:!1,error:"JSON  ",rawText:l}}catch(a){return console.error("OCR  :",a),{success:!1,error:a.message}}}function R6(t){const e=`    OCR .
    JSON .

 :
1.      
2.   YYYY-MM-DD 
3.    ( )
4. , ,   
5.    " " 

`,s={receipt:`  :
{
  "documentType": "receipt",
  "hospital": {
    "name": "",
    "address": "",
    "phone": "",
    "businessNumber": ""
  },
  "patient": {
    "petName": "()",
    "species": "",
    "ownerName": ""
  },
  "visitDate": "YYYY-MM-DD",
  "items": [
    {
      "category": "  (/// )",
      "name": "",
      "quantity": ,
      "unitPrice": ,
      "amount": 
    }
  ],
  "summary": {
    "subtotal": ,
    "discount": ,
    "total": ,
    "paid": ,
    "paymentMethod": ""
  },
  "notes": ""
}`,prescription:` :
{
  "documentType": "prescription",
  "hospital": {
    "name": "",
    "vetName": "",
    "licenseNumber": ""
  },
  "patient": {
    "petName": "",
    "species": "",
    "breed": "",
    "weight": "(kg)",
    "age": ""
  },
  "prescriptionDate": "YYYY-MM-DD",
  "diagnosis": "",
  "medications": [
    {
      "name": "",
      "dosage": "",
      "frequency": " ",
      "duration": " ",
      "instructions": " ",
      "warnings": ""
    }
  ],
  "nextVisit": " ",
  "notes": ""
}`,diagnosis:` :
{
  "documentType": "diagnosis",
  "hospital": {
    "name": "",
    "vetName": ""
  },
  "patient": {
    "petName": "",
    "species": "",
    "breed": "",
    "birthDate": "",
    "sex": "",
    "ownerName": ""
  },
  "visitDate": "YYYY-MM-DD",
  "chiefComplaint": "",
  "symptoms": ["1", "2"],
  "diagnosis": {
    "primary": "",
    "secondary": ["1", "2"]
  },
  "testResults": [
    {
      "testName": "",
      "result": "",
      "normalRange": "",
      "interpretation": ""
    }
  ],
  "treatment": {
    "procedures": ["1", "2"],
    "medications": ["1", "2"]
  },
  "prognosis": "",
  "followUp": " "
}`,vaccination:`  :
{
  "documentType": "vaccination",
  "hospital": {
    "name": "",
    "vetName": ""
  },
  "patient": {
    "petName": "",
    "species": "",
    "breed": "",
    "birthDate": "",
    "microchipNumber": ""
  },
  "vaccinations": [
    {
      "vaccineName": "",
      "manufacturer": "",
      "lotNumber": "",
      "administrationDate": "",
      "nextDueDate": "  ",
      "vetSignature": "  "
    }
  ],
  "issuedDate": ""
}`,test_result:`  :
{
  "documentType": "test_result",
  "hospital": {
    "name": ""
  },
  "patient": {
    "petName": "",
    "species": ""
  },
  "testDate": "YYYY-MM-DD",
  "testType": "  (// )",
  "results": [
    {
      "item": " ",
      "value": "",
      "unit": "",
      "normalRange": "",
      "status": "//"
    }
  ],
  "interpretation": " ",
  "recommendations": ""
}`,auto:`       .
    ,     JSON .
documentType     : receipt, prescription, diagnosis, vaccination, test_result

{
  "documentType": "  ",
  ...      ...
}`};return e+(s[t]||s.auto)+`

JSON .    .`}function M6(t){const e={receipt:{documentType:"receipt",hospital:{name:" ",address:"   123",phone:"02-1234-5678",businessNumber:"123-45-67890"},patient:{petName:"",species:"",ownerName:""},visitDate:new Date().toISOString().split("T")[0],items:[{category:"",name:" ",quantity:1,unitPrice:15e3,amount:15e3},{category:"",name:"",quantity:1,unitPrice:35e3,amount:35e3},{category:"",name:"",quantity:7,unitPrice:2e3,amount:14e3}],summary:{subtotal:64e3,discount:0,total:64e3,paid:64e3,paymentMethod:""},notes:""},prescription:{documentType:"prescription",hospital:{name:" ",vetName:"",licenseNumber:"12345"},patient:{petName:"",species:"",breed:"",weight:"5.2",age:"3"},prescriptionDate:new Date().toISOString().split("T")[0],diagnosis:" ",medications:[{name:"",dosage:"250mg",frequency:"1 2",duration:"7",instructions:" ",warnings:""}],nextVisit:"",notes:""}};return{success:!0,data:e[t]||e.receipt,isDummy:!0}}function O6(t,e){var n,r,a,o,l,c,u;const s={id:`record_${Date.now()}`,petId:e,source:"ocr",createdAt:new Date().toISOString(),originalDocument:t.documentType};switch(t.documentType){case"receipt":return{...s,type:"visit",date:t.visitDate,hospital:(n=t.hospital)==null?void 0:n.name,items:t.items,totalCost:(r=t.summary)==null?void 0:r.total,notes:t.notes};case"prescription":return{...s,type:"prescription",date:t.prescriptionDate,hospital:(a=t.hospital)==null?void 0:a.name,veterinarian:(o=t.hospital)==null?void 0:o.vetName,diagnosis:t.diagnosis,medications:t.medications,nextVisit:t.nextVisit};case"diagnosis":return{...s,type:"diagnosis",date:t.visitDate,hospital:(l=t.hospital)==null?void 0:l.name,symptoms:t.symptoms,diagnosis:t.diagnosis,treatment:t.treatment,testResults:t.testResults,prognosis:t.prognosis};case"vaccination":return{...s,type:"vaccination",date:t.issuedDate,hospital:(c=t.hospital)==null?void 0:c.name,vaccinations:t.vaccinations};case"test_result":return{...s,type:"test",date:t.testDate,hospital:(u=t.hospital)==null?void 0:u.name,testType:t.testType,results:t.results,interpretation:t.interpretation};default:return{...s,type:"other",rawData:t}}}function L6(t){const e="petMedical_records";try{const s=JSON.parse(localStorage.getItem(e)||"[]");return s.unshift(t),localStorage.setItem(e,JSON.stringify(s)),!0}catch(s){return console.error("   :",s),!1}}function V6({petData:t,onBack:e,onSaveRecord:s}){const[n,r]=O.useState(null),[a,o]=O.useState(null),[l,c]=O.useState("auto"),[u,h]=O.useState(!1),[m,f]=O.useState(null),[y,_]=O.useState(null),[S,R]=O.useState(!1),[k,x]=O.useState(null),A=O.useRef(null),M=E=>{var P;const C=(P=E.target.files)==null?void 0:P[0];if(C){if(!C.type.startsWith("image/")){_("   .");return}if(C.size>10*1024*1024){_("  10MB  .");return}r(C),o(URL.createObjectURL(C)),f(null),_(null),R(!1)}},D=async()=>{if(n){h(!0),_(null);try{const E=await C6(n),C=n.type,P=await P6(E,l,C);P.success?(f(P),x(P.data)):_(P.error||"OCR  .")}catch(E){_("   : "+E.message)}finally{h(!1)}}},B=()=>{if(!k||!t)return;const E=O6(k,t.id);L6(E)?(s&&s(E),alert("  ."),r(null),o(null),f(null),x(null),R(!1)):_(" .")},v=E=>{E.preventDefault(),E.stopPropagation()},N=E=>{var P;E.preventDefault(),E.stopPropagation();const C=(P=E.dataTransfer.files)==null?void 0:P[0];C&&M({target:{files:[C]}})},w=(E,C)=>{x(P=>{const j=JSON.parse(JSON.stringify(P)),re=E.split(".");let Z=j;for(let le=0;le<re.length-1;le++)Z=Z[re[le]];return Z[re[re.length-1]]=C,j})};return i.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-sky-50 to-white pb-24",children:[i.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:i.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[i.jsx("button",{onClick:e,className:"p-2 -ml-2 text-slate-600 hover:bg-slate-100 rounded-full transition",children:i.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),i.jsx("h1",{className:"text-lg font-bold text-slate-800",children:" "}),i.jsx("div",{className:"w-10"})]})}),i.jsxs("div",{className:"p-4 space-y-4",children:[t&&i.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-sky-100 flex items-center justify-center text-2xl",children:t.species==="dog"?"":t.species==="cat"?"":""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-semibold text-slate-800",children:t.petName||t.name}),i.jsx("div",{className:"text-sm text-slate-500",children:t.breed||" "})]})]}),i.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:" "}),i.jsxs("select",{value:l,onChange:E=>c(E.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-sky-400 bg-white",children:[i.jsx("option",{value:"auto",children:" "}),i.jsx("option",{value:"receipt",children:" "}),i.jsx("option",{value:"prescription",children:""}),i.jsx("option",{value:"diagnosis",children:""}),i.jsx("option",{value:"vaccination",children:" "}),i.jsx("option",{value:"test_result",children:" "})]})]}),i.jsxs("div",{className:`bg-white rounded-xl p-6 shadow-sm border-2 border-dashed transition-colors ${n?"border-sky-400 bg-sky-50/50":"border-slate-200 hover:border-sky-300"}`,onDragOver:v,onDrop:N,onClick:()=>{var E;return(E=A.current)==null?void 0:E.click()},children:[i.jsx("input",{ref:A,type:"file",accept:"image/*",onChange:M,className:"hidden"}),a?i.jsxs("div",{className:"space-y-4",children:[i.jsx("img",{src:a,alt:"",className:"max-h-64 mx-auto rounded-lg shadow-md"}),i.jsx("p",{className:"text-center text-sm text-slate-500",children:n==null?void 0:n.name}),i.jsx("button",{onClick:E=>{E.stopPropagation(),r(null),o(null),f(null)},className:"mx-auto block text-sm text-red-500 hover:text-red-600",children:" "})]}):i.jsxs("div",{className:"text-center py-8",children:[i.jsx("span",{className:"material-symbols-outlined text-5xl text-sky-400 mb-3 block",children:"document_scanner"}),i.jsx("p",{className:"text-slate-600 font-medium",children:"  "}),i.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"   "}),i.jsx("p",{className:"text-xs text-slate-400 mt-2",children:" : JPG, PNG, HEIC ( 10MB)"})]})]}),y&&i.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3",children:[i.jsx("span",{className:"material-symbols-outlined text-red-500",children:"error"}),i.jsx("p",{className:"text-sm text-red-700",children:y})]}),n&&!m&&i.jsx("button",{onClick:D,disabled:u,className:"w-full py-4 bg-gradient-to-r from-sky-500 to-sky-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:u?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"AI   ..."]}):i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"material-symbols-outlined",children:"auto_awesome"}),"AI  "]})}),m&&k&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("h2",{className:"font-bold text-slate-800 flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-sky-500",children:"check_circle"})," "]}),i.jsx("button",{onClick:()=>R(!S),className:`px-3 py-1 rounded-lg text-sm font-medium transition ${S?"bg-sky-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:S?" ":""})]}),i.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"description"}),$6(k.documentType),m.isDummy&&i.jsx("span",{className:"ml-2 px-2 py-0.5 bg-amber-100 text-amber-700 rounded-full text-xs",children:" "})]})]}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:i.jsx(F6,{data:k,editMode:S,onEdit:w})}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>{f(null),x(null)},className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition",children:" "}),i.jsxs("button",{onClick:B,className:"flex-1 py-3 bg-gradient-to-r from-sky-500 to-sky-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition flex items-center justify-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined",children:"save"})," "]})]})]}),i.jsxs("div",{className:"bg-sky-50 rounded-xl p-4 mt-4",children:[i.jsxs("h3",{className:"font-medium text-sky-800 flex items-center gap-2 mb-2",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"info"})," "]}),i.jsxs("ul",{className:"text-sm text-sky-700 space-y-1",children:[i.jsx("li",{children:"  , ,   "}),i.jsx("li",{children:"      "}),i.jsx("li",{children:" AI    "}),i.jsx("li",{children:"     "})]})]})]})]})}function $6(t){return{receipt:" ",prescription:"",diagnosis:"",vaccination:" ",test_result:" "}[t]||" "}function F6({data:t,editMode:e,onEdit:s}){var n;return t?i.jsxs("div",{className:"divide-y divide-slate-100",children:[t.hospital&&i.jsxs(zn,{title:" ",icon:"local_hospital",children:[i.jsx(bs,{label:"",value:t.hospital.name,editMode:e,onEdit:r=>s("hospital.name",r)}),t.hospital.address&&i.jsx(bs,{label:"",value:t.hospital.address,editMode:e,onEdit:r=>s("hospital.address",r)}),t.hospital.phone&&i.jsx(bs,{label:"",value:t.hospital.phone,editMode:e,onEdit:r=>s("hospital.phone",r)}),t.hospital.vetName&&i.jsx(bs,{label:"",value:t.hospital.vetName,editMode:e,onEdit:r=>s("hospital.vetName",r)})]}),t.patient&&i.jsxs(zn,{title:" ",icon:"pets",children:[i.jsx(bs,{label:"",value:t.patient.petName,editMode:e,onEdit:r=>s("patient.petName",r)}),t.patient.species&&i.jsx(bs,{label:"",value:t.patient.species,editMode:e,onEdit:r=>s("patient.species",r)}),t.patient.breed&&i.jsx(bs,{label:"",value:t.patient.breed,editMode:e,onEdit:r=>s("patient.breed",r)}),t.patient.ownerName&&i.jsx(bs,{label:"",value:t.patient.ownerName,editMode:e,onEdit:r=>s("patient.ownerName",r)})]}),t.items&&t.items.length>0&&i.jsxs(zn,{title:" ",icon:"receipt_long",children:[i.jsx("div",{className:"space-y-2",children:t.items.map((r,a)=>{var o;return i.jsxs("div",{className:"flex justify-between items-center py-2 px-1 bg-slate-50 rounded-lg",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-xs text-slate-500",children:r.category}),i.jsx("p",{className:"text-sm font-medium text-slate-700",children:r.name})]}),i.jsxs("div",{className:"text-right",children:[i.jsxs("p",{className:"text-sm font-semibold text-slate-800",children:[(o=r.amount)==null?void 0:o.toLocaleString(),""]}),r.quantity>1&&i.jsxs("span",{className:"text-xs text-slate-500",children:[r.quantity,""]})]})]},a)})}),t.summary&&i.jsx("div",{className:"mt-3 pt-3 border-t border-slate-200",children:i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-slate-500",children:" "}),i.jsxs("span",{className:"font-bold text-sky-600",children:[(n=t.summary.total)==null?void 0:n.toLocaleString(),""]})]})})]}),t.medications&&t.medications.length>0&&i.jsx(zn,{title:" ",icon:"medication",children:i.jsx("div",{className:"space-y-3",children:t.medications.map((r,a)=>i.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[i.jsx("p",{className:"font-medium text-slate-800",children:r.name}),i.jsxs("div",{className:"mt-1 text-sm text-slate-600 space-y-0.5",children:[i.jsxs("p",{children:[": ",r.dosage]}),i.jsxs("p",{children:[": ",r.frequency,", ",r.duration]}),r.instructions&&i.jsxs("p",{children:[": ",r.instructions]}),r.warnings&&i.jsxs("p",{className:"text-amber-600",children:[" ",r.warnings]})]})]},a))})}),t.diagnosis&&i.jsx(zn,{title:"",icon:"medical_information",children:typeof t.diagnosis=="string"?i.jsx(bs,{label:"",value:t.diagnosis,editMode:e,onEdit:r=>s("diagnosis",r)}):i.jsxs(i.Fragment,{children:[i.jsx(bs,{label:"",value:t.diagnosis.primary,editMode:e,onEdit:r=>s("diagnosis.primary",r)}),t.diagnosis.secondary&&t.diagnosis.secondary.length>0&&i.jsxs("div",{className:"mt-2",children:[i.jsx("span",{className:"text-xs text-slate-500",children:""}),i.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.diagnosis.secondary.map((r,a)=>i.jsx("span",{className:"px-2 py-0.5 bg-slate-100 text-slate-600 text-sm rounded",children:r},a))})]})]})}),t.results&&t.results.length>0&&i.jsx(zn,{title:" ",icon:"biotech",children:i.jsx("div",{className:"space-y-2",children:t.results.map((r,a)=>i.jsxs("div",{className:"flex justify-between items-center py-2 px-1",children:[i.jsx("span",{className:"text-sm text-slate-600",children:r.item}),i.jsxs("div",{className:"text-right",children:[i.jsxs("span",{className:`text-sm font-medium ${r.status===""?"text-red-600":r.status===""?"text-blue-600":"text-green-600"}`,children:[r.value," ",r.unit]}),r.normalRange&&i.jsxs("p",{className:"text-xs text-slate-400",children:[": ",r.normalRange]})]})]},a))})}),t.vaccinations&&t.vaccinations.length>0&&i.jsx(zn,{title:" ",icon:"vaccines",children:i.jsx("div",{className:"space-y-3",children:t.vaccinations.map((r,a)=>i.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[i.jsx("p",{className:"font-medium text-slate-800",children:r.vaccineName}),i.jsxs("div",{className:"mt-1 text-sm text-slate-600 space-y-0.5",children:[i.jsxs("p",{children:[": ",r.administrationDate]}),r.nextDueDate&&i.jsxs("p",{children:[" : ",r.nextDueDate]}),r.manufacturer&&i.jsxs("p",{children:[": ",r.manufacturer]})]})]},a))})}),(t.visitDate||t.prescriptionDate||t.testDate||t.issuedDate)&&i.jsx(zn,{title:"",icon:"event",children:i.jsx(bs,{label:"",value:t.visitDate||t.prescriptionDate||t.testDate||t.issuedDate,editMode:e,onEdit:r=>s(t.visitDate?"visitDate":t.prescriptionDate?"prescriptionDate":t.testDate?"testDate":"issuedDate",r)})}),(t.notes||t.interpretation||t.prognosis)&&i.jsxs(zn,{title:"",icon:"notes",children:[t.notes&&i.jsx(bs,{label:"",value:t.notes,editMode:e,onEdit:r=>s("notes",r)}),t.interpretation&&i.jsx(bs,{label:"",value:t.interpretation,editMode:e,onEdit:r=>s("interpretation",r)}),t.prognosis&&i.jsx(bs,{label:"",value:t.prognosis,editMode:e,onEdit:r=>s("prognosis",r)})]})]}):null}function zn({title:t,icon:e,children:s}){return i.jsxs("div",{className:"p-4",children:[i.jsxs("h3",{className:"font-semibold text-slate-700 flex items-center gap-2 mb-3",children:[i.jsx("span",{className:"material-symbols-outlined text-sky-500 text-lg",children:e}),t]}),s]})}function bs({label:t,value:e,editMode:s,onEdit:n}){return e?i.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[i.jsx("span",{className:"text-sm text-slate-500",children:t}),s?i.jsx("input",{type:"text",value:e,onChange:r=>n(r.target.value),className:"text-sm text-right bg-white border border-slate-200 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-sky-400 max-w-[60%]"}):i.jsx("span",{className:"text-sm font-medium text-slate-800",children:e})]}):null}const Cj={dog:"",cat:"",rabbit:"",hamster:"",bird:"",hedgehog:"",reptile:"",etc:"",other:""},Gg=t=>t?typeof t=="string"&&t.includes("")?t:typeof t=="number"?`${t}`:t:" ",Qg=t=>{if(!t)return null;const e=t==="M"||t==="male"||t===""||t==="",s=t==="F"||t==="female"||t===""||t==="";return e?i.jsx("span",{className:"text-blue-600 font-semibold",children:""}):s?i.jsx("span",{className:"text-red-600 font-semibold",children:""}):t},Mv="petMedical_bookings",cu="petMedical_clinicResults",D6="petMedical_medicationFeedback";function U6({onBack:t,onLogout:e,onModeSwitch:s,onHome:n}){const[r,a]=O.useState("today"),[o,l]=O.useState([]),[c,u]=O.useState(null),[h,m]=O.useState(!1),[f,y]=O.useState(null),[_,S]=O.useState({name:" ",doctorName:""});O.useEffect(()=>{R()},[]);const R=()=>{try{const v=localStorage.getItem(Mv),N=v?JSON.parse(v):[];l(N)}catch(v){console.error("  :",v)}},k=(v,N)=>{try{const w=o.map(E=>E.id===v?{...E,status:N,updatedAt:new Date().toISOString()}:E);localStorage.setItem(Mv,JSON.stringify(w)),l(w)}catch(w){console.error("  :",w)}},x=(v,N)=>{try{const w=JSON.parse(localStorage.getItem(cu)||"[]");w.push({id:`result_${Date.now()}`,bookingId:v,...N,createdAt:new Date().toISOString(),clinic:_}),localStorage.setItem(cu,JSON.stringify(w)),k(v,"completed"),m(!1),u(null)}catch(w){console.error("  :",w)}},A=new Date().toISOString().split("T")[0],M=o.filter(v=>v.date===A),D=o.filter(v=>v.status==="pending"),B=o.filter(v=>v.status==="confirmed");return i.jsxs("div",{className:"min-h-screen bg-slate-50",children:[i.jsxs("div",{className:"bg-white border-b border-slate-200",children:[i.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[i.jsx("button",{onClick:t,className:"text-slate-600",children:i.jsx("span",{className:"text-sm",children:" "})}),i.jsxs("div",{className:"flex items-center gap-2",children:[s&&i.jsx("button",{onClick:s,className:"p-2 text-sky-500 hover:bg-sky-50 rounded-full transition",title:"  ",children:i.jsx("span",{className:"material-symbols-outlined text-xl",children:"swap_horiz"})}),i.jsx("button",{onClick:e,className:"p-2 text-slate-500 hover:bg-slate-100 rounded-full transition",title:"",children:i.jsx("span",{className:"material-symbols-outlined text-xl",children:"logout"})})]})]}),i.jsxs("div",{className:"px-4 pb-4",children:[i.jsxs("h1",{className:"text-xl font-bold text-slate-900",children:[" ",_.name]}),i.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"  "})]}),i.jsxs("div",{className:"px-4 pb-4 grid grid-cols-3 gap-3",children:[i.jsxs("div",{className:"bg-sky-50 rounded-xl p-3 text-center",children:[i.jsx("p",{className:"text-2xl font-bold text-sky-600",children:M.length}),i.jsx("p",{className:"text-xs text-slate-500",children:" "})]}),i.jsxs("div",{className:"bg-amber-50 rounded-xl p-3 text-center",children:[i.jsx("p",{className:"text-2xl font-bold text-amber-600",children:D.length}),i.jsx("p",{className:"text-xs text-slate-500",children:" "})]}),i.jsxs("div",{className:"bg-green-50 rounded-xl p-3 text-center",children:[i.jsx("p",{className:"text-2xl font-bold text-green-600",children:B.length}),i.jsx("p",{className:"text-xs text-slate-500",children:""})]})]})]}),i.jsx("div",{className:"bg-white border-b border-slate-200 sticky top-0 z-10 overflow-x-auto scrollbar-hide",children:i.jsx("div",{className:"flex min-w-max",children:[{id:"today",label:" ",icon:"calendar_today"},{id:"schedule",label:" ",icon:"schedule"},{id:"monthly",label:"",icon:"calendar_month"},{id:"records",label:" ",icon:"folder_shared"},{id:"settings",label:"",icon:"settings"}].map(v=>i.jsxs("button",{onClick:()=>a(v.id),className:`flex-1 min-w-[70px] py-3 text-center text-xs font-medium transition border-b-2 ${r===v.id?"border-sky-500 text-sky-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:[i.jsx("span",{className:"material-symbols-outlined text-lg block mb-0.5",children:v.icon}),v.label]},v.id))})}),i.jsxs("div",{className:"p-4 pb-24",children:[r==="today"&&i.jsx(B6,{bookings:M,allBookings:o,onSelectBooking:v=>{u(v)},onUpdateStatus:k,onCompleteVisit:v=>{u(v),m(!0)}}),r==="schedule"&&i.jsx(H6,{bookings:o}),r==="monthly"&&i.jsx(q6,{bookings:o,selectedDay:f,onSelectDay:y,onSelectBooking:v=>{u(v)},onUpdateStatus:k}),r==="records"&&i.jsx(W6,{bookings:o}),r==="settings"&&i.jsx(G6,{clinicInfo:_,onUpdate:S})]}),c&&!h&&i.jsx(Q6,{booking:c,onClose:()=>u(null),onUpdateStatus:k,onStartVisit:()=>m(!0)}),h&&c&&i.jsx(J6,{booking:c,onClose:()=>{m(!1),u(null)},onSave:v=>x(c.id,v)})]})}function B6({bookings:t,allBookings:e,onSelectBooking:s,onUpdateStatus:n,onCompleteVisit:r}){new Date().toISOString().split("T")[0];const a=[...t].sort((o,l)=>!o.time||!l.time?0:o.time.localeCompare(l.time));return a.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("span",{className:"material-symbols-outlined text-5xl text-slate-300 mb-3 block",children:"event_available"}),i.jsx("p",{className:"text-slate-500",children:"   "}),i.jsx("p",{className:"text-sm text-slate-400 mt-1",children:e.length>0?` ${e.length}  `:"  "})]}):i.jsxs("div",{className:"space-y-3",children:[i.jsxs("h2",{className:"font-bold text-slate-800 flex items-center gap-2",children:["   (",a.length,")"]}),a.map(o=>i.jsx(z6,{booking:o,onSelectBooking:s,onConfirm:()=>n(o.id,"confirmed"),onComplete:()=>r(o)},o.id))]})}function z6({booking:t,onSelectBooking:e,onConfirm:s,onComplete:n}){const r=du(t.status),a=t.petProfile||{};return i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsx("div",{className:"text-lg font-bold text-slate-900",children:t.time||" "}),i.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${r.color}`,children:r.label})]}),i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-sky-400 to-violet-400 overflow-hidden",children:i.jsx("img",{src:Is(a||{species:a.species||"dog"},!1),alt:t.petName||"",className:"w-full h-full object-cover",style:{objectPosition:"center",display:"block"}})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("h3",{className:"text-sm font-semibold text-slate-900 whitespace-nowrap overflow-hidden text-ellipsis",children:[t.petName," ",a.breed&&`(${Cj[a.species]||a.speciesLabelKo||a.species||""}, ${Gg(a.age)})`,a.sex&&i.jsx("span",{className:"ml-1",children:Qg(a.sex)})]}),i.jsxs("p",{className:"text-sm text-slate-500",children:[": ",t.ownerDisplayName||t.ownerName||" ","  ",t.ownerPhone||" "]})]})]}),t.message&&i.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 mb-3",children:[i.jsx("div",{className:"text-xs text-slate-500 mb-1",children:""}),i.jsx("div",{className:"text-sm text-slate-900",children:t.message})]}),i.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[i.jsxs("button",{onClick:()=>e(t),className:`p-2 rounded-lg text-xs font-semibold transition flex flex-col items-center gap-1 ${t.diagnosisId||t.aiDiagnosis?"bg-purple-50 border border-purple-200 text-purple-700 hover:bg-purple-100":"bg-white border border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"smart_toy"})," "]}),i.jsxs("button",{onClick:()=>e(t),className:"p-2 bg-white border border-slate-200 rounded-lg text-xs font-semibold text-slate-600 hover:bg-slate-50 transition flex flex-col items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"description"}),""]}),i.jsxs("button",{onClick:()=>alert("   "),className:"p-2 bg-white border border-slate-200 rounded-lg text-xs font-semibold text-slate-600 hover:bg-slate-50 transition flex flex-col items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"history"})," "]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.status==="pending"?i.jsxs("button",{onClick:o=>{o.stopPropagation(),s()},className:"py-2.5 bg-sky-500 text-white text-sm font-bold rounded-lg hover:bg-sky-600 transition flex items-center justify-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"check_circle"})," "]}):i.jsxs("button",{className:"py-2.5 bg-slate-100 text-slate-500 text-sm font-semibold rounded-lg cursor-default flex items-center justify-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"check_circle"})," "]}),i.jsxs("button",{onClick:o=>{o.stopPropagation(),n()},className:"py-2.5 bg-sky-500 text-white text-sm font-bold rounded-lg hover:bg-sky-600 transition flex items-center justify-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"play_arrow"})," "]})]})]})}function H6({bookings:t}){const e=new Date,s=new Date(e);s.setDate(e.getDate()-e.getDay());const n=Array.from({length:7},(l,c)=>{const u=new Date(s);return u.setDate(s.getDate()+c),u}),r={};t.forEach(l=>{r[l.date]||(r[l.date]=[]),r[l.date].push(l)});const a=["","","","","","",""],o=e.toISOString().split("T")[0];return i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"section-title",children:"   "}),i.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("button",{className:"bg-slate-100 p-2 rounded-lg hover:bg-slate-200 transition",children:i.jsx("span",{className:"material-symbols-outlined text-slate-600",children:"chevron_left"})}),i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"font-bold text-slate-900",children:[n[0].getMonth()+1," ",n[0].getDate()," - ",n[6].getMonth()+1," ",n[6].getDate(),""]}),i.jsx("div",{className:"text-xs text-slate-500 mt-1",children:" "})]}),i.jsx("button",{className:"bg-slate-100 p-2 rounded-lg hover:bg-slate-200 transition",children:i.jsx("span",{className:"material-symbols-outlined text-slate-600",children:"chevron_right"})})]})}),n.slice(0,2).map((l,c)=>{const u=l.toISOString().split("T")[0],h=(r[u]||[]).filter(f=>f.status!=="cancelled").sort((f,y)=>(f.time||"").localeCompare(y.time||"")),m=u===o;return i.jsxs("div",{className:"mb-6",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsxs("div",{className:`flex flex-col items-center rounded-xl p-2 min-w-[3.5rem] shadow-md ${m?"bg-gradient-to-br from-sky-500 to-sky-600 text-white":"bg-white border-2 border-slate-200 text-slate-900"}`,children:[i.jsx("div",{className:`text-xs font-semibold ${m?"opacity-90":"text-slate-500"}`,children:a[l.getDay()]}),i.jsx("div",{className:"text-2xl font-bold",children:l.getDate()})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-bold text-slate-900",children:[l.getMonth()+1," ",l.getDate()," (",a[l.getDay()],")"]}),i.jsxs("div",{className:"text-sm text-slate-500",children:[m?"":"","  ",h.length,""]})]})]}),i.jsxs("div",{className:"relative pl-[4.25rem]",children:[i.jsx("div",{className:"absolute left-7 top-0 bottom-0 w-0.5 bg-gradient-to-b from-sky-200 to-sky-300"}),i.jsxs("div",{className:"space-y-3",children:[h.map((f,y)=>{var k,x;const _=f.status==="confirmed"?"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200":"bg-gradient-to-br from-amber-50 to-yellow-50 border-amber-200",S=f.status==="confirmed"?"":"",R=f.status==="confirmed"?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700";return i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:`absolute left-[-2.5rem] top-2 w-3 h-3 rounded-full border-2 border-white shadow-md ${f.status==="confirmed"?"bg-sky-500":"bg-amber-500"}`}),i.jsxs("div",{className:`${_} border rounded-xl p-3.5 transition-all hover:shadow-md hover:translate-x-1`,children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("span",{className:"font-bold text-slate-900 text-lg",children:f.time}),i.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${R}`,children:S})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-10 h-10 bg-white rounded-full overflow-hidden shadow-sm",children:i.jsx("img",{src:Is(f.petProfile||{species:((k=f.petProfile)==null?void 0:k.species)||"dog"},!1),alt:f.petName||"",className:"w-full h-full object-cover",style:{objectPosition:"center",display:"block"}})}),i.jsxs("div",{className:"text-sm",children:[i.jsx("span",{className:"font-semibold text-slate-900",children:f.petName}),i.jsxs("span",{className:"text-slate-500",children:["  ",((x=f.petProfile)==null?void 0:x.breed)||" "]})]})]})]})]},f.id)}),h.length===0&&i.jsxs("div",{className:"text-center py-8 text-slate-400",children:[i.jsx("span",{className:"material-symbols-outlined text-3xl mb-2 block",children:"event_busy"})," "]})]})]})]},u)}),i.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:i.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"info"}),i.jsx("span",{children:" : 5  "})]})})]})}function q6({bookings:t,selectedDay:e,onSelectDay:s,onSelectBooking:n,onUpdateStatus:r}){const a=new Date,o=a.getMonth(),l=a.getFullYear(),c=a.getDate(),u=new Date(l,o,1).getDay(),h=new Date(l,o+1,0).getDate(),m={};t.forEach(_=>{const S=new Date(_.date);if(S.getMonth()===o&&S.getFullYear()===l){const R=S.getDate();m[R]=(m[R]||0)+1}});const f=e?`${l}-${String(o+1).padStart(2,"0")}-${String(e).padStart(2,"0")}`:null,y=f?t.filter(_=>_.date===f):[];return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"bg-gradient-to-br from-sky-50 to-blue-50 rounded-2xl p-6 shadow-md",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("button",{className:"bg-white p-2 rounded-lg hover:bg-sky-50 transition shadow-sm",children:i.jsx("span",{className:"material-symbols-outlined text-sky-600",children:"chevron_left"})}),i.jsxs("h2",{className:"text-xl font-bold text-sky-900",children:[l," ",o+1,""]}),i.jsx("button",{className:"bg-white p-2 rounded-lg hover:bg-sky-50 transition shadow-sm",children:i.jsx("span",{className:"material-symbols-outlined text-sky-600",children:"chevron_right"})})]}),i.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["","","","","","",""].map((_,S)=>i.jsx("div",{className:`text-center text-sm font-bold py-2 ${S===0?"text-red-600":S===6?"text-blue-600":"text-sky-900"}`,children:_},_))}),i.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:u},(_,S)=>i.jsx("div",{className:"aspect-square"},`empty-${S}`)),Array.from({length:h},(_,S)=>{const R=S+1,k=R===c,x=R===e,A=m[R]||0,M=(u+S)%7,D=M===0,B=M===6;let v;return x?v="bg-gradient-to-br from-sky-500 to-sky-600 text-white shadow-md":k?v="bg-white border-2 border-sky-500 text-sky-600 shadow-sm":A>0?v="bg-white/90 border border-slate-200 text-slate-900 shadow-sm":v="bg-white/30 text-slate-400",i.jsxs("button",{onClick:()=>A>0&&s(R),className:`aspect-square rounded-xl flex flex-col items-center justify-center relative transition-all ${v} ${A>0?"hover:scale-105 cursor-pointer":"cursor-default"}`,children:[i.jsx("span",{className:`text-sm font-bold ${x||k||A>0?"":D?"text-red-400":B?"text-blue-400":""}`,children:R}),A>0&&i.jsx("span",{className:`absolute bottom-1 px-1.5 py-0.5 rounded-full text-xs font-bold ${x?"bg-white text-sky-600":"bg-gradient-to-r from-amber-500 to-orange-500 text-white"} shadow-sm`,children:A})]},R)})]})]}),e&&y.length>0&&i.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-md border-2 border-sky-500",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"font-bold text-slate-900 flex items-center gap-2",children:[i.jsxs("span",{className:"bg-gradient-to-r from-sky-500 to-sky-600 text-white px-3 py-1 rounded-lg shadow-sm",children:[e,""]}),i.jsx("span",{className:"text-slate-600 text-sm",children:" "})]}),i.jsx("button",{onClick:()=>s(null),className:"p-2 bg-slate-100 rounded-lg hover:bg-slate-200 transition",children:i.jsx("span",{className:"material-symbols-outlined text-slate-600",children:"close"})})]}),i.jsx("div",{className:"space-y-3",children:y.map(_=>{var R,k;const S=du(_.status);return i.jsxs("div",{className:`rounded-xl p-3 border transition-all cursor-pointer hover:shadow-md hover:translate-x-1 ${_.status==="confirmed"?"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200":"bg-gradient-to-br from-amber-50 to-yellow-50 border-amber-200"}`,onClick:()=>n(_),children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("span",{className:"font-bold text-slate-900",children:_.time}),i.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${S.color}`,children:S.label})]}),i.jsxs("div",{className:"flex items-center gap-2.5 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-white rounded-full overflow-hidden shadow-sm",children:i.jsx("img",{src:Is(_.petProfile||{species:((R=_.petProfile)==null?void 0:R.species)||"dog"},!1),alt:_.petName||"",className:"w-full h-full object-cover",style:{objectPosition:"center",display:"block"}})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"font-semibold text-slate-900 text-sm",children:[_.petName," ",i.jsxs("span",{className:"font-normal text-slate-500",children:[" ",((k=_.petProfile)==null?void 0:k.breed)||" "]})]}),i.jsxs("div",{className:"text-xs text-slate-500",children:[": ",_.ownerDisplayName||_.ownerName||" "]})]})]}),_.message&&i.jsxs("div",{className:"bg-white rounded-lg p-2 text-xs text-slate-600",children:[i.jsx("span",{className:"font-semibold",children:":"})," ",_.message]})]},_.id)})})]}),e&&y.length===0&&i.jsxs("div",{className:"bg-white rounded-xl p-8 text-center shadow-sm",children:[i.jsx("span",{className:"material-symbols-outlined text-5xl text-slate-300 mb-2 block",children:"event_busy"}),i.jsxs("p",{className:"text-slate-500",children:[e,"  "]}),i.jsx("button",{onClick:()=>s(null),className:"mt-4 bg-slate-100 px-4 py-2 rounded-lg text-slate-600 text-sm font-medium hover:bg-slate-200 transition",children:""})]}),!e&&i.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:i.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"info"}),i.jsx("span",{children:"      "})]})})]})}function W6({bookings:t}){const e=t.reduce((s,n)=>{var r;return n.petId&&!s.find(a=>a.petId===n.petId)&&s.push({petId:n.petId,petName:n.petName,petProfile:n.petProfile,visitCount:t.filter(a=>a.petId===n.petId).length,lastVisit:(r=t.filter(a=>a.petId===n.petId).sort((a,o)=>new Date(o.date)-new Date(a.date))[0])==null?void 0:r.date}),s},[]);return e.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"text-5xl mb-3",children:""}),i.jsx("p",{className:"text-slate-500",children:"  "})]}):i.jsxs("div",{className:"space-y-3",children:[i.jsx("h2",{className:"font-bold text-slate-800",children:"   "}),e.map(s=>i.jsx(K6,{pet:s},s.petId))]})}function K6({pet:t}){var a,o,l,c,u,h;const e=((a=t.petProfile)==null?void 0:a.species)==="cat"?"":"",n=JSON.parse(localStorage.getItem(cu)||"[]").filter(m=>m.petId===t.petId),r=[];return i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-sky-400 to-violet-400 flex items-center justify-center text-2xl",children:e}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("h3",{className:"text-sm font-bold text-slate-900 whitespace-nowrap overflow-hidden text-ellipsis",children:[t.petName," (",Cj[(o=t.petProfile)==null?void 0:o.species]||((l=t.petProfile)==null?void 0:l.speciesLabelKo)||((c=t.petProfile)==null?void 0:c.species)||"",", ",Gg((u=t.petProfile)==null?void 0:u.age),")",((h=t.petProfile)==null?void 0:h.sex)&&i.jsx("span",{className:"ml-1",children:Qg(t.petProfile.sex)})]}),i.jsxs("p",{className:"text-sm text-slate-500",children:[" ",t.visitCount,"   ",t.lastVisit||" "]})]})]}),i.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 border border-green-200 mb-3",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-8 h-8 bg-white rounded-lg flex items-center justify-center",children:""}),i.jsx("span",{className:"font-bold text-green-800 text-sm",children:" "})]}),i.jsxs("span",{className:"bg-green-500 text-white px-2.5 py-1 rounded-full text-xs font-bold",children:[n.length,""]})]}),n.length>0?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"text-sm text-green-700 mb-3 space-y-1",children:n.slice(0,2).map((m,f)=>i.jsxs("div",{children:[" ",new Date(m.createdAt).toLocaleDateString("ko-KR")," ",m.diagnosis]},f))}),i.jsxs("button",{className:"w-full bg-white border-2 border-green-500 text-green-700 py-2.5 rounded-xl font-bold text-sm hover:bg-green-50 transition flex items-center justify-center gap-2 shadow-sm",children:[i.jsx("span",{className:"material-symbols-outlined",children:"send"})," "]})]}):i.jsx("div",{className:"text-sm text-green-600 text-center py-2",children:"  "})]}),i.jsxs("div",{className:`rounded-xl p-4 border mb-3 ${r.length>0?"bg-gradient-to-br from-amber-50 to-yellow-50 border-amber-200":"bg-gradient-to-br from-slate-50 to-slate-100 border-slate-200 border-dashed"}`,children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:`w-8 h-8 bg-white rounded-lg flex items-center justify-center ${r.length===0&&"opacity-50"}`,children:""}),i.jsx("span",{className:`font-bold text-sm ${r.length>0?"text-amber-800":"text-slate-500"}`,children:" "})]}),r.length>0&&i.jsxs("span",{className:"bg-amber-500 text-white px-2.5 py-1 rounded-full text-xs font-bold",children:[r.length,""]})]}),i.jsx("div",{className:`text-sm text-center py-2 ${r.length>0?"text-amber-700":"text-slate-400"}`,children:"  "})]}),i.jsxs("button",{className:"w-full bg-gradient-to-r from-purple-500 to-violet-500 text-white py-3 rounded-xl font-bold text-sm hover:from-purple-600 hover:to-violet-600 transition flex items-center justify-center gap-2 shadow-md",children:[i.jsx("span",{className:"material-symbols-outlined text-xl",children:"timeline"}),"  "]})]})}function G6({clinicInfo:t,onUpdate:e}){const[s,n]=O.useState(!1),[r,a]=O.useState(t),o=()=>{e(r),n(!1)};return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("h2",{className:"font-bold text-slate-800 flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-slate-500",children:"settings"}),"  "]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4 space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:""}),s?i.jsx("input",{type:"text",value:r.name,onChange:l=>a({...r,name:l.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-400"}):i.jsx("p",{className:"text-slate-800",children:t.name})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:" "}),s?i.jsx("input",{type:"text",value:r.doctorName,onChange:l=>a({...r,doctorName:l.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-400"}):i.jsx("p",{className:"text-slate-800",children:t.doctorName})]}),s?i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>n(!1),className:"flex-1 py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 transition",children:""}),i.jsx("button",{onClick:o,className:"flex-1 py-2 bg-sky-500 text-white rounded-lg hover:bg-sky-600 transition",children:""})]}):i.jsx("button",{onClick:()=>n(!0),className:"w-full py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 transition",children:""})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm divide-y divide-slate-100",children:[i.jsxs("button",{className:"w-full p-4 flex items-center justify-between text-left hover:bg-slate-50 transition",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"notifications"}),i.jsx("span",{className:"text-slate-700",children:" "})]}),i.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"chevron_right"})]}),i.jsxs("button",{className:"w-full p-4 flex items-center justify-between text-left hover:bg-slate-50 transition",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"calendar_month"}),i.jsx("span",{className:"text-slate-700",children:" "})]}),i.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"chevron_right"})]}),i.jsxs("button",{className:"w-full p-4 flex items-center justify-between text-left hover:bg-slate-50 transition",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"help"}),i.jsx("span",{className:"text-slate-700",children:""})]}),i.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"chevron_right"})]})]})]})}function Q6({booking:t,onClose:e,onUpdateStatus:s,onStartVisit:n}){const[r,a]=O.useState(null),o=t.petProfile||{};return O.useEffect(()=>{if(t.aiDiagnosis)a(t.aiDiagnosis);else if(t.diagnosisId)try{const c=JSON.parse(localStorage.getItem("petMedical_diagnoses")||"[]").find(u=>u.id===t.diagnosisId);a(c)}catch(l){console.error("   :",l)}},[t.aiDiagnosis,t.diagnosisId]),i.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",children:i.jsxs("div",{className:"bg-white w-full rounded-t-2xl max-h-[85vh] overflow-y-auto animate-slide-up",children:[i.jsxs("div",{className:"sticky top-0 bg-white border-b border-slate-100 p-4 flex items-center justify-between z-10",children:[i.jsx("h2",{className:"font-bold text-lg text-slate-800",children:" "}),i.jsx("button",{onClick:e,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition",children:i.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),i.jsxs("div",{className:"p-4 space-y-4",children:[i.jsx("div",{className:"bg-sky-50 rounded-xl p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-16 h-16 rounded-full bg-white overflow-hidden shadow-sm",children:i.jsx("img",{src:Is(o||{species:o.species||"dog"},!1),alt:t.petName||"",className:"w-full h-full object-cover",style:{objectPosition:"center",display:"block"}})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"font-bold text-lg text-sky-800",children:t.petName}),i.jsxs("p",{className:"text-sm text-sky-600",children:[": ",t.date," ",t.time]}),i.jsx("span",{className:`inline-block mt-1 px-2 py-0.5 rounded-full text-xs font-medium ${du(t.status).color}`,children:du(t.status).label})]})]})}),o&&Object.keys(o).length>1&&i.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl overflow-hidden",children:[i.jsx("div",{className:"p-3 bg-sky-50 border-b border-sky-100",children:i.jsxs("h3",{className:"font-semibold text-sky-800 flex items-center gap-2 text-sm",children:[i.jsx("span",{className:"material-symbols-outlined text-sky-500 text-lg",children:"pets"})," "]})}),i.jsxs("div",{className:"p-3 grid grid-cols-2 gap-2 text-sm",children:[o.breed&&i.jsxs("div",{children:[i.jsx("span",{className:"text-slate-500 text-xs",children:""}),i.jsx("p",{className:"font-medium text-slate-800",children:o.breed})]}),o.age&&i.jsxs("div",{children:[i.jsx("span",{className:"text-slate-500 text-xs",children:""}),i.jsxs("p",{className:"font-medium text-slate-800",children:[Gg(o.age)," ",o.sex&&Qg(o.sex)]})]}),o.sex&&i.jsxs("div",{children:[i.jsx("span",{className:"text-slate-500 text-xs",children:""}),i.jsxs("p",{className:"font-medium text-slate-800",children:[o.sex==="M"?"":o.sex==="F"?"":o.sex,o.neutered?" ()":""]})]}),o.weight&&i.jsxs("div",{children:[i.jsx("span",{className:"text-slate-500 text-xs",children:""}),i.jsxs("p",{className:"font-medium text-slate-800",children:[o.weight,"kg"]})]}),o.allergies&&o.allergies.length>0&&i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"text-slate-500 text-xs",children:" "}),i.jsx("p",{className:"font-medium text-red-600",children:o.allergies.join(", ")})]}),o.chronicConditions&&o.chronicConditions.length>0&&i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"text-slate-500 text-xs",children:" "}),i.jsx("p",{className:"font-medium text-amber-600",children:o.chronicConditions.join(", ")})]})]})]}),t.message&&i.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-4",children:[i.jsxs("h3",{className:"font-semibold text-slate-700 flex items-center gap-2 mb-2 text-sm",children:[i.jsx("span",{className:"material-symbols-outlined text-sky-500",children:"chat"})," "]}),i.jsx("p",{className:"text-slate-600",children:t.message})]}),r&&i.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl overflow-hidden",children:[i.jsxs("div",{className:"p-4",children:[i.jsxs("h3",{className:"font-semibold text-amber-800 flex items-center gap-2 mb-3",children:[i.jsx("span",{className:"material-symbols-outlined text-amber-500",children:"auto_awesome"}),"AI   "]}),r.image&&i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"text-xs font-medium text-amber-700 mb-1",children:" "}),i.jsx("img",{src:r.image,alt:" ",className:"w-full max-h-48 object-cover rounded-lg border border-amber-200"})]}),r.symptoms&&r.symptoms.length>0&&i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"text-xs font-medium text-amber-700 mb-1",children:" "}),i.jsx("div",{className:"flex flex-wrap gap-1",children:r.symptoms.map((l,c)=>i.jsx("span",{className:"px-2 py-1 bg-amber-100 text-amber-800 text-sm rounded-lg",children:l},c))})]}),r.symptom&&i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"text-xs font-medium text-amber-700 mb-1",children:"  "}),i.jsx("p",{className:"text-sm text-amber-800 bg-white p-2 rounded-lg border border-amber-200",children:r.symptom})]}),r.onsetDate&&i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"text-xs font-medium text-amber-700 mb-1",children:" "}),i.jsx("p",{className:"text-sm text-amber-800",children:r.onsetDate})]}),r.diagnosis&&i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"text-xs font-medium text-amber-700 mb-1",children:"AI  "}),i.jsx("p",{className:"text-amber-800 font-medium",children:typeof r.diagnosis=="string"?r.diagnosis:r.diagnosis.primary||JSON.stringify(r.diagnosis)})]}),r.possibleDiseases&&r.possibleDiseases.length>0||r.suspectedConditions&&r.suspectedConditions.length>0?i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"text-xs font-medium text-amber-700 mb-1",children:" AI  (Top 3  )"}),i.jsx("div",{className:"space-y-2",children:(r.possibleDiseases||r.suspectedConditions||[]).slice(0,3).map((l,c)=>{const u=l.probability||l.probability_percent||0,h=typeof u=="number"&&u<=1?u*100:u;return i.jsxs("div",{className:"bg-white p-2 rounded-lg border border-amber-200",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"font-medium text-amber-800",children:l.name||l.name_kor}),i.jsxs("span",{className:`text-sm font-bold ${h>=70?"text-red-600":h>=40?"text-amber-600":"text-green-600"}`,children:[Math.round(h),"%"]})]}),i.jsx("div",{className:"h-1.5 bg-amber-100 rounded-full mt-1 overflow-hidden",children:i.jsx("div",{className:`h-full ${h>=70?"bg-red-500":h>=40?"bg-amber-500":"bg-green-500"}`,style:{width:`${h}%`}})}),l.related_area&&i.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[" : ",l.related_area]})]},c)})})]}):null,(r.triageScore!==void 0||r.triageLevel||r.riskLevel)&&i.jsxs("div",{className:"mb-3 p-3 bg-white rounded-lg border border-amber-200",children:[i.jsx("p",{className:"text-xs font-medium text-amber-700 mb-2",children:"   (Triage)"}),i.jsxs("div",{className:"flex items-center gap-3",children:[r.triageScore!==void 0&&i.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[i.jsx("div",{className:"flex-1 h-3 bg-slate-200 rounded-full overflow-hidden",children:i.jsx("div",{className:`h-full transition-all ${r.triageScore>=4?"bg-red-500":r.triageScore>=3?"bg-orange-500":r.triageScore>=2?"bg-yellow-500":"bg-green-500"}`,style:{width:`${r.triageScore/5*100}%`}})}),i.jsxs("span",{className:"text-lg font-bold text-slate-800",children:[r.triageScore,"/5"]})]}),(r.triageLevel||r.riskLevel)&&i.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${(r.triageLevel||"").includes("red")||r.riskLevel==="high"?"bg-red-100 text-red-700":(r.triageLevel||"").includes("orange")||r.riskLevel==="medium"?"bg-orange-100 text-orange-700":(r.triageLevel||"").includes("yellow")?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:r.triageLevel||(r.riskLevel==="high"?"":r.riskLevel==="medium"?"":"")})]}),r.hospitalVisitTime&&i.jsxs("p",{className:"text-sm text-red-600 mt-2 font-medium",children:["   : ",r.hospitalVisitTime]})]}),r.actions&&r.actions.length>0&&i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"text-xs font-medium text-amber-700 mb-1",children:" AI  "}),i.jsx("ul",{className:"text-sm text-amber-800 space-y-1 bg-white p-2 rounded-lg border border-amber-200",children:r.actions.map((l,c)=>i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-green-500 text-sm mt-0.5",children:"check_circle"}),l]},c))})]}),r.recommendations&&i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"text-xs font-medium text-amber-700 mb-1",children:"AI "}),i.jsx("p",{className:"text-sm text-amber-700",children:r.recommendations})]}),r.suggestedTreatments&&r.suggestedTreatments.length>0&&i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"text-xs font-medium text-amber-700 mb-1",children:" "}),i.jsx("ul",{className:"text-sm text-amber-700 list-disc list-inside space-y-1",children:r.suggestedTreatments.map((l,c)=>i.jsx("li",{children:l},c))})]}),r.hospitalVisitTime&&i.jsxs("div",{className:"p-2 bg-red-50 border border-red-200 rounded-lg",children:[i.jsxs("p",{className:"text-xs font-medium text-red-700 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"warning"}),"  "]}),i.jsxs("p",{className:"text-sm font-bold text-red-800",children:[r.hospitalVisitTime,"   "]})]})]}),i.jsxs("div",{className:"px-4 py-2 bg-amber-100/50 border-t border-amber-200 text-xs text-amber-600",children:[": ",r.created_at?new Date(r.created_at).toLocaleString("ko-KR"):r.date||" "]})]}),i.jsx(Y6,{petId:t.petId}),i.jsxs("div",{className:"flex gap-3 pt-2",children:[t.status==="pending"&&i.jsx("button",{onClick:()=>{s(t.id,"confirmed"),e()},className:"flex-1 py-3 bg-sky-500 text-white font-semibold rounded-xl hover:bg-sky-600 transition",children:" "}),t.status!=="completed"&&i.jsx("button",{onClick:n,className:"flex-1 py-3 bg-sky-500 text-white font-semibold rounded-xl hover:bg-sky-600 transition",children:" "}),t.status==="pending"&&i.jsx("button",{onClick:()=>{s(t.id,"cancelled"),e()},className:"py-3 px-4 bg-slate-100 text-slate-600 font-semibold rounded-xl hover:bg-slate-200 transition",children:""})]})]})]})})}function J6({booking:t,onClose:e,onSave:s}){const[n,r]=O.useState({diagnosis:"",treatment:"",notes:"",followUp:"",totalCost:""}),[a,o]=O.useState([{name:"",dosage:"",days:"",instructions:""}]),l=()=>{o([...a,{name:"",dosage:"",days:"",instructions:""}])},c=f=>{a.length>1&&o(a.filter((y,_)=>_!==f))},u=(f,y,_)=>{const S=[...a];S[f][y]=_,o(S)},h=()=>{if(!n.diagnosis.trim()){alert(" .");return}const f=a.filter(y=>y.name.trim());s({petId:t.petId,petName:t.petName,petProfile:t.petProfile,...n,medications:f,totalCost:n.totalCost?parseInt(n.totalCost):0})},m=t.petProfile||{};return i.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",children:i.jsxs("div",{className:"bg-white w-full rounded-t-2xl max-h-[90vh] overflow-y-auto animate-slide-up",children:[i.jsxs("div",{className:"sticky top-0 bg-white border-b border-slate-100 p-4 flex items-center justify-between z-10",children:[i.jsx("h2",{className:"font-bold text-lg text-slate-800",children:"  "}),i.jsx("button",{onClick:e,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition",children:i.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),i.jsxs("div",{className:"p-4 space-y-4",children:[i.jsxs("div",{className:"bg-sky-50 rounded-xl p-3 flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-white overflow-hidden shadow-sm",children:i.jsx("img",{src:Is(m||{species:m.species||"dog"},!1),alt:t.petName||"",className:"w-full h-full object-cover",style:{objectPosition:"center",display:"block"}})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"font-semibold text-sky-800",children:t.petName}),i.jsxs("p",{className:"text-xs text-sky-600",children:[m.breed&&`${m.breed}  `,m.age&&`${m.age}  `,t.date," "]})]})]}),t.aiDiagnosis&&i.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs font-medium text-amber-700 mb-1",children:" AI  "}),i.jsx("p",{className:"text-sm text-amber-800 font-medium",children:t.aiDiagnosis.diagnosis}),t.aiDiagnosis.triageScore&&i.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:[": ",t.aiDiagnosis.triageScore,"/5 (",t.aiDiagnosis.triageLevel||"",")"]})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:[" ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"text",value:n.diagnosis,onChange:f=>r({...n,diagnosis:f.target.value}),placeholder:":  ",className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-sky-400"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:" "}),i.jsx("textarea",{value:n.treatment,onChange:f=>r({...n,treatment:f.target.value}),placeholder:"   ",rows:3,className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-sky-400 resize-none"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:i.jsxs("span",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-lg text-sky-500",children:"medication"}),""]})}),i.jsxs("div",{className:"space-y-3",children:[a.map((f,y)=>i.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("span",{className:"text-xs text-slate-500",children:[" ",y+1]}),a.length>1&&i.jsx("button",{onClick:()=>c(y),className:"text-red-400 hover:text-red-600",children:i.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]}),i.jsx("input",{type:"text",value:f.name,onChange:_=>u(y,"name",_.target.value),placeholder:" (:  16mg)",className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-sky-400"}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsx("input",{type:"text",value:f.dosage,onChange:_=>u(y,"dosage",_.target.value),placeholder:" (: 1 2)",className:"px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-sky-400"}),i.jsx("input",{type:"text",value:f.days,onChange:_=>u(y,"days",_.target.value),placeholder:" (: 7)",className:"px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-sky-400"})]}),i.jsx("input",{type:"text",value:f.instructions,onChange:_=>u(y,"instructions",_.target.value),placeholder:"  (:  30)",className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-sky-400"})]},y)),i.jsxs("button",{onClick:l,className:"w-full py-2 border-2 border-dashed border-slate-300 rounded-xl text-slate-500 text-sm hover:border-sky-400 hover:text-sky-500 transition flex items-center justify-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})," "]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:" / "}),i.jsx("textarea",{value:n.notes,onChange:f=>r({...n,notes:f.target.value}),placeholder:"   ",rows:2,className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-sky-400 resize-none"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"  "}),i.jsx("input",{type:"date",value:n.followUp,onChange:f=>r({...n,followUp:f.target.value}),className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-sky-400"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:" ()"}),i.jsx("input",{type:"number",value:n.totalCost,onChange:f=>r({...n,totalCost:f.target.value}),placeholder:"0",className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-sky-400"})]}),i.jsxs("div",{className:"bg-sky-50 rounded-xl p-3 flex items-start gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-sky-500 text-lg",children:"info"}),i.jsx("p",{className:"text-sm text-sky-700",children:"      .    /   ."})]}),i.jsxs("div",{className:"flex gap-3 pt-2",children:[i.jsx("button",{onClick:e,className:"flex-1 py-3 bg-slate-100 text-slate-600 font-semibold rounded-xl hover:bg-slate-200 transition",children:""}),i.jsxs("button",{onClick:h,className:"flex-1 py-3 bg-sky-500 text-white font-semibold rounded-xl hover:bg-sky-600 transition flex items-center justify-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined",children:"save"}),""]})]})]})]})})}function Y6({petId:t}){const[e,s]=O.useState([]),[n,r]=O.useState(!1);if(O.useEffect(()=>{if(!t)return;const l=JSON.parse(localStorage.getItem(cu)||"[]"),c=JSON.parse(localStorage.getItem(D6)||"{}"),h=l.filter(m=>m.petId===t).flatMap(m=>(m.medications||[]).map((f,y)=>{var _;return{id:`${m.id}_med_${y}`,name:f.name,dosage:f.dosage,days:f.days,instructions:f.instructions,hospitalName:((_=m.clinic)==null?void 0:_.name)||m.hospitalName||"  ",date:m.visitDate||m.createdAt,feedback:c[`${m.id}_med_${y}`]||null}})).sort((m,f)=>new Date(f.date)-new Date(m.date));s(h)},[t]),e.length===0)return null;const a=e.filter(l=>{var c;return((c=l.feedback)==null?void 0:c.status)==="effective"}),o=e.filter(l=>{var c;return((c=l.feedback)==null?void 0:c.status)==="side_effect"});return i.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl overflow-hidden",children:[i.jsxs("button",{onClick:()=>r(!n),className:"w-full p-3 bg-purple-50 border-b border-purple-100 flex items-center justify-between",children:[i.jsxs("h3",{className:"font-semibold text-purple-800 flex items-center gap-2 text-sm",children:[i.jsx("span",{className:"material-symbols-outlined text-purple-500 text-lg",children:"history"}),"   (",e.length,")"]}),i.jsx("span",{className:"material-symbols-outlined text-purple-500",children:n?"expand_less":"expand_more"})]}),n&&i.jsxs("div",{className:"p-3",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[a.length>0&&i.jsxs("div",{className:"bg-green-50 rounded-lg p-2 flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-green-500",children:"thumb_up"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-green-600",children:"  "}),i.jsxs("p",{className:"font-bold text-green-700",children:[a.length,""]})]})]}),o.length>0&&i.jsxs("div",{className:"bg-red-50 rounded-lg p-2 flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-red-500",children:"thumb_down"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-red-600",children:"  "}),i.jsxs("p",{className:"font-bold text-red-700",children:[o.length,""]})]})]})]}),o.length>0&&i.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3",children:[i.jsxs("p",{className:"text-xs font-bold text-red-700 mb-2 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"warning"}),"    ( )"]}),i.jsx("div",{className:"space-y-1",children:o.map(l=>i.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-800",children:[i.jsx("span",{className:"material-symbols-outlined text-xs",children:"medication"}),i.jsx("span",{className:"font-medium",children:l.name}),i.jsxs("span",{className:"text-red-500 text-xs",children:["(",new Date(l.date).toLocaleDateString("ko-KR"),")"]})]},l.id))})]}),a.length>0&&i.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-3",children:[i.jsxs("p",{className:"text-xs font-bold text-green-700 mb-2 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"check_circle"}),"   ( )"]}),i.jsx("div",{className:"space-y-1",children:a.map(l=>i.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-800",children:[i.jsx("span",{className:"material-symbols-outlined text-xs",children:"medication"}),i.jsx("span",{className:"font-medium",children:l.name}),i.jsxs("span",{className:"text-green-500 text-xs",children:["(",new Date(l.date).toLocaleDateString("ko-KR"),")"]})]},l.id))})]}),i.jsx("p",{className:"text-xs font-medium text-slate-500 mb-2",children:"  "}),i.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:e.map(l=>i.jsxs("div",{className:"bg-slate-50 rounded-lg p-2 text-sm",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"font-medium text-slate-800",children:l.name}),l.feedback&&i.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${l.feedback.status==="effective"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:l.feedback.status==="effective"?"  ":" "})]}),i.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[l.hospitalName,"  ",new Date(l.date).toLocaleDateString("ko-KR"),l.dosage&&`  ${l.dosage}`]})]},l.id))})]})]})}function du(t){switch(t){case"confirmed":return{label:"",color:"bg-green-100 text-green-700"};case"cancelled":return{label:"",color:"bg-red-100 text-red-700"};case"completed":return{label:"",color:"bg-slate-100 text-slate-700"};default:return{label:"",color:"bg-amber-100 text-amber-700"}}}const Pj=document.createElement("style");Pj.textContent=`
  @keyframes slide-up {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
  }
  .animate-slide-up {
    animation: slide-up 0.3s ease-out;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
`;document.head.appendChild(Pj);function mt(t=0){const e=new Date;return e.setDate(e.getDate()-t),it.fromDate(e)}async function Ov(t,e){console.log(`
     : ${e} (${t})
`);try{console.log("   ...");const s={userId:t,petName:"",species:"dog",breed:"",gender:"male",birthDate:mt(365*3),neutered:!0,weight:3.5,createdAt:mt(30),updatedAt:mt(0)},r=(await as(fe(se,"pets"),s)).id;console.log(`       (ID: ${r})`);const a={userId:t,petName:"",species:"cat",breed:"",gender:"female",birthDate:mt(365*2),neutered:!0,weight:4.2,createdAt:mt(20),updatedAt:mt(0)},l=(await as(fe(se,"pets"),a)).id;console.log(`       (ID: ${l})`),console.log(`
 AI    ...`);const c=[{userId:t,petId:r,petName:"",diagnosis:" ",description:"      .   ,    .",emergencyLevel:"medium",triageLevel:"medium",actions:[{type:"home_care",title:"  ",description:" 1  "},{type:"medication",title:"",description:"   "},{type:"monitor",title:" ",description:"3     "}],symptomTags:["","",""],createdAt:mt(5)},{userId:t,petId:r,petName:"",diagnosis:"",description:"    .         .",emergencyLevel:"low",triageLevel:"low",actions:[{type:"diet",title:" ",description:"12    "},{type:"hydration",title:" ",description:"  "}],symptomTags:["",""],createdAt:mt(10)},{userId:t,petId:l,petName:"",diagnosis:"  ",description:"     .        .",emergencyLevel:"high",triageLevel:"high",actions:[{type:"hospital",title:" ",description:"24    "},{type:"monitor",title:"  ",description:"    "}],symptomTags:["","",""],createdAt:mt(3)},{userId:t,petId:l,petName:"",diagnosis:" ",description:"      .     .",emergencyLevel:"medium",triageLevel:"medium",actions:[{type:"hospital",title:" ",description:"    "},{type:"diet",title:" ",description:"     "}],symptomTags:["",""],createdAt:mt(15)}];for(const h of c)await as(fe(se,"diagnoses"),h);console.log("      4  "),console.log(`
     ...`);const u=[];for(let h=0;h<7;h++)u.push({userId:t,petId:r,petName:"",date:mt(h),activities:[{type:"meal",time:"08:00",note:" 1"},{type:"walk",time:"10:00",note:" 30"},{type:"meal",time:"18:00",note:" 1"}],notes:h===0?"  ":null,createdAt:mt(h)}),u.push({userId:t,petId:l,petName:"",date:mt(h),activities:[{type:"meal",time:"09:00",note:"  1"},{type:"play",time:"15:00",note:" "},{type:"meal",time:"20:00",note:"  1"}],notes:h===2?"  ":null,createdAt:mt(h)});for(const h of u)await as(fe(se,"dailyLogs"),h);return console.log("      14  "),console.log(`
     !`),{success:!0,pets:[r,l],diagnoses:4,careLogs:14}}catch(s){throw console.error("    :",s),s}}async function X6(t,e){console.log(`
     : ${e} (${t})
`);try{console.log("    ...");const s=await Ht(st(se,"users",t));let n=null;if(s.exists()&&(n=s.data().defaultClinicId,n)){const y=await Ht(st(se,"clinics",n));y.exists()?console.log(`       : ${y.data().name}`):n=null}if(!n){const f={name:"",address:"   123",phone:"02-1234-5678",ownerUserId:t,createdAt:mt(60),updatedAt:mt(0)};n=(await as(fe(se,"clinics"),f)).id,await Zi(st(se,"users",t),{defaultClinicId:n,userMode:"clinic",roles:["clinic_owner"]}),console.log(`       :  (ID: ${n})`)}console.log(`
    ...`);const r=[],a=["pending","confirmed","completed","cancelled"],o=["09:00","10:00","11:00","14:00","15:00","16:00","17:00"];for(let f=0;f<50;f++){const y=Math.floor(f/7),_=a[Math.floor(Math.random()*a.length)],S=o[Math.floor(Math.random()*o.length)];r.push({userId:`U${String(Math.floor(Math.random()*1e3)).padStart(4,"0")}`,petId:`PET${String(Math.floor(Math.random()*1e3)).padStart(4,"0")}`,clinicId:n,hospitalName:"",date:mt(y),time:S,status:_,reason:["",""," "," "][Math.floor(Math.random()*4)],createdAt:mt(y+1),updatedAt:mt(y)})}const l=[];for(const f of r){const y=await as(fe(se,"bookings"),f);l.push(y.id)}console.log("      50  "),console.log(`
    ...`);const c=r.filter(f=>f.status==="completed").slice(0,40),u=[];for(let f=0;f<c.length;f++){const y=c[f];u.push({userId:y.userId,petId:y.petId,clinicId:n,hospitalName:"",bookingId:l[r.indexOf(y)],diagnosis:["",""," "," ",""][Math.floor(Math.random()*5)],treatment:"    ",prescription:["","","",""][Math.floor(Math.random()*4)],notes:"  ",createdAt:y.date,updatedAt:y.date})}for(const f of u)await as(fe(se,"clinicResults"),f);console.log(`      ${u.length}  `),console.log(`
    ...`);const h=12,m=[];for(let f=0;f<h;f++){const y=["dog","cat"][Math.floor(Math.random()*2)],_=y==="dog"?["","","",""]:["","","",""];m.push({clinicId:n,clinicName:"",petId:`PET${String(f+1).padStart(4,"0")}`,petName:["","","","","","","","","",""][f],species:y,speciesLabelKo:y==="dog"?"":"",breed:_[Math.floor(Math.random()*_.length)],birthDate:mt(365*(2+Math.floor(Math.random()*5))),ownerUserId:`U${String(f+1).padStart(4,"0")}`,visitCount:Math.floor(Math.random()*5)+1,lastVisitDate:mt(Math.floor(Math.random()*30)),lastDiagnosis:["","",""][Math.floor(Math.random()*3)],lastTriageLevel:["low","medium","high"][Math.floor(Math.random()*3)],lastWeightKg:(2+Math.random()*5).toFixed(1),createdAt:mt(30+f),updatedAt:mt(Math.floor(Math.random()*30))})}for(const f of m)await as(fe(se,"clinicPatients"),f);return console.log(`      ${h}  `),console.log(`
     !`),{success:!0,clinicId:n,bookings:50,clinicResults:u.length,patients:h}}catch(s){throw console.error("    :",s),s}}function Z6({booking:t,clinic:e,onClose:s,onSaved:n,onShared:r}){var C,P,j,re;const[a,o]=O.useState(""),[l,c]=O.useState(""),[u,h]=O.useState(""),[m,f]=O.useState(""),[y,_]=O.useState(((C=t==null?void 0:t.aiDiagnosis)==null?void 0:C.triageScore)||0),[S,R]=O.useState(((P=t==null?void 0:t.aiDiagnosis)==null?void 0:P.diagnosis)||""),[k,x]=O.useState(!1),[A,M]=O.useState(!1),[D,B]=O.useState(null),[v,N]=O.useState(!1);if(O.useEffect(()=>{(async()=>{if(t!=null&&t.id)try{const le=t.bookingId||t.id,ce=await tr.getResultByBooking(le);ce.success&&ce.data&&(M(!0),B(ce.data.id),console.log("[TreatmentSheet]   :",ce.data.id))}catch(le){console.error("[TreatmentSheet]    :",le)}})()},[t==null?void 0:t.id,t==null?void 0:t.bookingId]),!t)return null;const w=async()=>{var Z,le,ce,F,Q,K,I;if(window.confirm("  ?")){if(!(e!=null&&e.id)){alert(" (clinicId)      .   .");return}if(!(t!=null&&t.id)||!(t!=null&&t.userId)||!(t!=null&&t.petId)){alert("       .");return}x(!0);try{const L={clinicId:e.id??null,clinicName:e.name??null,bookingId:t.id??null,userId:t.userId??null,ownerId:t.ownerId??t.userId??null,petId:t.petId??null,petName:((Z=t.pet)==null?void 0:Z.name)||t.petName||null,visitDate:t.date??null,visitTime:t.time??null,triageScore:y??0,mainDiagnosis:S??null,soap:{subjective:a??"",objective:l??"",assessment:u??"",plan:m??""},previsit:t.aiDiagnosis??null},W=await tr.saveResult(L);if(!W.success)throw W.error;M(!0),B(W.id);try{const b=`${e.id}_${t.petId}`,V={clinicId:e.id,clinicName:e.name,petId:t.petId,petName:((le=t.pet)==null?void 0:le.name)||t.petName||null,species:((ce=t.pet)==null?void 0:ce.species)??null,speciesLabelKo:((F=t.pet)==null?void 0:F.speciesLabelKo)??null,ownerUserId:t.userId??null,ownerName:((Q=t.owner)==null?void 0:Q.name)??null,ownerPhone:((K=t.owner)==null?void 0:K.phone)??null,lastVisitDate:t.date??null,lastDiagnosis:S??null,lastTriageLevel:y>=4?"high":y>=2?"medium":"low",lastWeightKg:((I=t.pet)==null?void 0:I.weight)??null,visitCount:yC(1),updatedAt:qt(),createdAt:qt()};console.log(" [clinicPatients]  :",{docId:b,clinicId:V.clinicId,petId:V.petId,ownerUserId:V.ownerUserId}),await UN(st(se,"clinicPatients",b),V,{merge:!0}),console.log(" [clinicPatients]  ")}catch(b){console.warn(" [clinicPatients]   (  ):",b)}alert("  ."),n&&n()}catch(L){console.error("   :",L),alert("     .")}finally{x(!1)}}},E=async()=>{if(!D){alert("   .");return}N(!0);try{const Z=await tr.shareResult(D);if(!Z.success){console.error("  :",Z.error),alert(" .    .");return}t!=null&&t.id&&await qi.updateBookingStatus(t.id,"completed"),alert("  ."),r&&r()}catch(Z){console.error("  :",Z),alert(" .    .")}finally{N(!1)}};return i.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-xl max-h-[90vh] overflow-y-auto p-6",children:[i.jsxs("div",{className:"mb-4",children:[i.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:[e.name,"  ",t.date," ",t.time]}),i.jsxs("div",{className:"text-lg font-bold",children:[((j=t.pet)==null?void 0:j.name)||t.petName," /  ",(re=t.owner)==null?void 0:re.name]})]}),i.jsxs("div",{className:"space-y-3 text-sm",children:[i.jsxs("div",{children:[i.jsx("label",{className:"font-semibold block mb-1",children:" "}),i.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-3 py-2",value:S,onChange:Z=>R(Z.target.value),placeholder:": "})]}),i.jsxs("div",{children:[i.jsx("label",{className:"font-semibold block mb-1",children:"Triage  (0~5)"}),i.jsx("input",{type:"number",min:0,max:5,className:"w-full border border-gray-300 rounded-lg px-3 py-2",value:y,onChange:Z=>_(Number(Z.target.value))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"font-semibold block mb-1",children:"Subjective ( )"}),i.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg px-3 py-2",rows:3,value:a,onChange:Z=>o(Z.target.value),placeholder:"  "})]}),i.jsxs("div",{children:[i.jsx("label",{className:"font-semibold block mb-1",children:"Objective ( )"}),i.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg px-3 py-2",rows:3,value:l,onChange:Z=>c(Z.target.value),placeholder:", ,   "})]}),i.jsxs("div",{children:[i.jsx("label",{className:"font-semibold block mb-1",children:"Assessment ()"}),i.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg px-3 py-2",rows:3,value:u,onChange:Z=>h(Z.target.value),placeholder:"  "})]}),i.jsxs("div",{children:[i.jsx("label",{className:"font-semibold block mb-1",children:"Plan (/ )"}),i.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg px-3 py-2",rows:3,value:m,onChange:Z=>f(Z.target.value),placeholder:",  "})]})]}),i.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[i.jsx("button",{className:"px-4 py-2 text-sm rounded-lg border border-gray-300 hover:bg-gray-50",onClick:s,disabled:k,children:""}),A?i.jsx("button",{className:"px-4 py-2 text-sm rounded-lg bg-sky-600 text-white hover:bg-sky-700 disabled:opacity-50",onClick:E,disabled:k||v,children:v?" ...":" "}):i.jsx("button",{className:"px-4 py-2 text-sm rounded-lg bg-sky-600 text-white hover:bg-sky-700 disabled:opacity-50",onClick:w,disabled:k,children:k?" ...":" "})]})]})})}const cm={dog:"",cat:"",rabbit:"",hamster:"",bird:"",hedgehog:"",reptile:"",etc:"",other:""},Lv=t=>t?typeof t=="string"&&t.includes("")?t:typeof t=="number"?`${t}`:t:" ",eM=t=>{if(!t)return null;const e=t==="M"||t==="male"||t===""||t==="",s=t==="F"||t==="female"||t===""||t==="";return e?i.jsx("span",{className:"text-blue-600 font-semibold",children:""}):s?i.jsx("span",{className:"text-rose-600 font-semibold",children:""}):t},tM=(t=new Date)=>{const e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${s}-${n}`};function sM({currentUser:t,onBack:e}){var $t,Rs,_n,Bn,Nn,Ks,ic,ac,hi,uo,ho,ta,pr,oc,on,mo,fo,sa,na,po,lc,go,cc,mi,xo,ra,gr,jn,ia,dc,yo,vo,bo,aa,oa,wo;const[s,n]=O.useState(!0),[r,a]=O.useState(null),[o,l]=O.useState([]),[c,u]=O.useState("home"),[h,m]=O.useState([]),[f,y]=O.useState([]),[_,S]=O.useState([]),[R,k]=O.useState([]),[x,A]=O.useState({}),[M,D]=O.useState(null),[B,v]=O.useState(new Date),[N,w]=O.useState("all"),[E,C]=O.useState(null),[P,j]=O.useState(null),[re,Z]=O.useState(null),[le,ce]=O.useState({diagnoses:[],results:[]}),[F,Q]=O.useState(!1),[K,I]=O.useState(!1),[L,W]=O.useState(null),[b,V]=O.useState(null),[J,z]=O.useState(!1),[q,ae]=O.useState(null),[je,Ve]=O.useState(""),[ye,ht]=O.useState("vet"),[Qe,an]=O.useState([]),[jt,ie]=O.useState(!1);O.useEffect(()=>{t!=null&&t.uid&&Ee()},[t]),O.useEffect(()=>{r&&Ce()},[r]);const Te=async $=>{try{const G=$.bookingId||$.id,xe=await tr.getResultByBooking(G);return xe.success&&xe.data?{...$,hasResult:!0,sharedToGuardian:xe.data.sharedToGuardian||!1,lastResultId:xe.data.id,clinicResult:xe.data}:{...$,hasResult:!1,sharedToGuardian:!1}}catch{return{...$,hasResult:!1,sharedToGuardian:!1}}};O.useEffect(()=>{if(!(r!=null&&r.id))return;const $=tM();console.log("[  ] clinicId:",r.id,":",$);const G=[];try{const xe=_e(fe(se,"bookings"),pe("clinicId","==",r.id),pe("date","==",$),Pt("time","asc")),Me=Vl(xe,async Ke=>{var kt,Xt;console.log("[]  :",Ke.docs.length,"");const Ge=[];for(const ve of Ke.docs){const ge=ve.data();let He=null;if(ge.petId)try{const Zt=await Ht(st(se,"pets",ge.petId));He=Zt.exists()?Zt.data():ge.pet||ge.petProfile||null}catch{He=ge.pet||ge.petProfile||null}let yt=null;if(ge.userId)try{const Zt=await Ht(st(se,"users",ge.userId));if(Zt.exists()){const ys=Zt.data();yt={...ys,name:ys.displayName||ys.name||((kt=ge.owner)==null?void 0:kt.name)||"  ",displayName:ys.displayName||ys.name||((Xt=ge.owner)==null?void 0:Xt.displayName)}}else yt=ge.owner||null}catch{yt=ge.owner||null}Ge.push({...ge,id:ve.id,bookingId:ge.bookingId||ve.id,pet:He,owner:yt})}Promise.all(Ge.map(Te)).then(ve=>{ve.sort((ge,He)=>(ge.time||"00:00").localeCompare(He.time||"00:00")),m(ve)})});G.push(Me)}catch(xe){console.error("[]  :",xe)}if(r.name)try{const xe=_e(fe(se,"bookings"),pe("clinicName","==",r.name),pe("date","==",$)),Me=Vl(xe,async Ke=>{m(Ge=>{const kt=new Map(Ge.map(ve=>[ve.id,ve]));for(const ve of Ke.docs){const ge=ve.data(),He={...ge,id:ve.id,bookingId:ge.bookingId||ve.id,pet:ge.pet||ge.petProfile||null,owner:ge.owner||null};kt.set(ve.id,He)}const Xt=Array.from(kt.values());return Promise.all(Xt.map(Te)).then(ve=>{ve.sort((ge,He)=>(ge.time||"00:00").localeCompare(He.time||"00:00")),m(ve)}),Xt.sort((ve,ge)=>(ve.time||"00:00").localeCompare(ge.time||"00:00"))})});G.push(Me)}catch(xe){console.error("[]   :",xe)}return()=>{G.forEach(xe=>xe())}},[r==null?void 0:r.id,r==null?void 0:r.name]),O.useEffect(()=>{r&&(ze(),ct())},[B,r]);const Ee=async()=>{try{n(!0);let $=await Ci(t.uid);if($.length===0){const xe=(await Vs.getUser(t.uid)).data||{};(await Aj(t.uid,{...xe,displayName:t.displayName||xe.displayName})).success&&($=await Ci(t.uid))}if($.length===0){alert("    .  ."),e();return}l($),a($[0])}catch($){console.error("   :",$),alert("  .")}finally{n(!1)}},Ce=async()=>{try{n(!0);const $=await Ej(r.id);A($);const G=await jj(r.id,t),xe=await Promise.all(G.map(Te));m(xe);const Me=await Sj(r.id,{limit:50});k(Me)}catch($){console.error("   :",$)}finally{n(!1)}},ze=async()=>{try{const $=B.getFullYear(),G=B.getMonth()+1,xe=await Ij(r.id,$,G);y(xe)}catch($){console.error("   :",$)}},ct=async()=>{try{const $=await kj(r.id,{limit:100});S($)}catch($){console.error("    :",$)}},Ne=()=>{confirm(" ?")&&e()},Oe=$=>({confirmed:"bg-green-100 text-green-800",pending:"bg-amber-100 text-amber-800",completed:"bg-blue-100 text-blue-800",cancelled:"bg-red-100 text-red-800"})[$]||"bg-gray-100 text-gray-800",Ze=$=>({confirmed:" ",pending:" ",completed:" ",cancelled:""})[$]||$,Ws=async $=>{const G=typeof $=="object"?$.id||$.docId||$.bookingId:$;if(!window.confirm("  ?"))return;const Me=await qi.updateBookingStatus(G,"confirmed");if(!(Me!=null&&Me.success)){alert("    .");return}m(Ke=>Ke.map(Ge=>Ge.id===G?{...Ge,status:"confirmed"}:Ge)),alert(" .")},xs=$=>{const G=h.find(xe=>xe.id===$);if(!G){alert("    .");return}C(G)},Ps=async $=>{if($.aiDiagnosis){ae({booking:$,diagnosis:$.aiDiagnosis});return}if($.diagnosisId){const G=await Da.getDiagnosisById($.diagnosisId);if(G.success&&G.data){ae({booking:$,diagnosis:G.data});return}}alert("AI   .")},li=$=>{j($),Z("patient")},ci=async $=>{if(!($!=null&&$.id)&&!($!=null&&$.bookingId)){alert("    .");return}try{const G=$.bookingId||$.id,xe=await tr.getResultByBooking(G);if(!xe.success||!xe.data){alert("   .");return}V(xe.data),z(!0)}catch{alert("     .")}},di=async $=>{var G;if(!$.petId){alert("  .");return}j($),Z("history"),Q(!0);try{const xe=$.userId||((G=$.owner)==null?void 0:G.id),Me=xe?Da.getDiagnosesByClinicAndPatient(r.id,xe,$.petId):Da.getDiagnosesByPet($.petId),Ke=tr.getResultsByPet($.petId,t),[Ge,kt]=await Promise.all([Me,Ke]);ce({diagnoses:Ge.success?Ge.data:[],results:kt.success?kt.data:[]})}catch{alert("     .")}finally{Q(!1)}},ui=$=>{D(M===$?null:$)},wn=()=>{const $=new Date(B);$.setMonth($.getMonth()-1),v($),D(null)},fr=()=>{const $=new Date(B);$.setMonth($.getMonth()+1),v($),D(null)},Y=()=>{const $=B.getFullYear(),G=B.getMonth(),xe=new Date($,G,1).getDay(),Me=new Date($,G+1,0).getDate(),Ke={};f.forEach(ge=>{const He=new Date(ge.date);if(He.getMonth()===G&&He.getFullYear()===$){const yt=He.getDate();Ke[yt]=(Ke[yt]||0)+1}});const Ge=new Date,Xt=Ge.getMonth()===G&&Ge.getFullYear()===$?Ge.getDate():null,ve=[];for(let ge=0;ge<xe;ge++)ve.push(i.jsx("div",{className:"aspect-square"},`empty-${ge}`));for(let ge=1;ge<=Me;ge++){const He=Ke[ge]||0,yt=ge===Xt,Zt=ge===M,ys=(xe+ge-1)%7,la=ys===0,ah=ys===6;ve.push(i.jsxs("div",{onClick:()=>He>0&&ui(ge),className:`aspect-square flex flex-col items-center justify-center rounded-xl transition-all cursor-pointer
            ${Zt?"bg-gradient-to-br from-red-300 to-rose-400 text-white shadow-lg scale-105":yt?"bg-white border-2 border-rose-300 shadow-md":He>0?"bg-white/90 shadow-sm hover:shadow-md hover:scale-105":"bg-white/30"}
          `,style:{position:"relative"},children:[i.jsx("div",{className:`text-sm font-bold
            ${Zt?"text-white":yt?"text-rose-500":He>0?"text-gray-900":la?"text-red-400":ah?"text-blue-400":"text-gray-400"}`,children:ge}),He>0&&i.jsx("div",{className:`absolute bottom-1 text-xs px-1.5 py-0.5 rounded-full font-bold shadow-sm
              ${Zt?"bg-white text-rose-500":"bg-gradient-to-r from-red-300 to-rose-400 text-white"}`,children:He})]},ge))}return ve},he=()=>{if(!M)return[];const $=B.getFullYear(),G=B.getMonth();return f.filter(xe=>{const Me=new Date(xe.date);return Me.getDate()===M&&Me.getMonth()===G&&Me.getFullYear()===$}).sort((xe,Me)=>xe.time.localeCompare(Me.time))},de=()=>{const $=B.getFullYear(),G=B.getMonth(),xe=_.filter(ge=>{if(!ge.visitDate)return!1;const He=new Date(ge.visitDate);return He.getMonth()===G&&He.getFullYear()===$}),Me={};xe.forEach(ge=>{var yt;const He=((yt=ge.pet)==null?void 0:yt.species)||ge.species||"other";Me[He]=(Me[He]||0)+1});const Ke={dog:23,cat:18,rabbit:5,hamster:3,bird:2},Ge=xe.length,kt=51,Xt=385e4,ve=Ge===0;return{total:ve?kt:Ge,speciesCount:ve?Ke:Object.keys(Me).length>0?Me:Ke,estimatedRevenue:ve?Xt:Ge*75e3,pendingCount:f.filter(ge=>ge.status==="pending").length,confirmedCount:f.filter(ge=>ge.status==="confirmed").length,isDemo:ve}},ke=async()=>{if(!je.trim()){alert(" .");return}ie(!0);try{const $=await Vs.findUserByEmail(je.trim());if(!$.success||!$.data){alert("      .");return}(await Wg(r.id,$.data.uid,ye)).success?(alert(" ."),Ve(""),dt()):alert("   .")}catch($){console.error("  :",$),alert("   .")}finally{ie(!1)}},dt=async()=>{try{const{getClinicStaff:$}=await Ud(async()=>{const{getClinicStaff:xe}=await Promise.resolve().then(()=>Rv);return{getClinicStaff:xe}},void 0),G=await $(r.id);an(G)}catch($){console.error("   :",$)}};if(O.useEffect(()=>{r!=null&&r.id&&c==="settings"&&dt()},[r==null?void 0:r.id,c]),s)return i.jsx("div",{className:"flex items-center justify-center min-h-screen bg-slate-100",children:i.jsxs("div",{className:"flex flex-col items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-sky-200 border-t-sky-600 rounded-full animate-spin"}),i.jsx("p",{className:"text-gray-600",children:"   ..."})]})});const $e=de(),Rt=h.filter($=>$.status==="confirmed"&&!$.hasResult).length,we=h.filter($=>$.status==="pending").length;return i.jsxs("div",{className:"min-h-screen bg-slate-100",children:[i.jsx("style",{children:`
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
      `}),i.jsx("header",{className:"bg-gradient-to-r from-red-300 to-rose-300 text-white px-4 pt-4 pb-4 shadow-lg",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-full transition-colors",children:i.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),i.jsxs("div",{className:"flex items-center justify-center flex-1",children:[i.jsx("div",{className:"w-9 h-9 bg-white rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:i.jsx("img",{src:"/ai-factory/icon/login/logo.png",alt:"PetMedical.AI",className:"w-6 h-6 object-contain"})}),i.jsxs("div",{className:"text-center ml-2",children:[i.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"PetMedical.AI"}),i.jsx("p",{className:"text-red-100 text-xs font-medium",children:"AI     "})]})]}),i.jsx("button",{onClick:Ne,className:"p-2 hover:bg-white/20 rounded-full transition-colors",title:"",children:i.jsx("span",{className:"material-symbols-outlined",children:"logout"})})]})}),i.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 flex overflow-x-auto shadow-sm",children:[{id:"home",icon:"home",label:""},{id:"today",icon:"today",label:" "},{id:"calendar",icon:"calendar_month",label:" "},{id:"stats",icon:"analytics",label:" "},{id:"settings",icon:"settings",label:" "}].map($=>i.jsxs("button",{onClick:()=>u($.id),className:`flex-1 min-w-[70px] px-3 py-3 text-xs font-medium text-center border-b-2 transition-all
              ${c===$.id?"text-blue-600 border-blue-600 bg-blue-50":"text-gray-600 border-transparent hover:text-gray-900 hover:bg-gray-50"}`,children:[i.jsx("span",{className:"material-symbols-outlined block text-xl mb-1",children:$.icon}),$.label]},$.id))}),i.jsxs("div",{className:"p-4 pb-24",children:[c==="home"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-lg border border-slate-100 relative overflow-hidden mb-4",children:[i.jsxs("div",{className:"relative flex items-stretch gap-4",children:[i.jsx("div",{className:"flex-shrink-0 w-28 h-40 bg-white/80 rounded-2xl shadow-md overflow-hidden border-2 border-white flex items-center justify-center",children:i.jsx("img",{src:"/ai-factory/icon/login/main_hospital.png",alt:" ",className:"w-full h-full object-contain"})}),i.jsxs("div",{className:"flex-1 flex flex-col justify-between py-2",children:[i.jsxs("div",{className:"flex flex-col items-center justify-center text-center w-full",children:[i.jsx("p",{className:"text-xl font-display font-bold text-gray-900 w-full",children:(r==null?void 0:r.name)||" "}),i.jsx("p",{className:"text-lg font-semibold text-rose-500 mt-2 w-full",children:" ."}),i.jsx("p",{className:"text-base text-gray-600 mt-2 w-full",children:"   !"})]}),i.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap mt-3 justify-center",children:[i.jsx("span",{className:"text-[11px] text-rose-700 font-semibold bg-rose-100 px-2.5 py-1 rounded-full border border-rose-200",children:(r==null?void 0:r.staffRole)==="director"?"":(r==null?void 0:r.staffRole)==="vet"?"":(r==null?void 0:r.staffRole)==="nurse"?"":""}),i.jsxs("span",{className:"text-[11px] text-rose-700 font-semibold bg-rose-100 px-2.5 py-1 rounded-full border border-rose-200",children:[" ",Rt,""]}),i.jsxs("span",{className:"text-[11px] text-rose-700 font-semibold bg-rose-100 px-2.5 py-1 rounded-full border border-rose-200",children:[" ",we,""]})]})]})]}),i.jsxs("button",{onClick:()=>{u("today"),w("all")},className:"w-full mt-3 bg-gradient-to-r from-sky-500 to-sky-600 text-white font-bold text-sm py-3 rounded-xl shadow-md hover:shadow-lg transition-all",children:["   ",h.length,"  >"]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[i.jsxs("div",{onClick:()=>{u("today"),w("confirmed")},className:"bg-white rounded-2xl p-4 shadow-lg border border-slate-100 cursor-pointer hover:shadow-xl transition-all active:scale-95",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("span",{className:"material-symbols-outlined text-rose-400",children:"medical_services"}),i.jsx("span",{className:"text-sm font-semibold text-gray-700",children:" "})]}),i.jsx("div",{className:"text-3xl font-bold text-gray-900",children:Rt}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"  "})]}),i.jsxs("div",{onClick:()=>{u("today"),w("pending")},className:"bg-white rounded-2xl p-4 shadow-lg border border-slate-100 cursor-pointer hover:shadow-xl transition-all active:scale-95",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("span",{className:"material-symbols-outlined text-amber-500",children:"pending_actions"}),i.jsx("span",{className:"text-sm font-semibold text-gray-700",children:" "})]}),i.jsx("div",{className:"text-3xl font-bold text-gray-900",children:we}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"  "})]}),i.jsxs("div",{onClick:()=>u("stats"),className:"bg-white rounded-2xl p-4 shadow-lg border border-slate-100 cursor-pointer hover:shadow-xl transition-all active:scale-95",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("span",{className:"material-symbols-outlined text-rose-400",children:"analytics"}),i.jsx("span",{className:"text-sm font-semibold text-gray-700",children:" "})]}),i.jsx("div",{className:"text-3xl font-bold text-gray-900",children:$e.total}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:" "})]}),i.jsxs("div",{onClick:()=>u("calendar"),className:"bg-white rounded-2xl p-4 shadow-lg border border-slate-100 cursor-pointer hover:shadow-xl transition-all active:scale-95",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("span",{className:"material-symbols-outlined text-rose-400",children:"calendar_month"}),i.jsx("span",{className:"text-sm font-semibold text-gray-700",children:" "})]}),i.jsx("div",{className:"text-3xl font-bold text-gray-900",children:f.length}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"  "})]})]}),i.jsxs("button",{onClick:()=>u("settings"),className:"w-full bg-white rounded-2xl p-4 shadow-lg border border-slate-100 flex items-center justify-between hover:shadow-xl transition-all active:scale-[0.99]",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"material-symbols-outlined text-gray-500",children:"settings"}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"text-sm font-semibold text-gray-700",children:" "}),i.jsx("p",{className:"text-xs text-gray-400",children:"    "})]})]}),i.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"chevron_right"})]})]}),c==="today"&&(()=>{const $=N==="all"?h:N==="confirmed"?h.filter(G=>G.status==="confirmed"&&!G.hasResult):h.filter(G=>G.status==="pending");return i.jsxs("div",{children:[i.jsxs("div",{className:"flex gap-2 mb-3",children:[i.jsxs("button",{onClick:()=>w("all"),className:`px-3 py-1.5 rounded-full text-xs font-semibold transition-colors ${N==="all"?"bg-rose-400 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[" (",h.length,")"]}),i.jsxs("button",{onClick:()=>w("confirmed"),className:`px-3 py-1.5 rounded-full text-xs font-semibold transition-colors ${N==="confirmed"?"bg-green-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["  (",h.filter(G=>G.status==="confirmed"&&!G.hasResult).length,")"]}),i.jsxs("button",{onClick:()=>w("pending"),className:`px-3 py-1.5 rounded-full text-xs font-semibold transition-colors ${N==="pending"?"bg-amber-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["  (",h.filter(G=>G.status==="pending").length,")"]})]}),i.jsxs("h2",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[i.jsx("span",{className:"w-2 h-2 bg-rose-400 rounded-full animate-pulse"}),N==="all"?"  ":N==="confirmed"?"  ":"  "," (",$.length,")"]}),$.length===0?i.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-10 text-center shadow-sm",children:[i.jsx("div",{className:"text-6xl mb-3",children:N==="pending"?"":""}),i.jsx("p",{className:"text-gray-400",children:N==="pending"?"    ":"  "}),i.jsx("p",{className:"text-gray-300 text-sm mt-1",children:"    "})]}):i.jsx("div",{className:"space-y-3",children:$.map((G,xe)=>{var Me,Ke,Ge,kt,Xt,ve,ge,He,yt,Zt,ys,la;return i.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 shadow-sm hover:shadow-md transition-shadow",children:[i.jsxs("div",{className:"flex justify-between items-start mb-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-lg font-bold text-gray-900",children:G.time||" "}),(G.aiDiagnosis||G.diagnosisId)&&i.jsxs("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 text-xs font-semibold rounded-full flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"smart_toy"}),"AI"]})]}),i.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${Oe(G.status)}`,children:Ze(G.status)})]}),i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-rose-100 to-pink-100 overflow-hidden border-2 border-rose-200",children:i.jsx("img",{src:((Me=G.pet)==null?void 0:Me.profileImage)||Is(G.pet||{species:((Ke=G.pet)==null?void 0:Ke.species)||"dog"},!1),alt:((Ge=G.pet)==null?void 0:Ge.name)||"",className:"w-full h-full object-cover"})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("h3",{className:"text-sm font-semibold text-gray-900",children:[((kt=G.pet)==null?void 0:kt.name)||"",i.jsxs("span",{className:"text-gray-500 font-normal ml-1",children:["(",cm[(Xt=G.pet)==null?void 0:Xt.species]||"",", ",Lv((ve=G.pet)==null?void 0:ve.age),")"]}),((ge=G.pet)==null?void 0:ge.sex)&&i.jsx("span",{className:"ml-1",children:eM(G.pet.sex)})]}),i.jsxs("p",{className:"text-sm text-gray-600",children:[": ",((He=G.owner)==null?void 0:He.displayName)||((yt=G.owner)==null?void 0:yt.name)||"  "]}),((Zt=G.owner)==null?void 0:Zt.phone)&&i.jsx("p",{className:"text-xs text-gray-400",children:G.owner.phone})]})]}),i.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg mb-3",children:[i.jsx("div",{className:"text-xs text-gray-500 mb-1",children:" "}),i.jsx("div",{className:"text-sm text-gray-900",children:((ys=G.aiDiagnosis)==null?void 0:ys.diagnosis)||((la=G.aiDiagnosis)==null?void 0:la.mainDiagnosis)||G.symptom||" "})]}),i.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[i.jsxs("button",{onClick:()=>li(G),className:"p-2 bg-rose-50 border border-rose-200 rounded-lg text-xs font-medium text-rose-700 hover:bg-rose-100 transition-colors flex flex-col items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"pets"}),""]}),i.jsxs("button",{onClick:()=>Ps(G),disabled:!G.aiDiagnosis&&!G.diagnosisId,className:`p-2 border rounded-lg text-xs font-medium flex flex-col items-center gap-1 transition-colors
                          ${G.aiDiagnosis||G.diagnosisId?"bg-emerald-50 border-emerald-200 text-emerald-700 hover:bg-emerald-100":"bg-gray-50 border-gray-200 text-gray-400 cursor-not-allowed"}`,children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"description"}),"AI"]}),i.jsxs("button",{onClick:()=>di(G),className:"p-2 bg-blue-50 border border-blue-200 rounded-lg text-xs font-medium text-blue-700 hover:bg-blue-100 transition-colors flex flex-col items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"history"}),""]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[G.status==="pending"&&i.jsxs(i.Fragment,{children:[i.jsxs("button",{onClick:()=>Ws(G),className:"py-2.5 rounded-lg text-sm font-semibold bg-blue-600 text-white hover:bg-blue-700 transition-colors flex items-center justify-center gap-1.5",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"check_circle"})," "]}),i.jsxs("button",{disabled:!0,className:"py-2.5 bg-gray-200 text-gray-500 rounded-lg text-sm font-semibold cursor-not-allowed flex items-center justify-center gap-1.5",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"play_arrow"})," "]})]}),G.status==="confirmed"&&!G.hasResult&&i.jsxs(i.Fragment,{children:[i.jsxs("button",{disabled:!0,className:"py-2.5 bg-green-100 text-green-700 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"check"})," "]}),i.jsxs("button",{onClick:()=>xs(G.id),className:"py-2.5 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-1.5",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"edit_note"})," "]})]}),G.status==="confirmed"&&G.hasResult&&!G.sharedToGuardian&&i.jsxs(i.Fragment,{children:[i.jsxs("button",{onClick:()=>ci(G),className:"py-2.5 bg-gray-100 text-gray-700 rounded-lg text-sm font-semibold hover:bg-gray-200 transition-colors flex items-center justify-center gap-1.5",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"visibility"})," "]}),i.jsxs("button",{onClick:()=>xs(G.id),className:"py-2.5 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-1.5",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"send"})," "]})]}),(G.status==="completed"||G.sharedToGuardian)&&i.jsxs(i.Fragment,{children:[i.jsxs("button",{onClick:()=>ci(G),className:"py-2.5 bg-gray-100 text-gray-700 rounded-lg text-sm font-semibold hover:bg-gray-200 transition-colors flex items-center justify-center gap-1.5",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"description"})," "]}),i.jsxs("div",{className:"py-2.5 bg-blue-100 text-blue-800 rounded-lg text-sm font-semibold flex items-center justify-center gap-1.5",children:[i.jsx("span",{className:"material-symbols-outlined text-lg",children:"check_circle"})," "]})]})]})]},G.id||xe)})})]})})(),c==="calendar"&&i.jsxs("div",{children:[i.jsxs("div",{className:"bg-gradient-to-br from-rose-50 to-pink-50 rounded-3xl p-6 mb-4 shadow-md border border-rose-100",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("button",{onClick:wn,className:"bg-white p-2 rounded-lg shadow-sm hover:bg-rose-50 transition-colors",children:i.jsx("span",{className:"material-symbols-outlined text-rose-500",children:"chevron_left"})}),i.jsxs("div",{className:"text-center",children:[i.jsxs("h2",{className:"text-xl font-bold text-rose-900",children:[B.getFullYear()," ",B.getMonth()+1,""]}),i.jsx("p",{className:"text-xs text-rose-500 mt-1",children:" "})]}),i.jsx("button",{onClick:fr,className:"bg-white p-2 rounded-lg shadow-sm hover:bg-rose-50 transition-colors",children:i.jsx("span",{className:"material-symbols-outlined text-rose-500",children:"chevron_right"})})]}),i.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["","","","","","",""].map(($,G)=>i.jsx("div",{className:`text-center text-sm font-bold py-2 ${G===0?"text-red-500":G===6?"text-blue-500":"text-rose-800"}`,children:$},$))}),i.jsx("div",{className:"grid grid-cols-7 gap-1",children:Y()})]}),M&&i.jsxs("div",{className:"bg-white border-2 border-rose-300 rounded-2xl p-5 mb-4 shadow-lg",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[i.jsxs("span",{className:"bg-gradient-to-r from-red-300 to-rose-400 text-white px-3 py-1 rounded-lg",children:[M,""]})," "]}),i.jsx("button",{onClick:()=>D(null),className:"bg-gray-100 p-2 rounded-lg hover:bg-gray-200 transition-colors",children:i.jsx("span",{className:"material-symbols-outlined text-xl text-gray-600",children:"close"})})]}),i.jsx("div",{className:"space-y-3",children:he().length===0?i.jsxs("div",{className:"text-center py-8 text-gray-400",children:[i.jsx("span",{className:"material-symbols-outlined text-4xl block mb-2",children:"event_busy"})," "]}):he().map(($,G)=>{var xe,Me,Ke,Ge;return i.jsxs("div",{onClick:()=>li($),className:`p-4 rounded-xl border transition-all hover:shadow-md cursor-pointer
                          ${$.status==="confirmed"?"bg-green-50 border-green-200":$.status==="completed"?"bg-blue-50 border-blue-200":"bg-amber-50 border-amber-200"}`,children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("span",{className:"font-bold text-gray-900",children:$.time}),i.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold text-white
                            ${$.status==="confirmed"?"bg-green-500":$.status==="completed"?"bg-blue-500":"bg-amber-500"}`,children:Ze($.status)})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("img",{src:Is($.pet||{species:"dog"},!1),alt:(xe=$.pet)==null?void 0:xe.name,className:"w-8 h-8 rounded-full object-cover"}),i.jsxs("div",{className:"text-sm",children:[i.jsx("span",{className:"font-semibold text-gray-900",children:((Me=$.pet)==null?void 0:Me.name)||""}),i.jsxs("span",{className:"text-gray-500",children:["  ",((Ke=$.owner)==null?void 0:Ke.displayName)||((Ge=$.owner)==null?void 0:Ge.name)||""]})]})]}),($.aiDiagnosis||$.diagnosisId)&&i.jsxs("div",{className:"mt-2 text-xs text-emerald-600 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"smart_toy"}),"AI  "]})]},G)})})]}),!M&&i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm text-center text-gray-500 text-sm",children:[i.jsx("span",{className:"material-symbols-outlined text-2xl block mb-1 text-rose-300",children:"touch_app"}),"      "]})]}),c==="stats"&&i.jsxs("div",{children:[i.jsxs("h2",{className:"font-bold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-rose-400",children:"analytics"}),B.getMonth()+1,"  "]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[i.jsxs("div",{className:"bg-gradient-to-br from-red-300 to-rose-400 text-white p-4 rounded-2xl shadow-lg",children:[i.jsx("div",{className:"text-3xl font-bold",children:$e.total}),i.jsx("div",{className:"text-red-100 text-sm",children:"  "})]}),i.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-500 text-white p-4 rounded-2xl shadow-lg",children:[i.jsxs("div",{className:"text-3xl font-bold",children:[$e.estimatedRevenue.toLocaleString(),""]}),i.jsx("div",{className:"text-blue-100 text-sm",children:" "})]})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm mb-4",children:[i.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-amber-500",children:"event_note"})," "]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{className:"bg-amber-50 p-3 rounded-xl text-center border border-amber-200",children:[i.jsx("div",{className:"text-2xl font-bold text-amber-600",children:$e.pendingCount}),i.jsx("div",{className:"text-xs text-amber-700",children:" "})]}),i.jsxs("div",{className:"bg-green-50 p-3 rounded-xl text-center border border-green-200",children:[i.jsx("div",{className:"text-2xl font-bold text-green-600",children:$e.confirmedCount}),i.jsx("div",{className:"text-xs text-green-700",children:""})]})]})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[i.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-rose-400",children:"pets"}),"  "]}),Object.keys($e.speciesCount).length===0?i.jsxs("div",{className:"text-center py-6 text-gray-400",children:[i.jsx("span",{className:"material-symbols-outlined text-3xl block mb-2",children:"bar_chart"}),"    "]}):i.jsx("div",{className:"space-y-2",children:Object.entries($e.speciesCount).sort(($,G)=>G[1]-$[1]).map(([$,G])=>i.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[i.jsx("span",{className:"text-gray-700 font-medium",children:cm[$]||""}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-gradient-to-r from-red-300 to-rose-400 rounded-full",style:{width:`${G/$e.total*100}%`}})}),i.jsx("span",{className:"font-bold text-rose-500 w-8 text-right",children:G})]})]},$))})]})]}),c==="settings"&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"font-bold text-gray-900 mb-3 flex items-center justify-between",children:[i.jsxs("span",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-rose-400",children:"local_hospital"})," "]}),!K&&i.jsx("button",{className:"px-3 py-1.5 text-xs rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors",onClick:()=>{W({name:(r==null?void 0:r.name)||"",address:(r==null?void 0:r.address)||"",phone:(r==null?void 0:r.phone)||""}),I(!0)},children:""})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm space-y-3",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-xs font-semibold text-gray-500 mb-1",children:""}),K?i.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(L==null?void 0:L.name)||"",onChange:$=>W(G=>({...G,name:$.target.value}))}):i.jsx("div",{className:"text-sm text-gray-900 font-medium",children:r==null?void 0:r.name})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-xs font-semibold text-gray-500 mb-1",children:" "}),i.jsx("div",{className:"text-sm text-gray-600",children:(r==null?void 0:r.staffRole)==="director"?"":(r==null?void 0:r.staffRole)==="vet"?"":(r==null?void 0:r.staffRole)==="nurse"?"":""})]})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-xs font-semibold text-gray-500 mb-1",children:""}),K?i.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:2,value:(L==null?void 0:L.address)||"",onChange:$=>W(G=>({...G,address:$.target.value}))}):i.jsx("div",{className:"text-sm text-gray-600",children:(r==null?void 0:r.address)||"  "})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-xs font-semibold text-gray-500 mb-1",children:""}),K?i.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(L==null?void 0:L.phone)||"",onChange:$=>W(G=>({...G,phone:$.target.value}))}):i.jsx("div",{className:"text-sm text-gray-600",children:(r==null?void 0:r.phone)||"  "})]}),K&&i.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[i.jsx("button",{className:"px-4 py-2 text-sm rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>{W(null),I(!1)},children:""}),i.jsx("button",{className:"px-4 py-2 text-sm rounded-lg bg-blue-600 text-white hover:bg-blue-700",onClick:async()=>{if(r!=null&&r.id)try{const{updateClinicInfo:$}=await Ud(async()=>{const{updateClinicInfo:xe}=await Promise.resolve().then(()=>Rv);return{updateClinicInfo:xe}},void 0),G=await $(r.id,L);if(!(G!=null&&G.success)){alert("   .");return}a(xe=>({...xe,...L})),I(!1),alert("  .")}catch{alert("   .")}},children:""})]})]})]}),i.jsxs("div",{children:[i.jsxs("h2",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined text-rose-400",children:"group"})," "]}),i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[i.jsxs("div",{className:"mb-4",children:[i.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:" "}),Qe.length===0?i.jsx("div",{className:"text-center py-3 text-gray-400 text-sm bg-gray-50 rounded-lg",children:"  "}):i.jsx("div",{className:"space-y-2",children:Qe.map($=>{var G,xe,Me;return i.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2.5 rounded-lg",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-medium text-gray-900",children:((G=$.user)==null?void 0:G.displayName)||((xe=$.user)==null?void 0:xe.email)||" "}),i.jsx("div",{className:"text-xs text-gray-500",children:(Me=$.user)==null?void 0:Me.email})]}),i.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-semibold
                            ${$.role==="director"?"bg-rose-100 text-rose-700":$.role==="vet"?"bg-blue-100 text-blue-700":$.role==="nurse"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:$.role==="director"?"":$.role==="vet"?"":$.role==="nurse"?"":""})]},$.id)})})]}),i.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[i.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"  "}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{type:"email",className:"flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:" ",value:je,onChange:$=>Ve($.target.value)}),i.jsxs("select",{className:"border border-gray-300 rounded-lg px-2 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:ye,onChange:$=>ht($.target.value),children:[i.jsx("option",{value:"vet",children:""}),i.jsx("option",{value:"nurse",children:""}),i.jsx("option",{value:"staff",children:""})]}),i.jsx("button",{onClick:ke,disabled:jt,className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50",children:jt?"...":""})]})]})]})]})]})]}),E&&i.jsx(Z6,{booking:E,clinic:r,onClose:()=>C(null),onSaved:()=>Ce(),onShared:()=>{C(null),Ce()}}),re==="patient"&&P&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md max-h-[85vh] overflow-y-auto",children:[i.jsx("div",{className:"bg-gradient-to-r from-red-300 to-rose-400 text-white p-4 rounded-t-2xl",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h3",{className:"font-bold text-lg",children:" "}),i.jsx("button",{onClick:()=>{Z(null),j(null)},className:"p-1 hover:bg-white/20 rounded-full",children:i.jsx("span",{className:"material-symbols-outlined",children:"close"})})]})}),i.jsxs("div",{className:"p-4 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden border-4 border-rose-100",children:i.jsx("img",{src:(($t=P.pet)==null?void 0:$t.profileImage)||Is(P.pet||{species:"dog"},!1),alt:(Rs=P.pet)==null?void 0:Rs.name,className:"w-full h-full object-cover"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-xl font-bold text-gray-900",children:((_n=P.pet)==null?void 0:_n.name)||""}),i.jsxs("p",{className:"text-gray-600",children:[cm[(Bn=P.pet)==null?void 0:Bn.species]||"","  ",((Nn=P.pet)==null?void 0:Nn.breed)||" "]})]})]}),i.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 space-y-2",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-500",children:""}),i.jsx("span",{className:"font-medium",children:Lv((Ks=P.pet)==null?void 0:Ks.age)})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-500",children:""}),i.jsx("span",{className:"font-medium",children:((ic=P.pet)==null?void 0:ic.sex)==="M"?"":((ac=P.pet)==null?void 0:ac.sex)==="F"?"":""})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-500",children:""}),i.jsx("span",{className:"font-medium",children:(hi=P.pet)!=null&&hi.weight?`${P.pet.weight}kg`:""})]})]}),i.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[i.jsxs("h5",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"person"})," "]}),i.jsxs("div",{className:"space-y-1 text-sm",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-blue-700",children:""}),i.jsx("span",{className:"font-medium text-blue-900",children:((uo=P.owner)==null?void 0:uo.displayName)||((ho=P.owner)==null?void 0:ho.name)||"  "})]}),((ta=P.owner)==null?void 0:ta.phone)&&i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-blue-700",children:""}),i.jsx("a",{href:`tel:${P.owner.phone}`,className:"font-medium text-blue-900 underline",children:P.owner.phone})]}),((pr=P.owner)==null?void 0:pr.email)&&i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-blue-700",children:""}),i.jsx("span",{className:"font-medium text-blue-900",children:P.owner.email})]})]})]}),i.jsxs("div",{className:"bg-amber-50 rounded-xl p-4",children:[i.jsxs("h5",{className:"font-semibold text-amber-900 mb-2 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"event"})," "]}),i.jsxs("div",{className:"space-y-1 text-sm",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-amber-700",children:""}),i.jsxs("span",{className:"font-medium text-amber-900",children:[P.date," ",P.time]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-amber-700",children:"/"}),i.jsx("span",{className:"font-medium text-amber-900",children:P.symptom||P.message||""})]})]})]}),(P.aiDiagnosis||P.diagnosisId)&&i.jsxs("div",{className:"bg-emerald-50 rounded-xl p-4",children:[i.jsxs("h5",{className:"font-semibold text-emerald-900 mb-2 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-sm",children:"smart_toy"}),"AI  "]}),i.jsxs("div",{className:"text-sm text-emerald-800",children:[i.jsx("p",{className:"font-medium",children:((oc=P.aiDiagnosis)==null?void 0:oc.diagnosis)||((on=P.aiDiagnosis)==null?void 0:on.mainDiagnosis)||" "}),((mo=P.aiDiagnosis)==null?void 0:mo.description)&&i.jsx("p",{className:"mt-1 text-emerald-700 line-clamp-3",children:P.aiDiagnosis.description})]}),i.jsxs("button",{onClick:()=>{Z(null),Ps(P)},className:"mt-2 text-sm text-emerald-600 font-medium flex items-center gap-1",children:["AI  ",i.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_forward"})]})]})]})]})}),q&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md max-h-[85vh] overflow-y-auto",children:[i.jsxs("div",{className:"bg-gradient-to-r from-emerald-500 to-teal-500 text-white p-4 rounded-t-2xl",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2",children:[i.jsx("span",{className:"material-symbols-outlined",children:"smart_toy"}),"AI "]}),i.jsx("button",{onClick:()=>ae(null),className:"p-1 hover:bg-white/20 rounded-full",children:i.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),i.jsx("p",{className:"text-emerald-100 text-sm mt-1",children:"  AI  "})]}),i.jsxs("div",{className:"p-4 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 p-3 rounded-xl",children:[i.jsx("img",{src:Is(((fo=q.booking)==null?void 0:fo.pet)||{species:"dog"},!1),alt:"pet",className:"w-12 h-12 rounded-full object-cover"}),i.jsxs("div",{children:[i.jsx("div",{className:"font-bold text-gray-900",children:((na=(sa=q.booking)==null?void 0:sa.pet)==null?void 0:na.name)||""}),i.jsxs("div",{className:"text-sm text-gray-500",children:[((lc=(po=q.booking)==null?void 0:po.owner)==null?void 0:lc.displayName)||""," "]})]})]}),i.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-xl p-4",children:[i.jsx("div",{className:"text-sm text-emerald-600 mb-1",children:" "}),i.jsx("div",{className:"text-lg font-bold text-emerald-900",children:((go=q.diagnosis)==null?void 0:go.diagnosis)||((cc=q.diagnosis)==null?void 0:cc.mainDiagnosis)||" "})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{className:`p-3 rounded-xl text-center
                  ${((mi=q.diagnosis)==null?void 0:mi.emergency)==="high"?"bg-red-100":((xo=q.diagnosis)==null?void 0:xo.emergency)==="medium"?"bg-amber-100":"bg-green-100"}`,children:[i.jsx("div",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsx("div",{className:`font-bold
                    ${((ra=q.diagnosis)==null?void 0:ra.emergency)==="high"?"text-red-700":((gr=q.diagnosis)==null?void 0:gr.emergency)==="medium"?"text-amber-700":"text-green-700"}`,children:((jn=q.diagnosis)==null?void 0:jn.emergency)==="high"?"":((ia=q.diagnosis)==null?void 0:ia.emergency)==="medium"?"":""})]}),i.jsxs("div",{className:"bg-blue-100 p-3 rounded-xl text-center",children:[i.jsx("div",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsxs("div",{className:"font-bold text-blue-700",children:[Math.round((((dc=q.diagnosis)==null?void 0:dc.probability)||((yo=q.diagnosis)==null?void 0:yo.confidence)||.7)*100),"%"]})]})]}),((vo=q.diagnosis)==null?void 0:vo.description)&&i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:" "}),i.jsx("div",{className:"bg-gray-50 p-3 rounded-xl text-sm text-gray-700",children:q.diagnosis.description})]}),((aa=(bo=q.diagnosis)==null?void 0:bo.actions)==null?void 0:aa.length)>0&&i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:" "}),i.jsx("div",{className:"space-y-2",children:q.diagnosis.actions.map(($,G)=>i.jsxs("div",{className:"flex items-start gap-2 bg-gray-50 p-3 rounded-lg",children:[i.jsx("span",{className:"w-5 h-5 bg-emerald-500 text-white text-xs rounded-full flex items-center justify-center flex-shrink-0",children:G+1}),i.jsx("span",{className:"text-sm text-gray-700",children:$})]},G))})]}),((oa=q.diagnosis)==null?void 0:oa.symptom)&&i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:"  "}),i.jsx("div",{className:"bg-gray-50 p-3 rounded-xl text-sm text-gray-700",children:q.diagnosis.symptom})]})]})]})}),re==="history"&&P&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md max-h-[85vh] overflow-y-auto",children:[i.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-500 text-white p-4 rounded-t-2xl",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("h3",{className:"font-bold text-lg",children:[((wo=P.pet)==null?void 0:wo.name)||"","  "]}),i.jsx("button",{onClick:()=>{Z(null),j(null)},className:"p-1 hover:bg-white/20 rounded-full",children:i.jsx("span",{className:"material-symbols-outlined",children:"close"})})]})}),i.jsx("div",{className:"p-4",children:F?i.jsxs("div",{className:"py-10 text-center text-gray-400",children:[i.jsx("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-2"})," ..."]}):i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-emerald-500 text-lg",children:"smart_toy"}),"AI  "]}),le.diagnoses.length===0?i.jsx("div",{className:"text-sm text-gray-400 bg-gray-50 p-3 rounded-lg",children:" "}):i.jsx("div",{className:"space-y-2",children:le.diagnoses.slice(0,5).map($=>{var G;return i.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 p-3 rounded-lg",children:[i.jsx("div",{className:"text-xs text-emerald-600 mb-1",children:(G=$.createdAt)!=null&&G.toDate?new Date($.createdAt.toDate()).toLocaleDateString("ko-KR"):$.createdAt}),i.jsx("div",{className:"font-semibold text-emerald-900",children:$.diagnosis}),$.symptom&&i.jsx("div",{className:"text-sm text-emerald-700 mt-1",children:$.symptom})]},$.id)})})]}),i.jsxs("div",{children:[i.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-1",children:[i.jsx("span",{className:"material-symbols-outlined text-rose-400 text-lg",children:"local_hospital"}),"  "]}),le.results.length===0?i.jsx("div",{className:"text-sm text-gray-400 bg-gray-50 p-3 rounded-lg",children:" "}):i.jsx("div",{className:"space-y-2",children:le.results.slice(0,5).map($=>{var G;return i.jsxs("div",{className:"bg-rose-50 border border-rose-200 p-3 rounded-lg",children:[i.jsxs("div",{className:"text-xs text-rose-500 mb-1",children:[$.visitDate," ",$.visitTime]}),i.jsx("div",{className:"font-semibold text-rose-900",children:$.mainDiagnosis||$.diagnosis}),((G=$.soap)==null?void 0:G.assessment)&&i.jsx("div",{className:"text-sm text-rose-700 mt-1 line-clamp-2",children:$.soap.assessment})]},$.id)})})]})]})})]})}),J&&b&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md max-h-[85vh] overflow-y-auto",children:[i.jsxs("div",{className:"bg-gradient-to-r from-red-300 to-rose-400 text-white p-4 rounded-t-2xl",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h3",{className:"font-bold text-lg",children:" "}),i.jsx("button",{onClick:()=>{z(!1),V(null)},className:"p-1 hover:bg-white/20 rounded-full",children:i.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),i.jsxs("p",{className:"text-red-100 text-sm",children:[b.visitDate," ",b.visitTime]})]}),i.jsxs("div",{className:"p-4 space-y-4",children:[i.jsxs("div",{className:"bg-rose-50 border border-rose-200 rounded-xl p-4",children:[i.jsx("div",{className:"text-sm text-rose-500 mb-1",children:" "}),i.jsx("div",{className:"text-lg font-bold text-rose-900",children:b.mainDiagnosis||b.diagnosis||" "})]}),i.jsxs("div",{className:"bg-amber-50 p-3 rounded-xl text-center",children:[i.jsx("div",{className:"text-xs text-amber-600",children:"Triage "}),i.jsxs("div",{className:"text-2xl font-bold text-amber-700",children:[b.triageScore??"-","/5"]})]}),b.soap&&i.jsxs("div",{className:"space-y-3",children:[b.soap.subjective&&i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Subjective ( )"}),i.jsx("div",{className:"bg-gray-50 p-3 rounded-lg text-sm text-gray-700",children:b.soap.subjective})]}),b.soap.objective&&i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Objective ( )"}),i.jsx("div",{className:"bg-gray-50 p-3 rounded-lg text-sm text-gray-700",children:b.soap.objective})]}),b.soap.assessment&&i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Assessment ()"}),i.jsx("div",{className:"bg-gray-50 p-3 rounded-lg text-sm text-gray-700",children:b.soap.assessment})]}),b.soap.plan&&i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Plan ( )"}),i.jsx("div",{className:"bg-gray-50 p-3 rounded-lg text-sm text-gray-700",children:b.soap.plan})]})]})]})]})})]})}function nM(){const t=[],e=new Date;for(let s=6;s>=0;s--){const n=new Date(e);n.setDate(n.getDate()-s);const r=n.toISOString().slice(0,10),a=Math.random();t.push({date:r,mealCount:a>.3?2:1,waterCount:Math.floor(2+Math.random()*3),walkCount:a>.5?2:1,poopCount:a>.4?2:1,weight:(5.2+Math.random()*.3).toFixed(1),note:s===3?"   ":s===1?" ":"",mood:a>.6?"happy":a>.3?"normal":"tired"})}return t}function rM({petData:t,onBack:e,onHome:s}){const[n,r]=O.useState([]),[a,o]=O.useState(null),[l,c]=O.useState(!0),[u,h]=O.useState(!1);O.useEffect(()=>{t&&m()},[t]);const m=async()=>{c(!0);let _=xj(t.id,7);!_||_.length<2?(_=nM(),h(!0)):h(!1),r(_);try{const S=await x6(t,7);o(S||f(_,t))}catch(S){console.error("AI  :",S),o(f(_))}c(!1)},f=(_,S)=>{const R=_.reduce((D,B)=>D+(B.mealCount||0),0)/_.length,k=_.reduce((D,B)=>D+(B.walkCount||0),0)/_.length,x=_.reduce((D,B)=>D+(B.poopCount||0),0)/_.length,A=[],M=[];return R<1.5&&(A.push("  ."),M.push("    .")),k<1&&(A.push("  ."),M.push(" .")),x>3&&(A.push("  ."),M.push("  .")),A.length===0&&(A.push("    ."),M.push("   .")),{earIssue:!1,digestionIssue:x>3,skinIssue:!1,energyLevel:Math.min(1,Math.max(.3,k/2)),fever:!1,patterns:A,predictions:M,risk_changes:{description:"    .",trend:"stable"}}},y=()=>{!t||!u||(n.forEach(_=>{H3(t.id,_)}),h(!1),alert("  !"))};return l?i.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-5xl mb-4 animate-bounce",children:""}),i.jsx("p",{className:"text-slate-600",children:"7    ..."})]})}):i.jsxs("div",{className:"min-h-screen bg-slate-50 pb-24",children:[i.jsxs("div",{className:"bg-gradient-to-r from-violet-500 to-purple-600 text-white px-4 py-6",children:[i.jsx("div",{className:"flex items-center gap-3 mb-4",children:i.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-lg hover:bg-white/10",children:" "})}),i.jsx("h1",{className:"text-xl font-bold",children:"AI   "}),i.jsxs("p",{className:"text-white/80 text-sm mt-1",children:[(t==null?void 0:t.petName)||(t==null?void 0:t.name)," 7   "]})]}),i.jsxs("div",{className:"p-4 space-y-4",children:[u&&i.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-bold text-amber-800 mb-1",children:"   "}),i.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"        .       !"}),i.jsx("button",{onClick:y,className:"text-sm bg-amber-500 text-white px-3 py-1.5 rounded-lg hover:bg-amber-600",children:"  "})]})]})}),i.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-slate-100",children:[i.jsxs("h2",{className:"font-bold text-slate-800 mb-4 flex items-center gap-2",children:[i.jsx("span",{className:"text-xl",children:""})," 7  "]}),i.jsx("div",{className:"space-y-2",children:n.map((_,S)=>i.jsxs("div",{className:"flex items-center gap-3 py-2 border-b border-slate-100 last:border-0",children:[i.jsx("span",{className:"text-xs text-slate-400 w-20",children:_.date}),i.jsxs("div",{className:"flex-1 flex gap-3 text-sm",children:[i.jsxs("span",{children:[" ",_.mealCount||0]}),i.jsxs("span",{children:[" ",_.waterCount||0]}),i.jsxs("span",{children:[" ",_.walkCount||0]}),i.jsxs("span",{children:[" ",_.poopCount||0]}),_.weight&&i.jsxs("span",{className:"text-slate-500",children:[" ",_.weight,"kg"]})]})]},S))})]}),a&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-slate-100",children:[i.jsxs("h2",{className:"font-bold text-slate-800 mb-4 flex items-center gap-2",children:[i.jsx("span",{className:"text-xl",children:""}),"  "]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx("div",{className:`p-3 rounded-xl ${a.digestionIssue?"bg-red-50 border border-red-200":"bg-green-50 border border-green-200"}`,children:i.jsx("span",{className:"text-sm",children:a.digestionIssue?"  ":"  "})}),i.jsx("div",{className:`p-3 rounded-xl ${a.skinIssue?"bg-red-50 border border-red-200":"bg-green-50 border border-green-200"}`,children:i.jsx("span",{className:"text-sm",children:a.skinIssue?"  ":"  "})}),i.jsx("div",{className:`p-3 rounded-xl ${a.earIssue?"bg-red-50 border border-red-200":"bg-green-50 border border-green-200"}`,children:i.jsx("span",{className:"text-sm",children:a.earIssue?"  ":"  "})}),i.jsx("div",{className:`p-3 rounded-xl ${a.fever?"bg-red-50 border border-red-200":"bg-green-50 border border-green-200"}`,children:i.jsx("span",{className:"text-sm",children:a.fever?"  ":"  "})})]}),i.jsxs("div",{className:"mt-4",children:[i.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[i.jsx("span",{className:"text-slate-600",children:" "}),i.jsxs("span",{className:"font-medium",children:[Math.round((a.energyLevel||.5)*100),"%"]})]}),i.jsx("div",{className:"w-full bg-slate-200 rounded-full h-3",children:i.jsx("div",{className:`h-3 rounded-full transition-all ${(a.energyLevel||.5)>.7?"bg-green-500":(a.energyLevel||.5)>.4?"bg-yellow-500":"bg-red-500"}`,style:{width:`${(a.energyLevel||.5)*100}%`}})})]})]}),a.patterns&&a.patterns.length>0&&i.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-slate-100",children:[i.jsxs("h2",{className:"font-bold text-slate-800 mb-4 flex items-center gap-2",children:[i.jsx("span",{className:"text-xl",children:""})," "]}),i.jsx("ul",{className:"space-y-2",children:a.patterns.map((_,S)=>i.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-700",children:[i.jsx("span",{className:"text-violet-500",children:""}),_]},S))})]}),a.predictions&&a.predictions.length>0&&i.jsxs("div",{className:"bg-gradient-to-br from-violet-50 to-purple-50 rounded-2xl p-5 border border-violet-100",children:[i.jsxs("h2",{className:"font-bold text-violet-800 mb-4 flex items-center gap-2",children:[i.jsx("span",{className:"text-xl",children:""}),"AI "]}),i.jsx("ul",{className:"space-y-2",children:a.predictions.map((_,S)=>i.jsxs("li",{className:"flex items-start gap-2 text-sm text-violet-700",children:[i.jsx("span",{className:"text-violet-500",children:""}),_]},S))})]}),a.risk_changes&&i.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-slate-100",children:[i.jsxs("h2",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[i.jsx("span",{className:"text-xl",children:""})," "]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:`px-3 py-1.5 rounded-full text-sm font-medium ${a.risk_changes.trend==="up"?"bg-red-100 text-red-700":a.risk_changes.trend==="down"?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700"}`,children:a.risk_changes.trend==="up"?" ":a.risk_changes.trend==="down"?" ":" "}),i.jsx("span",{className:"text-sm text-slate-600",children:a.risk_changes.description})]})]})]}),i.jsx("button",{onClick:m,className:"w-full py-3 bg-violet-500 hover:bg-violet-600 text-white font-bold rounded-xl transition-colors",children:" "})]})]})}const Rj=[{species_code:"dog",species_label_ko:"",department_code:"dermatology",department_label_ko:"",symptom_tag:"itching",symptom_label_ko:"",question_ko:"     ?",answer_ko:"    , ,      .      1~2    .",keywords:["","","",""]},{species_code:"dog",species_label_ko:"",department_code:"dermatology",department_label_ko:"",symptom_tag:"hair_loss",symptom_label_ko:"",question_ko:"       ?",answer_ko:"   , ,        .         .",keywords:["","","",""]},{species_code:"dog",species_label_ko:"",department_code:"dermatology",department_label_ko:"",symptom_tag:"bump",symptom_label_ko:"/",question_ko:"   . ?",answer_ko:"   . , ,    .   , ,    .",keywords:["","","",""]},{species_code:"dog",species_label_ko:"",department_code:"internal_medicine",department_label_ko:"",symptom_tag:"vomiting",symptom_label_ko:"",question_ko:"     . ?",answer_ko:"         .             .",keywords:["","","",""]},{species_code:"dog",species_label_ko:"",department_code:"internal_medicine",department_label_ko:"",symptom_tag:"diarrhea",symptom_label_ko:"",question_ko:"   .   ?",answer_ko:"            .  2   ,     .",keywords:[""," ","",""]},{species_code:"dog",species_label_ko:"",department_code:"internal_medicine",department_label_ko:"",symptom_tag:"no_appetite",symptom_label_ko:"",question_ko:"   .    .",answer_ko:"1~2     , 3           .      .",keywords:[""," ","",""]},{species_code:"dog",species_label_ko:"",department_code:"ophthalmology",department_label_ko:"",symptom_tag:"eye_discharge",symptom_label_ko:"/",question_ko:"      ?",answer_ko:"        ,         .     .",keywords:["","","",""]},{species_code:"dog",species_label_ko:"",department_code:"ophthalmology",department_label_ko:"",symptom_tag:"red_eye",symptom_label_ko:"",question_ko:"  .   ?",answer_ko:"  ,  ,     .           .",keywords:[" ",""," "]},{species_code:"dog",species_label_ko:"",department_code:"orthopedics",department_label_ko:"",symptom_tag:"limping",symptom_label_ko:"",question_ko:"   .   ?",answer_ko:"  , ,      .         .",keywords:["","","",""]},{species_code:"cat",species_label_ko:"",department_code:"urology",department_label_ko:"",symptom_tag:"urination_issue",symptom_label_ko:" ",question_ko:"       .",answer_ko:"      .        . 24     .",keywords:["","","",""]},{species_code:"cat",species_label_ko:"",department_code:"urology",department_label_ko:"",symptom_tag:"blood_in_urine",symptom_label_ko:"",question_ko:"    . ?",answer_ko:" , ,     .        .    .",keywords:["",""," "]},{species_code:"cat",species_label_ko:"",department_code:"internal_medicine",department_label_ko:"",symptom_tag:"vomiting",symptom_label_ko:"",question_ko:"  . ?",answer_ko:"     ,             .    .",keywords:["","",""]},{species_code:"cat",species_label_ko:"",department_code:"internal_medicine",department_label_ko:"",symptom_tag:"weight_loss",symptom_label_ko:" ",question_ko:"    .  ?",answer_ko:"      , ,       .     .",keywords:["","","",""]},{species_code:"cat",species_label_ko:"",department_code:"dermatology",department_label_ko:"",symptom_tag:"over_grooming",symptom_label_ko:" ",question_ko:"       .",answer_ko:"  , ,      .        .",keywords:["",""," "]},{species_code:"all",species_label_ko:" ",department_code:"preventive",department_label_ko:"",symptom_tag:"vaccination",symptom_label_ko:"",question_ko:"   ?",answer_ko:"    6~8   .     .     .",keywords:["","",""]},{species_code:"all",species_label_ko:" ",department_code:"preventive",department_label_ko:"",symptom_tag:"checkup",symptom_label_ko:"",question_ko:"    ?",answer_ko:"7   1, 7  /  2  .       .",keywords:["","",""]}];function iM(t,e="all",s=""){const n=t.toLowerCase(),r=n.split(/\s+/);return Rj.filter(a=>{if(!(a.species_code==="all"||a.species_code===e))return!1;const l=a.keywords.some(u=>n.includes(u.toLowerCase())),c=a.question_ko.split(/\s+/).some(u=>r.some(h=>u.includes(h)||h.includes(u)));return l||c}).sort((a,o)=>{const l=a.keywords.filter(u=>n.includes(u.toLowerCase())).length;return o.keywords.filter(u=>n.includes(u.toLowerCase())).length-l}).slice(0,3)}const Mj=[{key:"happy",label:"Happy",emoji:"",description:" ",fullDescription:"    "},{key:"funny",label:"Funny",emoji:"",description:"  ",fullDescription:"   "},{key:"lovely",label:"Lovely",emoji:"",description:"   ",fullDescription:"   "}];function aM({onClose:t,onStyleSelect:e,originalImageUrl:s,petName:n}){const[r,a]=O.useState("happy"),o=()=>{e(r)};return i.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",onClick:t,children:i.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md max-h-[90vh] overflow-auto p-6",onClick:l=>l.stopPropagation(),children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"  "}),i.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-700",children:""})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("p",{className:"text-sm text-gray-600 mb-3 text-center",children:"   "}),i.jsx("div",{className:"flex justify-center",children:i.jsx("img",{src:s,alt:" ",className:"w-32 h-32 rounded-2xl object-cover border-2 border-gray-200"})})]}),i.jsxs("div",{className:"mb-5",children:[i.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-4",children:"  "}),i.jsx("div",{className:"space-y-3",children:Mj.map(l=>i.jsxs("button",{onClick:()=>a(l.key),className:`w-full flex items-center gap-4 p-4 rounded-xl border-2 transition-all ${r===l.key?"border-purple-500 bg-purple-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[i.jsx("span",{className:"text-3xl",children:l.emoji}),i.jsxs("div",{className:"flex-1 text-left",children:[i.jsx("div",{className:"font-semibold text-gray-900",children:l.label}),i.jsx("div",{className:"text-sm text-gray-600",children:l.description})]})]},l.key))})]}),i.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-5",children:i.jsxs("p",{className:"text-xs text-yellow-800 text-center",children:[" AI   ",i.jsx("strong",{children:"30 "})," "]})}),i.jsx("button",{onClick:o,className:"w-full py-4 bg-gradient-to-r from-purple-600 to-purple-800 text-white rounded-xl font-semibold hover:from-purple-700 hover:to-purple-900 transition-all",children:"  "})]})})}function oM({onClose:t,characterUrl:e,style:s,onSave:n,onSetAsProfile:r,saving:a}){const o=Mj.find(l=>l.key===s);return i.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",onClick:t,children:i.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md max-h-[90vh] overflow-auto p-6",onClick:l=>l.stopPropagation(),children:[i.jsx("div",{className:"flex justify-end mb-3",children:i.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-700",children:""})}),i.jsx("h2",{className:"text-2xl font-bold text-gray-900 text-center mb-2",children:"  !"}),i.jsxs("p",{className:"text-gray-600 text-center mb-6",children:[o==null?void 0:o.emoji," ",o==null?void 0:o.label," "]}),i.jsx("div",{className:"flex justify-center mb-6",children:i.jsx("img",{src:e,alt:" ",className:"w-full max-w-sm rounded-2xl shadow-lg"})}),i.jsxs("div",{className:"space-y-3 mb-5",children:[i.jsx("button",{onClick:r,disabled:a,className:"w-full py-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold hover:from-green-600 hover:to-green-700 transition-all disabled:opacity-50",children:a?" ...":"  "}),i.jsx("button",{onClick:n,disabled:a,className:"w-full py-4 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-all disabled:opacity-50",children:a?" ...":""})]}),i.jsxs("p",{className:"text-xs text-gray-500 text-center leading-relaxed",children:[" ",i.jsx("strong",{children:" "}),"     .",i.jsx("br",{}),i.jsx("strong",{children:""}),"      ."]})]})})}async function lM(t,e){const s=await fetch(t),n=await s.blob(),r=QR(E3,e),a=await KR(r,n,{contentType:s.headers.get("content-type")||"image/png"});return await GR(a.ref)}function cM(t,e){const s=Date.now(),n=Math.random().toString(36).substring(2,8);return`${t}_${s}_${n}.${e}`}async function dM(t,e,s,n){try{console.log(" AI    ( API )..."),console.log("  URL:",t),console.log(":",n);const r=await IS({original_image_url:t,style:n,user_id:e,pet_id:s});if(!r.success)return{success:!1,error:r.error||"  ."};console.log(" Step 3: Firebase Storage  ...");const a=cM(`character_${n}`,"png"),o=`pets/${e}/${s}/characters/${a}`,l=await lM(r.character_url,o);return console.log("   :",l),{success:!0,characterUrl:l,style:r.style,analysis:r.analysis}}catch(r){return console.error(" AI   :",r),{success:!1,error:r.message||"    ."}}}const uM=async(t,e)=>{var r;const s=rn(fs.GEMINI);if(!s)throw new Error("Gemini API   .  > API   .");const n=`${ea}

 "CS Agent ( )".

[]
-   /   .
- ,  ,       .
-    1 . (,    Medical Agent Triage Engine )
-       .

[  ]
- pet_profile:   
- user_description:      

 :
- : ${t.petName}
- : ${Cs(t.species)}
- : ${t.breed||""}
- : ${t.age||""}
${t.weight?`- : ${t.weight}kg`:""}

  :
${e.symptomText||"  "}

${((r=e.images)==null?void 0:r.length)>0?` ${e.images.length} .`:""}

[  - JSON ONLY]
  :

{
  "summary_kor": "      (, 3~5)",
  "key_symptoms": ["  1", "  2"],
  "onset": "      (: 3 ,   )",
  "duration": "   (: 3 ,   )",
  "suspected_body_parts": ["", "", "", "", "", "/"    ],
  "first_urgency_assessment": "low | moderate | high | emergency  ",
  "missing_information": ["    1", "    2"],
  "next_step_brief": " ,     "
}

:
-   ,   'moderate' .
-   JSON  .`;try{const a=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:n}]}]})});if(!a.ok)throw new Error(`Gemini API : ${a.status}`);const c=(await a.json()).candidates[0].content.parts[0].text.match(/\{[\s\S]*\}/);if(c){const u=JSON.parse(c[0]);return{json:u,message:`, ${t.petName} .

 .

 :
 : ${t.petName}
 : ${Cs(t.species)}
 : ${t.breed||""}

: ${u.summary_kor}

   .`}}throw new Error("JSON  ")}catch(a){return console.error("CS Agent :",a),{json:{summary_kor:`${t.petName}   .`,key_symptoms:[],onset:"  ",duration:"  ",suspected_body_parts:[],first_urgency_assessment:"moderate",missing_information:[],next_step_brief:"AI      ."},message:`, ${t.petName} .

 .

   .`}}},hM=async(t,e,s)=>{var c;const n=(e.symptomText||"").toLowerCase(),r=[],a=[],o=[];(n.includes("")||n.includes(""))&&(r.push(" "),a.push(""),o.push("")),(n.includes("")||n.includes("")||n.includes(""))&&(r.push(" "),a.push(""),o.push("")),(n.includes("")||n.includes("")||n.includes(""))&&(r.push(" "),a.push(""),o.push("")),(n.includes("")||n.includes(""))&&(r.push(" "),a.push(""),o.push(""));const l=(s==null?void 0:s.first_urgency_assessment)==="emergency"||(s==null?void 0:s.first_urgency_assessment)==="high"?"high":(s==null?void 0:s.first_urgency_assessment)==="moderate"?"medium":"low";return{json:{symptom_keywords:r.length>0?r:[" "],body_part_focus:a.length>0?a:[""],severity_hint:l,possible_categories:o.length>0?o:[" "],related_past_cases_summary:"",notes_for_medical_agent:`   . ${r.join(", ")}   . Medical Agent   .`},message:`   .

${((c=e.images)==null?void 0:c.length)>0?`    .
`:""}   .
    .

    .`}};async function mM(t="dog",e=""){try{const s=fe(se,"owner_faq"),n=_e(s,pe("species_code","in",[t,"all"]),zs(20)),a=(await Pe(n)).docs.map(o=>({id:o.id,...o.data()}));if(e){const o=e.toLowerCase().split(/[\s,]+/);return a.map(c=>{let u=0;const h=`${c.question_ko||""} ${c.answer_ko||""} ${(c.keywords||[]).join(" ")}`.toLowerCase();return o.forEach(m=>{m&&h.includes(m)&&(u+=1)}),{...c,relevanceScore:u}}).filter(c=>c.relevanceScore>0).sort((c,u)=>u.relevanceScore-c.relevanceScore).slice(0,5)}return a.slice(0,5)}catch(s){return console.error("FAQ  :",s),[]}}async function fM(t){var s;const e=typeof t=="string"?t:((s=t==null?void 0:t.toString)==null?void 0:s.call(t))||null;if(!e)return[];try{const n=fe(se,"diagnoses"),r=_e(n,pe("petId","==",e),zs(10));return(await Pe(r)).docs.map(l=>({id:l.id,...l.data()})).sort((l,c)=>{var m,f,y,_;const u=((f=(m=l.createdAt)==null?void 0:m.toDate)==null?void 0:f.call(m))||new Date(l.created_at||0);return(((_=(y=c.createdAt)==null?void 0:y.toDate)==null?void 0:_.call(y))||new Date(c.created_at||0))-u}).slice(0,5)}catch(n){return console.error("    :",n),[]}}async function pM(t,e){try{const s=fe(se,"diagnoses"),n=_e(s,Pt("createdAt","desc"),zs(30)),a=(await Pe(n)).docs.map(c=>({id:c.id,...c.data()})),o=(e||"").toLowerCase().split(/[\s,]+/).filter(Boolean);return a.filter(c=>{if(c.species&&c.species!==t)return!1;const u=`${c.symptom||""} ${c.diagnosis||""} ${c.description||""}`.toLowerCase();return o.some(h=>h&&u.includes(h))}).slice(0,5).map(c=>({diagnosis:c.diagnosis,symptom:c.symptom,triage_score:c.triage_score,actions:c.actions,hospitalVisit:c.hospitalVisit}))}catch(s){return console.error("   :",s),[]}}async function gM(t,e=7){var n;const s=typeof t=="string"?t:((n=t==null?void 0:t.toString)==null?void 0:n.call(t))||null;if(!s)return[];try{const r=fe(se,"pets",s,"careLogs"),a=_e(r,Pt("date","desc"),zs(e));return(await Pe(a)).docs.map(l=>({id:l.id,...l.data()}))}catch(r){return console.error("   :",r),[]}}function xM(t){if(!t||t.length===0)return"";const e=[...t].sort((r,a)=>r.date<a.date?1:-1).slice(0,7);let s=["[ 7   ]"],n=[];for(const r of e){const a={happy:"",normal:"",tired:"",anxious:""}[r.mood]||r.mood,o=`- ${r.date}:  ${r.mealCount??"-"},  ${r.waterCount??"-"},  ${r.walkCount??"-"},  ${r.poopCount??"-"},  ${r.weightKg??""}kg,  ${a}`;s.push(o),typeof r.weightKg=="number"&&n.push(r.weightKg)}if(n.length>=2){const r=n[n.length-1],a=n[0],o=+(a-r).toFixed(1),l=o>.3?"  .":o<-.3?"  .":"   .";s.push(`  : ${r}kg  ${a}kg (${o>0?"+":""}${o}kg). ${l}`)}return s.join(`
`)}async function yM(t,e){const s=(t==null?void 0:t.species)||"dog",n=(e==null?void 0:e.symptomText)||(e==null?void 0:e.description)||"",r=((e==null?void 0:e.selectedSymptoms)||[]).join(", "),a=`${n} ${r}`,[o,l,c]=await Promise.all([mM(s,a).catch(()=>[]),fM(t==null?void 0:t.id).catch(()=>[]),pM(s,a).catch(()=>[])]);let u=[];try{u=await gM(t==null?void 0:t.id,7)}catch(f){console.warn("    (  ):",f),u=[]}let h="";l.length>0&&(h+=`

[    ]
`,l.forEach((f,y)=>{var S,R;const _=((R=(S=f.createdAt)==null?void 0:S.toDate)==null?void 0:R.call(S))||new Date(f.created_at);h+=`${y+1}. ${_.toLocaleDateString("ko-KR")} - ${f.diagnosis||""}
`,h+=`   : ${f.symptom||" "}
`,f.triage_score&&(h+=`   : ${f.triage_score}/5
`)})),c.length>0&&(h+=`

[     ]
`,c.forEach((f,y)=>{h+=`${y+1}. : ${f.diagnosis}
`,h+=`   : ${f.symptom}
`,f.triage_score&&(h+=`   : ${f.triage_score}/5
`),f.hospitalVisit&&(h+=`     : 
`)})),o.length>0&&(h+=`

[ FAQ  ]
`,o.forEach((f,y)=>{h+=`${y+1}. Q: ${f.question_ko}
`,h+=`   A: ${f.answer_ko}
`}));const m=xM(u);return m&&(h+=`

`+m),h}const vM=async(t,e,s,n,r="")=>{var u;const a=rn(fs.ANTHROPIC);if(!a)throw new Error("Claude API   .  > API   .");const o="claude-sonnet-4-20250514",l=`${ea}

 "Medical Agent ( )".
 10  ,    .

[]
- CS Agent + Information Agent     .
-   () 1~3  .
-     '  ' reasoning .
-     .
-       .      .

[  - JSON ONLY]
  JSON  .    .

{
  "primary_assessment_kor": "      ()",
  "possible_diseases": [
    {
      "name_kor": "  ()",
      "name_en": "  (  )",
      "probability": 0.0,
      "reasoning_kor": "    (, , / )",
      "body_part": " |  |  |  |  | / |   "
    }
  ],
  "risk_level": "low | moderate | high | emergency",
  "need_hospital_visit": true,
  "hospital_visit_timing": " ( ) |   | 24~48  |   |   ",
  "suggested_tests": ["    :   , , X-ray "],
  "caution_notes_for_owner": ["     1", "    1"]
}`,c=` :
- : ${t.petName}
- : ${Cs(t.species)}
- : ${t.breed||""}
- : ${t.age||""}
${t.weight?`- : ${t.weight}kg`:""}

CS Agent :
${JSON.stringify(s,null,2)}

Information Agent :
${JSON.stringify(n,null,2)}

  :
${e.symptomText||"  "}
${e.guardianResponsesSummary?`

    ():
${e.guardianResponsesSummary}
`:""}
${r?`
===   (Firestore DB) ===
${r}
=================================
      FAQ.   ,      .
`:""}

:
- 'emergency'      .
-      , ' //'  , JSON probability(0~1)  .
-      , 1~3  .
-   JSON .

 -  vs    :
- risk_level 'low' :      . need_hospital_visit false.
- risk_level 'moderate' :   , 24-48        .
-       :
  *  ,  (1-2),  
  *   ,   
  *   ,   
  * ,   
-      :
  *  (3 ), /
  * 48   ,  
  * , , 
  *  , , `;try{const h=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":a,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:o,max_tokens:2048,system:l,messages:[{role:"user",content:c}]})});if(!h.ok){const _=await h.json().catch(()=>({}));throw new Error(`Claude API : ${h.status} - ${((u=_.error)==null?void 0:u.message)||"   "}`)}const f=(await h.json()).content[0].text;let y;try{const _=f.match(/\{[\s\S]*\}/);y=JSON.parse(_?_[0]:f)}catch(_){throw console.error("JSON  :",_),new Error("  ")}return{json:y,message:`   ...

   :
${y.primary_assessment_kor}

  :
${y.possible_diseases.map(_=>` ${_.name_kor} ( ${Math.round(_.probability*100)}%)`).join(`
`)}

 : ${y.risk_level==="low"?"":y.risk_level==="moderate"?"":y.risk_level==="high"?"":""}
 : ${y.hospital_visit_timing}

 Triage Engine,   .`}}catch(h){return console.error("Medical Agent :",h),{json:{primary_assessment_kor:"   .",possible_diseases:[{name_kor:"  ",name_en:"",probability:.6,reasoning_kor:"  ",body_part:""}],risk_level:"moderate",need_hospital_visit:!1,hospital_visit_timing:" ",suggested_tests:[],caution_notes_for_owner:["  ","  "]},message:`   ...

    .

  :
    ( 60%)

 : Moderate
 :  

 Triage Engine,   .`}}},bM=async(t,e,s,n,r,a)=>{var h;const o=rn(fs.ANTHROPIC);if(!o)throw new Error("Claude API   .  > API   .");const l="claude-sonnet-4-20250514",c=`${ea}

 "Ops Agent ( )".

[]
- CS / Information / Medical / Triage  ,     .
-     "  (pre-visit packet)" .
- JSON   ,    .

[  - JSON ONLY]
  JSON  .    .

{
  "medical_log": {
    "pet_id": "${t.id}",
    "created_at": "${new Date().toISOString()}",
    "summary_kor": "       ",
    "triage_score": 0,
    "triage_level": "green | yellow | orange | red",
    "risk_level": "low | moderate | high | emergency",
    "need_hospital_visit": true,
    "hospital_visit_timing": "  |   | 24~48  |    |  ",
    "health_flags": {
      "earIssue": false,
      "digestionIssue": false,
      "skinIssue": false,
      "fever": false,
      "energyLevel": 0.8
    },
    "possible_diseases": [
      {
        "name_kor": " ",
        "probability": 0.7,
        "body_part": " |  |  |  |  | / | ",
        "reasoning_kor": "  "
      }
    ],
    "caution_notes_for_owner": ["      1", " 2"],
    "suggested_tests": ["  1", "  2"]
  },
  "owner_friendly_diagnosis_sheet": {
    "title": "  (: '${t.petName}   AI  ')",
    "intro": "       (, 2~3)",
    "problem_summary": "     ",
    "risk_explanation": "/     ",
    "what_to_watch": ["    ", "     "],
    "immediate_home_actions": ["       1", "     1"]
  },
  "hospital_previsit_packet": {
    "packet_title": " AI   ",
    "for_vet_summary": " 10        (, 3~5)",
    "pet_profile_brief": {
      "name": "${t.petName}",
      "species": "${t.species}",
      "breed": "${t.breed||""}",
      "age_info": ":  ${t.age||"?"} , ${Cs(t.species)}",
      "sex_neutered": ": ${t.sex==="M"?"":""}"
    },
    "visit_reason": "        ",
    "symptom_timeline": " ,     ",
    "ai_differential_diagnosis": [
      {
        "name_kor": " ",
        "probability": 0.7,
        "note_for_vet": "    ( ,   )"
      }
    ],
    "triage_and_risk": {
      "triage_score": 0,
      "triage_level": "green | yellow | orange | red",
      "risk_level": "low | moderate | high | emergency",
      "urgency_comment": "   "
    },
    "requested_actions_for_hospital": ["       ."]
  }
}

:
- JSON   ,   .
- (owner_friendly_diagnosis_sheet) (hospital_previsit_packet)    .
  - :  
  - :   ,  `,u=`[]
- pet_profile:  
- cs_summary: CS Agent JSON
- info_summary: Information Agent JSON
- medical_result: Medical Agent JSON
- triage_result: Triage Engine JSON

 :
- : ${t.petName}
- : ${Cs(t.species)}
- : ${t.breed||""}

CS Agent :
${JSON.stringify(r,null,2)}

Information Agent :
${JSON.stringify(a,null,2)}

Medical Agent :
${JSON.stringify(s,null,2)}

Triage Engine :
${JSON.stringify(n,null,2)}

  JSON .`;try{const m=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":o,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:l,max_tokens:4096,system:c,messages:[{role:"user",content:u}]})});if(!m.ok){const S=await m.json().catch(()=>({}));throw new Error(`Claude API : ${m.status} - ${((h=S.error)==null?void 0:h.message)||"   "}`)}const y=(await m.json()).content[0].text;let _;try{const S=y.match(/\{[\s\S]*\}/);_=JSON.parse(S?S[0]:y)}catch(S){throw console.error("JSON  :",S),new Error("  ")}return{json:_,message:`   .
   ...
  .

   !`}}catch(m){console.error("Ops Agent :",m);const f=(n==null?void 0:n.health_flags)||{earIssue:!1,digestionIssue:!1,skinIssue:!1,fever:!1,energyLevel:.7};return{json:{medical_log:{pet_id:t.id,created_at:new Date().toISOString(),summary_kor:`${t.petName}   AI  .`,triage_score:(n==null?void 0:n.triage_score)||2,triage_level:(n==null?void 0:n.triage_level)||"yellow",risk_level:(s==null?void 0:s.risk_level)||"moderate",need_hospital_visit:(s==null?void 0:s.need_hospital_visit)||!1,hospital_visit_timing:(s==null?void 0:s.hospital_visit_timing)||"  ",health_flags:f,possible_diseases:(s==null?void 0:s.possible_diseases)||[],caution_notes_for_owner:(s==null?void 0:s.caution_notes_for_owner)||[],suggested_tests:(s==null?void 0:s.suggested_tests)||[]},owner_friendly_diagnosis_sheet:{title:`${t.petName} AI  `,intro:"AI  .",problem_summary:"   .",risk_explanation:"  .",what_to_watch:["  "],immediate_home_actions:["  "]},hospital_previsit_packet:{packet_title:" AI   ",for_vet_summary:"AI    .",pet_profile_brief:{name:t.petName,species:t.species,breed:t.breed||"",age_info:`${t.age||"?"}`,sex_neutered:t.sex==="M"?"":""},visit_reason:"   ",symptom_timeline:"  ",ai_differential_diagnosis:[],triage_and_risk:{triage_score:(n==null?void 0:n.triage_score)||2,triage_level:(n==null?void 0:n.triage_level)||"yellow",risk_level:(s==null?void 0:s.risk_level)||"moderate",urgency_comment:"  "},requested_actions_for_hospital:[]}},message:`   .
   ...
  .

   !`}}},wM=(t,e)=>{const s=[],n=t.risk_level||"moderate",r=e.triage_level||"yellow";({low:["green","yellow"],moderate:["yellow","orange"],high:["orange","red"],emergency:["red"]}[n]||["yellow"]).includes(r)||s.push({type:"risk_level_mismatch",severity:"high",medical_assessment:n,triage_assessment:r,description:`Medical Agent ${n} , Triage Engine ${r} .`});const l=e.triage_score||2;(n==="emergency"||n==="high")&&l<3&&s.push({type:"emergency_score_mismatch",severity:"critical",medical_assessment:n,triage_score:l,description:`Medical Agent   , Triage (${l}) .`});const u=t.need_hospital_visit||!1,h=l>=3||r==="red";return u!==h&&s.push({type:"hospital_visit_mismatch",severity:"medium",medical_recommendation:u,triage_recommendation:h,description:`     . Medical: ${u}, Triage: ${h}`}),{has_discrepancies:s.length>0,discrepancy_count:s.length,discrepancies:s,critical_count:s.filter(m=>m.severity==="critical").length,needs_review:s.some(m=>m.severity==="critical"||m.severity==="high")}},_M=async(t,e,s,n,r)=>{const a=rn(fs.ANTHROPIC);if(!a)return console.warn("Claude API     ."),null;const o=`${ea}

 "Senior Veterinarian Reviewer (  )".

[]
- Medical Agent Triage Agent    .
-    ,       .
-       .
-      .

[]
-   :    
-    
-         `,l=`
 :
- : ${t.petName}
- : ${Cs(t.species)}
- : ${t.breed||""}
- : ${t.age||""}
- : ${t.weight||""}

:
${e.symptomText}
${e.guardianResponsesSummary?`
     ( ) 
${e.guardianResponsesSummary}
`:""}

Information Agent :
${JSON.stringify(r,null,2)}

Medical Agent :
${JSON.stringify(s,null,2)}

Triage Engine :
${JSON.stringify(n,null,2)}

[ ]
      :

{
  "agreement_level": "full_agreement | partial_agreement | significant_disagreement",
  "confidence_level": " |  | ",
  "primary_concern": "   ()",
  "medical_agent_assessment": "Medical Agent    (//)",
  "triage_agent_assessment": "Triage Agent    (//)",
  "recommended_risk_level": "low | moderate | high | emergency",
  "recommended_triage_score": 0-5,
  "recommended_hospital_visit": true/false,
  "reasoning": "  ( 3-4)",
  "additional_concerns": ["   "],
  "final_recommendation": "  ( 2-3)"
}`;try{const c=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":a,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:2048,temperature:.3,system:o,messages:[{role:"user",content:l}]})});if(!c.ok)throw new Error(`Claude API : ${c.status}`);const m=(await c.json()).content[0].text.match(/\{[\s\S]*\}/);if(m)return JSON.parse(m[0])}catch(c){console.error("  :",c)}return null},NM=async(t,e,s,n,r)=>{const a=rn(fs.OPENAI);if(!a)return console.warn("OpenAI API   2  ."),null;const o=`${ea}

 "Second Opinion Specialist (2  )".

[]
-  AI     2 .
- Claude       .
-      .`,l=`
: ${t.petName} (${Cs(t.species)}, ${t.breed||""})
: ${e.symptomText}
${e.guardianResponsesSummary?`
   : ${e.guardianResponsesSummary}
`:""}

1  (Medical Agent - Claude):
${JSON.stringify(s,null,2)}

  (Triage Engine - Claude):
${JSON.stringify(n,null,2)}

  (Senior Reviewer - Claude):
${r?JSON.stringify(r,null,2):""}

[2  ]
    :

{
  "agreement_with_diagnosis": true/false,
  "alternative_diagnosis": ["   "],
  "risk_assessment": "low | moderate | high | emergency",
  "key_observations": ["GPT-4o    "],
  "dissenting_opinion": " AI    ()",
  "confidence_level": " |  | ",
  "recommendation": "  ()"
}`;try{const c=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({model:"gpt-4o",messages:[{role:"system",content:o},{role:"user",content:l}],temperature:.3,max_tokens:1500})});if(!c.ok)throw new Error(`OpenAI API : ${c.status}`);const m=(await c.json()).choices[0].message.content.match(/\{[\s\S]*\}/);if(m)return JSON.parse(m[0])}catch(c){console.error("2  :",c)}return null},jM=(t,e,s,n,r)=>{var A,M;const a=[t.risk_level,e.triage_level,s==null?void 0:s.recommended_risk_level,n==null?void 0:n.risk_assessment].filter(Boolean),o=D=>({green:"low",yellow:"low",orange:"moderate",red:"high",emergency:"emergency",low:"low",moderate:"moderate",high:"high"})[D]||"moderate",l=a.map(o),u=["emergency","high","moderate","low"].find(D=>l.includes(D))||"moderate",h=[e.triage_score,s==null?void 0:s.recommended_triage_score].filter(D=>D!=null);let m=h.length>0?Math.round(h.reduce((D,B)=>D+B,0)/h.length):2;r.critical_count>0&&(m=Math.min(5,m+1));const f=[t.need_hospital_visit,m>=3,s==null?void 0:s.recommended_hospital_visit,(n==null?void 0:n.risk_assessment)==="high"||(n==null?void 0:n.risk_assessment)==="emergency"].filter(D=>D===!0||D===!1),y=f.filter(D=>D===!0).length>=f.length/2,_=r.has_discrepancies?1-r.discrepancy_count*.1:.95,S=(s==null?void 0:s.confidence_level)===""?.95:(s==null?void 0:s.confidence_level)===""?.8:(s==null?void 0:s.confidence_level)===""?.65:.75,R=(s==null?void 0:s.agreement_level)==="full_agreement"?.1:(s==null?void 0:s.agreement_level)==="partial_agreement"?0:-.15,k=(n==null?void 0:n.confidence_level)===""?.9:(n==null?void 0:n.confidence_level)===""?.75:(n==null?void 0:n.confidence_level)===""?.6:null;let x;return k!==null?x=S*.6+k*.4+R:x=Math.min(_,S)+R,x=Math.max(.5,Math.min(.98,x)),{consensus_reached:!r.needs_review||(s==null?void 0:s.agreement_level)==="full_agreement",final_risk_level:u,final_triage_score:m,final_hospital_visit:y,confidence_score:x,voting_summary:{risk_votes:l,triage_scores:h,hospital_votes:f},collaborative_notes:{medical_diagnosis:t.primary_assessment_kor||((M=(A=t.possible_diseases)==null?void 0:A[0])==null?void 0:M.name_kor),reviewer_opinion:s==null?void 0:s.final_recommendation,second_opinion:n==null?void 0:n.recommendation,key_concerns:[...(s==null?void 0:s.additional_concerns)||[],...(n==null?void 0:n.key_observations)||[]]},discrepancy_resolution:r.has_discrepancies?`${r.discrepancy_count}   ,     .`:"    ."}},IM=async(t,e,s,n,r)=>{console.log("   ...");const a=wM(s,n);console.log(" :",a);const o=await _M(t,e,s,n,r);console.log(" :",o);let l=null;(a.needs_review||s.risk_level==="high"||s.risk_level==="emergency")&&(l=await NM(t,e,s,n,o),console.log("2 :",l));const c=jM(s,n,o,l,a);return console.log(" :",c),{discrepancy_analysis:a,review_result:o,second_opinion:l,consensus:c,collaboration_summary:`${a.has_discrepancies?" ":" "} : ${c.consensus_reached?"  ":"  "} (: ${(c.confidence_score*100).toFixed(0)}%)`}},Oj={digestive:{category:"",medications:[{type:" ",examples:["",""],usage:" 30~1",duration:" 3~7",description:"     ",caution:"     "},{type:" ",examples:["",""],usage:"    ",duration:"  1~3",description:"  ",caution:"   "},{type:"/",examples:["",""],usage:"1 2~3 ",duration:"  3~5",description:"     ",caution:"   "}],symptoms:["","","","",""]},dermatology:{category:"",medications:[{type:"",examples:["",""],usage:"1 1~2",duration:"  1~2",description:"   ",caution:"   "},{type:" /",examples:[" "," "],usage:"1 2  ",duration:"2~4",description:"    ",caution:"  "},{type:" (/)",examples:[""," "],usage:" ",duration:"  ",description:"   ",caution:"    ,   "}],symptoms:["","","","","","",""]},respiratory:{category:"",medications:[{type:"",examples:["",""],usage:"1 2 ",duration:"7~14 ( )",description:"  ",caution:"    "},{type:" ",examples:["",""],usage:"  1 2~3",duration:" ",description:" ",caution:"    "},{type:" ",examples:["",""],usage:"1 2",duration:"  ",description:"    ",caution:"     "}],symptoms:["","","","","",""]},urinary:{category:"",medications:[{type:" ( )",examples:["","-"],usage:"1 1~2",duration:"7~14",description:"   ",caution:"   "},{type:"  ",examples:["D-"," "],usage:"1 1",duration:"  ",description:"     ",caution:"  "},{type:"",examples:["",""],usage:"1 1~2",duration:"  ",description:"  ",caution:"  "}],symptoms:["","","","",""]},orthopedic:{category:"",medications:[{type:"  (NSAIDs)",examples:["","",""],usage:"1 1 ",duration:"  ~",description:"  ",caution:" , /   "},{type:" ",examples:["","",""],usage:"1 1",duration:" ",description:"    ",caution:" 4~6  "}],symptoms:["","","","",""]},infection:{category:"/",medications:[{type:" ",examples:["-",""],usage:"1 2 ",duration:"7~14",description:"   ",caution:"    "},{type:"/",examples:[" ()"," ()"],usage:"1 1",duration:"  ",description:"  ",caution:"    !"},{type:" ",examples:[" ",""],usage:" ",duration:" ",description:"   ",caution:"   "}],symptoms:["","","","",""]}},SM={:"digestive",:"digestive",:"digestive",:"digestive",:"digestive",:"digestive"," ":"digestive",:"dermatology",:"dermatology",:"dermatology",:"dermatology",:"dermatology",:"dermatology",:"dermatology"," ":"dermatology"," ":"dermatology",:"respiratory",:"respiratory",:"respiratory"," ":"respiratory",:"respiratory","  ":"respiratory",:"urinary",:"urinary",:"urinary",FLUTD:"urinary",:"urinary",:"urinary",:"orthopedic",:"orthopedic",:"orthopedic",:"orthopedic",:"orthopedic"," ":"orthopedic",:"infection",:"infection",:"infection",:"infection",:"infection"};function kM(t,e=[]){const s=new Set;if(t){const n=t.toLowerCase();for(const[r,a]of Object.entries(SM))(n.includes(r.toLowerCase())||r.toLowerCase().includes(n))&&s.add(a)}return e.forEach(n=>{const r=(typeof n=="string"?n:(n==null?void 0:n.name_kor)||"").toLowerCase();for(const[a,o]of Object.entries(Oj))o.symptoms.some(l=>r.includes(l)||l.includes(r))&&s.add(a)}),Array.from(s)}function EM(t,e){var h,m,f;const s=((m=(h=t==null?void 0:t.possible_diseases)==null?void 0:h[0])==null?void 0:m.name_kor)||(t==null?void 0:t.primary_assessment_kor)||"",n=(e==null?void 0:e.selectedSymptoms)||[],a=((e==null?void 0:e.symptomText)||"").split(/[,\s]+/).filter(Boolean),o=kM(s,[...n,...a]);if(o.length===0)return{hasMedicationGuidance:!1,message:"      .    .",medications:[]};const l=[];o.forEach(y=>{const _=Oj[y];if(_){const S=_.medications.slice(0,2);l.push({category:_.category,medications:S})}});const c=(f=l[0])==null?void 0:f.medications[0];let u="";return c&&(u=`${c.type}     . ${c.description}`),{hasMedicationGuidance:!0,message:u,medications:l,disclaimer:"    ,        ."}}async function TM(t,e){try{const s=fe(se,"owner_faq"),n=_e(s,pe("species_code","in",[t,"all"]),zs(30)),a=(await Pe(n)).docs.map(o=>({id:o.id,...o.data()}));if(e){const o=e.toLowerCase().split(/[\s,]+/).filter(Boolean);return a.map(c=>{let u=0;const h=`${c.question_ko||""} ${c.answer_ko||""} ${c.symptom_label_ko||""} ${(c.keywords||[]).join(" ")}`.toLowerCase();return o.forEach(m=>{m&&m.length>1&&h.includes(m)&&(u+=1)}),{...c,relevanceScore:u}}).filter(c=>c.relevanceScore>0).sort((c,u)=>u.relevanceScore-c.relevanceScore).slice(0,5)}return a.slice(0,5)}catch(s){return console.error("Firebase FAQ  :",s),[]}}async function AM(t,e,s="dog"){var u,h;const n=((h=(u=t==null?void 0:t.possible_diseases)==null?void 0:u[0])==null?void 0:h.name_kor)||"",r=(e==null?void 0:e.selectedSymptoms)||[],a=(e==null?void 0:e.symptomText)||"",l=[n,...r.map(m=>typeof m=="string"?m:(m==null?void 0:m.name_kor)||""),...a.split(/[\s,]+/).filter(Boolean)].filter(Boolean).join(" ");let c=[];try{c=await TM(s,l),console.log("Firebase FAQ  :",c.length,"")}catch(m){console.warn("Firebase FAQ  ,   :",m)}if(c.length<3){const m=iM(l,s),f=new Set(c.map(_=>_.question_ko)),y=m.filter(_=>!f.has(_.question_ko));c=[...c,...y]}if(c.length<3){const m=CM(n),f=new Set(c.map(R=>R.question_ko)),y=Rj.filter(R=>(R.species_code===s||R.species_code==="all")&&!f.has(R.question_ko)),_=y.filter(R=>R.department_code===m),S=y.filter(R=>R.department_code!==m);c=[...c,..._,...S]}return c.slice(0,3).map((m,f)=>({id:m.id||`faq_${f}_${m.symptom_tag||"general"}`,question:m.question_ko,answer:m.answer_ko,category:m.department_label_ko||"",symptomTag:m.symptom_tag,keywords:m.keywords||[]}))}function CM(t){const e=(t||"").toLowerCase(),s={:"dermatology",:"dermatology",:"dermatology",:"dermatology",:"internal_medicine",:"internal_medicine",:"internal_medicine",:"internal_medicine",:"ophthalmology",:"ophthalmology",:"orthopedics",:"orthopedics",:"orthopedics",:"urology",:"urology",:"urology"};for(const[n,r]of Object.entries(s))if(e.includes(n))return r;return"internal_medicine"}function PM(t,e,s){const n=(s==null?void 0:s.petName)||(s==null?void 0:s.name)||"";let a=t.answer;const o=(e==null?void 0:e.risk_level)||"moderate";let l="";return o==="emergency"||o==="high"?l=`

 ${n}       .`:o==="low"&&(l=`

 ${n}         .`),{id:t.id,question:t.question,answer:a+l,category:t.category}}function RM(t,e,s,n){const r=[];return t.forEach(a=>{const o=e.find(l=>l.id===a);o&&r.push(PM(o,s,n))}),r}function MM(t){return{title:"   ?",subtitle:"    (  )",faqs:t.map(e=>({id:e.id,question:e.question,category:e.category,selected:!1})),allowMultiple:!0,skipOption:{id:"skip",label:",  "}}}function OM(t){if(!t||t.length===0)return"";let e=`    !

`;return t.forEach((s,n)=>{e+=` ${s.question}
`,e+=` ${s.answer}
`,n<t.length-1&&(e+=`
---

`)}),e}const LM=async(t,e,s,n=null)=>{var y,_,S,R,k,x,A,M,D,B,v;const r=[];let a=null,o=null,l=null,c=null,u=null,h=null;const m={...t,petName:t.petName||t.name||"",name:t.name||t.petName||"",species:t.species||"dog",breed:t.breed||"",age:t.age||"",weight:t.weight||null},f={...e,symptomText:(e==null?void 0:e.symptomText)||(e==null?void 0:e.description)||(e==null?void 0:e.userDescription)||"  ",selectedSymptoms:(e==null?void 0:e.selectedSymptoms)||[],department:(e==null?void 0:e.department)||"",images:(e==null?void 0:e.images)||[]};try{s({agent:"CS Agent",role:"   ",icon:"",type:"cs",content:", .   .",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,1500)),a=await uM(m,f),r.push({agent:"CS Agent",role:"   ",icon:"",type:"cs",content:a.message,timestamp:Date.now()}),s(r[r.length-1]),await new Promise(I=>setTimeout(I,2e3)),s({agent:"CS Agent",role:"   ",icon:"",type:"cs",content:"   .    .",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,1200)),s({agent:"Information Agent",role:"  ",icon:"",type:"info",content:",  .    .",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,1500)),o=await hM(m,f,a.json),r.push({agent:"Information Agent",role:"  ",icon:"",type:"info",content:o.message,timestamp:Date.now()}),s(r[r.length-1]),await new Promise(I=>setTimeout(I,2e3)),s({agent:"Information Agent",role:"  ",icon:"",type:"info",content:"       .    :",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,1e3));const N=[{id:"symptom_start",question:"  ?",options:["","","2-3 "," "],type:"single"},{id:"appetite",question:" ?",options:[" "," ","  ","  "],type:"single"},{id:"activity",question:"   ?",options:[" "," "," ","  "],type:"single"},{id:"other_symptoms",question:"   ? (  )",options:["","","","","","",""],type:"multiple"}];let w={};if(n)s({agent:"Information Agent",role:"  ",icon:"",type:"info",content:"",isQuestionPhase:!0,questions:N,timestamp:Date.now()}),w=await n(N),s({agent:"Information Agent",role:"  ",icon:"",type:"info",content:"  .     .",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,800));else{for(const I of N)s({agent:"Information Agent",role:"  ",icon:"",type:"info",content:I.question,isQuestion:!0,questionData:I,timestamp:Date.now()}),await new Promise(L=>setTimeout(L,800));await new Promise(I=>setTimeout(I,1200))}const E={...f,guardianResponses:w,guardianResponsesSummary:Object.entries(w).map(([I,L])=>{const W=N.find(b=>b.id===I);return`${(W==null?void 0:W.question)||I}: ${Array.isArray(L)?L.join(", "):L}`}).join(`
`)};s({agent:"Information Agent",role:"  ",icon:"",type:"info",content:"  .        .",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,1200)),s({agent:"Veterinarian Agent",role:" ",icon:"",type:"medical",content:",   .   .",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,1500));let C="";try{C=await yM(m,E),C&&console.log("AI   :",C.length,"")}catch(I){console.warn("AI    (  ):",I)}l=await vM(m,E,a.json,o.json,C),r.push({agent:"Veterinarian Agent",role:" ",icon:"",type:"medical",content:l.message,timestamp:Date.now()}),s(r[r.length-1]),await new Promise(I=>setTimeout(I,2e3)),s({agent:"Veterinarian Agent",role:" ",icon:"",type:"medical",content:" .    .",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,1200)),s({agent:"Triage Engine",role:" ",icon:"",type:"triage",content:",   .   .",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,1500));try{c=await K3(m,E,l.json,a.json),r.push({agent:"Triage Engine",role:" ",icon:"",type:"triage",content:`  .

 Triage Score: ${c.triage_score}/5
  : ${c.triage_level}
  : ${c.recommended_action_window}

${c.emergency_summary_kor}`,timestamp:Date.now()}),s(r[r.length-1])}catch(I){console.error("Triage  :",I)}await new Promise(I=>setTimeout(I,2e3)),s({agent:"Collaborative System",role:" ",icon:"",type:"collaboration",content:" AI     ...",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,1e3));let P=null;try{P=await IM(m,f,l.json,c,o.json);const I=P.consensus.consensus_reached?"  AI    .":` ${P.discrepancy_analysis.discrepancy_count}    .`;r.push({agent:"Collaborative System",role:" ",icon:"",type:"collaboration",content:`${P.collaboration_summary}

${I}

  : ${P.consensus.final_risk_level}
 : ${(P.consensus.confidence_score*100).toFixed(0)}%

${P.consensus.collaborative_notes.reviewer_opinion||""}`,timestamp:Date.now()}),s(r[r.length-1]),P.consensus&&(c.triage_score=P.consensus.final_triage_score,c.triage_level=P.consensus.final_risk_level==="low"?"yellow":P.consensus.final_risk_level==="moderate"?"orange":(P.consensus.final_risk_level==="high","red"),l.json.risk_level=P.consensus.final_risk_level,l.json.need_hospital_visit=P.consensus.final_hospital_visit)}catch(I){console.error("  :",I),s({agent:"Collaborative System",role:" ",icon:"",type:"collaboration",content:"     .   .",timestamp:Date.now()})}await new Promise(I=>setTimeout(I,800)),s({agent:"Collaborative System",role:" ",icon:"",type:"collaboration",content:"  .     .",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,600)),s({agent:"Data Agent",role:"  ",icon:"",type:"data",content:"   .     .",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,1500)),u=await bM(m,f,l.json,c,a.json,o.json),r.push({agent:"Data Agent",role:"  ",icon:"",type:"data",content:u.message,timestamp:Date.now()}),s(r[r.length-1]),await new Promise(I=>setTimeout(I,2e3)),s({agent:"Data Agent",role:"  ",icon:"",type:"data",content:`  
  .   .`,timestamp:Date.now()}),await new Promise(I=>setTimeout(I,1200)),h=await v6(m,u.json,l.json,c);const j=EM(l.json,E);let re=h.message;if(j&&j.hasMedicationGuidance){const I=(y=j.medications[0])==null?void 0:y.medications[0];re=`${m.petName}   !

 ${j.message}

${I?` : ${I.usage}
 : ${I.duration}`:""}

${j.disclaimer}`}r.push({agent:"Care Agent",role:"   ",icon:"",type:"care",content:re,medicationGuidance:j,timestamp:Date.now()}),s(r[r.length-1]),await new Promise(I=>setTimeout(I,2e3)),s({agent:"Care Agent",role:"   ",icon:"",type:"care",content:"  .",timestamp:Date.now()}),await new Promise(I=>setTimeout(I,800));let Z=[],le=[];try{if(Z=await AM(l.json,f,m.species),console.log("FAQ  :",Z.length,""),Z.length>0&&n){s({agent:"FAQ Agent",role:"  ",icon:"",type:"faq",content:`${m.petName}      .     !`,timestamp:Date.now()});const I=MM(Z),L=await n(I,"faq");if(L&&L.length>0&&!L.includes("skip")&&(le=RM(L,Z,l.json,m),le.length>0)){const W=OM(le);s({agent:"FAQ Agent",role:"  ",icon:"",type:"faq_answer",content:W,timestamp:Date.now()}),await new Promise(b=>setTimeout(b,1500))}}}catch(I){console.warn("FAQ / :",I)}s({agent:"summary",role:"   ",icon:"",type:"summary",content:`  .    .

      !`,timestamp:Date.now()});const ce=u.json.medical_log,F=u.json.owner_friendly_diagnosis_sheet,Q=Vf((c==null?void 0:c.health_flags)||ce.health_flags||{}),K={id:Date.now().toString(),created_at:Date.now(),petId:m.id,petName:m.petName,diagnosis:((S=(_=ce.possible_diseases)==null?void 0:_[0])==null?void 0:S.name_kor)||"  ",probability:((k=(R=ce.possible_diseases)==null?void 0:R[0])==null?void 0:k.probability)||.6,riskLevel:ce.risk_level||"moderate",emergency:ce.risk_level==="emergency"||ce.risk_level==="high"?"high":ce.risk_level==="moderate"?"medium":"low",actions:F.immediate_home_actions||[],hospitalVisit:ce.need_hospital_visit||!1,hospitalVisitTime:ce.hospital_visit_timing||"  ",description:l.json.primary_assessment_kor||"  ",careGuide:h.fullGuide,conversationHistory:[],triage_score:ce.triage_score||(c==null?void 0:c.triage_score)||2,triage_level:ce.triage_level||(c==null?void 0:c.triage_level)||"yellow",healthFlags:Q,ownerSheet:F,hospitalPacket:u.json.hospital_previsit_packet,carePlan:h.json,medicationGuidance:j,faqAnswers:le.length>0?le:null,recommendedFAQs:Z.length>0?Z:null,collaboration:P?{consensus_reached:((x=P.consensus)==null?void 0:x.consensus_reached)??!1,confidence_score:((A=P.consensus)==null?void 0:A.confidence_score)??0,discrepancies_found:((M=P.discrepancy_analysis)==null?void 0:M.discrepancy_count)??0,models_consulted:["Claude Sonnet (Medical Agent)","Claude Sonnet (Triage Engine)","Claude Sonnet (Senior Reviewer)",P.second_opinion?"GPT-4o (Second Opinion)":null].filter(Boolean),final_recommendation:((B=(D=P.consensus)==null?void 0:D.collaborative_notes)==null?void 0:B.reviewer_opinion)||"     .",resolution_notes:((v=P.consensus)==null?void 0:v.discrepancy_resolution)||null}:null};return{logs:r,finalDiagnosis:K}}catch(N){throw console.error("  :",N),N}},Lj="petMedical_pets",uu="petMedical_diagnoses",Vj=t=>`petMedical_pets_${t}`,ga=t=>{if(!t)return[];try{const e=localStorage.getItem(Vj(t));return e?JSON.parse(e):[]}catch{return[]}},Ko=async(t,e,s=null)=>{if(t)try{if(localStorage.setItem(Vj(t),JSON.stringify(e)),s)try{const n=await Wo.addPet(t,{petName:s.petName||s.name,species:s.species||"dog",breed:s.breed||"",sex:s.sex||"",birthDate:s.birthDate||null,weight:s.weight||null,neutered:s.neutered||!1,character:s.character||null,profileImage:s.profileImage||null,originalPhoto:s.originalPhoto||null,characters:s.characters||[],sido:s.sido||null,sigungu:s.sigungu||null});n.success&&console.log(" Firestore  :",n.id)}catch(n){console.warn(" Firestore   (  ):",n)}}catch(n){console.error("Failed to save pets:",n)}},VM=()=>{try{const t=localStorage.getItem(Lj);return t?JSON.parse(t):[]}catch{return[]}},$M=t=>{try{localStorage.setItem(Lj,JSON.stringify(t))}catch(e){console.error("Failed to save pets:",e)}},dm=async(t,e=null)=>{try{let s={...t};s.healthFlags||(s.healthFlags=g6(t));const n={...s,id:s.id||Date.now().toString(),date:new Date().toISOString()},r=JSON.parse(localStorage.getItem(uu)||"[]");r.unshift(n),localStorage.setItem(uu,JSON.stringify(r));try{const a={...n,userId:e||n.userId||null,petId:n.petId||null,symptom:n.symptom||n.description||"",species:n.species||"dog",created_at:new Date().toISOString()},o=await Da.saveDiagnosis(a);o.success&&console.log("  Firestore  :",o.id)}catch(a){console.warn("Firestore   (  ):",a)}}catch(s){console.error("Failed to save diagnosis:",s)}},FM=t=>{try{const s=JSON.parse(localStorage.getItem(uu)||"[]").filter(n=>n.petId===t);return s.length===0?null:s[0]}catch(e){return console.error("Failed to get latest diagnosis:",e),null}},Vv=t=>{if(!t)return" ";const e=new Date(t);return`${new Date().getFullYear()-e.getFullYear()}`},$f=[{id:"dog",label:"",emoji:"",icon:Ls.dog},{id:"cat",label:"",emoji:"",icon:Ls.cat},{id:"rabbit",label:"",emoji:"",icon:Ls.rabbit},{id:"hamster",label:"",emoji:"",icon:Ls.hamster},{id:"bird",label:"",emoji:"",icon:Ls.bird},{id:"hedgehog",label:"",emoji:"",icon:Ls.hedgehog},{id:"reptile",label:"",emoji:"",icon:Ls.reptile},{id:"other",label:"",emoji:"",icon:Ls.etc}],Nr="/ai-factory/",Rr={dog:`${Nr}icon/dog.png`,cat:`${Nr}icon/cat.png`,rabbit:`${Nr}icon/rabbit.png`,hamster:`${Nr}icon/hamster.png`,bird:`${Nr}icon/bird.png`,hedgehog:`${Nr}icon/hedgehog.png`,reptile:`${Nr}icon/reptile.png`,other:`${Nr}icon/etc.png`},DM=["","","","","","","","","","","","","","","","","","","",""],UM=["","","","","","","","","","","","","","","","",""],BM=[" "," ","","","","",""],zM=["","","","","",""],HM=["","","","","","","",""],qM=["","","","","",""],WM=["","","","","","","",""],$j=[""],KM={dog:DM,cat:UM,rabbit:BM,hamster:zM,bird:HM,hedgehog:qM,reptile:WM,other:$j};function GM({onComplete:t,userId:e}){var P;const[s,n]=O.useState({petName:"",species:"dog",breed:"",birthDate:"",sex:"M",neutered:!0,sido:"",sigungu:"",profileImage:null,character:"dog_white"}),[r,a]=O.useState(!1),[o,l]=O.useState(null),[c,u]=O.useState(null),[h,m]=O.useState(null),[f,y]=O.useState(null),[_,S]=O.useState(!1),[R,k]=O.useState(!1),[x,A]=O.useState(!1),M=j=>{const re=j.target.files[0];if(re){if(re.size>5*1024*1024){alert("  5MB  .");return}a(!0);const Z=new FileReader;Z.onload=le=>{const ce=le.target.result;l(ce),n(F=>({...F,profileImage:ce})),a(!1),u(null)},Z.onerror=()=>{console.error("  "),alert("   ."),a(!1)},Z.readAsDataURL(re),m(null),y(null)}},D=()=>{if(!c&&!o){alert("   .");return}k(!0)},B=async j=>{k(!1),S(!0);try{const re=c||o;if(!re){alert(" .  ."),S(!1);return}const Z=await dM(re,e||"temp","temp",j);Z.success?(m(Z.characterUrl),y(j),A(!0)):alert(Z.error||"  .")}catch(re){console.error("  :",re),alert("    .")}finally{S(!1)}},v=()=>{A(!1),alert(" !")},N=()=>{h&&fetch(h).then(j=>j.blob()).then(j=>{const re=new FileReader;re.onload=Z=>{const le=Z.target.result;l(le),n(ce=>({...ce,profileImage:le}))},re.readAsDataURL(j)}).catch(j=>{console.error("  :",j),l(h),n(re=>({...re,profileImage:h}))}),A(!1),alert("  !")},w=j=>{const Z={dog:"dog_white",cat:"cat_orange",bird:"bird_parrot",hamster:"hamster_gold",rabbit:"rabbit_white",hedgehog:"hedgehog_normal",reptile:"reptile_lizard",other:"other_pet"}[j]||"other_pet",le=j!=="dog"&&j!=="cat";n(ce=>({...ce,species:j,character:Z,breed:le?"":ce.breed}))},E={:["","","","","","","","","","","","","","","","","","","","","","","","",""],:["","","","","","","","","","","","","","","",""],:["","","","","","","",""],:["","","","","","","","","",""],:["","","","",""],:["","","","",""],:["","","","",""],:[""],:[""," "," "," ","","","","","","","","",""," "," "," "," "," "," "," ",""," "," ",""," "," ","","","","",""," "," "," ","","","","","","","",""],:["","","","","","","","","","","","","","","","","",""],:["","","","","","","","",""," "," "," "," ",""],:["","","","","","","","","","",""," "," ","","",""],:["","","","","","","","","","",""," "," ","",""],:["","","","","","","","","","","","","","","","","","","","","",""],:["","","","","","","","","","","","","","","","","","","","","",""," "," "],:["","","","","","","","","","","",""," "," "," "," "," ","","","","",""],:["",""]},C=async j=>{j.preventDefault(),a(!0);try{const re={...s,id:Date.now(),userId:e,createdAt:new Date().toISOString(),originalPhoto:c||null,characters:h?[{url:h,style:f,createdAt:new Date().toISOString()}]:[]};if(e){const Z=ga(e);Z.push(re),await Ko(e,Z,re)}else{const Z=VM();Z.push(re),$M(Z)}t(re)}catch(re){console.error("  :",re),alert("    .  .")}finally{a(!1)}};return i.jsxs("div",{className:"registration-container",children:[i.jsxs("div",{className:"registration-card",children:[i.jsx("header",{className:"bg-gradient-to-r from-sky-500 to-sky-600 text-white px-4 pt-8 pb-8 shadow-lg",children:i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx("div",{className:"w-16 h-16 bg-white rounded-xl flex items-center justify-center shadow-md flex-shrink-0",children:i.jsx("img",{src:"/ai-factory/icon/login/logo_red.png",alt:"PetMedical.AI",className:"w-12 h-12 object-contain"})}),i.jsxs("div",{className:"text-center ml-4",children:[i.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"PetMedical.AI"}),i.jsx("p",{className:"text-sky-100 text-base font-medium",children:"   "})]})]})}),r?i.jsxs("div",{className:"loading-container",children:[i.jsx("div",{className:"spinner"}),i.jsx("p",{children:" ..."})]}):i.jsxs("form",{onSubmit:C,className:"registration-form",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:" *"}),i.jsx("div",{className:"species-grid",children:$f.map(j=>i.jsxs("button",{type:"button",className:`species-btn ${s.species===j.id?"active":""}`,onClick:()=>w(j.id),children:[i.jsx("img",{src:j.icon,alt:j.label,className:"species-icon",onError:re=>{re.target.style.display="none",re.target.nextSibling.style.display="inline"}}),i.jsx("span",{className:"species-emoji",style:{display:"none"},children:j.emoji}),i.jsx("span",{className:"species-label",children:j.label})]},j.id))})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:" "}),i.jsxs("div",{className:"profile-selector",children:[i.jsx("div",{className:"profile-preview-container",children:o?i.jsxs("div",{className:"profile-preview",children:[i.jsx("img",{src:o,alt:" "}),i.jsx("button",{type:"button",className:"remove-image-btn",onClick:()=>{l(null),n(j=>({...j,profileImage:null}))},children:""})]}):i.jsx("div",{className:"profile-preview character",style:{backgroundColor:"#e0f2fe"},children:(()=>{const j=$f.find(Z=>Z.id===s.species),re=(j==null?void 0:j.icon)||null;return re?i.jsx("img",{src:re,alt:j.label,className:"profile-species-icon",onError:Z=>{Z.target.style.display="none",Z.target.parentElement.innerHTML=`<span class="character-emoji">${(j==null?void 0:j.emoji)||""}</span>`}}):i.jsx("span",{className:"character-emoji",children:(j==null?void 0:j.emoji)||""})})()})}),i.jsxs("div",{className:"profile-options",style:{display:"flex",gap:"8px",justifyContent:"center",flexWrap:"wrap"},children:[i.jsxs("label",{className:"upload-btn",style:{opacity:r?.6:1,flex:o?"1":"none",minWidth:o?"120px":"auto",maxWidth:"180px",display:"flex",alignItems:"center",justifyContent:"center",height:"40px",margin:0},children:[r?"  ...":"  ",i.jsx("input",{type:"file",accept:"image/*",onChange:M,style:{display:"none"},disabled:r})]}),o&&i.jsx("button",{type:"button",onClick:D,disabled:_,className:"upload-btn",style:{flex:"1",minWidth:"160px",maxWidth:"200px",height:"40px",background:"#7dd3fc",color:"#0c4a6e",border:"none",opacity:_?.6:1,margin:0,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"600"},children:_?"  ...":"  "})]})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"  *"}),i.jsx("input",{type:"text",required:!0,placeholder:": ",value:s.petName,onChange:j=>n({...s,petName:j.target.value})})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsxs("select",{value:s.breed,onChange:j=>n({...s,breed:j.target.value}),className:"breed-select",children:[i.jsx("option",{value:"",children:" "}),(KM[s.species]||$j).map(j=>i.jsx("option",{value:j,children:j},j))]})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:" *"}),i.jsx("input",{type:"date",required:!0,value:s.birthDate,onChange:j=>n({...s,birthDate:j.target.value})})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:" *"}),i.jsxs("div",{className:"radio-group",children:[i.jsxs("div",{className:`radio-item ${s.sex==="M"?"active":""}`,children:[i.jsx("input",{type:"radio",id:"male",name:"sex",value:"M",checked:s.sex==="M",onChange:j=>n({...s,sex:j.target.value})}),i.jsx("label",{htmlFor:"male",children:" "})]}),i.jsxs("div",{className:`radio-item ${s.sex==="F"?"active":""}`,children:[i.jsx("input",{type:"radio",id:"female",name:"sex",value:"F",checked:s.sex==="F",onChange:j=>n({...s,sex:j.target.value})}),i.jsx("label",{htmlFor:"female",children:" "})]})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"  *"}),i.jsxs("div",{className:"radio-group",children:[i.jsxs("div",{className:`radio-item ${s.neutered===!0?"active":""}`,children:[i.jsx("input",{type:"radio",id:"neutered-yes",name:"neutered",checked:s.neutered===!0,onChange:()=>n({...s,neutered:!0})}),i.jsx("label",{htmlFor:"neutered-yes",children:" "})]}),i.jsxs("div",{className:`radio-item ${s.neutered===!1?"active":""}`,children:[i.jsx("input",{type:"radio",id:"neutered-no",name:"neutered",checked:s.neutered===!1,onChange:()=>n({...s,neutered:!1})}),i.jsx("label",{htmlFor:"neutered-no",children:" "})]})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"  *"}),i.jsxs("select",{required:!0,value:s.sido,onChange:j=>n({...s,sido:j.target.value,sigungu:""}),children:[i.jsx("option",{value:"",children:"/ "}),Object.keys(E).map(j=>i.jsx("option",{value:j,children:j},j))]})]}),s.sido&&i.jsx("div",{className:"form-group",children:i.jsxs("select",{required:!0,value:s.sigungu,onChange:j=>n({...s,sigungu:j.target.value}),children:[i.jsx("option",{value:"",children:"// "}),(P=E[s.sido])==null?void 0:P.map(j=>i.jsx("option",{value:j,children:j},j))]})}),i.jsx("button",{type:"submit",className:"submit-btn",children:" "})]})]}),R&&i.jsx(aM,{onClose:()=>k(!1),onStyleSelect:B,originalImageUrl:c,petName:s.petName||""}),x&&h&&f&&i.jsx(oM,{onClose:()=>A(!1),characterUrl:h,style:f,onSave:v,onSetAsProfile:N,saving:!1})]})}function QM({pets:t,onSelectPet:e,onAddNew:s,onNavigate:n}){return i.jsxs("div",{className:"min-h-screen bg-slate-50",children:[i.jsx("div",{className:"fixed top-0 left-0 right-0 h-16 bg-white/80 backdrop-blur-md border-b border-gray-200 flex items-center px-4 z-50",children:i.jsxs("div",{className:"max-w-md mx-auto w-full flex items-center justify-between",children:[i.jsx("h1",{className:"text-lg font-bold text-gray-900",children:" "}),i.jsx("button",{className:"bg-teal-600 text-white px-4 py-2 rounded-xl text-sm font-bold hover:bg-teal-700 transition-colors",onClick:s,children:"+  "})]})}),i.jsx("div",{className:"pt-20 p-4 max-w-md mx-auto space-y-4",children:t.length===0?i.jsxs("div",{className:"text-center py-20 animate-fade-in",children:[i.jsx("div",{className:"w-24 h-24 mx-auto mb-4 rounded-full overflow-hidden",children:i.jsx("img",{src:Rr.other,alt:"Pet",className:"w-full h-full object-cover"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"  "}),i.jsx("p",{className:"text-gray-500 mb-6",children:"  "}),i.jsx("button",{className:"bg-teal-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-teal-700 transition-colors",onClick:s,children:" "})]}):i.jsx("div",{className:"space-y-4 animate-fade-in",children:t.map(r=>i.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex items-center gap-4 hover:shadow-md hover:border-teal-200 transition-all cursor-pointer",onClick:()=>e(r),children:[i.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden",children:i.jsx("img",{src:Is(r,!1),alt:r.petName,className:"w-full h-full object-cover"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-bold text-gray-900 text-lg",children:r.petName}),i.jsx("p",{className:"text-sm text-gray-500",children:r.breed||" "}),i.jsxs("p",{className:"text-xs text-gray-400",children:[r.sido," ",r.sigungu]})]}),i.jsx("div",{className:"w-8 h-8 rounded-full bg-teal-50 text-teal-600 flex items-center justify-center",children:""})]},r.id))})})]})}function JM({petData:t,pets:e,onNavigate:s,onSelectPet:n,onLogout:r}){var F,Q,K;const[a,o]=O.useState(null),[l,c]=O.useState([]),[u,h]=O.useState(null),[m,f]=O.useState(null),[y,_]=O.useState(null),[S,R]=O.useState(!1),[k,x]=O.useState(100),[A,M]=O.useState(""),[D,B]=O.useState(!1),[v,N]=O.useState({meal:0,water:0,walk:0,treats:0,grooming:0,play:0}),[w,E]=O.useState(null),[C,P]=O.useState(null);O.useEffect(()=>{let I=!0;return(async()=>{if(!(t!=null&&t.id))return;const W=(t==null?void 0:t.petName)||(t==null?void 0:t.name)||"",b=setTimeout(()=>{I&&P({displayText:`${W}        ! `})},5e3);try{let V=!1,J=!1;try{if(t!=null&&t.userId){const z=qi.getBookingsByUser(t.userId,currentUser),q=new Promise((Ve,ye)=>setTimeout(()=>ye(new Error("")),2e3)),ae=await Promise.race([z,q]);V=((ae==null?void 0:ae.data)||ae||[]).some(Ve=>Ve.status==="confirmed"||Ve.status==="completed"||Ve.date&&new Date(Ve.date)<=new Date)}}catch(z){console.warn("    (  ):",z)}try{const z=Da.getDiagnosesByPet(t.id),q=new Promise((Ve,ye)=>setTimeout(()=>ye(new Error("")),2e3)),ae=await Promise.race([z,q]);J=((ae==null?void 0:ae.data)||ae||[]).length>0}catch(z){console.warn("    (  ):",z);try{const q=localStorage.getItem("petMedical_diagnoses");q&&(J=JSON.parse(q).some(je=>je.petId===t.id))}catch(q){console.warn("localStorage    :",q)}}try{const z=A3.getRandomTemplate(V,J),q=new Promise((je,Ve)=>setTimeout(()=>Ve(new Error("")),3e3)),ae=await Promise.race([z,q]);if(clearTimeout(b),I&&ae.success&&ae.data){const je=ae.data.text.replace(/{name}/g,W);P({...ae.data,displayText:je})}else I&&P({displayText:`${W}        ! `})}catch(z){clearTimeout(b),I&&(console.warn("    (  ):",z),P({displayText:`${W}        ! `}))}}catch(V){clearTimeout(b),I&&(console.error("   :",V),P({displayText:`${W}        ! `}))}})(),()=>{I=!1}},[t==null?void 0:t.id,t==null?void 0:t.userId]);const j=()=>{if(!(t!=null&&t.id))return;const I=new Date().toISOString().split("T")[0],L={date:I,petId:t.id,weight:A?parseFloat(A):null,actions:v,savedAt:new Date().toISOString()},W=JSON.parse(localStorage.getItem(`petMedical_careRecords_${t.id}`)||"[]"),b=W.findIndex(J=>J.date===I);b>=0?W[b]=L:W.unshift(L);const V=W.slice(0,30);localStorage.setItem(`petMedical_careRecords_${t.id}`,JSON.stringify(V)),B(!0),setTimeout(()=>B(!1),2e3)};O.useEffect(()=>{if(!(t!=null&&t.id))return;const I=new Date().toISOString().split("T")[0],W=JSON.parse(localStorage.getItem(`petMedical_careRecords_${t.id}`)||"[]").find(b=>b.date===I);W&&(W.weight&&M(W.weight.toString()),W.actions&&N(W.actions))},[t==null?void 0:t.id]),O.useEffect(()=>{if(t)try{const I=localStorage.getItem(`petMedical_healthPoints_${t.id}`);I&&x(parseInt(I))}catch(I){console.error("   :",I)}},[t]),O.useEffect(()=>{if(!t)return;const I=z3(t.id);c(I);const L=FM(t.id);if(L){if(L.healthFlags){const W=Vf(L.healthFlags);o(W)}L.triage_score!==void 0&&f(L.triage_score)}I.length>=3&&!(L!=null&&L.healthFlags)&&W3(t,I).then(W=>{if(h(W),W.health_flags){const b=Vf(W.health_flags);_(b)}}).catch(W=>console.error("  :",W))},[t]),O.useEffect(()=>{(async()=>{if(!(!(t!=null&&t.userId)||!(t!=null&&t.id)))try{const L=await qi.getBookingsByUser(t.userId,currentUser),W=(L==null?void 0:L.data)||L||[];if(W&&W.length>0){const b=W.filter(z=>{var q;return z.petId===t.id||z.petName===t.name||((q=z.pet)==null?void 0:q.name)===t.name});if(b.length===0){E(null);return}const V=new Date,J=b.filter(z=>{const q=z.date?new Date(z.date):z.bookingDate?new Date(z.bookingDate):null;return q&&q>=V}).sort((z,q)=>new Date(z.date||z.bookingDate)-new Date(q.date||q.bookingDate));if(J.length>0)E(J[0]);else if(b.length>0){const z=[...b].sort((q,ae)=>new Date(ae.date||ae.bookingDate)-new Date(q.date||q.bookingDate));E(z[0])}}}catch(L){console.error("   :",L)}})()},[t==null?void 0:t.userId,t==null?void 0:t.id]),{...a||y||{earIssue:!1,digestionIssue:!1,skinIssue:!1,fever:!1,energyLevel:.7}};const Z=()=>{if(!t)return Ta("dog");const I=t.species||"dog",L=Ta(I);return t.profileImage&&typeof t.profileImage=="string"&&t.profileImage.trim()!==""&&(t.profileImage.startsWith("http")||t.profileImage.startsWith("data:"))?t.profileImage:L},le=()=>{if(!t)return"";if(t.species==="dog"||t.species==="cat")return t.breed||(t.species==="dog"?"":"");const I=$f.find(L=>L.id===t.species);return(I==null?void 0:I.label)||""},ce=()=>t!=null&&t.sex?t.sex==="M"?"":"":null;return i.jsxs("div",{className:"min-h-screen bg-slate-100",children:[i.jsxs("div",{className:"hidden",children:[i.jsx("div",{className:"flex-shrink-0 flex items-center justify-center",children:i.jsx("div",{className:"relative w-[430px] h-[932px] rounded-[3rem] shadow-2xl border-8 border-gray-800 overflow-hidden bg-white",children:i.jsxs("div",{className:"h-full overflow-y-auto overflow-x-hidden bg-gradient-to-b from-sky-50 to-white pb-20",children:[i.jsx("header",{className:"bg-gradient-to-r from-sky-500 to-blue-600 text-white px-4 py-4 shadow-lg",children:i.jsxs("div",{className:"flex items-center justify-center gap-2 relative",children:[i.jsx("div",{className:"w-9 h-9 bg-white rounded-lg flex items-center justify-center shadow-md flex-shrink-0 overflow-hidden",children:i.jsx("img",{src:Rr[t==null?void 0:t.species]||Rr.other,alt:"Pet",className:"w-full h-full object-cover"})}),i.jsxs("div",{className:"text-center",children:[i.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"PetMedical.AI"}),i.jsx("p",{className:"text-sky-100 text-xs font-medium",children:"AI     "})]}),i.jsx("button",{onClick:()=>{confirm(" ?")&&r&&r()},className:"absolute right-0 p-2 hover:bg-white/20 rounded-lg transition-colors",title:"",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})}),i.jsx("div",{className:"px-4 pt-4 pb-4",children:t?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-lg border border-slate-100 relative overflow-hidden mb-4",children:[i.jsxs("div",{className:"relative flex items-stretch gap-3",children:[i.jsx("div",{className:"flex-shrink-0 w-28 h-36 rounded-2xl overflow-hidden",children:i.jsx("img",{src:Z(),alt:"Pet Character",className:"w-full h-full object-cover",onError:I=>{if(I.target.dataset.retryAttempted==="true"){console.warn("   ,    "),I.target.style.display="none";return}console.error("  :",I.target.src),I.target.dataset.retryAttempted="true";const L=(t==null?void 0:t.species)||"dog",W=Ta(L);I.target.src!==W?I.target.src=W:I.target.style.display="none"}})}),i.jsxs("div",{className:"flex-1 flex flex-col justify-between py-2",children:[i.jsxs("div",{className:"flex flex-col items-center justify-center text-center w-full",children:[i.jsx("span",{className:"inline-block bg-sky-400 text-white text-sm font-bold px-4 py-1.5 rounded-lg shadow-md mb-2",children:"AI   24 "}),i.jsxs("p",{className:"text-xl font-display font-bold text-gray-900 mt-1.5 w-full",children:[(t==null?void 0:t.petName)||(t==null?void 0:t.name)||"","  "]}),i.jsx("p",{className:"text-lg font-semibold text-sky-600 mt-2.5 w-full",children:"   !"})]}),i.jsxs("div",{className:"flex items-center justify-center gap-1.5 flex-wrap mt-2",children:[i.jsx("span",{className:"text-[11px] text-sky-700 font-semibold bg-sky-100 px-2.5 py-1 rounded-full border border-sky-200",children:le()}),ce()&&i.jsx("span",{className:"text-[11px] text-sky-700 font-semibold bg-sky-100 px-2.5 py-1 rounded-full border border-sky-200",children:ce()}),i.jsx("span",{className:"text-[11px] text-sky-700 font-semibold bg-sky-100 px-2.5 py-1 rounded-full border border-sky-200",children:Vv(t.birthDate)}),i.jsx("button",{onClick:()=>s("profile-list"),className:"text-[11px] text-amber-800 font-semibold bg-amber-100 px-2.5 py-1 rounded-full border border-amber-300 hover:bg-amber-200 transition-colors",children:""})]})]})]}),i.jsx("button",{onClick:()=>s("symptom-input"),className:"w-full mt-3 bg-gradient-to-r from-sky-500 to-sky-600 text-white font-bold text-sm py-3 rounded-xl shadow-md hover:shadow-lg transition-all",children:"PetMedical.AI    >"})]}),i.jsxs("div",{className:"bg-amber-50 rounded-2xl p-3 shadow-lg border-2 border-amber-200 relative overflow-hidden mb-4",children:[i.jsxs("div",{className:"relative flex items-center justify-center gap-2 mb-2",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsx("h3",{className:"text-gray-900 font-display font-bold text-base",children:"AI  "})]}),i.jsx("button",{onClick:()=>s("ai-consultation"),className:"w-full bg-gradient-to-r from-amber-400 to-yellow-500 text-gray-900 font-bold text-sm py-2 rounded-xl shadow-md hover:shadow-lg hover:scale-[1.02] transition-all",children:"7  AI  >"})]}),i.jsxs("div",{className:"mb-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsxs("h3",{className:"text-base font-bold text-gray-800",children:[(t==null?void 0:t.petName)||(t==null?void 0:t.name)||"","  "]})]}),i.jsx("button",{onClick:()=>s("records"),className:"text-xs text-sky-600 font-semibold",children:" >"})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-lg border border-gray-200",children:[i.jsxs("div",{className:"w-full flex items-center gap-3 py-3 border-b border-gray-100",children:[i.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center flex-shrink-0",children:i.jsx("span",{className:"text-2xl",children:""})}),i.jsxs("div",{className:"flex-1 text-left",children:[i.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-0.5",children:" "}),w?i.jsxs("div",{className:"text-xs text-gray-500 space-y-0.5",children:[i.jsx("p",{className:"font-medium text-gray-700",children:w.clinicName||w.hospitalName||""}),i.jsxs("p",{children:[new Date(w.bookingDate||w.date).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"})," ",w.bookingTime||w.time||""]}),(w.symptomText||w.aiDiagnosis||w.diagnosis)&&i.jsx("p",{className:"text-blue-600",children:typeof w.symptomText=="string"?w.symptomText:typeof w.aiDiagnosis=="string"?w.aiDiagnosis:typeof w.diagnosis=="string"?w.diagnosis:((F=w.diagnosis)==null?void 0:F.name)||""})]}):i.jsx("p",{className:"text-xs text-gray-500",children:"  "})]})]}),i.jsxs("div",{className:"flex items-center gap-3 py-3 bg-yellow-50 rounded-xl px-3",children:[i.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0",children:i.jsx("span",{className:"text-xl",children:""})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"text-sm font-bold text-yellow-800 mb-0.5",children:"  "}),i.jsx("p",{className:"text-xs text-yellow-700",children:(C==null?void 0:C.displayText)||"    !"})]})]})]})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-lg border border-gray-200",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-base font-bold text-gray-800",children:" "}),i.jsx("span",{className:"text-xs text-gray-400",children:new Date().toISOString().split("T")[0]})]}),i.jsx("div",{className:"grid grid-cols-5 gap-2 mb-4",children:[{icon:"",label:"",key:"meal"},{icon:"",label:"",key:"water"},{icon:"",label:"",key:"walk"},{icon:"",label:"",key:"treats"},{icon:"",label:"",key:"grooming"}].map(I=>i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"relative",children:[i.jsx("button",{className:"w-12 h-12 bg-gray-50 rounded-full flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-sm",onClick:()=>{N(L=>({...L,[I.key]:L[I.key]+1})),x(L=>{const W=Math.min(100,L+5);return t!=null&&t.id&&localStorage.setItem(`petMedical_healthPoints_${t.id}`,W.toString()),W})},children:i.jsx("span",{className:"text-xl",children:I.icon})}),v[I.key]>0&&i.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center px-1 shadow-md",children:v[I.key]})]}),i.jsx("span",{className:"text-[10px] font-semibold text-gray-500 mt-1",children:I.label})]},I.key))})]})]}):i.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-100",children:[i.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-2",children:" "}),i.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"      "}),i.jsx("button",{onClick:()=>s("profile-registration"),className:"w-full py-3 bg-gradient-to-r from-sky-500 to-sky-600 text-white font-bold rounded-xl hover:shadow-lg transition-all",children:" "})]})})]})})}),i.jsx("main",{className:"flex-1 p-8 overflow-y-auto",children:i.jsxs("div",{className:"max-w-6xl mx-auto",children:[i.jsxs("div",{className:"mb-8",children:[i.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:t?`${(t==null?void 0:t.petName)||(t==null?void 0:t.name)||""}  `:" "}),i.jsx("p",{className:"text-gray-500 mt-2 text-lg",children:"AI 24   "})]}),i.jsx("div",{className:"space-y-6",children:t?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("button",{onClick:()=>s("symptom-input"),className:"bg-gradient-to-br from-sky-500 to-sky-600 text-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all text-left",children:[i.jsx("span",{className:"text-3xl mb-3 block",children:""}),i.jsx("h3",{className:"text-lg font-bold",children:"AI "}),i.jsx("p",{className:"text-sky-100 text-sm mt-1",children:"  AI "})]}),i.jsxs("button",{onClick:()=>s("ai-consultation"),className:"bg-gradient-to-br from-amber-400 to-yellow-500 text-gray-900 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all text-left",children:[i.jsx("span",{className:"text-3xl mb-3 block",children:""}),i.jsx("h3",{className:"text-lg font-bold",children:"AI  "}),i.jsx("p",{className:"text-amber-800 text-sm mt-1",children:"7   "})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[i.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[i.jsx("span",{children:""}),"  "]}),i.jsx("button",{onClick:()=>s("records"),className:"text-sm text-sky-600 font-medium",children:" >"})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"w-full flex items-center gap-3 p-3 bg-blue-50 rounded-xl text-left",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"font-medium text-gray-900",children:" "}),w?i.jsxs("div",{className:"text-sm text-gray-500 space-y-0.5",children:[i.jsx("p",{className:"font-medium text-gray-700",children:w.clinicName||w.hospitalName||""}),i.jsxs("p",{children:[new Date(w.bookingDate||w.date).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"})," ",w.bookingTime||w.time||""]}),(w.symptomText||w.aiDiagnosis||w.diagnosis)&&i.jsx("p",{className:"text-blue-600",children:typeof w.symptomText=="string"?w.symptomText:typeof w.aiDiagnosis=="string"?w.aiDiagnosis:typeof w.diagnosis=="string"?w.diagnosis:((Q=w.diagnosis)==null?void 0:Q.name)||""})]}):i.jsx("p",{className:"text-sm text-gray-500",children:"  "})]})]}),i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-yellow-50 rounded-xl",children:[i.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0",children:i.jsx("span",{className:"text-xl",children:""})}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-yellow-800",children:"  "}),i.jsx("p",{className:"text-sm text-yellow-700",children:(C==null?void 0:C.displayText)||"    !"})]})]})]})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-bold text-gray-900",children:" "}),i.jsx("span",{className:"text-sm text-gray-400",children:new Date().toISOString().split("T")[0]})]}),i.jsx("div",{className:"grid grid-cols-5 gap-3 mb-4",children:[{icon:"",label:"",key:"meal",bg:"bg-gray-50",points:5},{icon:"",label:"",key:"water",bg:"bg-sky-50",points:3},{icon:"",label:"",key:"walk",bg:"bg-yellow-50",points:10},{icon:"",label:"",key:"treats",bg:"bg-orange-50",points:2},{icon:"",label:"",key:"grooming",bg:"bg-amber-50",points:7}].map(I=>i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("button",{className:`w-12 h-12 ${I.bg} rounded-full flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-sm relative`,onClick:()=>{N(L=>({...L,[I.key]:L[I.key]+1})),x(L=>{const W=Math.min(100,L+I.points);return t!=null&&t.id&&localStorage.setItem(`petMedical_healthPoints_${t.id}`,W.toString()),W})},children:[i.jsx("span",{className:"text-xl",children:I.icon}),v[I.key]>0&&i.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center",children:v[I.key]})]}),i.jsx("span",{className:"text-xs text-gray-500 mt-1",children:I.label})]},I.key))}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  (kg)"}),i.jsx("input",{type:"number",step:"0.1",placeholder:"5.2",value:A,onChange:I=>M(I.target.value),className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:border-sky-400 focus:outline-none"})]}),i.jsx("button",{onClick:j,className:`w-full py-3 rounded-xl font-bold text-sm transition-all ${D?"bg-green-500 text-white":"bg-gradient-to-r from-sky-500 to-sky-600 text-white hover:shadow-lg"}`,children:D?" !":` ${(t==null?void 0:t.petName)||(t==null?void 0:t.name)||""}  `})]})]})]})]}):i.jsx("div",{className:"bg-white rounded-2xl p-8 shadow-lg",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-24 h-24 mx-auto mb-4 rounded-full overflow-hidden",children:i.jsx("img",{src:Rr.other,alt:"Pet",className:"w-full h-full object-cover"})}),i.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:" "}),i.jsx("p",{className:"text-gray-500 mb-6",children:" AI   "}),i.jsx("button",{onClick:()=>s("profile-registration"),className:"px-8 py-3 bg-gradient-to-r from-sky-500 to-sky-600 text-white font-bold rounded-xl hover:shadow-lg transition-all",children:" "})]})})})]})})]}),i.jsxs("div",{className:"lg:hidden md:flex md:items-center md:justify-center md:p-8 md:min-h-screen",children:[i.jsx("div",{className:"hidden md:block fixed inset-0 pointer-events-none",children:i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-200 via-sky-100 to-blue-200"})}),i.jsxs("div",{className:"relative md:w-[430px] md:h-[932px] md:rounded-[3rem] md:shadow-2xl md:border-8 md:border-gray-800 overflow-hidden",children:[i.jsx("div",{className:"hidden md:block absolute top-0 left-1/2 -translate-x-1/2 w-32 h-7 bg-gray-800 rounded-b-2xl z-50"}),i.jsxs("div",{className:"h-full overflow-y-auto overflow-x-hidden bg-gradient-to-b from-sky-50 to-white pb-20",children:[i.jsx("header",{className:"bg-gradient-to-r from-sky-500 to-blue-600 text-white px-4 py-4 shadow-lg",children:i.jsxs("div",{className:"flex items-center justify-center gap-2",children:[i.jsx("div",{className:"w-9 h-9 bg-white rounded-lg flex items-center justify-center shadow-md flex-shrink-0 overflow-hidden",children:i.jsx("img",{src:Rr[t==null?void 0:t.species]||Rr.other,alt:"Pet",className:"w-full h-full object-cover"})}),i.jsxs("div",{className:"text-center",children:[i.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"PetMedical.AI"}),i.jsx("p",{className:"text-sky-100 text-xs font-medium",children:"AI     "})]}),i.jsx("button",{onClick:()=>{confirm(" ?")&&r&&r()},className:"p-2 hover:bg-white/20 rounded-full transition-colors",title:"",children:i.jsx("span",{className:"material-symbols-outlined text-white text-2xl",children:"logout"})})]})}),i.jsx("div",{className:"px-4 pt-4 pb-4",children:t?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-lg border border-slate-100 relative overflow-hidden mb-4",children:[i.jsxs("div",{className:"relative flex items-stretch gap-3",children:[i.jsx("div",{className:"flex-shrink-0 w-28 h-36 rounded-2xl overflow-hidden",children:i.jsx("img",{src:Z(),alt:"Pet Character",className:"w-full h-full object-cover",onError:I=>{if(I.target.dataset.retryAttempted==="true"){console.warn("   ,    "),I.target.style.display="none";return}console.error("  :",I.target.src),I.target.dataset.retryAttempted="true";const L=(t==null?void 0:t.species)||"dog",W=Ta(L);I.target.src!==W?I.target.src=W:I.target.style.display="none"}})}),i.jsxs("div",{className:"flex-1 flex flex-col justify-between py-2 min-w-0",children:[i.jsxs("div",{className:"flex flex-col items-center justify-center text-center w-full",children:[i.jsx("span",{className:"inline-block bg-sky-400 text-white text-xs sm:text-sm font-bold px-3 py-1 rounded-full shadow-md mb-2",children:"AI   24 "}),i.jsxs("p",{className:"text-base sm:text-lg font-display font-bold text-gray-900 mt-1.5 w-full leading-tight truncate",children:[(t==null?void 0:t.petName)||(t==null?void 0:t.name)||"","  "]}),i.jsx("p",{className:"text-sm sm:text-base font-semibold text-sky-600 mt-2.5 w-full",children:"   !"})]}),i.jsxs("div",{className:"flex items-center gap-1 flex-wrap mt-2 justify-center",children:[i.jsx("span",{className:"text-[10px] sm:text-[11px] text-sky-700 font-semibold bg-sky-100 px-2 py-0.5 rounded-full border border-sky-200",children:le()}),ce()&&i.jsx("span",{className:`text-[10px] sm:text-[11px] font-semibold px-2 py-0.5 rounded-full border ${(t==null?void 0:t.sex)==="F"?"text-red-600 bg-red-100 border-red-200":"text-sky-700 bg-sky-100 border-sky-200"}`,children:ce()}),i.jsx("span",{className:"text-[10px] sm:text-[11px] text-sky-700 font-semibold bg-sky-100 px-2 py-0.5 rounded-full border border-sky-200",children:Vv(t.birthDate)}),i.jsx("button",{onClick:()=>s("profile-list"),className:"text-[10px] sm:text-[11px] text-amber-800 font-semibold bg-amber-100 px-2 py-0.5 rounded-full border border-amber-300 hover:bg-amber-200 transition-colors",children:""})]})]})]}),i.jsx("button",{onClick:()=>s("symptom-input"),className:"w-full mt-3 bg-gradient-to-r from-sky-500 to-sky-600 text-white font-bold text-xs sm:text-sm py-2.5 sm:py-3 rounded-xl shadow-md hover:shadow-lg transition-all",children:"PetMedical.AI    >"})]}),i.jsxs("div",{className:"bg-amber-50 rounded-2xl p-3 shadow-lg border-2 border-amber-200 relative overflow-hidden mb-4",children:[i.jsxs("div",{className:"relative flex items-center justify-center gap-2 mb-2",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsx("h3",{className:"text-gray-800 font-bold text-base",children:"AI  "})]}),i.jsx("button",{onClick:()=>s("ai-consultation"),className:"w-full bg-gradient-to-r from-amber-400 to-yellow-500 text-gray-900 font-bold text-sm py-2 rounded-xl shadow-md hover:shadow-lg hover:scale-[1.02] transition-all",children:"7  AI  >"})]}),i.jsxs("div",{className:"mb-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsxs("h3",{className:"text-base font-bold text-gray-800",children:[(t==null?void 0:t.petName)||(t==null?void 0:t.name)||"","  "]})]}),i.jsx("button",{onClick:()=>s("records"),className:"text-xs text-sky-600 font-semibold",children:" >"})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-lg border border-gray-200",children:[i.jsxs("div",{className:"w-full flex items-center gap-3 py-3 border-b border-gray-100",children:[i.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center flex-shrink-0",children:i.jsx("span",{className:"text-2xl",children:""})}),i.jsxs("div",{className:"flex-1 text-left",children:[i.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-0.5",children:" "}),w?i.jsxs("div",{className:"text-xs text-gray-500 space-y-0.5",children:[i.jsx("p",{className:"font-medium text-gray-700",children:w.clinicName||w.hospitalName||""}),i.jsxs("p",{children:[new Date(w.bookingDate||w.date).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"})," ",w.bookingTime||w.time||""]}),(w.symptomText||w.aiDiagnosis||w.diagnosis)&&i.jsx("p",{className:"text-blue-600",children:typeof w.symptomText=="string"?w.symptomText:typeof w.aiDiagnosis=="string"?w.aiDiagnosis:typeof w.diagnosis=="string"?w.diagnosis:((K=w.diagnosis)==null?void 0:K.name)||""})]}):i.jsx("p",{className:"text-xs text-gray-500",children:"  "})]})]}),i.jsxs("div",{className:"flex items-center gap-3 py-3 bg-yellow-50 rounded-xl px-3",children:[i.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0",children:i.jsx("span",{className:"text-xl",children:""})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"text-sm font-bold text-yellow-800 mb-0.5",children:"  "}),i.jsx("p",{className:"text-xs text-yellow-700",children:(C==null?void 0:C.displayText)||"    !"})]})]})]})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-lg border border-gray-200",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-base font-bold text-gray-800",children:" "}),i.jsx("span",{className:"text-xs text-gray-400",children:new Date().toISOString().split("T")[0]})]}),i.jsxs("div",{className:"grid grid-cols-5 gap-2 mb-4",children:[i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"relative",children:[i.jsx("button",{className:"w-12 h-12 bg-gray-50 rounded-full flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-sm",onClick:()=>{N(I=>({...I,meal:I.meal+1})),x(I=>{const L=Math.min(100,I+5);return t!=null&&t.id&&localStorage.setItem(`petMedical_healthPoints_${t.id}`,L.toString()),L})},children:i.jsx("span",{className:"text-xl",children:""})}),v.meal>0&&i.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center px-1 shadow-md",children:v.meal})]}),i.jsx("span",{className:"text-[10px] font-semibold text-gray-500 mt-1",children:""})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"relative",children:[i.jsx("button",{className:"w-12 h-12 bg-sky-50 rounded-full flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-sm",onClick:()=>{N(I=>({...I,water:I.water+1})),x(I=>{const L=Math.min(100,I+3);return t!=null&&t.id&&localStorage.setItem(`petMedical_healthPoints_${t.id}`,L.toString()),L})},children:i.jsx("span",{className:"text-xl",children:""})}),v.water>0&&i.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center px-1 shadow-md",children:v.water})]}),i.jsx("span",{className:"text-[10px] font-semibold text-gray-500 mt-1",children:""})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"relative",children:[i.jsx("button",{className:"w-12 h-12 bg-yellow-50 rounded-full flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-sm",onClick:()=>{N(I=>({...I,walk:I.walk+1})),x(I=>{const L=Math.min(100,I+10);return t!=null&&t.id&&localStorage.setItem(`petMedical_healthPoints_${t.id}`,L.toString()),L})},children:i.jsx("span",{className:"text-xl",children:""})}),v.walk>0&&i.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center px-1 shadow-md",children:v.walk})]}),i.jsx("span",{className:"text-[10px] font-semibold text-gray-500 mt-1",children:""})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"relative",children:[i.jsx("button",{className:"w-12 h-12 bg-orange-50 rounded-full flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-sm",onClick:()=>{N(I=>({...I,treats:I.treats+1})),x(I=>{const L=Math.min(100,I+2);return t!=null&&t.id&&localStorage.setItem(`petMedical_healthPoints_${t.id}`,L.toString()),L})},children:i.jsx("span",{className:"text-xl",children:""})}),v.treats>0&&i.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center px-1 shadow-md",children:v.treats})]}),i.jsx("span",{className:"text-[10px] font-semibold text-gray-500 mt-1",children:""})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"relative",children:[i.jsx("button",{className:"w-12 h-12 bg-amber-50 rounded-full flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-sm",onClick:()=>{N(I=>({...I,grooming:I.grooming+1})),x(I=>{const L=Math.min(100,I+7);return t!=null&&t.id&&localStorage.setItem(`petMedical_healthPoints_${t.id}`,L.toString()),L})},children:i.jsx("span",{className:"text-xl",children:""})}),v.grooming>0&&i.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center px-1 shadow-md",children:v.grooming})]}),i.jsx("span",{className:"text-[10px] font-semibold text-gray-500 mt-1",children:""})]})]}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"  (kg)"}),i.jsx("input",{type:"number",step:"0.1",placeholder:"5.2",value:A,onChange:I=>M(I.target.value),className:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:border-sky-400 focus:outline-none text-sm"})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:" "}),i.jsx("input",{type:"text",placeholder:"  ",className:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:border-sky-400 focus:outline-none text-sm"})]}),i.jsx("button",{onClick:j,className:`w-full py-3 rounded-xl font-bold text-sm transition-all ${D?"bg-green-500 text-white":"bg-gradient-to-r from-sky-500 to-sky-600 text-white hover:shadow-lg"}`,children:D?" !":` ${(t==null?void 0:t.petName)||(t==null?void 0:t.name)||""}  `})]})]}):i.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-100",children:[i.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-2",children:" "}),i.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"      "}),i.jsx("button",{onClick:()=>s("profile-registration"),className:"w-full py-3 bg-gradient-to-r from-sky-500 to-sky-600 text-white font-bold rounded-xl hover:shadow-lg transition-all",children:" "})]})})]})]})]})]})}function YM({petData:t,onComplete:e,onBack:s,onRegister:n}){const[r,a]=O.useState(""),[o,l]=O.useState([]),[c,u]=O.useState(!1),[h,m]=O.useState(""),[f,y]=O.useState([]),_={:{icon:"",desc:", ,  "},:{icon:"",desc:", , "},:{icon:"",desc:",  "},:{icon:"",desc:",  "},:{icon:"",desc:", "},:{icon:"",desc:"  "},:{icon:"",desc:",  "},:{icon:"",desc:",  "},:{icon:"",desc:",  "},:{icon:"",desc:",  "},:{icon:"",desc:", , "},:{icon:"",desc:", , "}," ":{icon:"",desc:"  "},:{icon:"",desc:" "}," ":{icon:"",desc:"  "}},S={dog:["","","","","","","","","",""],cat:["","","","","","","","",""],rabbit:["","","","",""],hamster:["","","",""],bird:[" ","","",""],hedgehog:["","","",""],reptile:[" ","","",""],other:["","","",""]},R={dog:{:[" ","","",""," "],:["","( )","/"," "," "],:[""," "," ","/"," "],:[" "," "," "," ","  "],:[" ","  "," "," ","   "],:[""," ","/ "," "," "],:["  ","  ","  "," ","  "],:["","  ","/","  "," "],:[" "," "," ","/",""],:["",""," "," ",""],:[""," "," ",""," "],:["",""," ","/"," "]},cat:{:[" ","",""," ",""],:[""," "," ","/"," "],:[""," ",""," "," "],:["/"," "," "," "," "],:[" ","  "," ","  "," "],:[""," "," "," "," "],:["  ","   ","  "," ","  "],:[" "," ","","/"," "],:[" "," "," "," /",""]},rabbit:{:[" ",""," "," "," "],:[" "," "," "," ",""],:[" "," "," ",""," "],:[" ",""," "," "," "],:["",""," "," "," "]},hamster:{:[" ",""," "," "," "],:[" "," ","","",""],:[" "," "," ","  ","  "],:[" "," "," ","",""]},bird:{" ":[" "," ",""," "," "],:[" ","",""," ",""],:[" "," "," "," "," "],:[" ","  "," ",""," "]},hedgehog:{:[" ",""," "," "," "],:[" "," ","",""," "],:[" "," ","","",""],:["",""," ","",""]},reptile:{" ":[" "," ",""," "," "],:[" "," ","","",""],:[" "," ","","",""],:["  ","",""," ",""]},other:{:[" ",""," "," "," "],:[" ","","",""," "],:["","","",""," "],:["/ ","","","",""]}};if(!t)return i.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-lg border border-slate-100 text-center max-w-sm",children:[i.jsx("div",{className:"w-20 h-20 bg-sky-100 rounded-full mx-auto mb-4 flex items-center justify-center",children:i.jsx("span",{className:"text-4xl",children:""})}),i.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:" "}),i.jsxs("p",{className:"text-sm text-slate-500 mb-6",children:["   ",i.jsx("br",{})," AI     "]}),i.jsx("button",{onClick:()=>n?n():s(),className:"w-full py-3 bg-sky-500 text-white font-bold rounded-xl hover:bg-sky-600 transition-colors",children:" "}),i.jsx("button",{onClick:s,className:"w-full mt-3 py-3 bg-slate-100 text-slate-600 font-medium rounded-xl hover:bg-slate-200 transition-colors",children:""})]})});const k=S[t.species]||S.other,x=R[t.species]||R.other,A=h?x[h]||[]:[],M=w=>{const C=Array.from(w.target.files).map(P=>new Promise(j=>{const re=new FileReader;re.onload=Z=>j(Z.target.result),re.readAsDataURL(P)}));Promise.all(C).then(P=>{l(j=>[...j,...P])})},D=w=>{l(E=>E.filter((C,P)=>P!==w))},B=()=>{if(!h){alert(" .");return}if(f.length===0&&!r.trim()&&o.length===0){alert("  .");return}u(!0);const w=[...f];r.trim()&&w.push(r.trim());const E=w.join(", ");setTimeout(()=>{e({symptomText:E,selectedSymptoms:f,userDescription:r,department:h,images:o,petData:t})},500)},v=w=>{y(E=>E.includes(w)?E.filter(C=>C!==w):[...E,w])},N=w=>{h===w?m(""):(m(w),y([]))};return i.jsxs("div",{className:"min-h-screen bg-slate-50",children:[i.jsxs("div",{className:"bg-white px-3 sm:px-4 py-3 sm:py-4 border-b border-slate-100",children:[i.jsx("div",{className:"flex items-center gap-2 sm:gap-3 mb-1 sm:mb-2",children:i.jsx("button",{onClick:s,className:"text-slate-600",children:i.jsx("span",{className:"text-xs sm:text-sm",children:" "})})}),i.jsx("h1",{className:"text-lg sm:text-xl font-bold text-slate-900",children:"AI  "}),i.jsxs("p",{className:"text-xs sm:text-sm text-slate-500 mt-0.5 sm:mt-1",children:[t.petName||t.name||"","  "]})]}),i.jsxs("div",{className:"px-4 pt-4 pb-32 space-y-4",children:[i.jsxs("div",{className:"bg-white rounded-2xl p-3 sm:p-4 shadow-sm border border-slate-100",children:[i.jsx("h3",{className:"font-bold text-slate-800 mb-0.5 sm:mb-1 text-xs sm:text-sm",children:"  ? *"}),i.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mb-2 sm:mb-3",children:" "}),i.jsx("div",{className:"grid grid-cols-2 gap-1.5 sm:gap-2",children:k.map(w=>{const E=_[w]||{icon:"",desc:" "},C=h===w;return i.jsxs("button",{onClick:()=>N(w),className:`p-2 sm:p-3 rounded-xl text-left transition-all border-2 ${C?"bg-sky-50 border-sky-500":"bg-white border-slate-200 hover:border-slate-300"}`,children:[i.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-0.5 sm:mb-1",children:[i.jsx("span",{className:"text-base sm:text-lg",children:E.icon}),i.jsx("span",{className:`font-bold text-xs sm:text-sm ${C?"text-sky-700":"text-slate-800"}`,children:w})]}),i.jsx("p",{className:`text-[10px] sm:text-xs ${C?"text-sky-600":"text-slate-500"} leading-tight`,children:E.desc})]},w)})})]}),h&&A.length>0&&i.jsxs("div",{className:"bg-white rounded-2xl p-3 sm:p-4 shadow-sm border border-slate-100",children:[i.jsxs("h3",{className:"font-bold text-slate-800 mb-0.5 sm:mb-1 text-xs sm:text-sm",children:[h,"  "]}),i.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mb-2 sm:mb-3",children:"   "}),i.jsx("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:A.map(w=>i.jsx("button",{onClick:()=>v(w),className:`px-2 sm:px-3 py-1.5 sm:py-2 rounded-xl text-xs sm:text-sm font-medium transition-all border ${f.includes(w)?"bg-sky-500 text-white border-sky-500":"bg-slate-50 text-slate-700 border-slate-200 hover:border-sky-300"}`,children:w},w))}),f.length>0&&i.jsx("div",{className:"mt-2 sm:mt-3 p-2 sm:p-3 bg-sky-50 rounded-xl",children:i.jsxs("p",{className:"text-[10px] sm:text-xs text-sky-700 font-medium leading-relaxed",children:[" : ",f.join(", ")]})})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-3 sm:p-4 shadow-sm border border-slate-100",children:[i.jsx("h3",{className:"font-bold text-slate-800 mb-0.5 sm:mb-1 text-xs sm:text-sm",children:"  "}),i.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mb-2 sm:mb-3",children:"     "}),i.jsx("textarea",{className:"w-full p-2.5 sm:p-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 min-h-[70px] sm:min-h-[80px] text-xs sm:text-sm resize-none",placeholder:": 3     ,   ...",value:r,onChange:w=>a(w.target.value)})]}),i.jsxs("div",{className:"bg-white rounded-2xl p-3 sm:p-4 shadow-sm border border-slate-100",children:[i.jsx("h3",{className:"font-bold text-slate-800 mb-2 sm:mb-3 text-xs sm:text-sm",children:"   ()"}),i.jsxs("div",{className:"flex gap-2 sm:gap-3 overflow-x-auto pb-2",children:[o.map((w,E)=>i.jsxs("div",{className:"relative shrink-0",children:[i.jsx("img",{src:w,alt:`  ${E+1}`,className:"w-16 h-16 sm:w-20 sm:h-20 object-cover rounded-xl"}),i.jsx("button",{onClick:()=>D(E),className:"absolute -top-1.5 -right-1.5 sm:-top-2 sm:-right-2 w-5 h-5 sm:w-6 sm:h-6 bg-red-500 text-white rounded-full text-[10px] sm:text-xs flex items-center justify-center",children:""})]},E)),i.jsxs("label",{className:"w-16 h-16 sm:w-20 sm:h-20 shrink-0 border-2 border-dashed border-slate-300 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:border-sky-500 hover:bg-sky-50 transition-all",children:[i.jsx("span",{className:"text-xl sm:text-2xl text-slate-400",children:""}),i.jsx("span",{className:"text-[9px] sm:text-[10px] text-slate-400 mt-0.5 sm:mt-1",children:""}),i.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:M,className:"hidden"})]})]}),i.jsx("p",{className:"text-[10px] sm:text-xs text-slate-400 mt-1.5 sm:mt-2",children:", ,          "})]})]}),i.jsx("div",{className:"fixed bottom-16 left-0 right-0 md:left-1/2 md:-translate-x-1/2 md:w-[430px] bg-white/95 backdrop-blur-sm border-t border-slate-100 p-4 z-40",children:i.jsx("button",{onClick:B,disabled:c||f.length===0&&!r.trim()&&o.length===0,className:"w-full bg-sky-500 text-white py-3 px-6 rounded-xl font-bold text-base disabled:opacity-50 disabled:cursor-not-allowed hover:bg-sky-600 active:bg-sky-700 transition-all flex items-center justify-center gap-2 shadow-lg shadow-sky-500/30",children:c?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),i.jsx("span",{className:"text-base font-bold",children:"AI  ..."})]}):i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"material-symbols-outlined text-xl",children:"psychology"}),i.jsx("span",{className:"text-base font-bold",children:"AI "})]})})})]})}const XM=t=>{const e=t.toLowerCase();return e.includes("")||e.includes("ear")?{diagnosis:" ( 75%)",emergency:"medium",actions:["    (  )","   (   )","  ","  (  )"],hospitalVisit:!0,hospitalVisitTime:"24 ",description:"      .        ."}:e.includes("")||e.includes("cough")||e.includes("")?{diagnosis:"   ( 70%)",emergency:"medium",actions:["  ","  ","   (20-22)","     "],hospitalVisit:!0,hospitalVisitTime:"48 ",description:"      .       ."}:e.includes("")||e.includes("")||e.includes("")||e.includes("appetite")?{diagnosis:" ( 65%)",emergency:e.includes("")||e.includes("")?"high":"medium",actions:["  ","   (,  )","  ","/     "],hospitalVisit:e.includes("")||e.includes(""),hospitalVisitTime:e.includes("")||e.includes("")?"":"24 ",description:"     .          ."}:e.includes("")||e.includes("diarrhea")||e.includes("")?{diagnosis:"  ( 70%)",emergency:"high",actions:["  ( )","  (12-24)","  ","   "],hospitalVisit:!0,hospitalVisitTime:"",description:"    .           ."}:e.includes("")||e.includes("")||e.includes("seizure")?{diagnosis:"   ( 80%)",emergency:"high",actions:["  ","    ","    ","  "],hospitalVisit:!0,hospitalVisitTime:"",description:"     .  5       ."}:{diagnosis:"   ( 60%)",emergency:"low",actions:["  ","  ","  ","    "],hospitalVisit:!1,hospitalVisitTime:"  ",description:"  ,       ."}};function ZM({petData:t,symptomData:e,onComplete:s,onBack:n,onDiagnosisResult:r,currentUser:a}){var an,jt;const[o,l]=O.useState([]),[c,u]=O.useState(0),[h,m]=O.useState(!1),[f,y]=O.useState({medical:!0,triage:!0,care:!0}),[_,S]=O.useState(null),[R,k]=O.useState(!0),[x,A]=O.useState(""),[M,D]=O.useState(!1),[B,v]=O.useState(!1),[N,w]=O.useState([]),[E,C]=O.useState(!1),P=O.useRef(null),[j,re]=O.useState([]),[Z,le]=O.useState({}),[ce,F]=O.useState(!1),[Q,K]=O.useState(""),I=O.useRef(null),[L,W]=O.useState(!1),[b,V]=O.useState(null),[J,z]=O.useState([]),q=O.useRef(null);O.useEffect(()=>{P.current&&P.current.scrollIntoView({behavior:"smooth"})},[o]),O.useEffect(()=>{let ie=!0;return(async()=>{var Ee,Ce;try{k(!0),l([]),u(0);const ze=(Ne,Oe="questions")=>new Promise(Ze=>{if(!ie){Ze(Oe==="faq"?[]:{});return}Oe==="faq"?(V(Ne),z([]),W(!0),q.current=Ze):(re(Ne),le({}),F(!0),K(""),I.current=Ze)});if([{agent:"CS Agent",role:"   ",icon:"",type:"cs",content:", .   .",delay:0},{agent:"Information Agent",role:"  ",icon:"",type:"info",content:",  .    .",delay:1500},{agent:"Veterinarian Agent",role:" ",icon:"",type:"medical",content:"   ...",delay:3e3},{agent:"Triage Engine",role:" ",icon:"",type:"triage",content:"  ...",delay:4500},{agent:"Care Agent",role:"   ",icon:"",type:"care",content:"   ...",delay:6e3}].forEach((Ne,Oe)=>{setTimeout(()=>{ie&&(l(Ze=>[...Ze,{agent:Ne.agent,role:Ne.role,icon:Ne.icon,type:Ne.type,content:Ne.content,timestamp:Date.now()}]),u(Oe+1))},Ne.delay)}),console.log("[MultiAgentDiagnosis]    "),!ie)return;try{const Ne=await LM(t,e,Oe=>{l(Ze=>[...Ze,{agent:Oe.agent||"System",role:Oe.role||"",icon:Oe.icon||"",type:Oe.type||"cs",content:Oe.content||Oe.message||"",isQuestionPhase:Oe.isQuestionPhase||!1,questions:Oe.questions||null,timestamp:Date.now()}])},ze);if(Ne&&Ne.finalDiagnosis){S(Ne.finalDiagnosis),m(!0),k(!1),D(!0),dm(Ne.finalDiagnosis,a==null?void 0:a.uid),r&&r(Ne.finalDiagnosis);return}else throw new Error("   .")}catch(Ne){throw console.error("[MultiAgentDiagnosis]    :",Ne),l(Oe=>[...Oe,{agent:"System",role:"",icon:"",type:"error",content:`   : ${Ne.message}`,timestamp:Date.now()}]),k(!1),Ne}if(!ie)return;if(console.log("[MultiAgentDiagnosis]  :",result),console.log("[MultiAgentDiagnosis] finalDiagnosis:",result==null?void 0:result.finalDiagnosis),!result||!result.finalDiagnosis){console.error("[MultiAgentDiagnosis]   :",result),k(!1),alert("     .  .");return}setTimeout(()=>{try{S(result.finalDiagnosis),m(!0),k(!1),D(!0),dm(result.finalDiagnosis,a==null?void 0:a.uid),r&&r(result.finalDiagnosis),console.log("[MultiAgentDiagnosis]   ")}catch(Ne){console.error("[MultiAgentDiagnosis]   :",Ne),k(!1),alert("    .")}},1500)}catch(ze){console.error("AI  :",ze);const ct=(e==null?void 0:e.symptomText)||"  ",Ne=((Ee=e==null?void 0:e.images)==null?void 0:Ee.length)>0,Oe=XM(ct),Ze=[{agent:"CS Agent",role:" ",icon:"",type:"cs",content:`, ${(t==null?void 0:t.petName)||(t==null?void 0:t.name)||""} .

 .

 :
 : ${(t==null?void 0:t.petName)||(t==null?void 0:t.name)||""}
 : ${Cs(t.species)}
 : ${t.breed||""}

:
${ct}
${Ne?`
 ${e.images.length}  
`:""}
 Information Agent .`},{agent:"Information Agent",role:"",icon:"",type:"info",content:`     ...

${Ne?`  :    ...
`:""}   :   ...
   :    ...
   : AI   ...

  . Veterinarian Agent .`},{agent:"Veterinarian Agent",role:" ",icon:"",type:"medical",content:`   ...

   :
${Oe.description}

  :
 ${typeof Oe.diagnosis=="string"?Oe.diagnosis:((Ce=Oe.diagnosis)==null?void 0:Ce.name)||"  "}

 : ${Oe.emergency==="low"?"":Oe.emergency==="medium"?"":""}
 : ${Oe.emergency==="low"?" ":Oe.emergency==="medium"?" ":" "}

 Data Agent,   .`},{agent:"Data Agent",role:" ",icon:"",type:"data",content:`   ...

    
   
    
  PDF   

   !`}];Ze.forEach((Ws,xs)=>{setTimeout(()=>{l(Ps=>[...Ps,Ws]),u(xs+1),xs===Ze.length-1&&setTimeout(()=>{const Ps={...Oe,id:Date.now().toString(),created_at:Date.now(),petId:t.id,petName:(t==null?void 0:t.petName)||(t==null?void 0:t.name)||"",symptom:ct};S(Ps),m(!0),k(!1),D(!0),dm(Ps,a==null?void 0:a.uid),r&&r(Ps)},1500)},xs*3e3)})}})(),()=>{ie=!1}},[t==null?void 0:t.id,e==null?void 0:e.symptomText]);const ae=(ie,Te,Ee)=>{le(Ce=>{if(Ee){const ze=Ce[ie]||[];if(ze.includes(Te))return{...Ce,[ie]:ze.filter(ct=>ct!==Te)};{if(Te==="")return{...Ce,[ie]:[""]};const ct=ze.filter(Ne=>Ne!=="");return{...Ce,[ie]:[...ct,Te]}}}else return{...Ce,[ie]:Te}})},je=()=>{if(!j.every(Ce=>{const ze=Z[Ce.id];return Ce.type==="multiple",ze&&ze.length>0})){alert("   .");return}const Te={...Z,additionalComment:Q.trim()||""},Ee=j.map(Ce=>{const ze=Z[Ce.id],ct=Array.isArray(ze)?ze.join(", "):ze;return` ${Ce.question}
   ${ct}`}).join(`

`);l(Ce=>[...Ce,{agent:"",role:"",icon:"",type:"user",content:`   

${Ee}${Q?`

  : ${Q}`:""}`,isUser:!0,timestamp:Date.now()}]),I.current&&(I.current(Te),I.current=null),F(!1),re([])},Ve=ie=>{z(Te=>Te.includes(ie)?Te.filter(Ee=>Ee!==ie):[...Te,ie])},ye=()=>{q.current&&(q.current(J.length>0?J:["skip"]),q.current=null),W(!1),V(null),z([])},ht=()=>{q.current&&(q.current(["skip"]),q.current=null),W(!1),V(null),z([])},Qe=ie=>{const Te={cs:{bg:"#EFF6FF",icon:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"#BFDBFE"},info:{bg:"#F0FDF4",icon:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"#BBF7D0"},medical:{bg:"#F5F3FF",icon:"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)",border:"#DDD6FE"},triage:{bg:"#FEF2F2",icon:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",border:"#FECACA"},data:{bg:"#FFF7ED",icon:"linear-gradient(135deg, #f97316 0%, #ea580c 100%)",border:"#FED7AA"},care:{bg:"#ECFEFF",icon:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",border:"#A5F3FC"},summary:{bg:"#F8FAFC",icon:"linear-gradient(135deg, #64748b 0%, #475569 100%)",border:"#E2E8F0"}};return Te[ie]||Te.cs};return i.jsxs("div",{className:"diagnosis-container",style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[i.jsxs("div",{style:{background:"linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%)",padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"center",borderBottom:"1px solid #bae6fd",position:"relative"},children:[i.jsx("button",{onClick:n,style:{position:"absolute",left:"12px",background:"none",border:"none",fontSize:"20px",cursor:"pointer",color:"#0369a1"},children:""}),i.jsx("div",{style:{textAlign:"center"},children:i.jsx("div",{style:{fontSize:"15px",fontWeight:"bold",color:"#0c4a6e"},children:" PetMedical.AI "})})]}),i.jsxs("div",{className:"chat-messages-container",style:{padding:"16px",display:"flex",flexDirection:"column",gap:"12px",flex:1,overflowY:"auto",background:"#f8fafc"},children:[o.length===0&&R&&i.jsxs("div",{className:"initial-loading",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px",gap:"16px"},children:[i.jsx("div",{className:"loading-spinner"}),i.jsx("p",{style:{margin:0,fontSize:"16px",color:"#333"},children:"AI   ..."}),i.jsx("p",{style:{margin:0,fontSize:"14px",color:"#666"},children:" "})]}),o.map((ie,Te)=>{const Ee=ie.agent===""||ie.isUser,Ce=ie.type==="system",ze=Qe(ie.type);return Ce?i.jsx("div",{style:{textAlign:"center",padding:"8px 16px",margin:"4px 0",fontSize:"12px",color:"#64748b",fontWeight:"500"},children:ie.content},Te):i.jsxs("div",{style:{display:"flex",flexDirection:Ee?"row-reverse":"row",gap:"8px",alignItems:"flex-start",marginBottom:"8px"},children:[!Ee&&i.jsx("div",{style:{width:"36px",height:"36px",minWidth:"36px",borderRadius:"50%",background:ze.icon,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",boxShadow:"0 2px 6px rgba(0,0,0,0.1)"},children:ie.icon||""}),i.jsxs("div",{style:{maxWidth:"70%",display:"flex",flexDirection:"column",gap:"4px"},children:[!Ee&&i.jsx("div",{style:{fontSize:"11px",color:"#64748b",fontWeight:"600",paddingLeft:"12px"},children:ie.role||ie.agent}),i.jsxs("div",{style:{background:Ee?"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)":ze.bg,color:Ee?"white":"#1e293b",borderRadius:Ee?"16px 16px 4px 16px":"16px 16px 16px 4px",padding:"12px 16px",fontSize:"14px",lineHeight:"1.6",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",border:Ee?"none":`1px solid ${ze.border}`,wordBreak:"break-word"},children:[ie.content.split(`
`).map((ct,Ne)=>i.jsx("div",{style:{marginBottom:ct?"4px":"0",whiteSpace:"pre-wrap"},children:ct},Ne)),ie.isQuestion&&ie.questionData&&!ie.answered&&i.jsx("div",{style:{marginTop:"12px",display:"flex",flexDirection:"column",gap:"6px"},children:ie.questionData.options.map((ct,Ne)=>i.jsx("button",{onClick:()=>{l(Oe=>{const Ze=[...Oe],Ws=Ze.findIndex(xs=>xs.timestamp===ie.timestamp);return Ws!==-1&&(Ze[Ws]={...Ze[Ws],answered:!0}),Ze}),l(Oe=>[...Oe,{agent:"",role:"",icon:"",type:"user",content:ct,isUser:!0,timestamp:Date.now()}])},style:{padding:"10px 14px",borderRadius:"8px",border:"1px solid #cbd5e1",background:"white",color:"#1e293b",fontSize:"13px",cursor:"pointer",transition:"all 0.2s",textAlign:"left"},onMouseEnter:Oe=>{Oe.target.style.background="#f1f5f9",Oe.target.style.borderColor="#94a3b8"},onMouseLeave:Oe=>{Oe.target.style.background="white",Oe.target.style.borderColor="#cbd5e1"},children:ct},Ne))})]}),i.jsx("div",{style:{fontSize:"10px",color:"#94a3b8",paddingLeft:Ee?"0":"12px",paddingRight:Ee?"12px":"0",textAlign:Ee?"right":"left"},children:new Date(ie.timestamp||Date.now()).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})})]}),Ee&&i.jsx("div",{style:{width:"36px",height:"36px",minWidth:"36px",borderRadius:"50%",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",boxShadow:"0 2px 6px rgba(0,0,0,0.1)"},children:""})]},Te)}),R&&o.length>0&&i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"flex-start",marginBottom:"8px"},children:[i.jsx("div",{style:{width:"36px",height:"36px",minWidth:"36px",borderRadius:"50%",background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",boxShadow:"0 2px 6px rgba(0,0,0,0.1)"},children:""}),i.jsx("div",{style:{background:"white",borderRadius:"16px 16px 16px 4px",padding:"16px 20px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:i.jsxs("div",{style:{display:"flex",gap:"4px",alignItems:"center"},children:[i.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#6366f1",animation:"pulse 1.4s infinite",animationDelay:"0s"}}),i.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#6366f1",animation:"pulse 1.4s infinite",animationDelay:"0.2s"}}),i.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#6366f1",animation:"pulse 1.4s infinite",animationDelay:"0.4s"}})]})})]}),ce&&j.length>0&&i.jsxs("div",{style:{background:"linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)",borderRadius:"16px",padding:"20px",margin:"12px 0",border:"2px solid #0ea5e9",boxShadow:"0 4px 12px rgba(14, 165, 233, 0.15)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[i.jsx("span",{style:{fontSize:"24px"},children:""}),i.jsxs("div",{children:[i.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"700",color:"#0369a1"},children:" "}),i.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#0284c7"},children:"      "})]})]}),j.map((ie,Te)=>{const Ee=ie.type==="multiple",Ce=Z[ie.id]||(Ee?[]:"");return i.jsxs("div",{style:{marginBottom:"20px",padding:"16px",background:"white",borderRadius:"12px",boxShadow:"0 2px 6px rgba(0,0,0,0.06)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"8px",marginBottom:"12px"},children:[i.jsx("span",{style:{background:"#0ea5e9",color:"white",width:"24px",height:"24px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"700",flexShrink:0},children:Te+1}),i.jsxs("div",{children:[i.jsx("p",{style:{margin:0,fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:ie.question}),Ee&&i.jsx("span",{style:{fontSize:"11px",color:"#64748b",marginTop:"4px",display:"block"},children:"  "})]})]}),i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:ie.options.map((ze,ct)=>{const Ne=Ee?Ce.includes(ze):Ce===ze;return i.jsxs("button",{onClick:()=>ae(ie.id,ze,Ee),style:{padding:"10px 16px",borderRadius:"20px",border:Ne?"2px solid #0ea5e9":"2px solid #e2e8f0",background:Ne?"linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)":"white",color:Ne?"white":"#475569",fontSize:"13px",fontWeight:Ne?"600":"500",cursor:"pointer",transition:"all 0.2s ease",boxShadow:Ne?"0 2px 8px rgba(14, 165, 233, 0.3)":"none"},children:[Ne&&i.jsx("span",{style:{marginRight:"4px"},children:""}),ze]},ct)})})]},ie.id)}),i.jsxs("div",{style:{marginBottom:"16px",padding:"16px",background:"white",borderRadius:"12px",boxShadow:"0 2px 6px rgba(0,0,0,0.06)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[i.jsx("span",{style:{fontSize:"16px"},children:""}),i.jsx("p",{style:{margin:0,fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:"   ? ()"})]}),i.jsx("textarea",{value:Q,onChange:ie=>K(ie.target.value),placeholder:":       /    ",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px",minHeight:"80px",resize:"vertical",fontFamily:"inherit",boxSizing:"border-box"}})]}),i.jsxs("button",{onClick:je,style:{width:"100%",padding:"14px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)",color:"white",fontSize:"14px",fontWeight:"700",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",boxShadow:"0 4px 12px rgba(14, 165, 233, 0.3)",transition:"all 0.2s ease",whiteSpace:"nowrap"},children:[i.jsx("span",{children:"    "}),i.jsx("span",{style:{fontSize:"16px"},children:""})]})]}),L&&b&&i.jsxs("div",{style:{background:"linear-gradient(135deg, #FFF9DB 0%, #FEF3C7 100%)",borderRadius:"16px",padding:"20px",margin:"12px 0",border:"2px solid #FCD34D",boxShadow:"0 4px 12px rgba(252, 211, 77, 0.25)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[i.jsx("span",{style:{fontSize:"24px"},children:""}),i.jsxs("div",{children:[i.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"700",color:"#92400E"},children:b.title}),i.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#B45309"},children:b.subtitle})]})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginBottom:"16px"},children:b.faqs&&b.faqs.map(ie=>{const Te=J.includes(ie.id);return i.jsxs("button",{onClick:()=>Ve(ie.id),style:{width:"100%",padding:"14px 16px",borderRadius:"12px",border:Te?"2px solid #F59E0B":"2px solid #e2e8f0",background:Te?"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)":"white",color:Te?"white":"#1e293b",fontSize:"14px",fontWeight:Te?"600":"500",cursor:"pointer",textAlign:"left",transition:"all 0.2s ease",boxShadow:Te?"0 2px 8px rgba(245, 158, 11, 0.3)":"0 1px 4px rgba(0,0,0,0.05)",display:"flex",alignItems:"flex-start",gap:"10px"},children:[i.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"4px",border:Te?"none":"2px solid #cbd5e1",background:Te?"white":"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginTop:"2px"},children:Te&&i.jsx("span",{style:{color:"#F59E0B",fontSize:"14px",fontWeight:"bold"},children:""})}),i.jsxs("div",{children:[i.jsx("div",{style:{marginBottom:"4px"},children:ie.question}),ie.category&&i.jsx("span",{style:{fontSize:"11px",padding:"2px 8px",borderRadius:"10px",background:Te?"rgba(255,255,255,0.3)":"#FEF3C7",color:Te?"white":"#92400E"},children:ie.category})]})]},ie.id)})}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:ht,style:{flex:1,padding:"12px",borderRadius:"12px",border:"2px solid #e2e8f0",background:"white",color:"#64748b",fontSize:"13px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease"},children:((an=b.skipOption)==null?void 0:an.label)||""}),i.jsx("button",{onClick:ye,disabled:J.length===0,style:{flex:2,padding:"12px",borderRadius:"12px",border:"none",background:J.length>0?"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)":"#e2e8f0",color:J.length>0?"white":"#94a3b8",fontSize:"13px",fontWeight:"700",cursor:J.length>0?"pointer":"not-allowed",transition:"all 0.2s ease",boxShadow:J.length>0?"0 4px 12px rgba(245, 158, 11, 0.3)":"none"},children:J.length>0?`  ${J.length} `:" "})]})]}),i.jsx("div",{ref:P})]}),!h&&!ce&&!L&&i.jsxs("div",{style:{marginTop:"auto"},children:[R&&i.jsxs("div",{style:{padding:"12px 16px",background:"#f8fafc",borderTop:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[i.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#3b82f6",animation:"pulse 1.5s infinite"}}),i.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:"AI  ..."})]}),i.jsx("div",{style:{background:"linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%)",padding:"14px 20px",textAlign:"center"},children:i.jsx("span",{style:{color:"white",fontSize:"14px",fontWeight:"600"},children:" AI    ."})})]}),h&&_&&i.jsxs("div",{className:"diagnosis-result-redesign",style:{minHeight:"100vh",background:"#f8fafc",display:"flex",flexDirection:"column"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",background:"white",borderBottom:"1px solid #e2e8f0"},children:[i.jsx("button",{onClick:()=>s("home"),style:{display:"flex",alignItems:"center",gap:"8px",color:"#0891b2",fontWeight:"600",fontSize:"15px",background:"none",border:"none",cursor:"pointer"},children:" "}),i.jsx("button",{onClick:()=>s("home"),style:{color:"#9ca3af",background:"none",border:"none",cursor:"pointer",fontSize:"24px",lineHeight:1},children:""})]}),i.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px",paddingBottom:"180px"},children:[i.jsxs("div",{style:{background:"linear-gradient(135deg, #22d3ee 0%, #06b6d4 100%)",borderRadius:"16px",padding:"20px",marginBottom:"16px",color:"white",boxShadow:"0 4px 12px rgba(6, 182, 212, 0.3)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[i.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"rgba(255,255,255,0.3)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px"},children:"!"}),i.jsx("span",{style:{fontSize:"14px",fontWeight:"600"},children:" "})]}),i.jsx("h2",{style:{fontSize:"24px",fontWeight:"bold",margin:"0 0 8px 0",lineHeight:"1.3"},children:typeof _.diagnosis=="string"?_.diagnosis:((jt=_.diagnosis)==null?void 0:jt.name)||" "}),i.jsx("p",{style:{fontSize:"13px",opacity:.9,margin:0},children:"AI     "})]}),_.description&&i.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"bold",color:"#1e293b",margin:"0 0 16px 0",display:"flex",alignItems:"center",gap:"8px"},children:"  "}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:_.description.split(/[.!?]\s+/).filter(ie=>ie.trim()).map((ie,Te)=>i.jsxs("p",{style:{fontSize:"14px",color:"#475569",lineHeight:"1.6",background:"#f8fafc",padding:"14px 16px",borderRadius:"12px",margin:0,borderLeft:"3px solid #e2e8f0"},children:[ie.trim(),ie.trim().match(/[.!?]$/)?"":"."]},Te))})]}),_.actions&&_.actions.length>0&&i.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},children:[i.jsxs("h3",{style:{fontSize:"16px",fontWeight:"bold",color:"#1e293b",margin:"0 0 16px 0",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{width:"22px",height:"22px",borderRadius:"50%",background:"#22d3ee",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx("span",{style:{color:"white",fontSize:"14px"},children:""})})," "]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:_.actions.map((ie,Te)=>i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",background:"linear-gradient(135deg, #ecfeff 0%, #f0f9ff 100%)",padding:"16px",borderRadius:"12px",border:"1px solid #a5f3fc"},children:[i.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"linear-gradient(135deg, #22d3ee, #06b6d4)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:Te+1}),i.jsx("p",{style:{fontSize:"14px",color:"#334155",lineHeight:"1.5",margin:0,flex:1},children:typeof ie=="string"?ie:(ie==null?void 0:ie.title)||(ie==null?void 0:ie.description)||(ie==null?void 0:ie.name)||""})]},Te))})]}),i.jsx("div",{style:{background:"linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%)",borderRadius:"16px",padding:"20px",marginBottom:"16px",border:"2px solid #fbbf24",boxShadow:"0 2px 8px rgba(251, 191, 36, 0.2)"},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"14px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#f97316",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx("span",{style:{color:"white",fontSize:"20px"},children:"!"})}),i.jsxs("div",{style:{flex:1},children:[i.jsx("h4",{style:{fontSize:"14px",fontWeight:"bold",color:"#9a3412",margin:"0 0 8px 0"},children:"  "}),i.jsx("p",{style:{fontSize:"13px",color:"#c2410c",lineHeight:"1.6",margin:0},children:"  AI  .          ."})]})]})}),i.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"6px"},children:[i.jsx("span",{style:{color:"#06b6d4",fontSize:"16px"},children:""}),i.jsx("span",{style:{fontSize:"15px",fontWeight:"600",color:"#475569"},children:"PetMedical.AI"})]}),i.jsx("p",{style:{fontSize:"12px",color:"#9ca3af",margin:0},children:"    "})]})]}),i.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,padding:"16px",background:"rgba(255, 255, 255, 0.97)",backdropFilter:"blur(8px)",borderTop:"1px solid #e2e8f0",zIndex:100},children:i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",maxWidth:"500px",margin:"0 auto"},children:[i.jsx("button",{onClick:()=>s("treatment"),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"14px 16px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg, #f87171 0%, #ef4444 100%)",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(239, 68, 68, 0.3)"},children:"  "}),i.jsx("button",{onClick:()=>s("hospital"),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"14px 16px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg, #22d3ee 0%, #06b6d4 100%)",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(6, 182, 212, 0.3)"},children:"  "}),i.jsx("button",{onClick:()=>C(!0),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"14px 16px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(245, 158, 11, 0.3)"},children:"  "}),i.jsx("button",{onClick:()=>s("home"),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"14px 16px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg, #64748b 0%, #475569 100%)",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(71, 85, 105, 0.3)"},children:" "})]})})]}),E&&_&&i.jsx(qg,{petData:t,diagnosisResult:_,symptomData:e,onClose:()=>C(!1),onGoToHospital:()=>{C(!1),s("hospital")},onGoToTreatment:()=>{C(!1),s("treatment")}})]})}function eO({petData:t,diagnosisResult:e,symptomData:s,onGoToTreatment:n,onGoToHospital:r,onBack:a}){var c;const[o,l]=O.useState(!1);return i.jsxs("div",{style:{minHeight:"100vh",background:"#f8fafc",display:"flex",flexDirection:"column"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",background:"white",borderBottom:"1px solid #e2e8f0"},children:[i.jsx("button",{onClick:a,style:{display:"flex",alignItems:"center",gap:"8px",color:"#0891b2",fontWeight:"600",fontSize:"15px",background:"none",border:"none",cursor:"pointer"},children:" "}),i.jsx("button",{onClick:a,style:{color:"#9ca3af",background:"none",border:"none",cursor:"pointer",fontSize:"24px",lineHeight:1},children:""})]}),i.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px",paddingBottom:"180px"},children:[i.jsxs("div",{style:{background:"linear-gradient(135deg, #22d3ee 0%, #06b6d4 100%)",borderRadius:"16px",padding:"20px",marginBottom:"16px",color:"white",boxShadow:"0 4px 12px rgba(6, 182, 212, 0.3)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[i.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"rgba(255,255,255,0.3)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px"},children:"!"}),i.jsx("span",{style:{fontSize:"14px",fontWeight:"600"},children:" "})]}),i.jsx("h2",{style:{fontSize:"24px",fontWeight:"bold",margin:"0 0 8px 0",lineHeight:"1.3"},children:typeof(e==null?void 0:e.diagnosis)=="string"?e.diagnosis:((c=e==null?void 0:e.diagnosis)==null?void 0:c.name)||" "}),i.jsx("p",{style:{fontSize:"13px",opacity:.9,margin:0},children:"AI     "})]}),(e==null?void 0:e.description)&&i.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"bold",color:"#1e293b",margin:"0 0 16px 0",display:"flex",alignItems:"center",gap:"8px"},children:"  "}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:e.description.split(/[.!?]\s+/).filter(u=>u.trim()).map((u,h)=>i.jsxs("p",{style:{fontSize:"14px",color:"#475569",lineHeight:"1.6",background:"#f8fafc",padding:"14px 16px",borderRadius:"12px",margin:0,borderLeft:"3px solid #e2e8f0"},children:[u.trim(),u.trim().match(/[.!?]$/)?"":"."]},h))})]}),(e==null?void 0:e.actions)&&e.actions.length>0&&i.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},children:[i.jsxs("h3",{style:{fontSize:"16px",fontWeight:"bold",color:"#1e293b",margin:"0 0 16px 0",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{width:"22px",height:"22px",borderRadius:"50%",background:"#22d3ee",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx("span",{style:{color:"white",fontSize:"14px"},children:""})})," "]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:e.actions.map((u,h)=>i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",background:"linear-gradient(135deg, #ecfeff 0%, #f0f9ff 100%)",padding:"16px",borderRadius:"12px",border:"1px solid #a5f3fc"},children:[i.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"linear-gradient(135deg, #22d3ee, #06b6d4)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:h+1}),i.jsx("p",{style:{fontSize:"14px",color:"#334155",lineHeight:"1.5",margin:0,flex:1},children:typeof u=="string"?u:(u==null?void 0:u.title)||(u==null?void 0:u.description)||(u==null?void 0:u.name)||""})]},h))})]}),i.jsx("div",{style:{background:"linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%)",borderRadius:"16px",padding:"20px",marginBottom:"16px",border:"2px solid #fbbf24",boxShadow:"0 2px 8px rgba(251, 191, 36, 0.2)"},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"14px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#f97316",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx("span",{style:{color:"white",fontSize:"20px"},children:"!"})}),i.jsxs("div",{style:{flex:1},children:[i.jsx("h4",{style:{fontSize:"14px",fontWeight:"bold",color:"#9a3412",margin:"0 0 8px 0"},children:"  "}),i.jsx("p",{style:{fontSize:"13px",color:"#c2410c",lineHeight:"1.6",margin:0},children:"  AI  .          ."})]})]})}),i.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"6px"},children:[i.jsx("span",{style:{color:"#06b6d4",fontSize:"16px"},children:""}),i.jsx("span",{style:{fontSize:"15px",fontWeight:"600",color:"#475569"},children:"PetMedical.AI"})]}),i.jsx("p",{style:{fontSize:"12px",color:"#9ca3af",margin:0},children:"    "})]})]}),i.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,padding:"16px",background:"rgba(255, 255, 255, 0.97)",backdropFilter:"blur(8px)",borderTop:"1px solid #e2e8f0",zIndex:100},children:i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",maxWidth:"500px",margin:"0 auto"},children:[i.jsx("button",{onClick:n,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"14px 16px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg, #f87171 0%, #ef4444 100%)",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(239, 68, 68, 0.3)"},children:"  "}),i.jsx("button",{onClick:r,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"14px 16px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg, #22d3ee 0%, #06b6d4 100%)",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(6, 182, 212, 0.3)"},children:"  "}),i.jsx("button",{onClick:()=>l(!0),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"14px 16px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(245, 158, 11, 0.3)"},children:"  "}),i.jsx("button",{onClick:a,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"14px 16px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg, #64748b 0%, #475569 100%)",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(71, 85, 105, 0.3)"},children:" "})]})}),o&&i.jsx(qg,{petData:t,diagnosisResult:e,symptomData:s,onClose:()=>l(!1),onGoToHospital:()=>{l(!1),r()},onGoToTreatment:()=>{l(!1),n()}})]})}function tO({petData:t,diagnosisResult:e,onBack:s,onGoToHospital:n}){var k;const r=`petMedical_checklist_${(t==null?void 0:t.id)||"default"}_${new Date().toISOString().split("T")[0]}`,a=[{id:"observe",label:"   ",checked:!1},{id:"water",label:"  ",checked:!1},{id:"appetite",label:"  ",checked:!1},{id:"stool",label:"  ",checked:!1},{id:"activity",label:" ",checked:!1}],[o,l]=O.useState(()=>a),[c,u]=O.useState(""),h=x=>{l(A=>{const M=A.map(D=>D.id===x?{...D,checked:!D.checked}:D);try{localStorage.setItem(r,JSON.stringify(M))}catch(D){console.error("  :",D)}return M})},m=()=>{n&&n()},f=o.filter(x=>x.checked).length,y=o.length,S=(()=>{if(!e)return[{step:1,title:" ",description:"   ."},{step:2,title:" ",description:"   ."},{step:3,title:" ",description:"   ."}];const x=e.emergency,A=[{step:1,title:" ",description:e.actions[0]||" "},{step:2,title:" ",description:"   ."},{step:3,title:"  ",description:"    ."}];return x==="low"?[...A,{step:4,title:" ",description:"24-48   ."},{step:5,title:" ",description:"     ."}]:[...A,{step:4,title:"",description:"    ."},{step:5,title:" ",description:" ,  ,  /    ."}]})(),R=(e==null?void 0:e.emergency)==="low"?"3-5":(e==null?void 0:e.emergency)==="medium"?"5-7":"   ";return i.jsxs("div",{style:{minHeight:"100vh",background:"#f8fafc",display:"flex",flexDirection:"column"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",background:"white",borderBottom:"1px solid #e2e8f0"},children:[i.jsx("button",{onClick:s,style:{display:"flex",alignItems:"center",gap:"8px",color:"#0891b2",fontWeight:"600",fontSize:"15px",background:"none",border:"none",cursor:"pointer"},children:" "}),i.jsx("button",{onClick:s,style:{color:"#9ca3af",background:"none",border:"none",cursor:"pointer",fontSize:"24px",lineHeight:1},children:""})]}),i.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px",paddingBottom:"100px"},children:[i.jsx("div",{style:{background:"linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)",borderRadius:"16px",padding:"20px",marginBottom:"16px",color:"white",boxShadow:"0 4px 12px rgba(14, 165, 233, 0.3)"},children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[i.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",background:"white",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:i.jsx("img",{src:Ls[t==null?void 0:t.species]||Ls.dog,alt:(t==null?void 0:t.species)||"pet",style:{width:"48px",height:"48px",objectFit:"contain"}})}),i.jsxs("h2",{style:{fontSize:"20px",fontWeight:"bold",margin:"0 0 4px 0",lineHeight:"1.3"},children:[(t==null?void 0:t.petName)||(t==null?void 0:t.name)||"","  "]}),e&&i.jsx("p",{style:{fontSize:"13px",opacity:.9,margin:0},children:typeof e.diagnosis=="string"?e.diagnosis:((k=e.diagnosis)==null?void 0:k.name)||""})]})}),i.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},children:[i.jsxs("h3",{style:{fontSize:"16px",fontWeight:"bold",color:"#1e293b",margin:"0 0 16px 0",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{width:"22px",height:"22px",borderRadius:"50%",background:"#0ea5e9",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx("span",{style:{color:"white",fontSize:"12px"},children:""})}),"  "]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:S.map((x,A)=>i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",background:"linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%)",padding:"14px",borderRadius:"12px",border:"1px solid #7dd3fc"},children:[i.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"linear-gradient(135deg, #0ea5e9, #0284c7)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:x.step}),i.jsxs("div",{style:{flex:1},children:[i.jsx("h4",{style:{fontSize:"14px",fontWeight:"600",color:"#0369a1",margin:"0 0 4px 0"},children:x.title}),i.jsx("p",{style:{fontSize:"13px",color:"#475569",lineHeight:"1.5",margin:0},children:x.description})]})]},A))})]}),e&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.06)",textAlign:"center"},children:[i.jsx("h3",{style:{fontSize:"14px",fontWeight:"600",color:"#64748b",margin:"0 0 8px 0"},children:"  "}),i.jsx("p",{style:{fontSize:"28px",fontWeight:"bold",color:"#0ea5e9",margin:0},children:R})]}),i.jsx("div",{style:{background:"linear-gradient(135deg, #fef9c3 0%, #fef08a 100%)",borderRadius:"16px",padding:"16px",marginBottom:"16px",border:"2px solid #facc15",boxShadow:"0 2px 8px rgba(250, 204, 21, 0.2)"},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"#eab308",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx("span",{style:{color:"white",fontSize:"16px"},children:"!"})}),i.jsxs("div",{style:{flex:1},children:[i.jsx("h4",{style:{fontSize:"14px",fontWeight:"bold",color:"#a16207",margin:"0 0 8px 0"},children:""}),i.jsxs("div",{style:{margin:0,display:"flex",flexDirection:"column",gap:"6px"},children:[i.jsx("p",{style:{fontSize:"13px",color:"#854d0e",lineHeight:"1.5",margin:0},children:"       ."}),i.jsx("p",{style:{fontSize:"13px",color:"#854d0e",lineHeight:"1.5",margin:0},children:"     ."}),i.jsx("p",{style:{fontSize:"13px",color:"#854d0e",lineHeight:"1.5",margin:0},children:" ( ,  ,   )   ."})]})]})]})}),i.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"bold",color:"#1e293b",margin:0},children:" "}),i.jsxs("span",{style:{fontSize:"14px",fontWeight:"600",color:"#0ea5e9"},children:[f,"/",y," "]})]}),i.jsx("div",{style:{width:"100%",height:"8px",background:"#e2e8f0",borderRadius:"4px",marginBottom:"16px",overflow:"hidden"},children:i.jsx("div",{style:{width:`${f/y*100}%`,height:"100%",background:"linear-gradient(90deg, #0ea5e9, #0284c7)",borderRadius:"4px",transition:"width 0.3s ease"}})}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:o.map(x=>i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:x.checked?"#e0f2fe":"#f8fafc",borderRadius:"10px",cursor:"pointer",border:x.checked?"1px solid #7dd3fc":"1px solid #e2e8f0",transition:"all 0.2s"},children:[i.jsx("div",{style:{width:"22px",height:"22px",borderRadius:"6px",border:x.checked?"none":"2px solid #cbd5e1",background:x.checked?"linear-gradient(135deg, #0ea5e9, #0284c7)":"white",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:x.checked&&i.jsx("span",{style:{color:"white",fontSize:"14px",fontWeight:"bold"},children:""})}),i.jsx("input",{type:"checkbox",checked:x.checked,onChange:()=>h(x.id),style:{display:"none"}}),i.jsx("span",{style:{fontSize:"14px",color:x.checked?"#0369a1":"#475569",textDecoration:x.checked?"line-through":"none",flex:1},children:x.label})]},x.id))}),c&&i.jsx("div",{style:{marginTop:"12px",padding:"10px",background:"#e0f2fe",borderRadius:"8px",textAlign:"center",fontSize:"13px",color:"#0ea5e9",fontWeight:"500"},children:c}),i.jsx("p",{style:{fontSize:"12px",color:"#9ca3af",textAlign:"center",margin:"12px 0 0 0"},children:"   "})]})]}),i.jsxs("div",{style:{textAlign:"center",padding:"16px 0"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"4px"},children:[i.jsx("img",{src:"/ai-factory/icon/login/logo.png",alt:"PetMedical.AI",style:{width:"24px",height:"24px",objectFit:"contain"}}),i.jsx("span",{style:{fontSize:"15px",fontWeight:"600",color:"#475569"},children:"PetMedical.AI"})]}),i.jsx("p",{style:{fontSize:"12px",color:"#9ca3af",margin:0},children:"    "})]})]}),i.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,padding:"16px",background:"rgba(255, 255, 255, 0.97)",backdropFilter:"blur(8px)",borderTop:"1px solid #e2e8f0",zIndex:100},children:i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",maxWidth:"500px",margin:"0 auto"},children:[i.jsx("button",{onClick:s,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"14px 16px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg, #64748b 0%, #475569 100%)",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(71, 85, 105, 0.3)"},children:"  "}),i.jsx("button",{onClick:m,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"14px 16px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(14, 165, 233, 0.3)"},children:"  "})]})})]})}function sO(){const[t,e]=O.useState("login"),[s,n]=O.useState(null),[r,a]=O.useState("guardian"),[o,l]=O.useState(!1),[c,u]=O.useState("care"),[h,m]=O.useState(null),[f,y]=O.useState(null),[_,S]=O.useState("ai"),[R,k]=O.useState([]),[x,A]=O.useState(null),[M,D]=O.useState(null),[B,v]=O.useState(null),[N,w]=O.useState(null),E=I=>{if(a(I),m(null),u("care"),localStorage.setItem("petMedical_userMode",I),s){const L={...s,userMode:I};n(L)}},C=()=>{m(null),u("care")};O.useEffect(()=>{u("care"),window.auth=kn,window.seedGuardianData=async(I,L)=>{try{const W=await Ov(I,L);return console.log("  :",W),W}catch(W){throw console.error("  :",W),W}},window.seedClinicData=async(I,L)=>{try{const W=await X6(I,L);return console.log("  :",W),W}catch(W){throw console.error("  :",W),W}},console.log("     ."),console.log("   : const user = window.auth.currentUser; await window.seedGuardianData(user.uid, user.email);")},[]);const P=async I=>{let L=I.userMode||"guardian",W=!1;if(I.roles&&I.roles.length>0||I.defaultClinicId)try{const V=await Ci(I.uid);W=V&&V.length>0,W?L="clinic":console.warn(":  roles     . guardian  .")}catch(V){console.error("   :",V),W=!1}l(W),n(I),a(L),e(null),m(null),u("care"),localStorage.setItem("petMedical_userMode",L);let b=[];try{const V=await Wo.getPetsByUser(I.uid);V.success&&V.data&&V.data.length>0?(b=V.data,Ko(I.uid,b),console.log(` Firestore ${b.length}   `)):b=ga(I.uid)}catch(V){console.warn("   , localStorage :",V),b=ga(I.uid)}k(b),b.length>0?y(b[0]):y(null);try{await Of(I.uid),console.log("    ")}catch(V){console.warn("   :",V)}vj(V=>{var J,z,q,ae,je;console.log("   :",V),"Notification"in window&&Notification.permission==="granted"&&new Notification(((J=V.notification)==null?void 0:J.title)||((z=V.data)==null?void 0:z.title)||"",{body:((q=V.notification)==null?void 0:q.body)||((ae=V.data)==null?void 0:ae.body)||"",icon:Ls.dog,tag:((je=V.data)==null?void 0:je.type)||"notification",data:V.data||{}})})},j=async I=>{let L=I.userMode||"guardian",W=!1;if(I.roles&&I.roles.length>0||I.defaultClinicId)try{const b=await Ci(I.uid);W=b&&b.length>0,W?L="clinic":console.warn(":  roles     . guardian  .")}catch(b){console.error("   :",b),W=!1}l(W),n(I),a(L),e(null),k([]),y(null)},re=()=>{E6(),localStorage.removeItem("petMedical_userMode"),n(null),a("guardian"),l(!1),k([]),y(null),e("login")},Z=async(I="guardian")=>{const L={guardian:{email:"guardian@test.com",password:"test1234",displayName:" "},clinic:{email:"clinic@happyvet.com",password:"test1234",displayName:" "}},W=L[I]||L.guardian;try{const b=await Pr.login(W.email,W.password);if(b.success){const V=b.user;let J=V.userMode||I,z=!1;if(V.roles&&V.roles.length>0||V.defaultClinicId)try{const ae=await Ci(V.uid);z=ae&&ae.length>0,z?J="clinic":console.warn(" :  roles     . guardian  .")}catch(ae){console.error("   :",ae),z=!1}l(z),n(V),a(J),e(null),m(null),u("care"),localStorage.setItem("petMedical_userMode",J);let q=[];try{const ae=await Wo.getPetsByUser(V.uid);if(ae.success&&ae.data&&ae.data.length>0)q=ae.data,Ko(V.uid,q),console.log(` Firestore ${q.length}   `);else if(q=ga(V.uid),J==="guardian"&&q.length===0)try{const je=await Wo.getPetsByUser(V.uid);if(je.success&&je.data&&je.data.length>0)console.log(` Firestore ${je.data.length}  ,    `),q=je.data,Ko(V.uid,q);else{console.log("   :     ..."),await Ov(V.uid,V.email);const Ve=await Wo.getPetsByUser(V.uid);Ve.success&&Ve.data&&Ve.data.length>0&&(q=Ve.data,Ko(V.uid,q),console.log(`    : ${q.length} `))}}catch(je){console.warn("   :",je)}}catch(ae){console.warn("   , localStorage :",ae),q=ga(V.uid)}k(q),q.length>0?y(q[0]):y(null);try{await Of(V.uid),console.log("    ")}catch(ae){console.warn("   :",ae)}}else{console.warn("   ,   :",b.error);const V={uid:`guest_${I}_${Date.now()}`,email:"guest@test.com",displayName:W.displayName,userMode:I};n(V),a(I),e(null),m(null),u("care")}}catch(b){console.error("   :",b);const V={uid:`guest_${I}_${Date.now()}`,email:"guest@test.com",displayName:W.displayName,userMode:I};n(V),a(I),e(null)}};if(t==="login")return i.jsx(T6,{onLogin:P,onGoToRegister:()=>e("register"),onSkipLogin:Z});if(t==="register")return i.jsx(A6,{onRegister:j,onGoToLogin:()=>e("login")});const le=I=>{if(s!=null&&s.uid){const L=ga(s.uid);k(L)}y(I),m(null),u("care")},ce=I=>{if(y(I),m(null),u("care"),I!=null&&I.id)try{const L=localStorage.getItem(uu);if(L){const b=JSON.parse(L).filter(V=>V.petId===I.id).sort((V,J)=>new Date(J.created_at||J.createdAt)-new Date(V.created_at||V.createdAt));b.length>0&&D(b[0])}}catch(L){console.error("   :",L)}},F=I=>{A(I),m("diagnosis"),u(null)},Q=(I,L)=>{L&&D(L),I==="treatment"?m("treatment"):I==="hospital"?(u("hospital"),m(null)):(m(null),u("care"))},K=I=>{m(null),I==="diagnosis"?(m("symptom-input"),u(null)):u(I)};return i.jsxs("div",{className:"App app-root",children:[i.jsx(U3,{variant:"default"}),r==="clinic"&&!h&&s&&i.jsx(sM,{currentUser:s,onBack:()=>{E("guardian")},onLogout:()=>{re()},onModeSwitch:()=>E("guardian"),onHome:C}),(r==="guardian"||h)&&i.jsxs(i.Fragment,{children:[h==="registration"&&i.jsx(GM,{onComplete:le,userId:s==null?void 0:s.uid}),h==="profile-list"&&i.jsx(QM,{pets:R,onSelectPet:ce,onAddNew:()=>m("registration"),onNavigate:I=>m(I)}),h==="symptom-input"&&i.jsx(YM,{petData:f,onComplete:F,onBack:()=>{m(null),u("care")},onRegister:()=>m("registration")}),h==="diagnosis"&&f&&x&&i.jsx(ZM,{petData:f,symptomData:x,currentUser:s,onComplete:I=>Q(I,M),onBack:()=>m("symptom-input"),onDiagnosisResult:I=>D(I)}),h==="treatment"&&f&&i.jsx(tO,{petData:f,diagnosisResult:M,onBack:()=>m("diagnosis-result"),onGoToHospital:()=>{m(null),u("hospital")}}),h==="diagnosis-result"&&f&&M&&i.jsx(eO,{petData:f,diagnosisResult:M,symptomData:x,onGoToTreatment:()=>m("treatment"),onGoToHospital:()=>{u("hospital"),m(null)},onBack:()=>{m(null),u("care")}}),h==="hospital"&&f&&i.jsx(Tv,{petData:f,diagnosis:M||null,symptomData:x||null,currentUser:s,onBack:()=>{m(null),u("care")},onHome:C,onGoToMyBookings:()=>{m(null),u("mypage"),localStorage.setItem("mypage_initialTab","bookings"),setTimeout(()=>{const I=new CustomEvent("mypage-set-tab",{detail:"bookings"});window.dispatchEvent(I)},100)},onSelectHospital:async I=>{if(v(I),M)try{const L=await Mf(f,M,x);w(L),m("hospital-review")}catch(L){console.error("  :",L)}}}),h==="hospital-review"&&f&&M&&B&&N&&i.jsx(i6,{petData:f,diagnosis:M,hospital:B,hospitalPacket:N,onBack:()=>m("hospital"),onEdit:()=>m("hospital"),onSend:I=>{console.log(" :",I),m("hospital-sent")},onSave:I=>{console.log(" :",I),m(null),u("care")}}),h==="hospital-sent"&&f&&B&&i.jsx(o6,{petData:f,hospital:B,bookingDate:B.bookingDate,bookingTime:B.bookingTime,onBack:()=>{m(null),u("care"),v(null),w(null)},onHome:()=>{m(null),u("care"),v(null),w(null)},onGetDirections:()=>{const I=`https://map.kakao.com/link/to/${B.name},${B.lat},${B.lng}`;window.open(I,"_blank")}}),h==="mypage"&&i.jsx(Iv,{selectedPet:f,currentUser:s,onBack:()=>{m(null),u("care")},onHome:C,onSelectPet:I=>{y(I),m(null),u("care")},onViewDiagnosis:I=>{D(I),I.source==="clinic"?S("clinic"):S("ai");const L=I.pet||R.find(W=>W.id===I.petId);L&&y(L),m("diagnosis-view")},onClinicMode:()=>m("clinic-admin"),userId:s==null?void 0:s.uid,onPetsUpdate:I=>{if(k(I),f!=null&&f.id){const L=I.find(W=>W.id===f.id);L&&y(L)}}}),h==="diagnosis-view"&&f&&M&&i.jsx(qg,{petData:f,diagnosisResult:M,symptomData:x,userData:s,mode:_,onClose:()=>m("mypage"),onGoToHospital:()=>{A({symptomText:M.symptom||M.description}),u("hospital"),m(null)},onGoToTreatment:()=>{u("care"),m(null)}}),!1,h==="history"&&i.jsxs("div",{className:"history-container",children:[i.jsx("button",{className:"back-btn",onClick:()=>{m(null),u("care")},children:" "}),i.jsx("h1",{children:"  "}),i.jsx("div",{className:"history-content",children:i.jsx("p",{children:"   ."})})]}),h==="ocr"&&i.jsx(V6,{petData:f,onBack:()=>m(null),onSaveRecord:I=>{console.log("  :",I)}}),h==="ai-consultation"&&f&&i.jsx(rM,{petData:f,onBack:()=>{m(null),u("care")},onHome:C}),h==="clinic-admin"&&i.jsx(U6,{onBack:()=>{m(null),u("care")},onLogout:()=>{m(null),u("care")},onModeSwitch:()=>E("guardian"),onHome:C}),r==="guardian"&&!h&&c&&i.jsxs("div",{className:"main-content",style:{paddingBottom:"80px"},children:[c==="care"&&f&&i.jsx(JM,{petData:f,pets:R,onNavigate:I=>{I==="hospital"||I==="records"?u(I):m(I)},onSelectPet:ce,onLogout:re}),c==="hospital"&&(f?i.jsx(Tv,{petData:f,diagnosis:M||null,symptomData:x||null,currentUser:s,onBack:()=>u("care"),onHome:C,onGoToMyBookings:()=>{u("mypage"),localStorage.setItem("mypage_initialTab","bookings"),setTimeout(()=>{const I=new CustomEvent("mypage-set-tab",{detail:"bookings"});window.dispatchEvent(I)},100)},onSelectHospital:async I=>{if(v(I),M)try{const L=await Mf(f,M,x);w(L),m("hospital-review")}catch(L){console.error("  :",L)}}}):i.jsx("div",{className:"min-h-screen bg-background-light flex items-center justify-center p-4",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-24 h-24 mx-auto mb-4 rounded-full overflow-hidden",children:i.jsx("img",{src:Rr.other,alt:"Pet",className:"w-full h-full object-cover"})}),i.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:" "}),i.jsx("button",{onClick:()=>m("registration"),className:"mt-4 bg-primary text-white px-6 py-3 rounded-lg font-bold hover:bg-primary/90 transition-colors",children:" "})]})})),c==="records"&&f&&i.jsx(p6,{petData:f,pets:R,onBack:()=>u("care"),onHome:C,onViewDiagnosis:I=>{D(I),m("diagnosis-view")},onOCR:()=>m("ocr"),onHospitalBooking:()=>u("hospital"),onSelectPet:ce}),c==="mypage"&&i.jsx(Iv,{selectedPet:f,currentUser:s,onBack:()=>u("care"),onHome:C,onAddPet:()=>m("registration"),onSelectPet:I=>{y(I),u("care")},onViewDiagnosis:I=>{D(I),localStorage.setItem("mypage_initialTab","records"),m("diagnosis-view-from-tab")},onClinicMode:()=>m("clinic-admin"),userId:s==null?void 0:s.uid,onPetsUpdate:I=>{if(k(I),f!=null&&f.id){const L=I.find(W=>W.id===f.id);L&&y(L)}}}),!f&&c==="care"&&i.jsx("div",{className:"page-container",children:i.jsxs("div",{className:"px-4 pt-8 pb-24",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"w-24 h-24 mx-auto mb-4 rounded-full overflow-hidden",children:i.jsx("img",{src:Rr.other,alt:"Pet",className:"w-full h-full object-cover"})}),i.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"!"}),i.jsx("p",{className:"text-slate-600",children:"  AI   "})]}),i.jsxs("div",{className:"space-y-4 mb-8",children:[i.jsx("div",{className:"bg-surface-light p-4 rounded-lg shadow-soft border border-slate-200",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-full flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-primary",children:"smart_toy"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold text-slate-900",children:"AI  "}),i.jsx("p",{className:"text-sm text-slate-600",children:"  AI "})]})]})}),i.jsx("div",{className:"bg-surface-light p-4 rounded-lg shadow-soft border border-slate-200",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-full flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-accent",children:"local_hospital"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold text-slate-900",children:" "}),i.jsx("p",{className:"text-sm text-slate-600",children:"    "})]})]})}),i.jsx("div",{className:"bg-surface-light p-4 rounded-lg shadow-soft border border-slate-200",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 bg-secondary/20 rounded-full flex items-center justify-center",children:i.jsx("span",{className:"material-symbols-outlined text-secondary",children:"monitor_heart"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold text-slate-900",children:" "}),i.jsx("p",{className:"text-sm text-slate-600",children:"     "})]})]})})]}),i.jsx("button",{onClick:()=>m("registration"),className:"w-full bg-primary text-white px-6 py-4 rounded-xl font-bold hover:bg-primary/90 transition-colors shadow-lg shadow-primary/30",children:" "})]})}),!f&&c&&c!=="care"&&i.jsx("div",{className:"page-container flex items-center justify-center",children:i.jsxs("div",{className:"text-center p-4",children:[i.jsx("div",{className:"text-5xl mb-4",children:""}),i.jsx("h2",{className:"text-lg font-bold text-slate-900 mb-2",children:"  "}),i.jsx("button",{onClick:()=>m("registration"),className:"mt-4 bg-primary text-white px-6 py-3 rounded-xl font-bold hover:bg-primary/90 transition-colors",children:" "})]})})]}),r==="guardian"&&c&&i.jsx(y6,{currentTab:c,onTabChange:K,onModeSwitch:()=>E("clinic"),showModeSwitch:!!s,hideInDiagnosis:!1})]})]})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{const e="/ai-factory/firebase-messaging-sw.js";fetch(e,{method:"HEAD"}).then(s=>s.ok?navigator.serviceWorker.register(e):Promise.reject(new Error("Service Worker  "))).then(s=>{console.log(" Service Worker  :",s.scope)}).catch(s=>{var n,r,a;(n=s.message)!=null&&n.includes("404")||(r=s.message)!=null&&r.includes("bad HTTP response code")||(a=s.message)!=null&&a.includes("Service Worker  ")||console.error(" Service Worker  :",s)})});um.createRoot(document.getElementById("root")).render(i.jsx(u2.StrictMode,{children:i.jsx(sO,{})}));
